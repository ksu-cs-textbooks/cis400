




	
	
		

	
	
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		
		

	
	
		

	
	
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		
		

	
	
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		
		

	
	
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		
		

	
	
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		
		

	
	
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		
		

	
	
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		
		

	
	
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		
		
		

	
	
		

	
	
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		
		

	
	
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		
		

	
	
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		
		

	
	
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		
		

	
	
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		
		

	
	
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		
		
		

	
	
		

	
	
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		
		

	
	
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		
		

	
	
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		
		

	
	
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		
		

	
	
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		
		

	
	
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		
		
		

	
	
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		
		

	
	
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		
<!DOCTYPE html>
<html lang="en" dir="ltr">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="height=device-height, width=device-width, initial-scale=1.0, minimum-scale=1.0">
    <meta name="generator" content="Hugo 0.117.0">
    <meta name="generator" content="Relearn 5.18.0">
    <meta name="description" content="K-State CIS 400 Textbook">
    <meta name="author" content="Nathan Bean">
    <title>PropertyChanged :: K-State CIS 400 Textbook</title>
    <link href="https://ksu-cs-textbooks.github.io/cis400/2-desktop-development/03-events/06-property-changed/index.html" rel="canonical" type="text/html" title="PropertyChanged :: K-State CIS 400 Textbook">
    <link href="https://ksu-cs-textbooks.github.io/cis400/2-desktop-development/03-events/06-property-changed/index.xml" rel="alternate" type="application/rss+xml" title="PropertyChanged :: K-State CIS 400 Textbook">
    <link href="https://ksu-cs-textbooks.github.io/cis400/2-desktop-development/03-events/06-property-changed/tele.html" rel="alternate" type="text/html" title="PropertyChanged :: K-State CIS 400 Textbook">
    <link href="https://ksu-cs-textbooks.github.io/cis400/2-desktop-development/03-events/06-property-changed/embed.html" rel="alternate" type="text/html" title="PropertyChanged :: K-State CIS 400 Textbook">
    <!-- https://github.com/filamentgroup/loadCSS/blob/master/README.md#how-to-use -->
    <link href="https://ksu-cs-textbooks.github.io/cis400/css/fontawesome-all.min.css?1697829858" rel="stylesheet" media="print" onload="this.media='all';this.onload=null;"><noscript><link href="https://ksu-cs-textbooks.github.io/cis400/css/fontawesome-all.min.css?1697829858" rel="stylesheet"></noscript>
    <link href="https://ksu-cs-textbooks.github.io/cis400/css/nucleus.css?1697829858" rel="stylesheet">
    <link href="https://ksu-cs-textbooks.github.io/cis400/css/auto-complete.css?1697829858" rel="stylesheet" media="print" onload="this.media='all';this.onload=null;"><noscript><link href="https://ksu-cs-textbooks.github.io/cis400/css/auto-complete.css?1697829858" rel="stylesheet"></noscript>
    <link href="https://ksu-cs-textbooks.github.io/cis400/css/perfect-scrollbar.min.css?1697829858" rel="stylesheet">
    <link href="https://ksu-cs-textbooks.github.io/cis400/css/fonts.css?1697829858" rel="stylesheet" media="print" onload="this.media='all';this.onload=null;"><noscript><link href="https://ksu-cs-textbooks.github.io/cis400/css/fonts.css?1697829858" rel="stylesheet"></noscript>
    <link href="https://ksu-cs-textbooks.github.io/cis400/css/theme.css?1697829858" rel="stylesheet">
    <link href="https://ksu-cs-textbooks.github.io/cis400/css/theme-auto.css?1697829858" rel="stylesheet" id="variant-style">
    <link href="https://ksu-cs-textbooks.github.io/cis400/css/variant.css?1697829858" rel="stylesheet">
    <link href="https://ksu-cs-textbooks.github.io/cis400/css/print.css?1697829858" rel="stylesheet" media="print">
    <link href="https://ksu-cs-textbooks.github.io/cis400/css/format-print.css?1697829858" rel="stylesheet">
    <link href="https://ksu-cs-textbooks.github.io/cis400/css/ie.css?1697829858" rel="stylesheet">
    <script src="https://ksu-cs-textbooks.github.io/cis400/js/url.js?1697829858"></script>
    <script src="https://ksu-cs-textbooks.github.io/cis400/js/variant.js?1697829858"></script>
    <script>
      // hack to let hugo tell us how to get to the root when using relativeURLs, it needs to be called *url= for it to do its magic:
      // https://github.com/gohugoio/hugo/blob/145b3fcce35fbac25c7033c91c1b7ae6d1179da8/transform/urlreplacers/absurlreplacer.go#L72
      window.index_js_url="https://ksu-cs-textbooks.github.io/cis400/index.search.js";
      var root_url="https://ksu-cs-textbooks.github.io/cis400/";
      var baseUri=root_url.replace(/\/$/, '');
      // translations
      window.T_Copy_to_clipboard = 'Copy to clipboard';
      window.T_Copied_to_clipboard = 'Copied to clipboard!';
      window.T_Copy_link_to_clipboard = 'Copy link to clipboard';
      window.T_Link_copied_to_clipboard = 'Copied link to clipboard!';
      window.T_No_results_found = 'No results found for \u0022{0}\u0022';
      window.T_N_results_found = '{1} results found for \u0022{0}\u0022';
      // some further base stuff
      var baseUriFull='https:\/\/ksu-cs-textbooks.github.io\/cis400/';
      window.variants && variants.init( [ 'auto', 'light-theme', 'dark-theme' ] );
    </script>
    
    <link href="https://ksu-cs-textbooks.github.io/cis400/css/custom.css?1697829858" rel="stylesheet">

  </head>
  <body class="mobile-support print disableInlineCopyToClipboard" data-url="https://ksu-cs-textbooks.github.io/cis400/2-desktop-development/03-events/06-property-changed/index.html">
    <div id="body" class="default-animation">
      <div id="sidebar-overlay"></div>
      <div id="toc-overlay"></div>
      <nav id="topbar" class="highlightable">
        <div>
          <div id="top-tele-link">
            <a class="print-link" title='Teleprompter View' href="https://ksu-cs-textbooks.github.io/cis400/2-desktop-development/03-events/06-property-changed/tele.html">
              <i class="fas fa-tv fa-fw"></i>
            </a>
          </div>
          <div id="top-embed-link">
            <a class="print-link" title='Embeddable Version' href="https://ksu-cs-textbooks.github.io/cis400/2-desktop-development/03-events/06-property-changed/embed.html">
              <i class="fas fa-expand-arrows-alt fa-fw"></i>
            </a>
          </div>
          <div id="breadcrumbs">
            <span id="sidebar-toggle-span">
              <a href="#" id="sidebar-toggle" class="topbar-link" title='Menu (CTRL+ALT+n)'><i class="fas fa-bars fa-fw"></i></a>
            </span>
            <ol class="links" itemscope itemtype="http://schema.org/BreadcrumbList">
              <li itemscope itemtype="https://schema.org/ListItem" itemprop="itemListElement"><a itemprop="item" href="https://ksu-cs-textbooks.github.io/cis400/index.html"><span itemprop="name">CIS 400: Object-Oriented Design, Implementation, and Testing</span></a><meta itemprop="position" content="1"> &gt; </li>
              <li itemscope itemtype="https://schema.org/ListItem" itemprop="itemListElement"><a itemprop="item" href="https://ksu-cs-textbooks.github.io/cis400/2-desktop-development/index.html"><span itemprop="name">Desktop Development</span></a><meta itemprop="position" content="2"> &gt; </li>
              <li itemscope itemtype="https://schema.org/ListItem" itemprop="itemListElement"><a itemprop="item" href="https://ksu-cs-textbooks.github.io/cis400/2-desktop-development/03-events/index.html"><span itemprop="name">Event-Driven Programming</span></a><meta itemprop="position" content="3"> &gt; </li>
              <li itemscope itemtype="https://schema.org/ListItem" itemprop="itemListElement"><span itemprop="name">PropertyChanged</span><meta itemprop="position" content="4"></li>
            </ol>
          </div>
        </div>
      </nav>
      <main id="body-inner" class="highlightable default" tabindex="-1">
        <div class="flex-block-wrapper">
          <article class="default">
            <header class="headline">
            </header>
<h1 id="propertychanged">PropertyChanged</h1>

<p>We often have classes which encapsulate data we might need to look at.  For example, we might have a &ldquo;Smart&rdquo; dog dish, which keeps track of the amount of food it contains in ounces.  So it exposes a <code>Weight</code> property.</p>
<p>Now let&rsquo;s assume we have a few possible add-on products that can be combined with that smart bowl.  One is a &ldquo;dinner bell&rdquo;, which makes noises when the bowl is filled (ostensibly to attract the dog, but mostly just to annoy your neighbors).  Another is a wireless device that sends texts to your phone to let you know when the bowl is empty.</p>
<p>How can the software running on these devices determine when the bowl is empty or full?  One possibility would be to check the bowl&rsquo;s weight constantly, or at a set interval.  We call this strategy <em>polling</em>:</p>
<div class="wrap-code highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-csharp" data-lang="csharp"><span style="display:flex;"><span><span style="color:#75715e">/// &lt;summary&gt;</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">/// The run button for the Dinner Bell add-on</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">/// &lt;/summary&gt;</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">public</span> <span style="color:#66d9ef">void</span> Run()
</span></span><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">while</span>(bowl.Weight != <span style="color:#ae81ff">0</span>) {
</span></span><span style="display:flex;"><span>        <span style="color:#75715e">// Do nothing</span>
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">// If we reach here, the bowl is empty!</span>
</span></span><span style="display:flex;"><span>    sendEmptyText();
</span></span><span style="display:flex;"><span>}</span></span></code></pre></div><p>The problem with this approach is that it means our program is running full-bore <em>all the time</em>.  If this is a battery-operated device, those batteries will drain quickly.  It might be better if we let the smart bowl notify the Dinner Bell, but if we did this using methods, the Smart Bowl would need a reference to that dinner bell&hellip; and any other accessories we plug in.</p>
<p>This was a common problem in GUI design - sometimes we need to know when a property changes because we are displaying that property&rsquo;s value in the GUI, possibly in multiple places.  But if that property is <em>not</em> part of a GUI display, we may not care when it changes.</p>
<h3 id="the-inotifypropertychanged-interface">The INotifyPropertyChanged Interface</h3>
<p>The standard answer to this dilemma in .NET is the <code>INotifyPropertyChanged</code> interface - an interface defined in the <code>System.ComponentModel</code> namespace that requires you to implement a single event <code>PropertyChanged</code> on the class that is changing.  You can define this event as:</p>
<div class="wrap-code highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-csharp" data-lang="csharp"><span style="display:flex;"><span><span style="color:#66d9ef">public</span> <span style="color:#66d9ef">event</span> PropertyChangedEventHandler? PropertyChanged;</span></span></code></pre></div><p>This sets up the <code>PropertyChanged</code> event handler on your class.  Let&rsquo;s first look at writing event listeners to take advantage of this event.</p>
<h4 id="propertychanged-event-listeners">PropertyChanged Event Listeners</h4>
<p>In our example, we would do this with the smart dog bowl, and add listeners to the dinner bell and empty notification tools.  The <code>PropertyChangedEventArgs</code> includes the name of the property that is changing (<code>PropertyName</code>) - so we can check that 1) the property changing is the weight, and 2) that the weight meets our criteria, i.e.:</p>
<div class="wrap-code highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-csharp" data-lang="csharp"><span style="display:flex;"><span><span style="color:#75715e">/// &lt;summary&gt;</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">/// A SmartBowl accessory that sends text notifications when the SmartBowl is empty</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">/// &lt;/summary&gt;</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">public</span> <span style="color:#66d9ef">class</span> <span style="color:#a6e22e">EmptyTexter</span>
</span></span><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">/// &lt;summary&gt;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">/// Constructs a new EmptyTexter object </span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">/// &lt;/summary&gt;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">/// &lt;param Name=&#34;bowl&#34;&gt;The SmartBowl to listen to&lt;/param&gt;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">public</span> EmptyTexter(SmartBowl bowl)
</span></span><span style="display:flex;"><span>    {
</span></span><span style="display:flex;"><span>        bowl.PropertyChanged += onBowlPropertyChanged;
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">/// &lt;summary&gt;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">/// Responds to changes in the Weight property of the bowl</span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">/// &lt;/summary&gt;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">/// &lt;param Name=&#34;Sender&#34;&gt;The bowl sending the event&lt;/param&gt;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">/// &lt;param Name=&#34;e&#34;&gt;The event arguments (specifying which property changed)&lt;/param&gt;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">private</span> <span style="color:#66d9ef">void</span> onBowlPropertyChanged(<span style="color:#66d9ef">object</span> sender, PropertyChangedEventArgs e)
</span></span><span style="display:flex;"><span>    {
</span></span><span style="display:flex;"><span>        <span style="color:#75715e">// Only move forward if the property changing is the weight</span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">if</span> (e.PropertyName == <span style="color:#e6db74">&#34;Weight&#34;</span>)
</span></span><span style="display:flex;"><span>        {
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">if</span> (sender <span style="color:#66d9ef">is</span> SmartBowl)
</span></span><span style="display:flex;"><span>            {
</span></span><span style="display:flex;"><span>                <span style="color:#66d9ef">var</span> bowl = sender <span style="color:#66d9ef">as</span> SmartBowl;
</span></span><span style="display:flex;"><span>                <span style="color:#66d9ef">if</span> (bowl.Weight == <span style="color:#ae81ff">0</span>) textBowlIsEmpty();
</span></span><span style="display:flex;"><span>            }
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">/// &lt;summary&gt;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">/// Helper method to notify bowl is empty</span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">/// &lt;/summary&gt;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">private</span> <span style="color:#66d9ef">void</span> textBowlIsEmpty()
</span></span><span style="display:flex;"><span>    {
</span></span><span style="display:flex;"><span>        <span style="color:#75715e">// TODO: Implement texting</span>
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>}</span></span></code></pre></div><p>Note that in our event listener, we need to check the specific property that is changing is the one we care about - the <code>Weight</code>.  We also cast the source of the event back into a <code>SmartBowl</code>, but only after checking the cast is possible.  Alternatively, we could have stored the <code>SmartBowl</code> instance in a class variable rather than casting.</p>
<p>Or, we can use the new <a href="https://docs.microsoft.com/en-us/dotnet/csharp/pattern-matching#the-is-type-pattern-expression" target="_blank">is type pattern expression</a>
:</p>
<div class="wrap-code highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-csharp" data-lang="csharp"><span style="display:flex;"><span><span style="color:#66d9ef">if</span>(sender <span style="color:#66d9ef">is</span> SmartBowl bowl) {
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">// Inside this body, bowl is the sender cast as a SmartBowl</span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">// TODO: logic goes here</span>
</span></span><span style="display:flex;"><span>}</span></span></code></pre></div><p>This is syntactic sugar for:</p>
<div class="wrap-code highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-csharp" data-lang="csharp"><span style="display:flex;"><span><span style="color:#66d9ef">if</span>(sender <span style="color:#66d9ef">is</span> SmartBowl) {
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">var</span> bowl = sender <span style="color:#66d9ef">as</span> SmartBowl;
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">// TODO: logic goes here</span>
</span></span><span style="display:flex;"><span>}</span></span></code></pre></div><p>Notice how the is type pattern expression merges the if test and variable assignment?</p>
<p>Also, notice that the only extra information supplied by our <code>PropertyChangedEventArgs</code> is the name of the property - not its prior value, or any other info.  This helps keep the event lightweight, but it does mean if we need to keep track of prior values, we must implement that ourselves, as we do in the <code>DinnerBell</code> implementation:</p>
<div class="wrap-code highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-csharp" data-lang="csharp"><span style="display:flex;"><span><span style="color:#75715e">/// &lt;summary&gt;</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">/// A SmartBowl accessory that makes noise when the bowl is filled</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">/// &lt;/summary&gt;</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">public</span> <span style="color:#66d9ef">class</span> <span style="color:#a6e22e">DinnerBell</span>
</span></span><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">/// &lt;summary&gt;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">/// Caches the previous weight measurement </span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">/// &lt;/summary&gt;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">private</span> <span style="color:#66d9ef">double</span> lastWeight;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">/// &lt;summary&gt;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">/// Constructs a new DinnerBell object </span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">/// &lt;/summary&gt;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">/// &lt;param Name=&#34;bowl&#34;&gt;The SmartBowl to listen to&lt;/param&gt;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">public</span> DinnerBell(SmartBowl bowl)
</span></span><span style="display:flex;"><span>    {
</span></span><span style="display:flex;"><span>        lastWeight = bowl.Weight;
</span></span><span style="display:flex;"><span>        bowl.PropertyChanged += onBowlPropertyChanged;
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">/// &lt;summary&gt;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">/// Responds to changes in the Weight property of the bowl</span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">/// &lt;/summary&gt;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">/// &lt;param Name=&#34;Sender&#34;&gt;The bowl sending the event&lt;/param&gt;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">/// &lt;param Name=&#34;e&#34;&gt;The event arguments (specifying which property changed)&lt;/param&gt;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">private</span> <span style="color:#66d9ef">void</span> onBowlPropertyChanged(<span style="color:#66d9ef">object</span> sender, PropertyChangedEventArgs e)
</span></span><span style="display:flex;"><span>    {
</span></span><span style="display:flex;"><span>        <span style="color:#75715e">// Only move forward if the property changing is the weight</span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">if</span> (e.PropertyName == <span style="color:#e6db74">&#34;Weight&#34;</span>)
</span></span><span style="display:flex;"><span>        {
</span></span><span style="display:flex;"><span>            <span style="color:#75715e">// Cast the sender to a smart bowl using the is type expression</span>
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">if</span> (sender <span style="color:#66d9ef">is</span> SmartBowl bowl)
</span></span><span style="display:flex;"><span>            {
</span></span><span style="display:flex;"><span>                <span style="color:#75715e">// Ring the dinner bell if the bowl is now heavier </span>
</span></span><span style="display:flex;"><span>                <span style="color:#75715e">// (i.e. food has been added)</span>
</span></span><span style="display:flex;"><span>                <span style="color:#66d9ef">if</span> (bowl.Weight &gt; lastWeight) ringTheBell();
</span></span><span style="display:flex;"><span>                <span style="color:#75715e">// Cache the new weight</span>
</span></span><span style="display:flex;"><span>                lastWeight = bowl.Weight;
</span></span><span style="display:flex;"><span>            }
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">/// &lt;summary&gt;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">/// Helper method to make noise </span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">/// &lt;/summary&gt;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">private</span> <span style="color:#66d9ef">void</span> ringTheBell()
</span></span><span style="display:flex;"><span>    {
</span></span><span style="display:flex;"><span>        <span style="color:#75715e">// TODO: Implement noisemaking</span>
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>}</span></span></code></pre></div><h4 id="propertychanged-event-declaration">PropertyChanged Event Declaration</h4>
<p>For the event listeners to work as expected, we need to implement the <code>PropertyChanged</code> event in our <code>SmartBowl</code> class with:</p>
<div class="wrap-code highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-csharp" data-lang="csharp"><span style="display:flex;"><span><span style="color:#66d9ef">public</span> <span style="color:#66d9ef">event</span> PropertyChangedEventHandler? PropertyChanged;</span></span></code></pre></div><p>Which makes it available for the event handlers to attach to.  But this is only <em>part</em> of the process, we also need to <em>invoke</em> this event when it happens.  This is done with the <code>Invoke(object sender, EventArgs e)</code> method defined for every event handler. It takes two parameters, an <code>object</code> which is the source of the event, and the <code>EventArgs</code> defining the event.  The specific kind of <code>EventArgs</code> corresponds to the event declaration - in our case, <code>PropertyChangedEventArgs</code>.</p>
<p>Let&rsquo;s start with a straightforward example.  Assume we have a <code>Name</code> property in the <code>SmartBowl</code> that is a customizable string, allowing us to identify the bowl, i.e. &ldquo;Water&rdquo; or &ldquo;Food&rdquo;.  When we change it, we need to invoke the <code>PropertyChanged</code> event, i.e.:</p>
<div class="wrap-code highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-csharp" data-lang="csharp"><span style="display:flex;"><span><span style="color:#66d9ef">private</span> <span style="color:#66d9ef">string</span> name = <span style="color:#e6db74">&#34;Bowl&#34;</span>;
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">public</span> <span style="color:#66d9ef">string</span> Name {
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">get</span> {<span style="color:#66d9ef">return</span> name;}
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">set</span> 
</span></span><span style="display:flex;"><span>    {
</span></span><span style="display:flex;"><span>        name = <span style="color:#66d9ef">value</span>;
</span></span><span style="display:flex;"><span>        PropertyChanged?.Invoke(<span style="color:#66d9ef">this</span>, <span style="color:#66d9ef">new</span> PropertyChangedEventArgs(<span style="color:#e6db74">&#34;Name&#34;</span>));
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>}</span></span></code></pre></div><p>Notice how we use the setter for <code>Name</code> to invoke the <code>PropertyChanged</code> event handler, <em>after</em> the change to the property has been made.  This invocation needs to be done <em>after</em> the change, or the responding event listener may grab the <em>old</em> value (remember, event listeners are triggered <em>synchronously</em>).</p>
<p>Also note that we use the  null-conditional operator <a href="https://docs.microsoft.com/en-us/dotnet/csharp/language-reference/operators/member-access-operators#null-conditional-operators--and-" target="_blank"><code>?.</code></a>
 to avoid calling the <code>Invoke()</code> method if <code>PropertyChanged</code> is null (which is the case if no event listeners have been assigned).</p>
<p>Now let&rsquo;s tackle a more complex example.  Since our <code>SmartBowl</code> uses a sensor to measure the weight of its contents, we might be able to read the sensor data - probably through a driver or a class representing the sensor. Rather than doing this constantly, let&rsquo;s set a polling interval of 1 minute:</p>
<div class="wrap-code highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-csharp" data-lang="csharp"><span style="display:flex;"><span><span style="color:#75715e">/// &lt;summary&gt;</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">/// A class representing a &#34;smart&#34; dog bowl.</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">/// &lt;/summary&gt;</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">public</span> <span style="color:#66d9ef">class</span> <span style="color:#a6e22e">SmartBowl</span> : INotifyPropertyChanged 
</span></span><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">/// &lt;summary&gt;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">/// Event triggered when a property changes</span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">/// &lt;/summary&gt;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">event</span> PropertyChangedEventHandler? PropertyChanged;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">/// &lt;summary&gt;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">/// The weight sensor installed in the bowl</span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">/// &lt;/summary&gt;</span>
</span></span><span style="display:flex;"><span>    Sensor sensor;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">private</span> <span style="color:#66d9ef">string</span> name = <span style="color:#e6db74">&#34;Bowl&#34;</span>;
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">/// &lt;summary&gt;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">/// The name of this bowl</span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">/// &lt;/summary&gt;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">string</span> Name
</span></span><span style="display:flex;"><span>    {
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">get</span> { <span style="color:#66d9ef">return</span> name; }
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">set</span>
</span></span><span style="display:flex;"><span>        {
</span></span><span style="display:flex;"><span>            name = <span style="color:#66d9ef">value</span>;
</span></span><span style="display:flex;"><span>            PropertyChanged?.Invoke(<span style="color:#66d9ef">this</span>, <span style="color:#66d9ef">new</span> PropertyChangedEventArgs(<span style="color:#e6db74">&#34;Name&#34;</span>));
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">private</span> <span style="color:#66d9ef">double</span> weight;
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">/// &lt;summary&gt;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">/// The weight of the bowl contents, measured in ounces</span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">/// &lt;/summary&gt;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">double</span> Weight
</span></span><span style="display:flex;"><span>    {
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">get</span> { <span style="color:#66d9ef">return</span> weight; }
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">set</span>
</span></span><span style="display:flex;"><span>        {
</span></span><span style="display:flex;"><span>            <span style="color:#75715e">// We only want to treat the weight as changing </span>
</span></span><span style="display:flex;"><span>            <span style="color:#75715e">// if the change is more than a 16th of an ounce</span>
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">if</span> (Math.Abs(weight - <span style="color:#66d9ef">value</span>) &gt; <span style="color:#ae81ff">1</span> / <span style="color:#ae81ff">16</span>)
</span></span><span style="display:flex;"><span>            {
</span></span><span style="display:flex;"><span>                weight = <span style="color:#66d9ef">value</span>;
</span></span><span style="display:flex;"><span>                <span style="color:#75715e">// Notify of the property changing</span>
</span></span><span style="display:flex;"><span>                PropertyChanged?.Invoke(<span style="color:#66d9ef">this</span>, <span style="color:#66d9ef">new</span> PropertyChangedEventArgs(<span style="color:#e6db74">&#34;Weight&#34;</span>));
</span></span><span style="display:flex;"><span>            }
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">/// &lt;summary&gt;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">/// Constructs a new SmartBowl </span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">/// &lt;/summary&gt;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">/// &lt;param Name=&#34;sensor&#34;&gt;the weight sensor&lt;/param&gt;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">public</span> SmartBowl(Sensor sensor)
</span></span><span style="display:flex;"><span>    {
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">this</span>.sensor = sensor;
</span></span><span style="display:flex;"><span>        <span style="color:#75715e">// Set the initial weight</span>
</span></span><span style="display:flex;"><span>        weight = sensor.Value;
</span></span><span style="display:flex;"><span>        <span style="color:#75715e">// Set a timer to go off in 1 minute  </span>
</span></span><span style="display:flex;"><span>        <span style="color:#75715e">// (ms = 60 seconds/minute * 1000 milliseconds/seconds)</span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">var</span> timer = <span style="color:#66d9ef">new</span> System.Timers.Timer(<span style="color:#ae81ff">60</span> * <span style="color:#ae81ff">1000</span>);
</span></span><span style="display:flex;"><span>        <span style="color:#75715e">// Set the timer to reset when it goes off </span>
</span></span><span style="display:flex;"><span>        timer.AutoReset = <span style="color:#66d9ef">true</span>;
</span></span><span style="display:flex;"><span>        <span style="color:#75715e">// Trigger a sensor read each time the timer elapses</span>
</span></span><span style="display:flex;"><span>        timer.Elapsed += readSensor;
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">/// &lt;summary&gt;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">/// Handles the elapsing of the polling timer by updating the weight</span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">/// &lt;/summary&gt;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">private</span> <span style="color:#66d9ef">void</span> readSensor(<span style="color:#66d9ef">object</span> Sender, System.Timers.ElapsedEventArgs e)
</span></span><span style="display:flex;"><span>    {
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">this</span>.Weight = sensor.Value;
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>}</span></span></code></pre></div><p>Notice in this code, we use the setter of the <code>Weight</code> property to trigger the <code>PropertyChanged</code> event.  Because we&rsquo;re dealing with a real-world sensor that may have slight variations in the readings, we also only treat changes of more than 1/16th of an ounce as significant enough to change the property.</p>

  
  
<div class="box notices cstyle warning">
  <div class="box-label"><i class="fa-fw fas fa-exclamation-triangle"></i> Warning</div>
  <div class="box-content">

<p>With the <code>INotifyPropertyChanged</code> interface, the <em>only</em> aspect Visual Studio checks is that the <code>PropertyChanged</code> event is declared.  There is no built-in check that the programmer is using it as expected.  Therefore it is upon you, the programmer, to ensure that you meet the expectation that comes with implementing this interface: <em>that any public or protected property that changes will invoke the <code>PropertyChanged</code> event</em>.</p>
</div>
</div>
<h4 id="testing-the-propertychanged-event">Testing the PropertyChanged Event</h4>
<p>Finally, we should write unit tests to confirm that our <code>PropertyChanged</code> event works as expected:</p>
<div class="wrap-code highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-csharp" data-lang="csharp"><span style="display:flex;"><span><span style="color:#66d9ef">public</span> <span style="color:#66d9ef">class</span> <span style="color:#a6e22e">SmartBowlUnitTests</span> {
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">/// &lt;summary&gt;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">/// A mock sensor that increases its reading by one ounce </span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">/// every time its Value property is invoked.</span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">/// &lt;/summary&gt;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">class</span> <span style="color:#a6e22e">MockChangingWeightSensor</span> : Sensor
</span></span><span style="display:flex;"><span>    {
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">double</span> <span style="color:#66d9ef">value</span> = <span style="color:#ae81ff">0.0</span>;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">double</span> Value {
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">get</span> {
</span></span><span style="display:flex;"><span>                <span style="color:#66d9ef">value</span> += <span style="color:#ae81ff">1</span>;
</span></span><span style="display:flex;"><span>                <span style="color:#66d9ef">return</span> <span style="color:#66d9ef">value</span>;
</span></span><span style="display:flex;"><span>            }
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">
</span></span></span><span style="display:flex;"><span><span style="color:#a6e22e">    [Fact]</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">void</span> NameChangeShouldTriggerPropertyChanged() 
</span></span><span style="display:flex;"><span>    {
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">var</span> bowl = <span style="color:#66d9ef">new</span> SmartBowl(<span style="color:#66d9ef">new</span> MockChangingWeightSensor());
</span></span><span style="display:flex;"><span>        Assert.PropertyChanged(bowl, <span style="color:#e6db74">&#34;Name&#34;</span>, () =&gt; {
</span></span><span style="display:flex;"><span>            bowl.Name = <span style="color:#e6db74">&#34;New Name&#34;</span>;
</span></span><span style="display:flex;"><span>        });
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">
</span></span></span><span style="display:flex;"><span><span style="color:#a6e22e">    [Fact]</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">void</span> WeightChangeShouldTriggerPropertyChanged()
</span></span><span style="display:flex;"><span>    {
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">var</span> bowl = <span style="color:#66d9ef">new</span> SmartBowl(<span style="color:#66d9ef">new</span> MockChangingWeightSensor());
</span></span><span style="display:flex;"><span>        Assert.PropertyChangedAsync(bowl, <span style="color:#e6db74">&#34;Weight&#34;</span>, () =&gt; {
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">return</span> Task.Delay(<span style="color:#ae81ff">2</span> * <span style="color:#ae81ff">60</span> * <span style="color:#ae81ff">1000</span>);
</span></span><span style="display:flex;"><span>        });
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>}</span></span></code></pre></div><p>The <code>PropertyChanged</code> interface is so common in C# programming that we have <em>two</em> assertions dealing with it.  The first we use to test the <code>Name</code> property:</p>
<div class="wrap-code highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-csharp" data-lang="csharp"><span style="display:flex;"><span><span style="color:#a6e22e">[Fact]</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">public</span> <span style="color:#66d9ef">void</span> NameChangeShouldTriggerPropertyChanged() 
</span></span><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">var</span> bowl = <span style="color:#66d9ef">new</span> SmartBowl(<span style="color:#66d9ef">new</span> MockChangingWeightSensor());
</span></span><span style="display:flex;"><span>    Assert.PropertyChanged(bowl, <span style="color:#e6db74">&#34;Name&#34;</span>, () =&gt; {
</span></span><span style="display:flex;"><span>        bowl.Name = <span style="color:#e6db74">&#34;New Name&#34;</span>;
</span></span><span style="display:flex;"><span>    });
</span></span><span style="display:flex;"><span>}</span></span></code></pre></div><p>Notice that <code>Assert.PropertyChanged(@object ojb, string propertyName, Action action)</code> takes three arguments - first the object with the property that should be changing, second the name of the property we expect to change, and third an action that should trigger the event.  In this case, we change the name property.</p>
<p>The second is a bit more involved, as we have an event that happens based on a timer.  To test it therefore, we have to wait for the timer to have had an opportunity to trigger.  We do this with an asynchronous action, so we use the <code>Assert.PropertyChangedAsync(@object obj, string propertyName, Func&lt;Task&gt; action)</code>.  The first two arguments are the same, but the last one is a <code>Func</code> (a function) that returns an asynchronous <code>Task</code> object.  The simplest one to use here is <code>Task.Delay</code>, which delays for the supplied period of time (in our case, two minutes).  Since our property should change on one-minute intervals, we&rsquo;ll know if there was a problem if it doesn&rsquo;t change after two minutes.</p>

            <footer class="footline">

            </footer>
          </article>


        </div>
      </main>
    
<div class="git-footer">
<p class="theme-version-footer">5.18.0</p>
<p>Last modified by: 
            <i class='fas fa-user'></i> Julie Thornton
            <i class='fas fa-calendar'></i> <a href="https://gitlab.cs.ksu.edu/cs-textbooks/cis400-textbook/-/commit/ef18ce65a00eb108b511d010eb9041717f43ed69">Oct 9, 2023</a>
</p>
</div>

    
    </div>
    <script src="https://ksu-cs-textbooks.github.io/cis400/js/clipboard.min.js?1697829860" defer></script>
    <script src="https://ksu-cs-textbooks.github.io/cis400/js/perfect-scrollbar.min.js?1697829860" defer></script>
    <script src="https://ksu-cs-textbooks.github.io/cis400/js/theme.js?1697829860" defer></script>
  </body>
</html>
