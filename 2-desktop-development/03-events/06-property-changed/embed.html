<!doctype html><html lang=en-us dir=ltr itemscope itemtype=http://schema.org/Article><head><meta charset=utf-8><meta name=viewport content="height=device-height,width=device-width,initial-scale=1,minimum-scale=1"><meta name=generator content="Hugo 0.128.0"><meta name=generator content="Relearn 6.0.0"><meta name=description content="We often have classes which encapsulate data we might need to look at. For example, we might have a “Smart” dog dish, which keeps track of the amount of food it contains in ounces. So it exposes a Weight property.
Now let’s assume we have a few possible add-on products that can be combined with that smart bowl. One is a “dinner bell”, which makes noises when the bowl is filled (ostensibly to attract the dog, but mostly just to annoy your neighbors)."><meta name=author content="Nathan Bean"><meta name=twitter:card content="summary"><meta name=twitter:title content="PropertyChanged :: K-State CIS 400 Textbook"><meta name=twitter:description content="We often have classes which encapsulate data we might need to look at. For example, we might have a “Smart” dog dish, which keeps track of the amount of food it contains in ounces. So it exposes a Weight property.
Now let’s assume we have a few possible add-on products that can be combined with that smart bowl. One is a “dinner bell”, which makes noises when the bowl is filled (ostensibly to attract the dog, but mostly just to annoy your neighbors)."><meta property="og:url" content="https://textbooks.cs.ksu.edu/cis400/2-desktop-development/03-events/06-property-changed/embed.html"><meta property="og:site_name" content="K-State CIS 400 Textbook"><meta property="og:title" content="PropertyChanged :: K-State CIS 400 Textbook"><meta property="og:description" content="We often have classes which encapsulate data we might need to look at. For example, we might have a “Smart” dog dish, which keeps track of the amount of food it contains in ounces. So it exposes a Weight property.
Now let’s assume we have a few possible add-on products that can be combined with that smart bowl. One is a “dinner bell”, which makes noises when the bowl is filled (ostensibly to attract the dog, but mostly just to annoy your neighbors)."><meta property="og:locale" content="en-us"><meta property="og:type" content="article"><meta property="article:section" content="Desktop Development"><meta property="article:published_time" content="2018-08-24T10:53:26-05:00"><meta property="article:modified_time" content="2024-03-04T09:44:07-06:00"><meta itemprop=name content="PropertyChanged :: K-State CIS 400 Textbook"><meta itemprop=description content="We often have classes which encapsulate data we might need to look at. For example, we might have a “Smart” dog dish, which keeps track of the amount of food it contains in ounces. So it exposes a Weight property.
Now let’s assume we have a few possible add-on products that can be combined with that smart bowl. One is a “dinner bell”, which makes noises when the bowl is filled (ostensibly to attract the dog, but mostly just to annoy your neighbors)."><meta itemprop=datePublished content="2018-08-24T10:53:26-05:00"><meta itemprop=dateModified content="2024-03-04T09:44:07-06:00"><meta itemprop=wordCount content="1935"><title>PropertyChanged :: K-State CIS 400 Textbook</title>
<link href=https://textbooks.cs.ksu.edu/cis400/2-desktop-development/03-events/06-property-changed/ rel=canonical type=text/html title="PropertyChanged :: K-State CIS 400 Textbook"><link href=/cis400/2-desktop-development/03-events/06-property-changed/index.xml rel=alternate type=application/rss+xml title="PropertyChanged :: K-State CIS 400 Textbook"><link href=/cis400/2-desktop-development/03-events/06-property-changed/index.print.html rel=alternate type=text/html title="PropertyChanged :: K-State CIS 400 Textbook"><link href=/cis400/2-desktop-development/03-events/06-property-changed/tele.html rel=alternate type=text/html title="PropertyChanged :: K-State CIS 400 Textbook"><link href=/cis400/css/fontawesome-all.min.css?1728334422 rel=stylesheet media=print onload='this.media="all",this.onload=null'><noscript><link href=/cis400/css/fontawesome-all.min.css?1728334422 rel=stylesheet></noscript><link href=/cis400/css/nucleus.css?1728334422 rel=stylesheet><link href=/cis400/css/auto-complete.css?1728334422 rel=stylesheet media=print onload='this.media="all",this.onload=null'><noscript><link href=/cis400/css/auto-complete.css?1728334422 rel=stylesheet></noscript><link href=/cis400/css/perfect-scrollbar.min.css?1728334422 rel=stylesheet><link href=/cis400/css/fonts.css?1728334422 rel=stylesheet media=print onload='this.media="all",this.onload=null'><noscript><link href=/cis400/css/fonts.css?1728334422 rel=stylesheet></noscript><link href=/cis400/css/theme.css?1728334422 rel=stylesheet><link href=/cis400/css/theme-light-theme.css?1728334422 rel=stylesheet id=R-variant-style><link href=/cis400/css/chroma-relearn-light.css?1728334422 rel=stylesheet id=R-variant-chroma-style><link href=/cis400/css/variant.css?1728334422 rel=stylesheet><link href=/cis400/css/print.css?1728334422 rel=stylesheet media=print><script>window.relearn=window.relearn||{},window.relearn.relBasePath="../../..",window.relearn.relBaseUri="../../../..",window.relearn.absBaseUri="https://textbooks.cs.ksu.edu/cis400",window.index_js_url="/cis400/index.search.js",window.variants&&variants.init(["light-theme"]),window.T_Copy_to_clipboard=`Copy to clipboard`,window.T_Copied_to_clipboard=`Copied to clipboard!`,window.T_Copy_link_to_clipboard=`Copy link to clipboard`,window.T_Link_copied_to_clipboard=`Copied link to clipboard!`,window.T_Reset_view=`Reset view`,window.T_View_reset=`View reset!`,window.T_No_results_found=`No results found for "{0}"`,window.T_N_results_found=`{1} results found for "{0}"`</script><link href=/cis400/css/custom.css?1728334422 rel=stylesheet></head><body class="mobile-support embed disableInlineCopyToClipboard" data-url=/cis400/2-desktop-development/03-events/06-property-changed/embed.html><div id=R-body class=default-animation><div id=R-body-overlay></div><div id=R-main-overlay></div><main id=R-body-inner class="highlightable default" tabindex=-1><div class=flex-block-wrapper><article class=default><p>We often have classes which encapsulate data we might need to look at. For example, we might have a &ldquo;Smart&rdquo; dog dish, which keeps track of the amount of food it contains in ounces. So it exposes a <code>Weight</code> property.</p><p>Now let&rsquo;s assume we have a few possible add-on products that can be combined with that smart bowl. One is a &ldquo;dinner bell&rdquo;, which makes noises when the bowl is filled (ostensibly to attract the dog, but mostly just to annoy your neighbors). Another is a wireless device that sends texts to your phone to let you know when the bowl is empty.</p><p>How can the software running on these devices determine when the bowl is empty or full? One possibility would be to check the bowl&rsquo;s weight constantly, or at a set interval. We call this strategy <em>polling</em>:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-csharp data-lang=csharp><span class=line><span class=cl><span class=cs>/// &lt;summary&gt;</span>
</span></span><span class=line><span class=cl><span class=cs>/// The run button for the Dinner Bell add-on</span>
</span></span><span class=line><span class=cl><span class=cs>/// &lt;/summary&gt;</span>
</span></span><span class=line><span class=cl><span class=kd>public</span> <span class=k>void</span> <span class=n>Run</span><span class=p>()</span>
</span></span><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>while</span><span class=p>(</span><span class=n>bowl</span><span class=p>.</span><span class=n>Weight</span> <span class=p>!=</span> <span class=m>0</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=c1>// Do nothing</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=c1>// If we reach here, the bowl is empty!</span>
</span></span><span class=line><span class=cl>    <span class=n>sendEmptyText</span><span class=p>();</span>
</span></span><span class=line><span class=cl><span class=p>}</span></span></span></code></pre></div><p>The problem with this approach is that it means our program is running full-bore <em>all the time</em>. If this is a battery-operated device, those batteries will drain quickly. It might be better if we let the smart bowl notify the Dinner Bell, but if we did this using methods, the Smart Bowl would need a reference to that dinner bell&mldr; and any other accessories we plug in.</p><p>This was a common problem in GUI design - sometimes we need to know when a property changes because we are displaying that property&rsquo;s value in the GUI, possibly in multiple places. But if that property is <em>not</em> part of a GUI display, we may not care when it changes.</p><h3 id=the-inotifypropertychanged-interface>The INotifyPropertyChanged Interface</h3><p>The standard answer to this dilemma in .NET is the <code>INotifyPropertyChanged</code> interface - an interface defined in the <code>System.ComponentModel</code> namespace that requires you to implement a single event <code>PropertyChanged</code> on the class that is changing. You can define this event as:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-csharp data-lang=csharp><span class=line><span class=cl><span class=kd>public</span> <span class=k>event</span> <span class=n>PropertyChangedEventHandler</span><span class=p>?</span> <span class=n>PropertyChanged</span><span class=p>;</span></span></span></code></pre></div><p>This sets up the <code>PropertyChanged</code> event handler on your class. Let&rsquo;s first look at writing event listeners to take advantage of this event.</p><h4 id=propertychanged-event-listeners>PropertyChanged Event Listeners</h4><p>In our example, we would do this with the smart dog bowl, and add listeners to the dinner bell and empty notification tools. The <code>PropertyChangedEventArgs</code> includes the name of the property that is changing (<code>PropertyName</code>) - so we can check that 1) the property changing is the weight, and 2) that the weight meets our criteria, i.e.:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-csharp data-lang=csharp><span class=line><span class=cl><span class=cs>/// &lt;summary&gt;</span>
</span></span><span class=line><span class=cl><span class=cs>/// A SmartBowl accessory that sends text notifications when the SmartBowl is empty</span>
</span></span><span class=line><span class=cl><span class=cs>/// &lt;/summary&gt;</span>
</span></span><span class=line><span class=cl><span class=kd>public</span> <span class=k>class</span> <span class=nc>EmptyTexter</span>
</span></span><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=cs>/// &lt;summary&gt;</span>
</span></span><span class=line><span class=cl>    <span class=cs>/// Constructs a new EmptyTexter object </span>
</span></span><span class=line><span class=cl>    <span class=cs>/// &lt;/summary&gt;</span>
</span></span><span class=line><span class=cl>    <span class=cs>/// &lt;param Name=&#34;bowl&#34;&gt;The SmartBowl to listen to&lt;/param&gt;</span>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=n>EmptyTexter</span><span class=p>(</span><span class=n>SmartBowl</span> <span class=n>bowl</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=n>bowl</span><span class=p>.</span><span class=n>PropertyChanged</span> <span class=p>+=</span> <span class=n>onBowlPropertyChanged</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=cs>/// &lt;summary&gt;</span>
</span></span><span class=line><span class=cl>    <span class=cs>/// Responds to changes in the Weight property of the bowl</span>
</span></span><span class=line><span class=cl>    <span class=cs>/// &lt;/summary&gt;</span>
</span></span><span class=line><span class=cl>    <span class=cs>/// &lt;param Name=&#34;Sender&#34;&gt;The bowl sending the event&lt;/param&gt;</span>
</span></span><span class=line><span class=cl>    <span class=cs>/// &lt;param Name=&#34;e&#34;&gt;The event arguments (specifying which property changed)&lt;/param&gt;</span>
</span></span><span class=line><span class=cl>    <span class=kd>private</span> <span class=k>void</span> <span class=n>onBowlPropertyChanged</span><span class=p>(</span><span class=kt>object</span> <span class=n>sender</span><span class=p>,</span> <span class=n>PropertyChangedEventArgs</span> <span class=n>e</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=c1>// Only move forward if the property changing is the weight</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=p>(</span><span class=n>e</span><span class=p>.</span><span class=n>PropertyName</span> <span class=p>==</span> <span class=s>&#34;Weight&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=k>if</span> <span class=p>(</span><span class=n>sender</span> <span class=k>is</span> <span class=n>SmartBowl</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            <span class=p>{</span>
</span></span><span class=line><span class=cl>                <span class=kt>var</span> <span class=n>bowl</span> <span class=p>=</span> <span class=n>sender</span> <span class=k>as</span> <span class=n>SmartBowl</span><span class=p>;</span>
</span></span><span class=line><span class=cl>                <span class=k>if</span> <span class=p>(</span><span class=n>bowl</span><span class=p>.</span><span class=n>Weight</span> <span class=p>==</span> <span class=m>0</span><span class=p>)</span> <span class=n>textBowlIsEmpty</span><span class=p>();</span>
</span></span><span class=line><span class=cl>            <span class=p>}</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=cs>/// &lt;summary&gt;</span>
</span></span><span class=line><span class=cl>    <span class=cs>/// Helper method to notify bowl is empty</span>
</span></span><span class=line><span class=cl>    <span class=cs>/// &lt;/summary&gt;</span>
</span></span><span class=line><span class=cl>    <span class=kd>private</span> <span class=k>void</span> <span class=n>textBowlIsEmpty</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=c1>// TODO: Implement texting</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span></span></span></code></pre></div><p>Note that in our event listener, we need to check the specific property that is changing is the one we care about - the <code>Weight</code>. We also cast the source of the event back into a <code>SmartBowl</code>, but only after checking the cast is possible. Alternatively, we could have stored the <code>SmartBowl</code> instance in a class variable rather than casting.</p><p>Or, we can use the new <a href=https://docs.microsoft.com/en-us/dotnet/csharp/pattern-matching#the-is-type-pattern-expression rel=external target=_blank>is type pattern expression</a>:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-csharp data-lang=csharp><span class=line><span class=cl><span class=k>if</span><span class=p>(</span><span class=n>sender</span> <span class=k>is</span> <span class=n>SmartBowl</span> <span class=n>bowl</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=c1>// Inside this body, bowl is the sender cast as a SmartBowl</span>
</span></span><span class=line><span class=cl>    <span class=c1>// TODO: logic goes here</span>
</span></span><span class=line><span class=cl><span class=p>}</span></span></span></code></pre></div><p>This is syntactic sugar for:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-csharp data-lang=csharp><span class=line><span class=cl><span class=k>if</span><span class=p>(</span><span class=n>sender</span> <span class=k>is</span> <span class=n>SmartBowl</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=kt>var</span> <span class=n>bowl</span> <span class=p>=</span> <span class=n>sender</span> <span class=k>as</span> <span class=n>SmartBowl</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=c1>// TODO: logic goes here</span>
</span></span><span class=line><span class=cl><span class=p>}</span></span></span></code></pre></div><p>Notice how the is type pattern expression merges the if test and variable assignment?</p><p>Also, notice that the only extra information supplied by our <code>PropertyChangedEventArgs</code> is the name of the property - not its prior value, or any other info. This helps keep the event lightweight, but it does mean if we need to keep track of prior values, we must implement that ourselves, as we do in the <code>DinnerBell</code> implementation:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-csharp data-lang=csharp><span class=line><span class=cl><span class=cs>/// &lt;summary&gt;</span>
</span></span><span class=line><span class=cl><span class=cs>/// A SmartBowl accessory that makes noise when the bowl is filled</span>
</span></span><span class=line><span class=cl><span class=cs>/// &lt;/summary&gt;</span>
</span></span><span class=line><span class=cl><span class=kd>public</span> <span class=k>class</span> <span class=nc>DinnerBell</span>
</span></span><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=cs>/// &lt;summary&gt;</span>
</span></span><span class=line><span class=cl>    <span class=cs>/// Caches the previous weight measurement </span>
</span></span><span class=line><span class=cl>    <span class=cs>/// &lt;/summary&gt;</span>
</span></span><span class=line><span class=cl>    <span class=kd>private</span> <span class=kt>double</span> <span class=n>lastWeight</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=cs>/// &lt;summary&gt;</span>
</span></span><span class=line><span class=cl>    <span class=cs>/// Constructs a new DinnerBell object </span>
</span></span><span class=line><span class=cl>    <span class=cs>/// &lt;/summary&gt;</span>
</span></span><span class=line><span class=cl>    <span class=cs>/// &lt;param Name=&#34;bowl&#34;&gt;The SmartBowl to listen to&lt;/param&gt;</span>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=n>DinnerBell</span><span class=p>(</span><span class=n>SmartBowl</span> <span class=n>bowl</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=n>lastWeight</span> <span class=p>=</span> <span class=n>bowl</span><span class=p>.</span><span class=n>Weight</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=n>bowl</span><span class=p>.</span><span class=n>PropertyChanged</span> <span class=p>+=</span> <span class=n>onBowlPropertyChanged</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=cs>/// &lt;summary&gt;</span>
</span></span><span class=line><span class=cl>    <span class=cs>/// Responds to changes in the Weight property of the bowl</span>
</span></span><span class=line><span class=cl>    <span class=cs>/// &lt;/summary&gt;</span>
</span></span><span class=line><span class=cl>    <span class=cs>/// &lt;param Name=&#34;Sender&#34;&gt;The bowl sending the event&lt;/param&gt;</span>
</span></span><span class=line><span class=cl>    <span class=cs>/// &lt;param Name=&#34;e&#34;&gt;The event arguments (specifying which property changed)&lt;/param&gt;</span>
</span></span><span class=line><span class=cl>    <span class=kd>private</span> <span class=k>void</span> <span class=n>onBowlPropertyChanged</span><span class=p>(</span><span class=kt>object</span> <span class=n>sender</span><span class=p>,</span> <span class=n>PropertyChangedEventArgs</span> <span class=n>e</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=c1>// Only move forward if the property changing is the weight</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=p>(</span><span class=n>e</span><span class=p>.</span><span class=n>PropertyName</span> <span class=p>==</span> <span class=s>&#34;Weight&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=c1>// Cast the sender to a smart bowl using the is type expression</span>
</span></span><span class=line><span class=cl>            <span class=k>if</span> <span class=p>(</span><span class=n>sender</span> <span class=k>is</span> <span class=n>SmartBowl</span> <span class=n>bowl</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            <span class=p>{</span>
</span></span><span class=line><span class=cl>                <span class=c1>// Ring the dinner bell if the bowl is now heavier </span>
</span></span><span class=line><span class=cl>                <span class=c1>// (i.e. food has been added)</span>
</span></span><span class=line><span class=cl>                <span class=k>if</span> <span class=p>(</span><span class=n>bowl</span><span class=p>.</span><span class=n>Weight</span> <span class=p>&gt;</span> <span class=n>lastWeight</span><span class=p>)</span> <span class=n>ringTheBell</span><span class=p>();</span>
</span></span><span class=line><span class=cl>                <span class=c1>// Cache the new weight</span>
</span></span><span class=line><span class=cl>                <span class=n>lastWeight</span> <span class=p>=</span> <span class=n>bowl</span><span class=p>.</span><span class=n>Weight</span><span class=p>;</span>
</span></span><span class=line><span class=cl>            <span class=p>}</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=cs>/// &lt;summary&gt;</span>
</span></span><span class=line><span class=cl>    <span class=cs>/// Helper method to make noise </span>
</span></span><span class=line><span class=cl>    <span class=cs>/// &lt;/summary&gt;</span>
</span></span><span class=line><span class=cl>    <span class=kd>private</span> <span class=k>void</span> <span class=n>ringTheBell</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=c1>// TODO: Implement noisemaking</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span></span></span></code></pre></div><h4 id=propertychanged-event-declaration>PropertyChanged Event Declaration</h4><p>For the event listeners to work as expected, we need to implement the <code>PropertyChanged</code> event in our <code>SmartBowl</code> class with:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-csharp data-lang=csharp><span class=line><span class=cl><span class=kd>public</span> <span class=k>event</span> <span class=n>PropertyChangedEventHandler</span><span class=p>?</span> <span class=n>PropertyChanged</span><span class=p>;</span></span></span></code></pre></div><p>Which makes it available for the event handlers to attach to. But this is only <em>part</em> of the process, we also need to <em>invoke</em> this event when it happens. This is done with the <code>Invoke(object sender, EventArgs e)</code> method defined for every event handler. It takes two parameters, an <code>object</code> which is the source of the event, and the <code>EventArgs</code> defining the event. The specific kind of <code>EventArgs</code> corresponds to the event declaration - in our case, <code>PropertyChangedEventArgs</code>.</p><p>Let&rsquo;s start with a straightforward example. Assume we have a <code>Name</code> property in the <code>SmartBowl</code> that is a customizable string, allowing us to identify the bowl, i.e. &ldquo;Water&rdquo; or &ldquo;Food&rdquo;. When we change it, we need to invoke the <code>PropertyChanged</code> event, i.e.:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-csharp data-lang=csharp><span class=line><span class=cl><span class=kd>private</span> <span class=kt>string</span> <span class=n>name</span> <span class=p>=</span> <span class=s>&#34;Bowl&#34;</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=kd>public</span> <span class=kt>string</span> <span class=n>Name</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>get</span> <span class=p>{</span><span class=k>return</span> <span class=n>name</span><span class=p>;}</span>
</span></span><span class=line><span class=cl>    <span class=k>set</span> 
</span></span><span class=line><span class=cl>    <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=n>name</span> <span class=p>=</span> <span class=k>value</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=n>PropertyChanged</span><span class=p>?.</span><span class=n>Invoke</span><span class=p>(</span><span class=k>this</span><span class=p>,</span> <span class=k>new</span> <span class=n>PropertyChangedEventArgs</span><span class=p>(</span><span class=s>&#34;Name&#34;</span><span class=p>));</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span></span></span></code></pre></div><p>Notice how we use the setter for <code>Name</code> to invoke the <code>PropertyChanged</code> event handler, <em>after</em> the change to the property has been made. This invocation needs to be done <em>after</em> the change, or the responding event listener may grab the <em>old</em> value (remember, event listeners are triggered <em>synchronously</em>).</p><p>Also note that we use the null-conditional operator <a href=https://docs.microsoft.com/en-us/dotnet/csharp/language-reference/operators/member-access-operators#null-conditional-operators--and- rel=external target=_blank><code>?.</code></a> to avoid calling the <code>Invoke()</code> method if <code>PropertyChanged</code> is null (which is the case if no event listeners have been assigned).</p><p>Now let&rsquo;s tackle a more complex example. Since our <code>SmartBowl</code> uses a sensor to measure the weight of its contents, we might be able to read the sensor data - probably through a driver or a class representing the sensor. Rather than doing this constantly, let&rsquo;s set a polling interval of 1 minute:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-csharp data-lang=csharp><span class=line><span class=cl><span class=cs>/// &lt;summary&gt;</span>
</span></span><span class=line><span class=cl><span class=cs>/// A class representing a &#34;smart&#34; dog bowl.</span>
</span></span><span class=line><span class=cl><span class=cs>/// &lt;/summary&gt;</span>
</span></span><span class=line><span class=cl><span class=kd>public</span> <span class=k>class</span> <span class=nc>SmartBowl</span> <span class=p>:</span> <span class=n>INotifyPropertyChanged</span> 
</span></span><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=cs>/// &lt;summary&gt;</span>
</span></span><span class=line><span class=cl>    <span class=cs>/// Event triggered when a property changes</span>
</span></span><span class=line><span class=cl>    <span class=cs>/// &lt;/summary&gt;</span>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=k>event</span> <span class=n>PropertyChangedEventHandler</span><span class=p>?</span> <span class=n>PropertyChanged</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=cs>/// &lt;summary&gt;</span>
</span></span><span class=line><span class=cl>    <span class=cs>/// The weight sensor installed in the bowl</span>
</span></span><span class=line><span class=cl>    <span class=cs>/// &lt;/summary&gt;</span>
</span></span><span class=line><span class=cl>    <span class=n>Sensor</span> <span class=n>sensor</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=kd>private</span> <span class=kt>string</span> <span class=n>name</span> <span class=p>=</span> <span class=s>&#34;Bowl&#34;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=cs>/// &lt;summary&gt;</span>
</span></span><span class=line><span class=cl>    <span class=cs>/// The name of this bowl</span>
</span></span><span class=line><span class=cl>    <span class=cs>/// &lt;/summary&gt;</span>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=kt>string</span> <span class=n>Name</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=k>get</span> <span class=p>{</span> <span class=k>return</span> <span class=n>name</span><span class=p>;</span> <span class=p>}</span>
</span></span><span class=line><span class=cl>        <span class=k>set</span>
</span></span><span class=line><span class=cl>        <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=n>name</span> <span class=p>=</span> <span class=k>value</span><span class=p>;</span>
</span></span><span class=line><span class=cl>            <span class=n>PropertyChanged</span><span class=p>?.</span><span class=n>Invoke</span><span class=p>(</span><span class=k>this</span><span class=p>,</span> <span class=k>new</span> <span class=n>PropertyChangedEventArgs</span><span class=p>(</span><span class=s>&#34;Name&#34;</span><span class=p>));</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=kd>private</span> <span class=kt>double</span> <span class=n>weight</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=cs>/// &lt;summary&gt;</span>
</span></span><span class=line><span class=cl>    <span class=cs>/// The weight of the bowl contents, measured in ounces</span>
</span></span><span class=line><span class=cl>    <span class=cs>/// &lt;/summary&gt;</span>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=kt>double</span> <span class=n>Weight</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=k>get</span> <span class=p>{</span> <span class=k>return</span> <span class=n>weight</span><span class=p>;</span> <span class=p>}</span>
</span></span><span class=line><span class=cl>        <span class=k>set</span>
</span></span><span class=line><span class=cl>        <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=c1>// We only want to treat the weight as changing </span>
</span></span><span class=line><span class=cl>            <span class=c1>// if the change is more than a 16th of an ounce</span>
</span></span><span class=line><span class=cl>            <span class=k>if</span> <span class=p>(</span><span class=n>Math</span><span class=p>.</span><span class=n>Abs</span><span class=p>(</span><span class=n>weight</span> <span class=p>-</span> <span class=k>value</span><span class=p>)</span> <span class=p>&gt;</span> <span class=m>1</span> <span class=p>/</span> <span class=m>16</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            <span class=p>{</span>
</span></span><span class=line><span class=cl>                <span class=n>weight</span> <span class=p>=</span> <span class=k>value</span><span class=p>;</span>
</span></span><span class=line><span class=cl>                <span class=c1>// Notify of the property changing</span>
</span></span><span class=line><span class=cl>                <span class=n>PropertyChanged</span><span class=p>?.</span><span class=n>Invoke</span><span class=p>(</span><span class=k>this</span><span class=p>,</span> <span class=k>new</span> <span class=n>PropertyChangedEventArgs</span><span class=p>(</span><span class=s>&#34;Weight&#34;</span><span class=p>));</span>
</span></span><span class=line><span class=cl>            <span class=p>}</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=cs>/// &lt;summary&gt;</span>
</span></span><span class=line><span class=cl>    <span class=cs>/// Constructs a new SmartBowl </span>
</span></span><span class=line><span class=cl>    <span class=cs>/// &lt;/summary&gt;</span>
</span></span><span class=line><span class=cl>    <span class=cs>/// &lt;param Name=&#34;sensor&#34;&gt;the weight sensor&lt;/param&gt;</span>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=n>SmartBowl</span><span class=p>(</span><span class=n>Sensor</span> <span class=n>sensor</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=k>this</span><span class=p>.</span><span class=n>sensor</span> <span class=p>=</span> <span class=n>sensor</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=c1>// Set the initial weight</span>
</span></span><span class=line><span class=cl>        <span class=n>weight</span> <span class=p>=</span> <span class=n>sensor</span><span class=p>.</span><span class=n>Value</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=c1>// Set a timer to go off in 1 minute  </span>
</span></span><span class=line><span class=cl>        <span class=c1>// (ms = 60 seconds/minute * 1000 milliseconds/seconds)</span>
</span></span><span class=line><span class=cl>        <span class=kt>var</span> <span class=n>timer</span> <span class=p>=</span> <span class=k>new</span> <span class=n>System</span><span class=p>.</span><span class=n>Timers</span><span class=p>.</span><span class=n>Timer</span><span class=p>(</span><span class=m>60</span> <span class=p>*</span> <span class=m>1000</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=c1>// Set the timer to reset when it goes off </span>
</span></span><span class=line><span class=cl>        <span class=n>timer</span><span class=p>.</span><span class=n>AutoReset</span> <span class=p>=</span> <span class=kc>true</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=c1>// Trigger a sensor read each time the timer elapses</span>
</span></span><span class=line><span class=cl>        <span class=n>timer</span><span class=p>.</span><span class=n>Elapsed</span> <span class=p>+=</span> <span class=n>readSensor</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=cs>/// &lt;summary&gt;</span>
</span></span><span class=line><span class=cl>    <span class=cs>/// Handles the elapsing of the polling timer by updating the weight</span>
</span></span><span class=line><span class=cl>    <span class=cs>/// &lt;/summary&gt;</span>
</span></span><span class=line><span class=cl>    <span class=kd>private</span> <span class=k>void</span> <span class=n>readSensor</span><span class=p>(</span><span class=kt>object</span> <span class=n>Sender</span><span class=p>,</span> <span class=n>System</span><span class=p>.</span><span class=n>Timers</span><span class=p>.</span><span class=n>ElapsedEventArgs</span> <span class=n>e</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=k>this</span><span class=p>.</span><span class=n>Weight</span> <span class=p>=</span> <span class=n>sensor</span><span class=p>.</span><span class=n>Value</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=p>}</span></span></span></code></pre></div><p>Notice in this code, we use the setter of the <code>Weight</code> property to trigger the <code>PropertyChanged</code> event. Because we&rsquo;re dealing with a real-world sensor that may have slight variations in the readings, we also only treat changes of more than 1/16th of an ounce as significant enough to change the property.</p><div class="box notices cstyle warning"><div class=box-label><i class="fa-fw fas fa-exclamation-triangle"></i> Warning</div><div class=box-content><p>With the <code>INotifyPropertyChanged</code> interface, the <em>only</em> aspect Visual Studio checks is that the <code>PropertyChanged</code> event is declared. There is no built-in check that the programmer is using it as expected. Therefore it is upon you, the programmer, to ensure that you meet the expectation that comes with implementing this interface: <em>that any public or protected property that changes will invoke the <code>PropertyChanged</code> event</em>.</p></div></div><h4 id=testing-the-propertychanged-event>Testing the PropertyChanged Event</h4><p>Finally, we should write unit tests to confirm that our <code>PropertyChanged</code> event works as expected:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-csharp data-lang=csharp><span class=line><span class=cl><span class=kd>public</span> <span class=k>class</span> <span class=nc>SmartBowlUnitTests</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=cs>/// &lt;summary&gt;</span>
</span></span><span class=line><span class=cl>    <span class=cs>/// A mock sensor that increases its reading by one ounce </span>
</span></span><span class=line><span class=cl>    <span class=cs>/// every time its Value property is invoked.</span>
</span></span><span class=line><span class=cl>    <span class=cs>/// &lt;/summary&gt;</span>
</span></span><span class=line><span class=cl>    <span class=k>class</span> <span class=nc>MockChangingWeightSensor</span> <span class=p>:</span> <span class=n>Sensor</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=kt>double</span> <span class=k>value</span> <span class=p>=</span> <span class=m>0.0</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=kd>public</span> <span class=kt>double</span> <span class=n>Value</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=k>get</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>                <span class=k>value</span> <span class=p>+=</span> <span class=m>1</span><span class=p>;</span>
</span></span><span class=line><span class=cl>                <span class=k>return</span> <span class=k>value</span><span class=p>;</span>
</span></span><span class=line><span class=cl>            <span class=p>}</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=na>
</span></span></span><span class=line><span class=cl><span class=na>    [Fact]</span>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=k>void</span> <span class=n>NameChangeShouldTriggerPropertyChanged</span><span class=p>()</span> 
</span></span><span class=line><span class=cl>    <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=kt>var</span> <span class=n>bowl</span> <span class=p>=</span> <span class=k>new</span> <span class=n>SmartBowl</span><span class=p>(</span><span class=k>new</span> <span class=n>MockChangingWeightSensor</span><span class=p>());</span>
</span></span><span class=line><span class=cl>        <span class=n>Assert</span><span class=p>.</span><span class=n>PropertyChanged</span><span class=p>(</span><span class=n>bowl</span><span class=p>,</span> <span class=s>&#34;Name&#34;</span><span class=p>,</span> <span class=p>()</span> <span class=p>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=n>bowl</span><span class=p>.</span><span class=n>Name</span> <span class=p>=</span> <span class=s>&#34;New Name&#34;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=p>});</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=na>
</span></span></span><span class=line><span class=cl><span class=na>    [Fact]</span>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=k>void</span> <span class=n>WeightChangeShouldTriggerPropertyChanged</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=kt>var</span> <span class=n>bowl</span> <span class=p>=</span> <span class=k>new</span> <span class=n>SmartBowl</span><span class=p>(</span><span class=k>new</span> <span class=n>MockChangingWeightSensor</span><span class=p>());</span>
</span></span><span class=line><span class=cl>        <span class=n>Assert</span><span class=p>.</span><span class=n>PropertyChangedAsync</span><span class=p>(</span><span class=n>bowl</span><span class=p>,</span> <span class=s>&#34;Weight&#34;</span><span class=p>,</span> <span class=p>()</span> <span class=p>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=k>return</span> <span class=n>Task</span><span class=p>.</span><span class=n>Delay</span><span class=p>(</span><span class=m>2</span> <span class=p>*</span> <span class=m>60</span> <span class=p>*</span> <span class=m>1000</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=p>});</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span></span></span></code></pre></div><p>The <code>PropertyChanged</code> interface is so common in C# programming that we have <em>two</em> assertions dealing with it. The first we use to test the <code>Name</code> property:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-csharp data-lang=csharp><span class=line><span class=cl><span class=na>[Fact]</span>
</span></span><span class=line><span class=cl><span class=kd>public</span> <span class=k>void</span> <span class=n>NameChangeShouldTriggerPropertyChanged</span><span class=p>()</span> 
</span></span><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=kt>var</span> <span class=n>bowl</span> <span class=p>=</span> <span class=k>new</span> <span class=n>SmartBowl</span><span class=p>(</span><span class=k>new</span> <span class=n>MockChangingWeightSensor</span><span class=p>());</span>
</span></span><span class=line><span class=cl>    <span class=n>Assert</span><span class=p>.</span><span class=n>PropertyChanged</span><span class=p>(</span><span class=n>bowl</span><span class=p>,</span> <span class=s>&#34;Name&#34;</span><span class=p>,</span> <span class=p>()</span> <span class=p>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=n>bowl</span><span class=p>.</span><span class=n>Name</span> <span class=p>=</span> <span class=s>&#34;New Name&#34;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=p>});</span>
</span></span><span class=line><span class=cl><span class=p>}</span></span></span></code></pre></div><p>Notice that <code>Assert.PropertyChanged(@object obj, string propertyName, Action action)</code> takes three arguments - first the object with the property that should be changing, second the name of the property we expect to change, and third an action that should trigger the event. In this case, we change the name property.</p><p>The second is a bit more involved, as we have an event that happens based on a timer. To test it therefore, we have to wait for the timer to have had an opportunity to trigger. We do this with an asynchronous action, so we use the <code>Assert.PropertyChangedAsync(@object obj, string propertyName, Func&lt;Task> action)</code>. The first two arguments are the same, but the last one is a <code>Func</code> (a function) that returns an asynchronous <code>Task</code> object. The simplest one to use here is <code>Task.Delay</code>, which delays for the supplied period of time (in our case, two minutes). Since our property should change on one-minute intervals, we&rsquo;ll know if there was a problem if it doesn&rsquo;t change after two minutes.</p><footer class=footline></footer></article></div></main></div><script src=/cis400/js/clipboard.min.js?1728334422 defer></script><script src=/cis400/js/perfect-scrollbar.min.js?1728334422 defer></script><script src=/cis400/js/theme.js?1728334422 defer></script><script src=/cis400/js/embed-iframe.js?1728334422 defer></script></body></html>