<!doctype html><html lang=en-us dir=ltr itemscope itemtype=http://schema.org/Article><head><meta charset=utf-8><meta name=viewport content="height=device-height,width=device-width,initial-scale=1,minimum-scale=1"><meta name=generator content="Hugo 0.128.0"><meta name=generator content="Relearn 6.0.0"><meta name=description content="In the previous section, we discussed using XUnit’s Assert.Raises<T> to test generic events (events declared with the EventHandler<T> generic). However, this approach does not work with non-generic events, like PropertyChanged and CollectionChanged. That is why XUnit provides an Assert.PropertyChanged() method. Unfortunately, it does not offer a corresponding test for CollectionChanged. So to test for this expectation we will need to write our own assertions.
To do that, we need to understand how assertions in the XUnit framework work."><meta name=author content="Nathan Bean"><meta name=twitter:card content="summary"><meta name=twitter:title content="Testing Custom Events :: K-State CIS 400 Textbook"><meta name=twitter:description content="In the previous section, we discussed using XUnit’s Assert.Raises<T> to test generic events (events declared with the EventHandler<T> generic). However, this approach does not work with non-generic events, like PropertyChanged and CollectionChanged. That is why XUnit provides an Assert.PropertyChanged() method. Unfortunately, it does not offer a corresponding test for CollectionChanged. So to test for this expectation we will need to write our own assertions.
To do that, we need to understand how assertions in the XUnit framework work."><meta property="og:url" content="https://textbooks.cs.ksu.edu/cis400/2-desktop-development/03-events/11-testing-custom-events/"><meta property="og:site_name" content="K-State CIS 400 Textbook"><meta property="og:title" content="Testing Custom Events :: K-State CIS 400 Textbook"><meta property="og:description" content="In the previous section, we discussed using XUnit’s Assert.Raises<T> to test generic events (events declared with the EventHandler<T> generic). However, this approach does not work with non-generic events, like PropertyChanged and CollectionChanged. That is why XUnit provides an Assert.PropertyChanged() method. Unfortunately, it does not offer a corresponding test for CollectionChanged. So to test for this expectation we will need to write our own assertions.
To do that, we need to understand how assertions in the XUnit framework work."><meta property="og:locale" content="en-us"><meta property="og:type" content="article"><meta property="article:section" content="Desktop Development"><meta property="article:published_time" content="2018-08-24T10:53:26-05:00"><meta property="article:modified_time" content="2024-03-05T09:03:23-06:00"><meta itemprop=name content="Testing Custom Events :: K-State CIS 400 Textbook"><meta itemprop=description content="In the previous section, we discussed using XUnit’s Assert.Raises<T> to test generic events (events declared with the EventHandler<T> generic). However, this approach does not work with non-generic events, like PropertyChanged and CollectionChanged. That is why XUnit provides an Assert.PropertyChanged() method. Unfortunately, it does not offer a corresponding test for CollectionChanged. So to test for this expectation we will need to write our own assertions.
To do that, we need to understand how assertions in the XUnit framework work."><meta itemprop=datePublished content="2018-08-24T10:53:26-05:00"><meta itemprop=dateModified content="2024-03-05T09:03:23-06:00"><meta itemprop=wordCount content="1243"><title>Testing Custom Events :: K-State CIS 400 Textbook</title>
<link href=https://textbooks.cs.ksu.edu/cis400/2-desktop-development/03-events/11-testing-custom-events/ rel=canonical type=text/html title="Testing Custom Events :: K-State CIS 400 Textbook"><link href=/cis400/2-desktop-development/03-events/11-testing-custom-events/index.xml rel=alternate type=application/rss+xml title="Testing Custom Events :: K-State CIS 400 Textbook"><link href=/cis400/2-desktop-development/03-events/11-testing-custom-events/index.print.html rel=alternate type=text/html title="Testing Custom Events :: K-State CIS 400 Textbook"><link href=/cis400/2-desktop-development/03-events/11-testing-custom-events/embed.html rel=alternate type=text/html title="Testing Custom Events :: K-State CIS 400 Textbook"><link href=/cis400/css/fontawesome-all.min.css?1724347214 rel=stylesheet media=print onload='this.media="all",this.onload=null'><noscript><link href=/cis400/css/fontawesome-all.min.css?1724347214 rel=stylesheet></noscript><link href=/cis400/css/nucleus.css?1724347214 rel=stylesheet><link href=/cis400/css/auto-complete.css?1724347214 rel=stylesheet media=print onload='this.media="all",this.onload=null'><noscript><link href=/cis400/css/auto-complete.css?1724347214 rel=stylesheet></noscript><link href=/cis400/css/perfect-scrollbar.min.css?1724347214 rel=stylesheet><link href=/cis400/css/fonts.css?1724347214 rel=stylesheet media=print onload='this.media="all",this.onload=null'><noscript><link href=/cis400/css/fonts.css?1724347214 rel=stylesheet></noscript><link href=/cis400/css/theme.css?1724347214 rel=stylesheet><link href=/cis400/css/theme-auto.css?1724347214 rel=stylesheet id=R-variant-style><link href=/cis400/css/chroma-auto.css?1724347214 rel=stylesheet id=R-variant-chroma-style><link href=/cis400/css/variant.css?1724347214 rel=stylesheet><link href=/cis400/css/print.css?1724347214 rel=stylesheet media=print><script src=/cis400/js/variant.js?1724347214></script><script>window.relearn=window.relearn||{},window.relearn.relBasePath="../../..",window.relearn.relBaseUri="../../../..",window.relearn.absBaseUri="https://textbooks.cs.ksu.edu/cis400",window.index_js_url="/cis400/index.search.js",window.variants&&variants.init(["auto","light-theme","dark-theme"]),window.T_Copy_to_clipboard=`Copy to clipboard`,window.T_Copied_to_clipboard=`Copied to clipboard!`,window.T_Copy_link_to_clipboard=`Copy link to clipboard`,window.T_Link_copied_to_clipboard=`Copied link to clipboard!`,window.T_Reset_view=`Reset view`,window.T_View_reset=`View reset!`,window.T_No_results_found=`No results found for "{0}"`,window.T_N_results_found=`{1} results found for "{0}"`</script><link href=/cis400/css/custom.css?1724347214 rel=stylesheet></head><body class="mobile-support tele disableInlineCopyToClipboard" data-url=/cis400/2-desktop-development/03-events/11-testing-custom-events/><div id=tele class="tele mirror"><div id=R-body class=default-animation><div id=R-body-overlay></div><div id=R-main-overlay></div><main id=R-body-inner class="highlightable default" tabindex=-1><div class=flex-block-wrapper><article class=default><header class=headline></header><h1 id=testing-custom-events>Testing Custom Events</h1><p>In the previous section, we discussed using XUnit&rsquo;s <code>Assert.Raises&lt;T></code> to test generic events (events declared with the <code>EventHandler&lt;T></code> generic). However, this approach does not work with non-generic events, like <code>PropertyChanged</code> and <code>CollectionChanged</code>. That is why XUnit provides an <code>Assert.PropertyChanged()</code> method. Unfortunately, it does not offer a corresponding test for <code>CollectionChanged</code>. So to test for this expectation we will need to write our own assertions.</p><p>To do that, we need to understand how assertions in the XUnit framework work. Essentially, they test the truthfulness of what is being asserted (i.e. two values are equal, a collection contains an item, etc.). If the assertion is not true, then the code raises an exception - specifically, a <code>XunitException</code> or a class derived from it. This class provides a <code>UserMessage</code> (the message you get when the test fails) and a <code>StackTrace</code> (the lines describing where the error was thrown). With this in mind, we can write our own assertion method. Let&rsquo;s start with a simple example that asserts the value of a string is &ldquo;Hello World&rdquo;:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-csharp data-lang=csharp><span class=line><span class=cl><span class=kd>public</span> <span class=kd>static</span> <span class=k>class</span> <span class=nc>MyAssert</span>
</span></span><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=kd>public</span> <span class=k>class</span> <span class=nc>HelloWorldAssertionException</span><span class=p>:</span> <span class=n>XunitException</span> 
</span></span><span class=line><span class=cl>  <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=kd>public</span> <span class=n>HelloWorldAssertionException</span><span class=p>(</span><span class=kt>string</span> <span class=n>actual</span><span class=p>)</span> <span class=p>:</span> <span class=k>base</span><span class=p>(</span><span class=s>$&#34;Expected \&#34;</span><span class=n>Hello</span> <span class=n>World</span><span class=err>\</span><span class=s>&#34; but instead saw \&#34;{actual}\&#34;&#34;</span><span class=p>)</span> <span class=p>{}</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=kd>public</span> <span class=kd>static</span> <span class=k>void</span> <span class=n>HelloWorld</span><span class=p>(</span><span class=kt>string</span> <span class=n>phrase</span><span class=p>)</span>
</span></span><span class=line><span class=cl>  <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span><span class=p>(</span><span class=n>phrase</span> <span class=p>!=</span> <span class=s>&#34;Hello World&#34;</span><span class=p>)</span> <span class=k>throw</span> <span class=k>new</span> <span class=n>HelloWorldAssertionException</span><span class=p>(</span><span class=n>phrase</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span></span></span></code></pre></div><p>Note that we use the <code>base</code> keyword to execute the <code>XunitException</code> constructor as part of the <code>HelloWorldAssertionException</code>, and pass along the <code>string</code> parameter <code>actual</code>. Then the body of the <code>XunitException</code> constructor does all the work of setting values, so the body of our constructor is empty.</p><p>Now we can use this assertion in our own tests:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-csharp data-lang=csharp><span class=line><span class=cl><span class=na>[Theory]</span>
</span></span><span class=line><span class=cl><span class=na>[InlineData(&#34;Hello World&#34;)]</span>
</span></span><span class=line><span class=cl><span class=na>[InlineData(&#34;Hello Bob&#34;)]</span>
</span></span><span class=line><span class=cl><span class=kd>public</span> <span class=k>void</span> <span class=n>ShouldBeHelloWorld</span><span class=p>(</span><span class=kt>string</span> <span class=n>phrase</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=n>MyAssert</span><span class=p>.</span><span class=n>HelloWorld</span><span class=p>(</span><span class=n>phrase</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=p>}</span></span></span></code></pre></div><p>The first <code>InlineData</code> will pass, and the second will fail with the report <code>Expected "Hello World" but instead saw "Hello Bob"</code>.</p><p>This was of course, a silly example, but it shows the basic concepts. We would probably never use this in our own work, as <code>Assert.Equal()</code> can do the same thing. Now let&rsquo;s look at a more complex example that we <em>would</em> use.</p><h2 id=assertions-for-collectionchanged>Assertions for CollectionChanged</h2><p>As we discussed previously, the <code>CollectionChanged</code> event cannot be tested with the Xunit <code>Assert.Throws</code>. So this is a great candidate for custom assertions. To be thorough, we should test <em>all</em> the possible actions (and we would do this if expanding the Xunit library). But for how we plan to use it, we really only need two actions covered - adding and removing items <em>one at a time</em> from the collection. Let&rsquo;s start with our exception definitions:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-csharp data-lang=csharp><span class=line><span class=cl><span class=kd>public</span> <span class=kd>static</span> <span class=k>class</span> <span class=nc>MyAssert</span>
</span></span><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=kd>public</span> <span class=k>class</span> <span class=nc>NotifyCollectionChangedNotTriggeredException</span><span class=p>:</span> <span class=n>XunitException</span> 
</span></span><span class=line><span class=cl>  <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=kd>public</span> <span class=n>NotifyCollectionChangedNotTriggeredException</span><span class=p>(</span><span class=n>NotifyCollectionChangedAction</span> <span class=n>expectedAction</span><span class=p>)</span> <span class=p>:</span> <span class=k>base</span><span class=p>(</span><span class=s>$&#34;Expected a NotifyCollectionChanged event with an action of {expectedAction} to be invoked, but saw none.&#34;</span><span class=p>)</span> <span class=p>{}</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=kd>public</span> <span class=k>class</span> <span class=nc>NotifyCollectionChangedWrongActionException</span><span class=p>:</span> <span class=n>XunitException</span> 
</span></span><span class=line><span class=cl>  <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=kd>public</span> <span class=n>NotifyCollectionChangedWrongActionException</span><span class=p>(</span><span class=n>NotifyCollectionChangedAction</span> <span class=n>expectedAction</span><span class=p>,</span> <span class=n>NotifyCollectionChangedAction</span> <span class=n>actualAction</span><span class=p>)</span> <span class=p>:</span> <span class=k>base</span><span class=p>(</span><span class=s>$&#34;Expected a NotifyCollectionChanged event with an action of {expectedAction} to be invoked, but saw {actualAction}&#34;</span><span class=p>)</span> <span class=p>{}</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=kd>public</span> <span class=k>class</span> <span class=nc>NotifyCollectionChangedAddException</span><span class=p>:</span> <span class=n>XunitException</span> 
</span></span><span class=line><span class=cl>  <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=kd>public</span> <span class=n>NotifyCollectionChangedAddException</span><span class=p>(</span><span class=kt>object</span> <span class=n>expected</span><span class=p>,</span> <span class=kt>object</span> <span class=n>actual</span><span class=p>)</span> <span class=p>:</span> <span class=k>base</span><span class=p>(</span><span class=s>$&#34;Expected a NotifyCollectionChanged event with an action of Add and object {expected} but instead saw {actual}&#34;</span><span class=p>)</span> <span class=p>{}</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=kd>public</span> <span class=k>class</span> <span class=nc>NotifyCollectionChangedRemoveException</span> <span class=p>:</span> <span class=n>XunitException</span>
</span></span><span class=line><span class=cl>  <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=n>NotifyCollectionChangedRemoveException</span><span class=p>(</span><span class=kt>object</span> <span class=n>expectedItem</span><span class=p>,</span> <span class=kt>int</span> <span class=n>expectedIndex</span><span class=p>,</span> <span class=kt>object</span> <span class=n>actualItem</span><span class=p>,</span> <span class=kt>int</span> <span class=n>actualIndex</span><span class=p>)</span> <span class=p>:</span> <span class=k>base</span><span class=p>(</span><span class=s>$&#34;Expected a NotifyCollectionChanged event with an action of Remove and object {expectedItem} at index {expectedIndex} but instead saw {actualItem} at index  {actualIndex}&#34;</span><span class=p>)</span> <span class=p>{}</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span></span></span></code></pre></div><p>We have four different exceptions, each with a very specific message conveying what the failure was due to - no event being triggered, an event with the wrong action being triggered, or an event with the wrong information being triggered. We could also handle this with one exception class using multiple constructors (much like the <code>NotifyCollectionChangedEventArgs</code> does).</p><p>Then we need to write our assertions, which are more involved than our previous example as 1) the event uses a generic type, so our assertion also must be a generic, and 2) we need to handle an event - so we need to attach an event handler, and trigger code that should make that event occur. Let&rsquo;s start with defining the signature of the <code>Add</code> method:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-csharp data-lang=csharp><span class=line><span class=cl><span class=kd>public</span> <span class=kd>static</span> <span class=k>class</span> <span class=nc>MyAssert</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=kd>public</span> <span class=kd>static</span> <span class=k>void</span> <span class=n>NotifyCollectionChangedAdd</span><span class=p>&lt;</span><span class=n>T</span><span class=p>&gt;(</span><span class=n>INotifyCollectionChanged</span> <span class=n>collection</span><span class=p>,</span> <span class=n>T</span> <span class=n>item</span><span class=p>,</span> <span class=n>Action</span> <span class=n>testCode</span><span class=p>)</span> 
</span></span><span class=line><span class=cl>  <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=c1>// Assertion tests here.</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span></span></span></code></pre></div><p>We use the generic type <code>T</code> to allow our assertion to be used with any kind of collection - and the second parameter <code>item</code> is <em>also</em> this type. That is the object we are trying to add to the <code>collection</code>. Finally, the <code>Action</code> is the code the test will execute that would, in theory, add <code>item</code> to <code>collection</code>. Let&rsquo;s flesh out the method body now:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-csharp data-lang=csharp><span class=line><span class=cl><span class=kd>public</span> <span class=kd>static</span> <span class=k>class</span> <span class=nc>MyAssert</span>
</span></span><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=kd>public</span> <span class=kd>static</span> <span class=k>void</span> <span class=n>NotifyCollectionChangedAdd</span><span class=p>&lt;</span><span class=n>T</span><span class=p>&gt;(</span><span class=n>INotifyCollectionChanged</span> <span class=n>collection</span><span class=p>,</span> <span class=n>T</span> <span class=n>newItem</span><span class=p>,</span> <span class=n>Action</span> <span class=n>testCode</span><span class=p>)</span>
</span></span><span class=line><span class=cl>  <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=c1>// A flag to indicate if the event triggered successfully</span>
</span></span><span class=line><span class=cl>    <span class=kt>bool</span> <span class=n>notifySucceeded</span> <span class=p>=</span> <span class=kc>false</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c1>// An event handler to attach to the INotifyCollectionChanged and be </span>
</span></span><span class=line><span class=cl>    <span class=c1>// notified when the Add event occurs.</span>
</span></span><span class=line><span class=cl>    <span class=n>NotifyCollectionChangedEventHandler</span> <span class=n>handler</span> <span class=p>=</span> <span class=p>(</span><span class=n>sender</span><span class=p>,</span> <span class=n>args</span><span class=p>)</span> <span class=p>=&gt;</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=c1>// Make sure the event is an Add event</span>
</span></span><span class=line><span class=cl>      <span class=k>if</span> <span class=p>(</span><span class=n>args</span><span class=p>.</span><span class=n>Action</span> <span class=p>!=</span> <span class=n>NotifyCollectionChangedAction</span><span class=p>.</span><span class=n>Add</span><span class=p>)</span>
</span></span><span class=line><span class=cl>      <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=k>throw</span> <span class=k>new</span> <span class=n>NotifyCollectionChangedWrongActionException</span><span class=p>(</span><span class=n>NotifyCollectionChangedAction</span><span class=p>.</span><span class=n>Add</span><span class=p>,</span> <span class=n>args</span><span class=p>.</span><span class=n>Action</span><span class=p>);</span>
</span></span><span class=line><span class=cl>      <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>      <span class=c1>// Make sure we added just one item</span>
</span></span><span class=line><span class=cl>      <span class=k>if</span> <span class=p>(</span><span class=n>args</span><span class=p>.</span><span class=n>NewItems</span><span class=p>?.</span><span class=n>Count</span> <span class=p>!=</span> <span class=m>1</span><span class=p>)</span>
</span></span><span class=line><span class=cl>      <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=c1>// We&#39;ll use the collection of added items as the second argument</span>
</span></span><span class=line><span class=cl>        <span class=k>throw</span> <span class=k>new</span> <span class=n>NotifyCollectionChangedAddException</span><span class=p>(</span><span class=n>newItem</span><span class=p>,</span> <span class=n>args</span><span class=p>.</span><span class=n>NewItems</span><span class=p>);</span>
</span></span><span class=line><span class=cl>      <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>      <span class=c1>// Make sure the added item is what we expected</span>
</span></span><span class=line><span class=cl>      <span class=k>if</span> <span class=p>(!</span><span class=n>args</span><span class=p>.</span><span class=n>NewItems</span><span class=p>[</span><span class=m>0</span><span class=p>].</span><span class=n>Equals</span><span class=p>(</span><span class=n>newItem</span><span class=p>))</span>
</span></span><span class=line><span class=cl>      <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=c1>// Here we only have one item in the changed collection, so we&#39;ll report it directly</span>
</span></span><span class=line><span class=cl>        <span class=k>throw</span> <span class=k>new</span> <span class=n>NotifyCollectionChangedAddException</span><span class=p>(</span><span class=n>newItem</span><span class=p>,</span> <span class=n>args</span><span class=p>.</span><span class=n>NewItems</span><span class=p>[</span><span class=m>0</span><span class=p>]);</span>
</span></span><span class=line><span class=cl>      <span class=p>}</span> 
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>      <span class=c1>// If we reach this point, the NotifyCollectionChanged event was triggered successfully</span>
</span></span><span class=line><span class=cl>      <span class=c1>// and contains the correct item! We&#39;ll set the flag to true so we know.</span>
</span></span><span class=line><span class=cl>      <span class=n>notifySucceeded</span> <span class=p>=</span> <span class=kc>true</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=p>};</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c1>// Now we connect the event handler </span>
</span></span><span class=line><span class=cl>    <span class=n>collection</span><span class=p>.</span><span class=n>CollectionChanged</span> <span class=p>+=</span> <span class=n>handler</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c1>// And attempt to trigger the event by running the actionCode</span>
</span></span><span class=line><span class=cl>    <span class=c1>// We place this in a try/catch to be able to utilize the finally </span>
</span></span><span class=line><span class=cl>    <span class=c1>// clause, but don&#39;t actually catch any exceptions</span>
</span></span><span class=line><span class=cl>    <span class=k>try</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=n>testCode</span><span class=p>();</span>
</span></span><span class=line><span class=cl>      <span class=c1>// After this code has been run, our handler should have </span>
</span></span><span class=line><span class=cl>      <span class=c1>// triggered, and if all went well, the notifySucceed is true</span>
</span></span><span class=line><span class=cl>      <span class=k>if</span> <span class=p>(!</span><span class=n>notifySucceeded</span><span class=p>)</span>
</span></span><span class=line><span class=cl>      <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=c1>// If notifySucceed is false, the event was not triggered</span>
</span></span><span class=line><span class=cl>        <span class=c1>// We throw an exception denoting that</span>
</span></span><span class=line><span class=cl>        <span class=k>throw</span> <span class=k>new</span> <span class=n>NotifyCollectionChangedNotTriggeredException</span><span class=p>(</span><span class=n>NotifyCollectionChangedAction</span><span class=p>.</span><span class=n>Add</span><span class=p>);</span>
</span></span><span class=line><span class=cl>      <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=c1>// We don&#39;t actually want to catch an exception - we want it to </span>
</span></span><span class=line><span class=cl>    <span class=c1>// bubble up and be reported as a failing test.  So we don&#39;t </span>
</span></span><span class=line><span class=cl>    <span class=c1>// have a catch () {} clause to this try/catch.</span>
</span></span><span class=line><span class=cl>    <span class=k>finally</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=c1>// However, we *do* want to remove the event handler. We do </span>
</span></span><span class=line><span class=cl>      <span class=c1>// this in a finally block so it will happen even if we do </span>
</span></span><span class=line><span class=cl>      <span class=c1>// have an exception occur. </span>
</span></span><span class=line><span class=cl>      <span class=n>collection</span><span class=p>.</span><span class=n>CollectionChanged</span> <span class=p>-=</span> <span class=n>handler</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span></span></span></code></pre></div><p>Now we can test this in our code. For example, if we had a collection of <code>ShoppingList</code> objects named <code>shoppingLists</code> that implemented <code>INotifyCollectionChanged</code>, we could test adding a new shopping list, <code>shoppingList</code>, to it with:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-csharp data-lang=csharp><span class=line><span class=cl><span class=kt>var</span> <span class=n>newList</span> <span class=p>=</span> <span class=k>new</span> <span class=n>ShoppingList</span><span class=p>();</span>
</span></span><span class=line><span class=cl><span class=n>MyAssert</span><span class=p>.</span><span class=n>NotifyCollectionChangedAdd</span><span class=p>(</span><span class=n>shoppingLists</span><span class=p>,</span> <span class=n>newList</span><span class=p>,</span> <span class=p>()</span> <span class=p>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=n>shoppingLists</span><span class=p>.</span><span class=n>Add</span><span class=p>(</span><span class=n>newList</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=p>});</span></span></span></code></pre></div><p>Note that we didn&rsquo;t need to explicitly state <code>T</code> in this case is <code>ShoppingList</code> - the compiler infers this from the arguments supplied to the method.</p><p>Our assertion method handles adding a <em>single</em> item. We can use method <em>overloading</em> providing another method of the same name with different arguments to handle when <em>multiple</em> items are added. For that case, the signature might look like:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-csharp data-lang=csharp><span class=line><span class=cl><span class=kd>public</span> <span class=kd>static</span> <span class=k>void</span> <span class=n>NotifyCollectionChangedAdd</span><span class=p>&lt;</span><span class=n>T</span><span class=p>&gt;(</span><span class=n>INotifyCollectionChanged</span> <span class=n>collection</span><span class=p>,</span> <span class=n>ICollection</span><span class=p>&lt;</span><span class=n>T</span><span class=p>&gt;</span> <span class=n>items</span><span class=p>,</span> <span class=n>Action</span> <span class=n>testCode</span><span class=p>)</span> 
</span></span><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=c1>// Assertion tests here.</span>
</span></span><span class=line><span class=cl><span class=p>}</span></span></span></code></pre></div><p>We&rsquo;d also want to write assertion methods for handling removing items, and any other actions we might need to test. I&rsquo;ll leave these as exercises for the reader.</p><footer class=footline></footer></article></div></main></div></div><script src=/cis400/js/clipboard.min.js?1724347214 defer></script><script src=/cis400/js/perfect-scrollbar.min.js?1724347214 defer></script><script src=/cis400/js/theme.js?1724347214 defer></script><script src=/cis400/js/tele-scroll.js?1724347214 defer></script></body></html>