




	
	
		

	
	
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		
		

	
	
		

	
	
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		
		

	
	
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		
		

	
	
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		
		

	
	
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		
		

	
	
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		
		

	
	
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		
		

	
	
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		
		
		

	
	
		

	
	
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		
		

	
	
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		
		

	
	
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		
		

	
	
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		
		

	
	
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		
		

	
	
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		
		
		

	
	
		

	
	
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		
		

	
	
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		
		

	
	
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		
		

	
	
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		
		

	
	
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		
		

	
	
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		
		
		

	
	
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		
		

	
	
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		
<!DOCTYPE html>
<html lang="en" dir="ltr">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="height=device-height, width=device-width, initial-scale=1.0, minimum-scale=1.0">
    <meta name="generator" content="Hugo 0.117.0">
    <meta name="generator" content="Relearn 5.18.0">
    <meta name="description" content="K-State CIS 400 Textbook">
    <meta name="author" content="Nathan Bean">
    <title>Testing Custom Events :: K-State CIS 400 Textbook</title>
    <link href="https://ksu-cs-textbooks.github.io/cis400/2-desktop-development/03-events/11-testing-custom-events/index.html" rel="canonical" type="text/html" title="Testing Custom Events :: K-State CIS 400 Textbook">
    <link href="https://ksu-cs-textbooks.github.io/cis400/2-desktop-development/03-events/11-testing-custom-events/index.xml" rel="alternate" type="application/rss+xml" title="Testing Custom Events :: K-State CIS 400 Textbook">
    <link href="https://ksu-cs-textbooks.github.io/cis400/2-desktop-development/03-events/11-testing-custom-events/tele.html" rel="alternate" type="text/html" title="Testing Custom Events :: K-State CIS 400 Textbook">
    <link href="https://ksu-cs-textbooks.github.io/cis400/2-desktop-development/03-events/11-testing-custom-events/embed.html" rel="alternate" type="text/html" title="Testing Custom Events :: K-State CIS 400 Textbook">
    <!-- https://github.com/filamentgroup/loadCSS/blob/master/README.md#how-to-use -->
    <link href="https://ksu-cs-textbooks.github.io/cis400/css/fontawesome-all.min.css?1699286532" rel="stylesheet" media="print" onload="this.media='all';this.onload=null;"><noscript><link href="https://ksu-cs-textbooks.github.io/cis400/css/fontawesome-all.min.css?1699286532" rel="stylesheet"></noscript>
    <link href="https://ksu-cs-textbooks.github.io/cis400/css/nucleus.css?1699286532" rel="stylesheet">
    <link href="https://ksu-cs-textbooks.github.io/cis400/css/auto-complete.css?1699286532" rel="stylesheet" media="print" onload="this.media='all';this.onload=null;"><noscript><link href="https://ksu-cs-textbooks.github.io/cis400/css/auto-complete.css?1699286532" rel="stylesheet"></noscript>
    <link href="https://ksu-cs-textbooks.github.io/cis400/css/perfect-scrollbar.min.css?1699286532" rel="stylesheet">
    <link href="https://ksu-cs-textbooks.github.io/cis400/css/fonts.css?1699286532" rel="stylesheet" media="print" onload="this.media='all';this.onload=null;"><noscript><link href="https://ksu-cs-textbooks.github.io/cis400/css/fonts.css?1699286532" rel="stylesheet"></noscript>
    <link href="https://ksu-cs-textbooks.github.io/cis400/css/theme.css?1699286532" rel="stylesheet">
    <link href="https://ksu-cs-textbooks.github.io/cis400/css/theme-auto.css?1699286532" rel="stylesheet" id="variant-style">
    <link href="https://ksu-cs-textbooks.github.io/cis400/css/variant.css?1699286532" rel="stylesheet">
    <link href="https://ksu-cs-textbooks.github.io/cis400/css/print.css?1699286532" rel="stylesheet" media="print">
    <link href="https://ksu-cs-textbooks.github.io/cis400/css/format-print.css?1699286532" rel="stylesheet">
    <link href="https://ksu-cs-textbooks.github.io/cis400/css/ie.css?1699286532" rel="stylesheet">
    <script src="https://ksu-cs-textbooks.github.io/cis400/js/url.js?1699286532"></script>
    <script src="https://ksu-cs-textbooks.github.io/cis400/js/variant.js?1699286532"></script>
    <script>
      // hack to let hugo tell us how to get to the root when using relativeURLs, it needs to be called *url= for it to do its magic:
      // https://github.com/gohugoio/hugo/blob/145b3fcce35fbac25c7033c91c1b7ae6d1179da8/transform/urlreplacers/absurlreplacer.go#L72
      window.index_js_url="https://ksu-cs-textbooks.github.io/cis400/index.search.js";
      var root_url="https://ksu-cs-textbooks.github.io/cis400/";
      var baseUri=root_url.replace(/\/$/, '');
      // translations
      window.T_Copy_to_clipboard = 'Copy to clipboard';
      window.T_Copied_to_clipboard = 'Copied to clipboard!';
      window.T_Copy_link_to_clipboard = 'Copy link to clipboard';
      window.T_Link_copied_to_clipboard = 'Copied link to clipboard!';
      window.T_No_results_found = 'No results found for \u0022{0}\u0022';
      window.T_N_results_found = '{1} results found for \u0022{0}\u0022';
      // some further base stuff
      var baseUriFull='https:\/\/ksu-cs-textbooks.github.io\/cis400/';
      window.variants && variants.init( [ 'auto', 'light-theme', 'dark-theme' ] );
    </script>
    
    <link href="https://ksu-cs-textbooks.github.io/cis400/css/custom.css?1699286532" rel="stylesheet">

  </head>
  <body class="mobile-support print disableInlineCopyToClipboard" data-url="https://ksu-cs-textbooks.github.io/cis400/2-desktop-development/03-events/11-testing-custom-events/index.html">
    <div id="body" class="default-animation">
      <div id="sidebar-overlay"></div>
      <div id="toc-overlay"></div>
      <nav id="topbar" class="highlightable">
        <div>
          <div id="top-tele-link">
            <a class="print-link" title='Teleprompter View' href="https://ksu-cs-textbooks.github.io/cis400/2-desktop-development/03-events/11-testing-custom-events/tele.html">
              <i class="fas fa-tv fa-fw"></i>
            </a>
          </div>
          <div id="top-embed-link">
            <a class="print-link" title='Embeddable Version' href="https://ksu-cs-textbooks.github.io/cis400/2-desktop-development/03-events/11-testing-custom-events/embed.html">
              <i class="fas fa-expand-arrows-alt fa-fw"></i>
            </a>
          </div>
          <div id="breadcrumbs">
            <span id="sidebar-toggle-span">
              <a href="#" id="sidebar-toggle" class="topbar-link" title='Menu (CTRL+ALT+n)'><i class="fas fa-bars fa-fw"></i></a>
            </span>
            <ol class="links" itemscope itemtype="http://schema.org/BreadcrumbList">
              <li itemscope itemtype="https://schema.org/ListItem" itemprop="itemListElement"><a itemprop="item" href="https://ksu-cs-textbooks.github.io/cis400/index.html"><span itemprop="name">CIS 400: Object-Oriented Design, Implementation, and Testing</span></a><meta itemprop="position" content="1"> &gt; </li>
              <li itemscope itemtype="https://schema.org/ListItem" itemprop="itemListElement"><a itemprop="item" href="https://ksu-cs-textbooks.github.io/cis400/2-desktop-development/index.html"><span itemprop="name">Desktop Development</span></a><meta itemprop="position" content="2"> &gt; </li>
              <li itemscope itemtype="https://schema.org/ListItem" itemprop="itemListElement"><a itemprop="item" href="https://ksu-cs-textbooks.github.io/cis400/2-desktop-development/03-events/index.html"><span itemprop="name">Event-Driven Programming</span></a><meta itemprop="position" content="3"> &gt; </li>
              <li itemscope itemtype="https://schema.org/ListItem" itemprop="itemListElement"><span itemprop="name">Testing Custom Events</span><meta itemprop="position" content="4"></li>
            </ol>
          </div>
        </div>
      </nav>
      <main id="body-inner" class="highlightable default" tabindex="-1">
        <div class="flex-block-wrapper">
          <article class="default">
            <header class="headline">
            </header>
<h1 id="testing-custom-events">Testing Custom Events</h1>

<p>In the previous section, we discussed using XUnit&rsquo;s <code>Assert.Raises&lt;T&gt;</code> to test generic events (events declared with the <code>EventHandler&lt;T&gt;</code> generic).  However, this approach does not work with non-generic events, like <code>PropertyChanged</code> and <code>CollectionChanged</code>.  That is why XUnit provides an <code>Assert.PropertyChanged()</code> method.  Unfortunately, it does not offer a corresponding test for <code>CollectionChanged</code>.  So to test for this expectation we will need to write our own assertions.</p>
<p>To do that, we need to understand how assertions in the XUnit framework work.  Essentially, they test the truthfulness of what is being asserted (i.e. two values are equal, a collection contains an item, etc.).  If the assertion is not true, then the code raises an exception - specifically, a <code>XunitException</code> or a class derived from it. This class provides a <code>UserMessage</code> (the message you get when the test fails) and a <code>StackTrace</code> (the lines describing where the error was thrown). With this in mind, we can write our own assertion method.  Let&rsquo;s start with a simple example that asserts the value of a string is &ldquo;Hello World&rdquo;:</p>
<div class="wrap-code highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-csharp" data-lang="csharp"><span style="display:flex;"><span><span style="color:#66d9ef">public</span> <span style="color:#66d9ef">static</span> <span style="color:#66d9ef">class</span> <span style="color:#a6e22e">MyAssert</span>
</span></span><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">class</span> <span style="color:#a6e22e">HelloWorldAssertionException</span>: XunitException 
</span></span><span style="display:flex;"><span>  {
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">public</span> HelloWorldAssertionException(<span style="color:#66d9ef">string</span> actual) : <span style="color:#66d9ef">base</span>(<span style="color:#e6db74">$&#34;Expected \&#34;</span>Hello World<span style="color:#960050;background-color:#1e0010">\</span><span style="color:#e6db74">&#34; but instead saw \&#34;{actual}\&#34;&#34;</span>) {}
</span></span><span style="display:flex;"><span>  }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">static</span> <span style="color:#66d9ef">void</span> HelloWorld(<span style="color:#66d9ef">string</span> phrase)
</span></span><span style="display:flex;"><span>  {
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">if</span>(phrase != <span style="color:#e6db74">&#34;Hello World&#34;</span>) <span style="color:#66d9ef">throw</span> <span style="color:#66d9ef">new</span> HelloWorldException(phrase);
</span></span><span style="display:flex;"><span>  }
</span></span><span style="display:flex;"><span>}</span></span></code></pre></div><p>Note that we use the <code>base</code> keyword to execute the <code>XunitException</code> constructor as part of the <code>HelloWorldAssertionException</code>, and pass along the <code>string</code> parameter <code>actual</code>.  Then the body of the <code>XunitException</code> constructor does all the work of setting values, so the body of our constructor is empty.</p>
<p>Now we can use this assertion in our own tests:</p>
<div class="wrap-code highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-csharp" data-lang="csharp"><span style="display:flex;"><span><span style="color:#a6e22e">[Theory]</span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">[InlineData(&#34;Hello World&#34;)]</span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">[InlineData(&#34;Hello Bob&#34;)]</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">public</span> <span style="color:#66d9ef">void</span> ShouldBeHelloWorld(<span style="color:#66d9ef">string</span> phrase)
</span></span><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>  MyAssert.HelloWorld(phrase);
</span></span><span style="display:flex;"><span>}</span></span></code></pre></div><p>The first <code>InlineData</code> will pass, and the second will fail with the report <code>Expected &quot;Hello World&quot; but instead saw Hello Bob</code>.</p>
<p>This was of course, a silly example, but it shows the basic concepts.  We would probably never use this in our own work, as <code>Assert.Equal()</code> can do the same thing.  Now let&rsquo;s look at a more complex example that we <em>would</em> use.</p>
<h2 id="assertions-for-collectionchanged">Assertions for CollectionChanged</h2>
<p>As we discussed previously, the <code>CollectionChanged</code> event cannot be tested with the Xunit <code>Assert.Throws</code>.  So this is a great candidate for custom assertions.  To be thorough, we should test <em>all</em> the possible actions (and we would do this if expanding the Xunit library).  But for how we plan to use it, we really only need two actions covered - adding and removing items <em>one at a time</em> from the collection.  Let&rsquo;s start with our exception definitions:</p>
<div class="wrap-code highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-csharp" data-lang="csharp"><span style="display:flex;"><span><span style="color:#66d9ef">public</span> <span style="color:#66d9ef">static</span> <span style="color:#66d9ef">class</span> <span style="color:#a6e22e">MyAssert</span>
</span></span><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">class</span> <span style="color:#a6e22e">NotifyCollectionChangedNotTriggeredException</span>: XunitException 
</span></span><span style="display:flex;"><span>  {
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">public</span> NotifyCollectionChangedNotTriggeredException(NotifyCollectionChangedAction expectedAction) : <span style="color:#66d9ef">base</span>(<span style="color:#e6db74">$&#34;Expected a NotifyCollectionChanged event with an action of {expectedAction} to be invoked, but saw none.&#34;</span>) {}
</span></span><span style="display:flex;"><span>  }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">class</span> <span style="color:#a6e22e">NotifyCollectionChangedWrongActionException</span>: XunitException 
</span></span><span style="display:flex;"><span>  {
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">public</span> NotifyCollectionChangedWrongActionException(NotifyCollectionChangedAction expectedAction, NotifyCollectionChangedAction actualAction) : <span style="color:#66d9ef">base</span>(<span style="color:#e6db74">$&#34;Expected a NotifyCollectionChanged event with an action of {expectedAction} to be invoked, but saw {actualAction}&#34;</span>) {}
</span></span><span style="display:flex;"><span>  }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">class</span> <span style="color:#a6e22e">NotifyCollectionChangedAddException</span>: XunitException 
</span></span><span style="display:flex;"><span>  {
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">public</span> NotifyCollectionChangedAddException(<span style="color:#66d9ef">object</span> expected, <span style="color:#66d9ef">object</span> actual) : <span style="color:#66d9ef">base</span>(<span style="color:#e6db74">$&#34;Expected a NotifyCollectionChanged event with an action of Add and object {expected} but instead saw {actual}&#34;</span>) {}
</span></span><span style="display:flex;"><span>  }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">class</span> <span style="color:#a6e22e">NotifyCollectionChangedRemoveException</span> : XunitException
</span></span><span style="display:flex;"><span>  {
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">public</span> NotifyCollectionChangedRemoveException(<span style="color:#66d9ef">object</span> expectedItem, <span style="color:#66d9ef">int</span> expectedIndex, <span style="color:#66d9ef">object</span> actualItem, <span style="color:#66d9ef">int</span> actualIndex) : <span style="color:#66d9ef">base</span>(<span style="color:#e6db74">$&#34;Expected a NotifyCollectionChanged event with an action of Remove and object {expectedItem} at index {expectedIndex} but instead saw {actualItem} at index  {actualIndex}&#34;</span>) {}
</span></span><span style="display:flex;"><span>  }
</span></span><span style="display:flex;"><span>}</span></span></code></pre></div><p>We have four different exceptions, each with a very specific message conveying what the failure was due to - no event being triggered, an event with the wrong action being triggered, or an event with the wrong information being triggered.  We could also handle this with one exception class using multiple constructors (much like the <code>NotifyCollectionChangedEventArgs</code> does).</p>
<p>Then we need to write our assertions, which are more involved than our previous example as 1) the event uses a generic type, so our assertion also must be a generic, and 2) we need to handle an event - so we need to attach an event handler, and trigger code that should make that event occur.  Let&rsquo;s start with defining the signature of the <code>Add</code> method:</p>
<div class="wrap-code highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-csharp" data-lang="csharp"><span style="display:flex;"><span><span style="color:#66d9ef">public</span> <span style="color:#66d9ef">static</span> <span style="color:#66d9ef">class</span> <span style="color:#a6e22e">MyAssert</span> {
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">static</span> <span style="color:#66d9ef">void</span> NotifyCollectionChangedAdd&lt;T&gt;(INotifyCollectionChanged collection, T item, Action testCode) 
</span></span><span style="display:flex;"><span>  {
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">// Assertion tests here.</span>
</span></span><span style="display:flex;"><span>  }
</span></span><span style="display:flex;"><span>}</span></span></code></pre></div><p>We use the generic type <code>T</code> to allow our assertion to be used with any kind of collection - and the second parameter <code>item</code> is <em>also</em> this type.  That is the object of we are trying to add to the <code>collection</code>.  Finally, the <code>Action</code> is the code the test will execute that would, in theory, add <code>item</code> to <code>collection</code>.  Let&rsquo;s flesh out the method body now:</p>
<div class="wrap-code highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-csharp" data-lang="csharp"><span style="display:flex;"><span><span style="color:#66d9ef">public</span> <span style="color:#66d9ef">static</span> <span style="color:#66d9ef">class</span> <span style="color:#a6e22e">MyAssert</span>
</span></span><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">static</span> <span style="color:#66d9ef">void</span> NotifyCollectionChangedAdd&lt;T&gt;(INotifyCollectionChanged collection, T newItem, Action testCode)
</span></span><span style="display:flex;"><span>  {
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">// A flag to indicate if the event triggered successfully</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">bool</span> notifySucceeded = <span style="color:#66d9ef">false</span>;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">// An event handler to attach to the INotifyCollectionChanged and be </span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">// notified when the Add event occurs.</span>
</span></span><span style="display:flex;"><span>    NotifyCollectionChangedEventHandler handler = (sender, args) =&gt;
</span></span><span style="display:flex;"><span>    {
</span></span><span style="display:flex;"><span>      <span style="color:#75715e">// Make sure the event is an Add event</span>
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">if</span> (args.Action != NotifyCollectionChangedAction.Add)
</span></span><span style="display:flex;"><span>      {
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">throw</span> <span style="color:#66d9ef">new</span> NotifyCollectionChangedWrongActionException(NotifyCollectionChangedAction.Add, args.Action);
</span></span><span style="display:flex;"><span>      }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>      <span style="color:#75715e">// Make sure we added just one item</span>
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">if</span> (args.NewItems?.Count != <span style="color:#ae81ff">1</span>)
</span></span><span style="display:flex;"><span>      {
</span></span><span style="display:flex;"><span>        <span style="color:#75715e">// We&#39;ll use the collection of added items as the second argument</span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">throw</span> <span style="color:#66d9ef">new</span> NotifyCollectionChangedAddException(newItem, args.NewItems);
</span></span><span style="display:flex;"><span>      }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>      <span style="color:#75715e">// Make sure the added item is what we expected</span>
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">if</span> (!args.NewItems[<span style="color:#ae81ff">0</span>].Equals(newItem))
</span></span><span style="display:flex;"><span>      {
</span></span><span style="display:flex;"><span>        <span style="color:#75715e">// Here we only have one item in the changed collection, so we&#39;ll report it directly</span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">throw</span> <span style="color:#66d9ef">new</span> NotifyCollectionChangedAddException(newItem, args.NewItems[<span style="color:#ae81ff">0</span>]);
</span></span><span style="display:flex;"><span>      } 
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>      <span style="color:#75715e">// If we reach this point, the NotifyCollectionChanged event was triggered successfully</span>
</span></span><span style="display:flex;"><span>      <span style="color:#75715e">// and contains the correct item! We&#39;ll set the flag to true so we know.</span>
</span></span><span style="display:flex;"><span>      notifySucceeded = <span style="color:#66d9ef">true</span>;
</span></span><span style="display:flex;"><span>    };
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">// Now we connect the event handler </span>
</span></span><span style="display:flex;"><span>    collection.CollectionChanged += handler;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">// And attempt to trigger the event by running the actionCode</span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">// We place this in a try/catch to be able to utilize the finally </span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">// clause, but don&#39;t actually catch any exceptions</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">try</span>
</span></span><span style="display:flex;"><span>    {
</span></span><span style="display:flex;"><span>      testCode();
</span></span><span style="display:flex;"><span>      <span style="color:#75715e">// After this code has been run, our handler should have </span>
</span></span><span style="display:flex;"><span>      <span style="color:#75715e">// triggered, and if all went well, the notifySucceed is true</span>
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">if</span> (!notifySucceeded)
</span></span><span style="display:flex;"><span>      {
</span></span><span style="display:flex;"><span>        <span style="color:#75715e">// If notifySucceed is false, the event was not triggered</span>
</span></span><span style="display:flex;"><span>        <span style="color:#75715e">// We throw an exception denoting that</span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">throw</span> <span style="color:#66d9ef">new</span> NotifyCollectionChangedNotTriggeredException(NotifyCollectionChangedAction.Add);
</span></span><span style="display:flex;"><span>      }
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">// We don&#39;t actually want to catch an exception - we want it to </span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">// bubble up and be reported as a failing test.  So we don&#39;t </span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">// have a catch () {} clause to this try/catch.</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">finally</span>
</span></span><span style="display:flex;"><span>    {
</span></span><span style="display:flex;"><span>      <span style="color:#75715e">// However, we *do* want to remove the event handler. We do </span>
</span></span><span style="display:flex;"><span>      <span style="color:#75715e">// this in a finally block so it will happen even if we do </span>
</span></span><span style="display:flex;"><span>      <span style="color:#75715e">// have an exception occur. </span>
</span></span><span style="display:flex;"><span>      collection.CollectionChanged -= handler;
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>  }
</span></span><span style="display:flex;"><span>}</span></span></code></pre></div><p>Now we can test this in our code.  For example, if we had a collection of <code>ShoppingList</code> objects named <code>shoppingLists</code> that implemented <code>INotifyCollectionChanged</code>, we could test adding a new Shopping list it with:</p>
<div class="wrap-code highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-csharp" data-lang="csharp"><span style="display:flex;"><span><span style="color:#66d9ef">var</span> newList = <span style="color:#66d9ef">new</span> ShoppingList();
</span></span><span style="display:flex;"><span>MyAssert.NotifyCollectionChangedAdd(shoppingLists, newList, () =&gt; {
</span></span><span style="display:flex;"><span>  shoppingLists.Add(shoppingList);
</span></span><span style="display:flex;"><span>});</span></span></code></pre></div><p>Note that we didn&rsquo;t need to explicitly state <code>T</code> in this case is <code>ShoppingList</code> - the compiler infers this from the arguments supplied to the method.</p>
<p>Our assertion method handles adding a <em>single</em> item. We can use method <em>overloading</em> providing another method of the same name with different arguments to handle when <em>multiple</em> items are added. For that case, the signature might look like:</p>
<div class="wrap-code highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-csharp" data-lang="csharp"><span style="display:flex;"><span><span style="color:#66d9ef">public</span> <span style="color:#66d9ef">static</span> <span style="color:#66d9ef">void</span> NotifyCollectionChangedAdd&lt;T&gt;(INotifyCollectionChanged collection, ICollection&lt;T&gt; items, Action testCode) 
</span></span><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>  <span style="color:#75715e">// Assertion tests here.</span>
</span></span><span style="display:flex;"><span>}</span></span></code></pre></div><p>We&rsquo;d also want to write assertion methods for handling removing items, and any other actions we might need to test.  I&rsquo;ll leave these as exercises for the reader.</p>

            <footer class="footline">

            </footer>
          </article>


        </div>
      </main>
    
<div class="git-footer">
<p class="theme-version-footer">5.18.0</p>
<p>Last modified by: 
            <i class='fas fa-user'></i> Nathan Bean
            <i class='fas fa-calendar'></i> <a href="https://gitlab.cs.ksu.edu/cs-textbooks/cis400-textbook/-/commit/78226cef46ed95f56a8c2841c0582a8b90f186af">Feb 28, 2023</a>
</p>
</div>

    
    </div>
    <script src="https://ksu-cs-textbooks.github.io/cis400/js/clipboard.min.js?1699286533" defer></script>
    <script src="https://ksu-cs-textbooks.github.io/cis400/js/perfect-scrollbar.min.js?1699286533" defer></script>
    <script src="https://ksu-cs-textbooks.github.io/cis400/js/theme.js?1699286533" defer></script>
  </body>
</html>
