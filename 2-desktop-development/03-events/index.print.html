




	
	
		

	
	
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		
		

	
	
		

	
	
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		
		

	
	
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		
		

	
	
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		
		

	
	
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		
		

	
	
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		
		

	
	
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		
		

	
	
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		
		
		

	
	
		

	
	
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		
		

	
	
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		
		

	
	
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		
		

	
	
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		
		

	
	
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		
		

	
	
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		
		
		

	
	
		

	
	
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		
		

	
	
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		
		

	
	
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		
		

	
	
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		
		

	
	
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		
		

	
	
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		
		
		

	
	
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		
		

	
	
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		
		

	
	
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		
		

	
	
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		
		

	
	
		

	
	
		
		

	
	
		
		
		
<!DOCTYPE html>
<html lang="en" dir="ltr">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="height=device-height, width=device-width, initial-scale=1.0, minimum-scale=1.0">
    <meta name="generator" content="Hugo 0.117.0">
    <meta name="generator" content="Relearn 5.18.0">
    <meta name="description" content="K-State CIS 400 Textbook">
    <meta name="author" content="Nathan Bean">
    <title>Event-Driven Programming :: K-State CIS 400 Textbook</title>
    <link href="https://ksu-cs-textbooks.github.io/cis400/2-desktop-development/03-events/index.html" rel="canonical" type="text/html" title="Event-Driven Programming :: K-State CIS 400 Textbook">
    <link href="https://ksu-cs-textbooks.github.io/cis400/2-desktop-development/03-events/index.xml" rel="alternate" type="application/rss+xml" title="Event-Driven Programming :: K-State CIS 400 Textbook">
    <link href="https://ksu-cs-textbooks.github.io/cis400/2-desktop-development/03-events/tele.html" rel="alternate" type="text/html" title="Event-Driven Programming :: K-State CIS 400 Textbook">
    <link href="https://ksu-cs-textbooks.github.io/cis400/2-desktop-development/03-events/embed.html" rel="alternate" type="text/html" title="Event-Driven Programming :: K-State CIS 400 Textbook">
    <!-- https://github.com/filamentgroup/loadCSS/blob/master/README.md#how-to-use -->
    <link href="https://ksu-cs-textbooks.github.io/cis400/css/fontawesome-all.min.css?1707765069" rel="stylesheet" media="print" onload="this.media='all';this.onload=null;"><noscript><link href="https://ksu-cs-textbooks.github.io/cis400/css/fontawesome-all.min.css?1707765069" rel="stylesheet"></noscript>
    <link href="https://ksu-cs-textbooks.github.io/cis400/css/nucleus.css?1707765069" rel="stylesheet">
    <link href="https://ksu-cs-textbooks.github.io/cis400/css/auto-complete.css?1707765069" rel="stylesheet" media="print" onload="this.media='all';this.onload=null;"><noscript><link href="https://ksu-cs-textbooks.github.io/cis400/css/auto-complete.css?1707765069" rel="stylesheet"></noscript>
    <link href="https://ksu-cs-textbooks.github.io/cis400/css/perfect-scrollbar.min.css?1707765069" rel="stylesheet">
    <link href="https://ksu-cs-textbooks.github.io/cis400/css/fonts.css?1707765069" rel="stylesheet" media="print" onload="this.media='all';this.onload=null;"><noscript><link href="https://ksu-cs-textbooks.github.io/cis400/css/fonts.css?1707765069" rel="stylesheet"></noscript>
    <link href="https://ksu-cs-textbooks.github.io/cis400/css/theme.css?1707765069" rel="stylesheet">
    <link href="https://ksu-cs-textbooks.github.io/cis400/css/theme-auto.css?1707765069" rel="stylesheet" id="variant-style">
    <link href="https://ksu-cs-textbooks.github.io/cis400/css/variant.css?1707765069" rel="stylesheet">
    <link href="https://ksu-cs-textbooks.github.io/cis400/css/print.css?1707765069" rel="stylesheet" media="print">
    <link href="https://ksu-cs-textbooks.github.io/cis400/css/format-print.css?1707765069" rel="stylesheet">
    <link href="https://ksu-cs-textbooks.github.io/cis400/css/ie.css?1707765069" rel="stylesheet">
    <script src="https://ksu-cs-textbooks.github.io/cis400/js/url.js?1707765069"></script>
    <script src="https://ksu-cs-textbooks.github.io/cis400/js/variant.js?1707765069"></script>
    <script>
      // hack to let hugo tell us how to get to the root when using relativeURLs, it needs to be called *url= for it to do its magic:
      // https://github.com/gohugoio/hugo/blob/145b3fcce35fbac25c7033c91c1b7ae6d1179da8/transform/urlreplacers/absurlreplacer.go#L72
      window.index_js_url="https://ksu-cs-textbooks.github.io/cis400/index.search.js";
      var root_url="https://ksu-cs-textbooks.github.io/cis400/";
      var baseUri=root_url.replace(/\/$/, '');
      // translations
      window.T_Copy_to_clipboard = 'Copy to clipboard';
      window.T_Copied_to_clipboard = 'Copied to clipboard!';
      window.T_Copy_link_to_clipboard = 'Copy link to clipboard';
      window.T_Link_copied_to_clipboard = 'Copied link to clipboard!';
      window.T_No_results_found = 'No results found for \u0022{0}\u0022';
      window.T_N_results_found = '{1} results found for \u0022{0}\u0022';
      // some further base stuff
      var baseUriFull='https:\/\/ksu-cs-textbooks.github.io\/cis400/';
      window.variants && variants.init( [ 'auto', 'light-theme', 'dark-theme' ] );
    </script>
    
    <link href="https://ksu-cs-textbooks.github.io/cis400/css/custom.css?1707765069" rel="stylesheet">

  </head>
  <body class="mobile-support print disableInlineCopyToClipboard" data-url="https://ksu-cs-textbooks.github.io/cis400/2-desktop-development/03-events/index.html">
    <div id="body" class="default-animation">
      <div id="sidebar-overlay"></div>
      <div id="toc-overlay"></div>
      <nav id="topbar" class="highlightable">
        <div>
          <div id="top-tele-link">
            <a class="print-link" title='Teleprompter View' href="https://ksu-cs-textbooks.github.io/cis400/2-desktop-development/03-events/tele.html">
              <i class="fas fa-tv fa-fw"></i>
            </a>
          </div>
          <div id="top-embed-link">
            <a class="print-link" title='Embeddable Version' href="https://ksu-cs-textbooks.github.io/cis400/2-desktop-development/03-events/embed.html">
              <i class="fas fa-expand-arrows-alt fa-fw"></i>
            </a>
          </div>
          <div id="breadcrumbs">
            <span id="sidebar-toggle-span">
              <a href="#" id="sidebar-toggle" class="topbar-link" title='Menu (CTRL+ALT+n)'><i class="fas fa-bars fa-fw"></i></a>
            </span>
            <ol class="links" itemscope itemtype="http://schema.org/BreadcrumbList">
              <li itemscope itemtype="https://schema.org/ListItem" itemprop="itemListElement"><a itemprop="item" href="https://ksu-cs-textbooks.github.io/cis400/index.html"><span itemprop="name">CIS 400: Object-Oriented Design, Implementation, and Testing</span></a><meta itemprop="position" content="1"> &gt; </li>
              <li itemscope itemtype="https://schema.org/ListItem" itemprop="itemListElement"><a itemprop="item" href="https://ksu-cs-textbooks.github.io/cis400/2-desktop-development/index.html"><span itemprop="name">Desktop Development</span></a><meta itemprop="position" content="2"> &gt; </li>
              <li itemscope itemtype="https://schema.org/ListItem" itemprop="itemListElement"><span itemprop="name">Event-Driven Programming</span><meta itemprop="position" content="3"></li>
            </ol>
          </div>
        </div>
      </nav>
      <main id="body-inner" class="highlightable chapter narrow" tabindex="-1">
        <div class="flex-block-wrapper">
          <article class="chapter">
            <header class="headline">
            </header>


<div class="article-subheading">Chapter 3</div>
<h1 id="event-driven-programming">Event-Driven Programming</h1>

<p>I Fight for the Users!</p>

            <footer class="footline">

            </footer>
          </article>

          <section>
            <h1 class="a11y-only">Subsections of Event-Driven Programming</h1>
    
    
          <article class="default">
            <header class="headline">
            </header>
<h1 id="introduction">Introduction</h1>

<p>Event-Driven programming is a programming paradigm where the program primarily responds to events - typically generated by a user, but also potentially from sensors, network connections, or other sources.  We cover it here because event-driven programming is a staple of graphical user interfaces.  These typically display a fairly static screen until the user interacts with the program in some meaningful way - moving or clicking the mouse, hitting a key, or the like.</p>
<p>As you might suspect, event-driven programming is often used alongside other programming paradigms, including structured programming and object-orientation.  We&rsquo;ll be exploring how event-driven programming is implemented in C# in this chapter, especially how it interacts with Windows Presentation Foundation.</p>
<h2 id="key-terms">Key Terms</h2>
<ul>
<li>Event</li>
<li>Message Loop</li>
<li>Message Queue</li>
<li>Event Handler</li>
<li>Event Listener</li>
<li>Event Arguments</li>
</ul>
<h2 id="c-keywords-and-operators">C# Keywords and Operators</h2>
<ul>
<li><code>event</code></li>
<li><code>EventArgs</code></li>
<li><code>+=</code></li>
<li><code>-=</code></li>
<li><code>?.</code></li>
</ul>
<h2 id="key-skills">Key Skills</h2>
<p>The key skills to learn in this chapter are how to write event listeners, attach event listeners to event handlers, and how to define custom event handlers.</p>

            <footer class="footline">

            </footer>
          </article>

    
    
          <article class="default">
            <header class="headline">
            </header>
<h1 id="message-loops">Message Loops</h1>

<p>At the heart of every Windows program (and most operating systems), is an infinitely repeating loop we call the <em>message loop</em> and a data structure we call a <em>message queue</em> (some languages/operating systems use the term <em>event</em> instead of <em>message</em>).  The message queue is managed by the operating system - it adds new events that the GUI needs to know about (i.e. a mouse click that occurred within the GUI) to this queue.  The message loop is often embedded in the main function of the program, and continuously checks for new messages in the queue.  When it finds one, it processes the message.  Once the message is processed, the message loop again checks for a new message.  The basic code for such a loop looks something like this:</p>
<div class="wrap-code highlight"><pre tabindex="0"><code>function main
    initialize()
    while message != quit
        message := get_next_message()
        process_message(message)
    end while
end function</code></pre></div><p>This approach works well for most GUIs as once the program is drawn initially (during the <code>initialize()</code> function), the appearance of the GUI will not change until it responds to some user action.</p>
<p>In a WPF or Windows Forms application, this loop is buried in the <a href="https://docs.microsoft.com/en-us/dotnet/api/system.windows.application?view=netcore-3.1" target="_blank"><code>Application</code></a>
 class that the <code>App</code> inherits from.  Instead of writing the code to process these system messages directly, this class converts these messages into C# <em>events</em>, which are then consumed by the event listeners the programmer provides.  We&rsquo;ll look at these next.</p>

            <footer class="footline">

            </footer>
          </article>

    
    
          <article class="default">
            <header class="headline">
            </header>
<h1 id="event-handlers">Event Handlers</h1>

<p>In C#, we use <em>event handlers</em> (sometimes called <em>event listeners</em> in other languages) to register the behavior we want to happen in response to specific events.  You&rsquo;ve probably already used these, i.e. declaring a handler:</p>
<div class="wrap-code highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-csharp" data-lang="csharp"><span style="display:flex;"><span><span style="color:#66d9ef">private</span> <span style="color:#66d9ef">void</span> OnEvent(<span style="color:#66d9ef">object</span> sender, EventArgs e) {
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">// TODO: Respond to the event</span>
</span></span><span style="display:flex;"><span>}</span></span></code></pre></div><p>Most event handlers follow the same pattern.  They do not have a return value (their return type is <code>void</code>), and take two parameters.  The first is always an <code>object</code>, and it is the source of the event (hence &ldquo;sender&rdquo;).  The second is an <code>EventArgs</code> object, or a class <em>descended</em> from <code>EventArgs</code>, which provides details about the event.</p>
<p>For example, the various events dealing with mouse input (<code>MouseMove</code>, <code>MouseDown</code>, <code>MouseUp</code>) supply a <a href="https://docs.microsoft.com/en-us/dotnet/api/system.windows.forms.mouseeventargs?view=netcore-3.1" target="_blank"><code>MouseEventArgs</code></a>
 object.  This object includes properties defining the mouse location, number of clicks, mouse wheel rotations, and which button was involved in the event.</p>
<p>You&rsquo;ve probably attached event handlers using the <strong>&ldquo;Properties&rdquo;</strong> panel in Visual Studio, but you can also attach them in code:</p>
<div class="wrap-code highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-csharp" data-lang="csharp"><span style="display:flex;"><span>Button button = <span style="color:#66d9ef">new</span> Button();
</span></span><span style="display:flex;"><span>button.Click += OnClick;</span></span></code></pre></div><p>Note you <em>don&rsquo;t include parenthesis</em> after the name of the event handler.  You aren&rsquo;t <em>invoking</em> the event handler, you&rsquo;re <em>attaching</em> it (so it can be invoked in the future when the event happens).  Also, note that we use the <code>+=</code> operator to signify attaching an event handler.</p>
<p>This syntax is a deliberate choice to help reinforce the idea that we can attach <em>multiple</em> event handlers in C#, i.e.:</p>
<div class="wrap-code highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-csharp" data-lang="csharp"><span style="display:flex;"><span>Button button = <span style="color:#66d9ef">new</span> Button();
</span></span><span style="display:flex;"><span>button.Click += onClick1;
</span></span><span style="display:flex;"><span>button.Click += onClick2;</span></span></code></pre></div><p>In this case, <em>both</em> <code>onClick1</code> and <code>onClick2</code> will be invoked when the button is clicked.  This is also one reason to attach event handlers programmatically rather than through the <strong>&ldquo;Properties&rdquo;</strong> window (it can only attach one).</p>
<p>We can also <em>remove</em> an event handler if we no longer want it to be invoked when the event happens.  We do this with the <code>-=</code> operator:</p>
<div class="wrap-code highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-csharp" data-lang="csharp"><span style="display:flex;"><span>button.Click -= onClick1;</span></span></code></pre></div><p>Again, note we use the handler&rsquo;s name without parenthesis.</p>

            <footer class="footline">

            </footer>
          </article>

    
    
          <article class="default">
            <header class="headline">
            </header>
<h1 id="declaring-events">Declaring Events</h1>

<p>Up to this point, you&rsquo;ve probably only used events that were defined on library objects, like the Button&rsquo;s Click event.  However, you can also declare events in your own classes, and even create new event types.</p>
<p>In order to attach an event handler to an object in C#, we must first declare that that object has the corresponding event.  To do so, we need both a <em>name</em> for the event, and a <em>delegate</em>.</p>
<p>In C# a <a href="https://learn.microsoft.com/en-us/dotnet/csharp/programming-guide/delegates/" target="_blank">Delegate</a>
, a special type that represents a method with a specific method signature and return type. A delegate allows us to associate the delegate with any method that matches that signature and return type. For example, the <code>Click</code> event handler we discussed earlier is a delegate which matches a method that takes two arguments: an <code>object</code> and an <code>EventArgs</code>, and returns void.  Any event listener that we write that matches this specification can be attached to the <code>button.Click</code>.  In a way, a <code>Delegate</code> is like an <code>Interface</code>, only for methods instead of objects.</p>
<p>Consider a class representing an egg.  What if we wanted to define an event to represent when it hatched?  We&rsquo;d need a delegate for that event, which can be declared a couple of ways.  The traditional method would be:</p>
<div class="wrap-code highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-csharp" data-lang="csharp"><span style="display:flex;"><span><span style="color:#66d9ef">public</span> <span style="color:#66d9ef">delegate</span> <span style="color:#66d9ef">void</span> HatchHandler(<span style="color:#66d9ef">object</span> sender, EventArgs args);</span></span></code></pre></div><p>And then in our class we&rsquo;d declare the corresponding event. In C#, these are written much like a field, but with the addition of the <code>event</code> keyword:</p>
<div class="wrap-code highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-csharp" data-lang="csharp"><span style="display:flex;"><span><span style="color:#66d9ef">public</span> <span style="color:#66d9ef">event</span> HatchHandler Hatch;</span></span></code></pre></div><p>Like a field declaration, an event declaration can have an access modifier (<code>public</code>, <code>private</code>, or <code>protected</code>), a name (in this case <code>Hatch</code>), and a type (the delegate).  It also gets marked with the <code>event</code> keyword.</p>
<p>When C# introduced generics, it became possible to use a generic delegate as well, <code>EventHandler&lt;T&gt;</code>, where the <code>T</code> is the type for the event arguments.  This simplifies writing an event, because we no longer need to define the delegate ourselves.  So instead of the two lines above, we can just use:</p>
<div class="wrap-code highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-csharp" data-lang="csharp"><span style="display:flex;"><span><span style="color:#66d9ef">public</span> <span style="color:#66d9ef">event</span> EventHandler&lt;EventArgs&gt; Hatch;</span></span></code></pre></div><p>The second form is increasingly preferred, as it makes testing our code much easier (we&rsquo;ll see this soon), and it&rsquo;s less code to write.</p>
<h3 id="custom-eventargs">Custom EventArgs</h3>
<p>We might also want to create our own custom event arguments to accompany the event.  Perhaps we want to provide a reference to an object representing the baby chick that hatched.  To do so we can create a new class that inherits from <code>EventArgs</code>:</p>
<div class="wrap-code highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-csharp" data-lang="csharp"><span style="display:flex;"><span><span style="color:#75715e">/// &lt;summary&gt;</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">/// A class representing the hatching of a chick </span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">/// &lt;/summary&gt;</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">public</span> <span style="color:#66d9ef">class</span> <span style="color:#a6e22e">HatchEventArgs</span> : EventArgs 
</span></span><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">/// &lt;summary&gt;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">/// The chick that hatched </span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">/// &lt;/summary&gt;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">public</span> Chick Chick { <span style="color:#66d9ef">get</span>; <span style="color:#66d9ef">protected</span> <span style="color:#66d9ef">set</span>; }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">/// &lt;summary&gt;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">/// Constructs a new HachEventArgs </span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">/// &lt;/summary&gt;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">/// &lt;param name=&#34;chick&#34;&gt;The chick that hatched&lt;/param&gt;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">public</span> HatchEventArgs(Chick chick) 
</span></span><span style="display:flex;"><span>    {
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">this</span>.Chick = chick;
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>}</span></span></code></pre></div><p>And we use this custom event args in our event declaration as the type for the generic <code>EventHandler&lt;T&gt;</code> generic:</p>
<div class="wrap-code highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-csharp" data-lang="csharp"><span style="display:flex;"><span><span style="color:#66d9ef">public</span> <span style="color:#66d9ef">event</span> EventHandler&lt;HatchEvent&gt; Hatch;</span></span></code></pre></div><p>Now let&rsquo;s say we set up our <code>Egg</code> constructor to start a timer to determine when the egg will hatch:</p>
<div class="wrap-code highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-csharp" data-lang="csharp"><span style="display:flex;"><span><span style="color:#66d9ef">public</span> Egg() 
</span></span><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">// Set a timer to go off in 20 days </span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">// (ms = 20 days * 24 hours/day * 60 minutes/hour * 60 seconds/minute * 1000 milliseconds/seconds)</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">var</span> timer = <span style="color:#66d9ef">new</span> System.Timers.Timer(<span style="color:#ae81ff">20</span> * <span style="color:#ae81ff">24</span> * <span style="color:#ae81ff">60</span> * <span style="color:#ae81ff">60</span> * <span style="color:#ae81ff">1000</span>);
</span></span><span style="display:flex;"><span>    timer.Elapsed += StartHatching;
</span></span><span style="display:flex;"><span>}</span></span></code></pre></div><p>In the event handler <code>startHatching</code>, we&rsquo;ll want to create our new baby chick, and then trigger the <code>Hatch</code> event.  To do this, we need to <em>raise</em> the event to pass to any attached handlers with <code>Hatch.Invoke()</code>, passing in both the event arguments and the source of the event (our egg):</p>
<div class="wrap-code highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-csharp" data-lang="csharp"><span style="display:flex;"><span><span style="color:#66d9ef">private</span> <span style="color:#66d9ef">void</span> StartHatching(<span style="color:#66d9ef">object</span> source, ElapsedEventArgs e) 
</span></span><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">var</span> chick = <span style="color:#66d9ef">new</span> Chick();
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">var</span> args = <span style="color:#66d9ef">new</span> HatchEventArgs(chick);
</span></span><span style="display:flex;"><span>    Hatch.Invoke(<span style="color:#66d9ef">this</span>, args);
</span></span><span style="display:flex;"><span>}</span></span></code></pre></div><p>However we might have the case where there are no registered event handlers, in which case <code>Hatch</code> evaluates to <code>null</code>, and attempting to call <code>Invoke()</code> will cause an error.  We can prevent this by wrapping our <code>Invoke()</code> within a conditional:</p>
<div class="wrap-code highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-csharp" data-lang="csharp"><span style="display:flex;"><span><span style="color:#66d9ef">if</span>(Hatch != <span style="color:#66d9ef">null</span>) {
</span></span><span style="display:flex;"><span>    Hatch.Invoke(<span style="color:#66d9ef">this</span>, args);
</span></span><span style="display:flex;"><span>}</span></span></code></pre></div><p>However, there is a handy shorthand form for doing this (more syntactic sugar):</p>
<div class="wrap-code highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-csharp" data-lang="csharp"><span style="display:flex;"><span>Hatch?.Invoke(<span style="color:#66d9ef">this</span>, args);</span></span></code></pre></div><p>Using the question mark (<code>?</code>) before the method invocation is known as the <a href="https://docs.microsoft.com/en-us/dotnet/csharp/language-reference/operators/member-access-operators#null-conditional-operators--and-" target="_blank">Null-condition operator</a>
. We use this to avoid calling the <code>Invoke()</code> method if <code>PropertyChanged</code> is null (which is the case if no event handlers have been assigned to it). It tests the object to see if it is null.  If it is null, the method is not invoked.</p>

  
  
<div class="box notices cstyle info">
  <div class="box-label"><i class="fa-fw fas fa-info-circle"></i> Info</div>
  <div class="box-content">

<p>You might be wondering why an event with no assigned event handlers is <code>Null</code> instead of some form of empty collection. The answer is rooted in efficiency - remember that each object (even empty collection) requires a certain amount of memory to hold its details.  Now think about all the possible events we might want to listen for in a GUI.  The <a href="https://docs.microsoft.com/en-us/dotnet/api/system.windows.controls.control?view=netcore-3.1#events" target="_blank">System.Windows.Controls.Control</a>
 Class (a base class for all WPF controls) defines around 100 events.  Now multiply that by all the controls used in a single GUI, and you&rsquo;ll see that small amount of memory consumption adds up quickly.  By leaving unused events null, C# saves significant memory!</p>
</div>
</div>
<p>Thus, our complete egg class would be:</p>
<div class="wrap-code highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-csharp" data-lang="csharp"><span style="display:flex;"><span><span style="color:#75715e">/// &lt;summary&gt;</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">/// A class representing an egg </span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">/// &lt;/summary&gt;</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">public</span> <span style="color:#66d9ef">class</span> <span style="color:#a6e22e">Egg</span> 
</span></span><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">/// &lt;summary&gt;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">/// An event triggered when the egg hatches </span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">/// &lt;/summary&gt;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">event</span> EventHandler&lt;HatchEventArgs&gt; Hatch;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">/// &lt;summary&gt;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">/// Constructs a new Egg instance </span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">/// &lt;/summary&gt;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">public</span> Egg() 
</span></span><span style="display:flex;"><span>    {
</span></span><span style="display:flex;"><span>        <span style="color:#75715e">// Set a timer to go off in 20 days </span>
</span></span><span style="display:flex;"><span>        <span style="color:#75715e">// (ms = 20 days * 24 hours/day * 60 minutes/hour * 60 seconds/minute * 1000 milliseconds/seconds)</span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">var</span> timer = <span style="color:#66d9ef">new</span> System.Timers.Timer(<span style="color:#ae81ff">20</span> * <span style="color:#ae81ff">24</span> * <span style="color:#ae81ff">60</span> * <span style="color:#ae81ff">60</span> * <span style="color:#ae81ff">1000</span>);
</span></span><span style="display:flex;"><span>        timer.Elapsed += StartHatching;
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">/// &lt;summary&gt;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">/// Handles the end of the incubation period </span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">/// by triggering a Hatch event </span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">/// &lt;/summary&gt;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">private</span> <span style="color:#66d9ef">void</span> StartHatching(<span style="color:#66d9ef">object</span> source, ElapsedEventArgs e) 
</span></span><span style="display:flex;"><span>    {
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">var</span> chick = <span style="color:#66d9ef">new</span> Chick();
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">var</span> args = <span style="color:#66d9ef">new</span> HatchEventArgs(chick);
</span></span><span style="display:flex;"><span>        Hatch?.Invoke(<span style="color:#66d9ef">this</span>, args);
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>}</span></span></code></pre></div>
            <footer class="footline">

            </footer>
          </article>

    
    
          <article class="default">
            <header class="headline">
            </header>
<h1 id="events-as-messages">Events as Messages</h1>

<p>It might be coming clear that in many ways, events are another form of <em>message passing</em>, much like methods are.  In fact, they are processed much the same way: the <code>Invoke()</code> method of the event <em>calls</em> each attached event handler in turn.</p>

  
  
<div class="box notices cstyle tip">
  <div class="box-label"><i class="fa-fw fas fa-lightbulb"></i> Tip</div>
  <div class="box-content">

<p>Regular event invocation in C# is <em>synchronous</em>, just as is method calling - invoking an event passes execution to the event handlers one at a time the same way calling a method hands program execution to the method.  Once they have finished executing, program execution continues back in the code that invoked the event.  Let&rsquo;s see a practical example based on our discussion of the Hatch event.  If we were to give our chick a name:</p>
<div class="wrap-code highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-csharp" data-lang="csharp"><span style="display:flex;"><span><span style="color:#66d9ef">private</span> <span style="color:#66d9ef">void</span> StartHatching(<span style="color:#66d9ef">object</span> source, ElapsedEventArgs e) 
</span></span><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">var</span> chick = <span style="color:#66d9ef">new</span> Chick();
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">var</span> args = <span style="color:#66d9ef">new</span> HatchEventArgs(chick);
</span></span><span style="display:flex;"><span>    Hatch?.Invoke(<span style="color:#66d9ef">this</span>, args);
</span></span><span style="display:flex;"><span>    chick.Name = <span style="color:#e6db74">&#34;Cluckzilla&#34;</span>;
</span></span><span style="display:flex;"><span>}</span></span></code></pre></div><p>And in our event handler, we tried to print that name:</p>
<div class="wrap-code highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-csharp" data-lang="csharp"><span style="display:flex;"><span><span style="color:#66d9ef">private</span> <span style="color:#66d9ef">void</span> OnHatch(<span style="color:#66d9ef">object</span> sender, HatchEventArgs e)
</span></span><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>    Console.WriteLine(<span style="color:#e6db74">$&#34;Welcome to the world, {e.Chick.Name}!&#34;</span>);
</span></span><span style="display:flex;"><span>}</span></span></code></pre></div><p>The <code>OnHatch</code> event handler would be triggered by the <code>Hatch?.Invoke()</code> line <em>before</em> the name was set, so the <code>Chick.Name</code> property would be null!  We would need to move the name assignment to <em>before</em> the <code>Invoke()</code> call for it to be available in any attached event handlers.</p>
</div>
</div>
<p>The <code>EventArgs</code> define what the message contains, the <code>sender</code> specifies which object is sending the event, and the objects defining the event handlers are the ones receiving it.</p>
<p>That last bit is the biggest difference between using an event to pass a message and using a method to pass the same message.  With a method, we always have one object sending and one object receiving.  In contrast, an event can have <em>no</em> objects receiving, one object receiving, or <em>many</em> objects receiving.</p>
<p>An event is therefore more flexible and open-ended.  We can determine which object(s) should receive the message at any point - even at runtime.  In contrast, with a method we need to know what object we are sending the message to (i.e invoking the method of) as we write the code to do so.</p>
<p>Let&rsquo;s look at a concrete example of where this can come into play.</p>

            <footer class="footline">

            </footer>
          </article>

    
    
          <article class="default">
            <header class="headline">
            </header>
<h1 id="propertychanged">PropertyChanged</h1>

<p>We often have classes which encapsulate data we might need to look at.  For example, we might have a &ldquo;Smart&rdquo; dog dish, which keeps track of the amount of food it contains in ounces.  So it exposes a <code>Weight</code> property.</p>
<p>Now let&rsquo;s assume we have a few possible add-on products that can be combined with that smart bowl.  One is a &ldquo;dinner bell&rdquo;, which makes noises when the bowl is filled (ostensibly to attract the dog, but mostly just to annoy your neighbors).  Another is a wireless device that sends texts to your phone to let you know when the bowl is empty.</p>
<p>How can the software running on these devices determine when the bowl is empty or full?  One possibility would be to check the bowl&rsquo;s weight constantly, or at a set interval.  We call this strategy <em>polling</em>:</p>
<div class="wrap-code highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-csharp" data-lang="csharp"><span style="display:flex;"><span><span style="color:#75715e">/// &lt;summary&gt;</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">/// The run button for the Dinner Bell add-on</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">/// &lt;/summary&gt;</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">public</span> <span style="color:#66d9ef">void</span> Run()
</span></span><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">while</span>(bowl.Weight != <span style="color:#ae81ff">0</span>) {
</span></span><span style="display:flex;"><span>        <span style="color:#75715e">// Do nothing</span>
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">// If we reach here, the bowl is empty!</span>
</span></span><span style="display:flex;"><span>    sendEmptyText();
</span></span><span style="display:flex;"><span>}</span></span></code></pre></div><p>The problem with this approach is that it means our program is running full-bore <em>all the time</em>.  If this is a battery-operated device, those batteries will drain quickly.  It might be better if we let the smart bowl notify the Dinner Bell, but if we did this using methods, the Smart Bowl would need a reference to that dinner bell&hellip; and any other accessories we plug in.</p>
<p>This was a common problem in GUI design - sometimes we need to know when a property changes because we are displaying that property&rsquo;s value in the GUI, possibly in multiple places.  But if that property is <em>not</em> part of a GUI display, we may not care when it changes.</p>
<h3 id="the-inotifypropertychanged-interface">The INotifyPropertyChanged Interface</h3>
<p>The standard answer to this dilemma in .NET is the <code>INotifyPropertyChanged</code> interface - an interface defined in the <code>System.ComponentModel</code> namespace that requires you to implement a single event <code>PropertyChanged</code> on the class that is changing.  You can define this event as:</p>
<div class="wrap-code highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-csharp" data-lang="csharp"><span style="display:flex;"><span><span style="color:#66d9ef">public</span> <span style="color:#66d9ef">event</span> PropertyChangedEventHandler? PropertyChanged;</span></span></code></pre></div><p>This sets up the <code>PropertyChanged</code> event handler on your class.  Let&rsquo;s first look at writing event listeners to take advantage of this event.</p>
<h4 id="propertychanged-event-listeners">PropertyChanged Event Listeners</h4>
<p>In our example, we would do this with the smart dog bowl, and add listeners to the dinner bell and empty notification tools.  The <code>PropertyChangedEventArgs</code> includes the name of the property that is changing (<code>PropertyName</code>) - so we can check that 1) the property changing is the weight, and 2) that the weight meets our criteria, i.e.:</p>
<div class="wrap-code highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-csharp" data-lang="csharp"><span style="display:flex;"><span><span style="color:#75715e">/// &lt;summary&gt;</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">/// A SmartBowl accessory that sends text notifications when the SmartBowl is empty</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">/// &lt;/summary&gt;</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">public</span> <span style="color:#66d9ef">class</span> <span style="color:#a6e22e">EmptyTexter</span>
</span></span><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">/// &lt;summary&gt;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">/// Constructs a new EmptyTexter object </span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">/// &lt;/summary&gt;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">/// &lt;param Name=&#34;bowl&#34;&gt;The SmartBowl to listen to&lt;/param&gt;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">public</span> EmptyTexter(SmartBowl bowl)
</span></span><span style="display:flex;"><span>    {
</span></span><span style="display:flex;"><span>        bowl.PropertyChanged += onBowlPropertyChanged;
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">/// &lt;summary&gt;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">/// Responds to changes in the Weight property of the bowl</span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">/// &lt;/summary&gt;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">/// &lt;param Name=&#34;Sender&#34;&gt;The bowl sending the event&lt;/param&gt;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">/// &lt;param Name=&#34;e&#34;&gt;The event arguments (specifying which property changed)&lt;/param&gt;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">private</span> <span style="color:#66d9ef">void</span> onBowlPropertyChanged(<span style="color:#66d9ef">object</span> sender, PropertyChangedEventArgs e)
</span></span><span style="display:flex;"><span>    {
</span></span><span style="display:flex;"><span>        <span style="color:#75715e">// Only move forward if the property changing is the weight</span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">if</span> (e.PropertyName == <span style="color:#e6db74">&#34;Weight&#34;</span>)
</span></span><span style="display:flex;"><span>        {
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">if</span> (sender <span style="color:#66d9ef">is</span> SmartBowl)
</span></span><span style="display:flex;"><span>            {
</span></span><span style="display:flex;"><span>                <span style="color:#66d9ef">var</span> bowl = sender <span style="color:#66d9ef">as</span> SmartBowl;
</span></span><span style="display:flex;"><span>                <span style="color:#66d9ef">if</span> (bowl.Weight == <span style="color:#ae81ff">0</span>) textBowlIsEmpty();
</span></span><span style="display:flex;"><span>            }
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">/// &lt;summary&gt;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">/// Helper method to notify bowl is empty</span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">/// &lt;/summary&gt;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">private</span> <span style="color:#66d9ef">void</span> textBowlIsEmpty()
</span></span><span style="display:flex;"><span>    {
</span></span><span style="display:flex;"><span>        <span style="color:#75715e">// TODO: Implement texting</span>
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>}</span></span></code></pre></div><p>Note that in our event listener, we need to check the specific property that is changing is the one we care about - the <code>Weight</code>.  We also cast the source of the event back into a <code>SmartBowl</code>, but only after checking the cast is possible.  Alternatively, we could have stored the <code>SmartBowl</code> instance in a class variable rather than casting.</p>
<p>Or, we can use the new <a href="https://docs.microsoft.com/en-us/dotnet/csharp/pattern-matching#the-is-type-pattern-expression" target="_blank">is type pattern expression</a>
:</p>
<div class="wrap-code highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-csharp" data-lang="csharp"><span style="display:flex;"><span><span style="color:#66d9ef">if</span>(sender <span style="color:#66d9ef">is</span> SmartBowl bowl) {
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">// Inside this body, bowl is the sender cast as a SmartBowl</span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">// TODO: logic goes here</span>
</span></span><span style="display:flex;"><span>}</span></span></code></pre></div><p>This is syntactic sugar for:</p>
<div class="wrap-code highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-csharp" data-lang="csharp"><span style="display:flex;"><span><span style="color:#66d9ef">if</span>(sender <span style="color:#66d9ef">is</span> SmartBowl) {
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">var</span> bowl = sender <span style="color:#66d9ef">as</span> SmartBowl;
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">// TODO: logic goes here</span>
</span></span><span style="display:flex;"><span>}</span></span></code></pre></div><p>Notice how the is type pattern expression merges the if test and variable assignment?</p>
<p>Also, notice that the only extra information supplied by our <code>PropertyChangedEventArgs</code> is the name of the property - not its prior value, or any other info.  This helps keep the event lightweight, but it does mean if we need to keep track of prior values, we must implement that ourselves, as we do in the <code>DinnerBell</code> implementation:</p>
<div class="wrap-code highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-csharp" data-lang="csharp"><span style="display:flex;"><span><span style="color:#75715e">/// &lt;summary&gt;</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">/// A SmartBowl accessory that makes noise when the bowl is filled</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">/// &lt;/summary&gt;</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">public</span> <span style="color:#66d9ef">class</span> <span style="color:#a6e22e">DinnerBell</span>
</span></span><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">/// &lt;summary&gt;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">/// Caches the previous weight measurement </span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">/// &lt;/summary&gt;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">private</span> <span style="color:#66d9ef">double</span> lastWeight;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">/// &lt;summary&gt;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">/// Constructs a new DinnerBell object </span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">/// &lt;/summary&gt;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">/// &lt;param Name=&#34;bowl&#34;&gt;The SmartBowl to listen to&lt;/param&gt;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">public</span> DinnerBell(SmartBowl bowl)
</span></span><span style="display:flex;"><span>    {
</span></span><span style="display:flex;"><span>        lastWeight = bowl.Weight;
</span></span><span style="display:flex;"><span>        bowl.PropertyChanged += onBowlPropertyChanged;
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">/// &lt;summary&gt;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">/// Responds to changes in the Weight property of the bowl</span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">/// &lt;/summary&gt;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">/// &lt;param Name=&#34;Sender&#34;&gt;The bowl sending the event&lt;/param&gt;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">/// &lt;param Name=&#34;e&#34;&gt;The event arguments (specifying which property changed)&lt;/param&gt;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">private</span> <span style="color:#66d9ef">void</span> onBowlPropertyChanged(<span style="color:#66d9ef">object</span> sender, PropertyChangedEventArgs e)
</span></span><span style="display:flex;"><span>    {
</span></span><span style="display:flex;"><span>        <span style="color:#75715e">// Only move forward if the property changing is the weight</span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">if</span> (e.PropertyName == <span style="color:#e6db74">&#34;Weight&#34;</span>)
</span></span><span style="display:flex;"><span>        {
</span></span><span style="display:flex;"><span>            <span style="color:#75715e">// Cast the sender to a smart bowl using the is type expression</span>
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">if</span> (sender <span style="color:#66d9ef">is</span> SmartBowl bowl)
</span></span><span style="display:flex;"><span>            {
</span></span><span style="display:flex;"><span>                <span style="color:#75715e">// Ring the dinner bell if the bowl is now heavier </span>
</span></span><span style="display:flex;"><span>                <span style="color:#75715e">// (i.e. food has been added)</span>
</span></span><span style="display:flex;"><span>                <span style="color:#66d9ef">if</span> (bowl.Weight &gt; lastWeight) ringTheBell();
</span></span><span style="display:flex;"><span>                <span style="color:#75715e">// Cache the new weight</span>
</span></span><span style="display:flex;"><span>                lastWeight = bowl.Weight;
</span></span><span style="display:flex;"><span>            }
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">/// &lt;summary&gt;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">/// Helper method to make noise </span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">/// &lt;/summary&gt;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">private</span> <span style="color:#66d9ef">void</span> ringTheBell()
</span></span><span style="display:flex;"><span>    {
</span></span><span style="display:flex;"><span>        <span style="color:#75715e">// TODO: Implement noisemaking</span>
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>}</span></span></code></pre></div><h4 id="propertychanged-event-declaration">PropertyChanged Event Declaration</h4>
<p>For the event listeners to work as expected, we need to implement the <code>PropertyChanged</code> event in our <code>SmartBowl</code> class with:</p>
<div class="wrap-code highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-csharp" data-lang="csharp"><span style="display:flex;"><span><span style="color:#66d9ef">public</span> <span style="color:#66d9ef">event</span> PropertyChangedEventHandler? PropertyChanged;</span></span></code></pre></div><p>Which makes it available for the event handlers to attach to.  But this is only <em>part</em> of the process, we also need to <em>invoke</em> this event when it happens.  This is done with the <code>Invoke(object sender, EventArgs e)</code> method defined for every event handler. It takes two parameters, an <code>object</code> which is the source of the event, and the <code>EventArgs</code> defining the event.  The specific kind of <code>EventArgs</code> corresponds to the event declaration - in our case, <code>PropertyChangedEventArgs</code>.</p>
<p>Let&rsquo;s start with a straightforward example.  Assume we have a <code>Name</code> property in the <code>SmartBowl</code> that is a customizable string, allowing us to identify the bowl, i.e. &ldquo;Water&rdquo; or &ldquo;Food&rdquo;.  When we change it, we need to invoke the <code>PropertyChanged</code> event, i.e.:</p>
<div class="wrap-code highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-csharp" data-lang="csharp"><span style="display:flex;"><span><span style="color:#66d9ef">private</span> <span style="color:#66d9ef">string</span> name = <span style="color:#e6db74">&#34;Bowl&#34;</span>;
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">public</span> <span style="color:#66d9ef">string</span> Name {
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">get</span> {<span style="color:#66d9ef">return</span> name;}
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">set</span> 
</span></span><span style="display:flex;"><span>    {
</span></span><span style="display:flex;"><span>        name = <span style="color:#66d9ef">value</span>;
</span></span><span style="display:flex;"><span>        PropertyChanged?.Invoke(<span style="color:#66d9ef">this</span>, <span style="color:#66d9ef">new</span> PropertyChangedEventArgs(<span style="color:#e6db74">&#34;Name&#34;</span>));
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>}</span></span></code></pre></div><p>Notice how we use the setter for <code>Name</code> to invoke the <code>PropertyChanged</code> event handler, <em>after</em> the change to the property has been made.  This invocation needs to be done <em>after</em> the change, or the responding event listener may grab the <em>old</em> value (remember, event listeners are triggered <em>synchronously</em>).</p>
<p>Also note that we use the  null-conditional operator <a href="https://docs.microsoft.com/en-us/dotnet/csharp/language-reference/operators/member-access-operators#null-conditional-operators--and-" target="_blank"><code>?.</code></a>
 to avoid calling the <code>Invoke()</code> method if <code>PropertyChanged</code> is null (which is the case if no event listeners have been assigned).</p>
<p>Now let&rsquo;s tackle a more complex example.  Since our <code>SmartBowl</code> uses a sensor to measure the weight of its contents, we might be able to read the sensor data - probably through a driver or a class representing the sensor. Rather than doing this constantly, let&rsquo;s set a polling interval of 1 minute:</p>
<div class="wrap-code highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-csharp" data-lang="csharp"><span style="display:flex;"><span><span style="color:#75715e">/// &lt;summary&gt;</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">/// A class representing a &#34;smart&#34; dog bowl.</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">/// &lt;/summary&gt;</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">public</span> <span style="color:#66d9ef">class</span> <span style="color:#a6e22e">SmartBowl</span> : INotifyPropertyChanged 
</span></span><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">/// &lt;summary&gt;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">/// Event triggered when a property changes</span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">/// &lt;/summary&gt;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">event</span> PropertyChangedEventHandler? PropertyChanged;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">/// &lt;summary&gt;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">/// The weight sensor installed in the bowl</span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">/// &lt;/summary&gt;</span>
</span></span><span style="display:flex;"><span>    Sensor sensor;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">private</span> <span style="color:#66d9ef">string</span> name = <span style="color:#e6db74">&#34;Bowl&#34;</span>;
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">/// &lt;summary&gt;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">/// The name of this bowl</span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">/// &lt;/summary&gt;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">string</span> Name
</span></span><span style="display:flex;"><span>    {
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">get</span> { <span style="color:#66d9ef">return</span> name; }
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">set</span>
</span></span><span style="display:flex;"><span>        {
</span></span><span style="display:flex;"><span>            name = <span style="color:#66d9ef">value</span>;
</span></span><span style="display:flex;"><span>            PropertyChanged?.Invoke(<span style="color:#66d9ef">this</span>, <span style="color:#66d9ef">new</span> PropertyChangedEventArgs(<span style="color:#e6db74">&#34;Name&#34;</span>));
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">private</span> <span style="color:#66d9ef">double</span> weight;
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">/// &lt;summary&gt;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">/// The weight of the bowl contents, measured in ounces</span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">/// &lt;/summary&gt;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">double</span> Weight
</span></span><span style="display:flex;"><span>    {
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">get</span> { <span style="color:#66d9ef">return</span> weight; }
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">set</span>
</span></span><span style="display:flex;"><span>        {
</span></span><span style="display:flex;"><span>            <span style="color:#75715e">// We only want to treat the weight as changing </span>
</span></span><span style="display:flex;"><span>            <span style="color:#75715e">// if the change is more than a 16th of an ounce</span>
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">if</span> (Math.Abs(weight - <span style="color:#66d9ef">value</span>) &gt; <span style="color:#ae81ff">1</span> / <span style="color:#ae81ff">16</span>)
</span></span><span style="display:flex;"><span>            {
</span></span><span style="display:flex;"><span>                weight = <span style="color:#66d9ef">value</span>;
</span></span><span style="display:flex;"><span>                <span style="color:#75715e">// Notify of the property changing</span>
</span></span><span style="display:flex;"><span>                PropertyChanged?.Invoke(<span style="color:#66d9ef">this</span>, <span style="color:#66d9ef">new</span> PropertyChangedEventArgs(<span style="color:#e6db74">&#34;Weight&#34;</span>));
</span></span><span style="display:flex;"><span>            }
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">/// &lt;summary&gt;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">/// Constructs a new SmartBowl </span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">/// &lt;/summary&gt;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">/// &lt;param Name=&#34;sensor&#34;&gt;the weight sensor&lt;/param&gt;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">public</span> SmartBowl(Sensor sensor)
</span></span><span style="display:flex;"><span>    {
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">this</span>.sensor = sensor;
</span></span><span style="display:flex;"><span>        <span style="color:#75715e">// Set the initial weight</span>
</span></span><span style="display:flex;"><span>        weight = sensor.Value;
</span></span><span style="display:flex;"><span>        <span style="color:#75715e">// Set a timer to go off in 1 minute  </span>
</span></span><span style="display:flex;"><span>        <span style="color:#75715e">// (ms = 60 seconds/minute * 1000 milliseconds/seconds)</span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">var</span> timer = <span style="color:#66d9ef">new</span> System.Timers.Timer(<span style="color:#ae81ff">60</span> * <span style="color:#ae81ff">1000</span>);
</span></span><span style="display:flex;"><span>        <span style="color:#75715e">// Set the timer to reset when it goes off </span>
</span></span><span style="display:flex;"><span>        timer.AutoReset = <span style="color:#66d9ef">true</span>;
</span></span><span style="display:flex;"><span>        <span style="color:#75715e">// Trigger a sensor read each time the timer elapses</span>
</span></span><span style="display:flex;"><span>        timer.Elapsed += readSensor;
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">/// &lt;summary&gt;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">/// Handles the elapsing of the polling timer by updating the weight</span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">/// &lt;/summary&gt;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">private</span> <span style="color:#66d9ef">void</span> readSensor(<span style="color:#66d9ef">object</span> Sender, System.Timers.ElapsedEventArgs e)
</span></span><span style="display:flex;"><span>    {
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">this</span>.Weight = sensor.Value;
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>}</span></span></code></pre></div><p>Notice in this code, we use the setter of the <code>Weight</code> property to trigger the <code>PropertyChanged</code> event.  Because we&rsquo;re dealing with a real-world sensor that may have slight variations in the readings, we also only treat changes of more than 1/16th of an ounce as significant enough to change the property.</p>

  
  
<div class="box notices cstyle warning">
  <div class="box-label"><i class="fa-fw fas fa-exclamation-triangle"></i> Warning</div>
  <div class="box-content">

<p>With the <code>INotifyPropertyChanged</code> interface, the <em>only</em> aspect Visual Studio checks is that the <code>PropertyChanged</code> event is declared.  There is no built-in check that the programmer is using it as expected.  Therefore it is upon you, the programmer, to ensure that you meet the expectation that comes with implementing this interface: <em>that any public or protected property that changes will invoke the <code>PropertyChanged</code> event</em>.</p>
</div>
</div>
<h4 id="testing-the-propertychanged-event">Testing the PropertyChanged Event</h4>
<p>Finally, we should write unit tests to confirm that our <code>PropertyChanged</code> event works as expected:</p>
<div class="wrap-code highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-csharp" data-lang="csharp"><span style="display:flex;"><span><span style="color:#66d9ef">public</span> <span style="color:#66d9ef">class</span> <span style="color:#a6e22e">SmartBowlUnitTests</span> {
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">/// &lt;summary&gt;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">/// A mock sensor that increases its reading by one ounce </span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">/// every time its Value property is invoked.</span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">/// &lt;/summary&gt;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">class</span> <span style="color:#a6e22e">MockChangingWeightSensor</span> : Sensor
</span></span><span style="display:flex;"><span>    {
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">double</span> <span style="color:#66d9ef">value</span> = <span style="color:#ae81ff">0.0</span>;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">double</span> Value {
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">get</span> {
</span></span><span style="display:flex;"><span>                <span style="color:#66d9ef">value</span> += <span style="color:#ae81ff">1</span>;
</span></span><span style="display:flex;"><span>                <span style="color:#66d9ef">return</span> <span style="color:#66d9ef">value</span>;
</span></span><span style="display:flex;"><span>            }
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">
</span></span></span><span style="display:flex;"><span><span style="color:#a6e22e">    [Fact]</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">void</span> NameChangeShouldTriggerPropertyChanged() 
</span></span><span style="display:flex;"><span>    {
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">var</span> bowl = <span style="color:#66d9ef">new</span> SmartBowl(<span style="color:#66d9ef">new</span> MockChangingWeightSensor());
</span></span><span style="display:flex;"><span>        Assert.PropertyChanged(bowl, <span style="color:#e6db74">&#34;Name&#34;</span>, () =&gt; {
</span></span><span style="display:flex;"><span>            bowl.Name = <span style="color:#e6db74">&#34;New Name&#34;</span>;
</span></span><span style="display:flex;"><span>        });
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">
</span></span></span><span style="display:flex;"><span><span style="color:#a6e22e">    [Fact]</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">void</span> WeightChangeShouldTriggerPropertyChanged()
</span></span><span style="display:flex;"><span>    {
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">var</span> bowl = <span style="color:#66d9ef">new</span> SmartBowl(<span style="color:#66d9ef">new</span> MockChangingWeightSensor());
</span></span><span style="display:flex;"><span>        Assert.PropertyChangedAsync(bowl, <span style="color:#e6db74">&#34;Weight&#34;</span>, () =&gt; {
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">return</span> Task.Delay(<span style="color:#ae81ff">2</span> * <span style="color:#ae81ff">60</span> * <span style="color:#ae81ff">1000</span>);
</span></span><span style="display:flex;"><span>        });
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>}</span></span></code></pre></div><p>The <code>PropertyChanged</code> interface is so common in C# programming that we have <em>two</em> assertions dealing with it.  The first we use to test the <code>Name</code> property:</p>
<div class="wrap-code highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-csharp" data-lang="csharp"><span style="display:flex;"><span><span style="color:#a6e22e">[Fact]</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">public</span> <span style="color:#66d9ef">void</span> NameChangeShouldTriggerPropertyChanged() 
</span></span><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">var</span> bowl = <span style="color:#66d9ef">new</span> SmartBowl(<span style="color:#66d9ef">new</span> MockChangingWeightSensor());
</span></span><span style="display:flex;"><span>    Assert.PropertyChanged(bowl, <span style="color:#e6db74">&#34;Name&#34;</span>, () =&gt; {
</span></span><span style="display:flex;"><span>        bowl.Name = <span style="color:#e6db74">&#34;New Name&#34;</span>;
</span></span><span style="display:flex;"><span>    });
</span></span><span style="display:flex;"><span>}</span></span></code></pre></div><p>Notice that <code>Assert.PropertyChanged(@object ojb, string propertyName, Action action)</code> takes three arguments - first the object with the property that should be changing, second the name of the property we expect to change, and third an action that should trigger the event.  In this case, we change the name property.</p>
<p>The second is a bit more involved, as we have an event that happens based on a timer.  To test it therefore, we have to wait for the timer to have had an opportunity to trigger.  We do this with an asynchronous action, so we use the <code>Assert.PropertyChangedAsync(@object obj, string propertyName, Func&lt;Task&gt; action)</code>.  The first two arguments are the same, but the last one is a <code>Func</code> (a function) that returns an asynchronous <code>Task</code> object.  The simplest one to use here is <code>Task.Delay</code>, which delays for the supplied period of time (in our case, two minutes).  Since our property should change on one-minute intervals, we&rsquo;ll know if there was a problem if it doesn&rsquo;t change after two minutes.</p>

            <footer class="footline">

            </footer>
          </article>

    
    
          <article class="default">
            <header class="headline">
            </header>
<h1 id="inheritance-and-events">Inheritance And Events</h1>

<p>Considering that C# was developed as an object-oriented language from the ground up, you would expect that events would be inheritable just like properties, fields, and methods.  Unfortunately this is not the case.  Remember, the C# language is compiled into intermediate language to run on the .NET Runtime, and this Runtime proceeded C# (it is also used to compile Visual Basic), and the way events are implemented in intermediate language does not lend itself to inheritance patterns.</p>
<p>This has some important implications for writing C# events:</p>
<ul>
<li>You cannot invoke events defined in a base class in a derived class</li>
<li>The <code>virtual</code> and <code>override</code> keywords used with events do not actually create an overridden event - you instead end up with two separate implementations.</li>
</ul>
<p>The standard way programmers have adopted to this issue is to:</p>
<ol>
<li>Define the event normally in the base class</li>
<li>Add a <code>protected</code> helper method to that base class that will invoke the event, taking whatever parameters are needed</li>
<li>Calling that helper method from derived classes.</li>
</ol>
<p>For example, the <code>PropertyChanged</code> event we discussed previously is often invoked from a helper method named <code>OnPropertyChanged()</code> that is defined like this:</p>
<div class="wrap-code highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-csharp" data-lang="csharp"><span style="display:flex;"><span><span style="color:#66d9ef">protected</span> <span style="color:#66d9ef">virtual</span> <span style="color:#66d9ef">void</span> OnPropertyChanged(<span style="color:#66d9ef">string</span> propertyName)
</span></span><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">this</span>.PropertyChanged?.Invoke(<span style="color:#66d9ef">this</span>, <span style="color:#66d9ef">new</span> PropertyChangedEventArgs(propertyName));
</span></span><span style="display:flex;"><span>}</span></span></code></pre></div><p>In derived classes, you can indicate a property is changing by calling this event, and passing in the property name, i.e.:</p>
<div class="wrap-code highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-csharp" data-lang="csharp"><span style="display:flex;"><span><span style="color:#66d9ef">private</span> <span style="color:#66d9ef">object</span> _tag = <span style="color:#66d9ef">null</span>;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">/// &lt;summary&gt;</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">/// An object to represent whatever you need </span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">/// &lt;/summary&gt;</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">public</span> <span style="color:#66d9ef">object</span> Tag {
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">get</span> =&gt; _obj;
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">set</span> 
</span></span><span style="display:flex;"><span>  {
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">if</span>(<span style="color:#66d9ef">value</span> != _obj) 
</span></span><span style="display:flex;"><span>    {
</span></span><span style="display:flex;"><span>      _obj = <span style="color:#66d9ef">value</span>;
</span></span><span style="display:flex;"><span>      OnPropertyChanged(nameof(<span style="color:#66d9ef">this</span>.Tag));
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>  }
</span></span><span style="display:flex;"><span>}</span></span></code></pre></div><p>Note the call to <code>OnPropertyChanged()</code> - this will trigger the <code>PropertyChanged</code> event handler on the base class.</p>

  
  
<div class="box notices cstyle tip">
  <div class="box-label"><i class="fa-fw fas fa-lightbulb"></i> Tip</div>
  <div class="box-content">

<p>You might have noticed the use of <code>nameof(this.Tag)</code> in the example code above.  The <a href="https://docs.microsoft.com/en-us/dotnet/csharp/language-reference/operators/nameof" target="_blank">nameof expression</a> returns the <em>name</em> of a property as a string.  This approach is preferred over just writing the string, as it makes it less likely a typo will result in your code not working as expected.</p>
</div>
</div>

            <footer class="footline">

            </footer>
          </article>

    
    
          <article class="default">
            <header class="headline">
            </header>
<h1 id="routed-events">Routed Events</h1>

<p>While events exist in Windows Forms, Windows Presentation Foundation adds a twist with their concept of <em>routed events</em>.  Routed events are similar to regular C# events, but provide additional functionality.  One of the most important of these is the ability of the routed event to &ldquo;bubble&rdquo; up the <a href="https://ksu-cs-textbooks.github.io/cis400/2-desktop-development/02-element-tree/">elements tree</a>
.  Essentially, the event will be passed up each successive WPF element until one chooses to &ldquo;handle&rdquo; it, or the top of the tree is reached (in which case the event is ignored).</p>
<p>Consider a Click event handler for a button.  In Windows Forms, we have to attach our listener <em>directly to the button</em>, i.e:</p>
<div class="wrap-code highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-csharp" data-lang="csharp"><span style="display:flex;"><span><span style="color:#66d9ef">namespace</span> WindowsFormsApp1
</span></span><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">partial</span> <span style="color:#66d9ef">class</span> <span style="color:#a6e22e">Form1</span> : Form
</span></span><span style="display:flex;"><span>    {
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">public</span> Form1()
</span></span><span style="display:flex;"><span>        {
</span></span><span style="display:flex;"><span>            InitializeComponent();
</span></span><span style="display:flex;"><span>            IncrementButton.Click += HandleClick;
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">private</span> <span style="color:#66d9ef">void</span> HandleClick(<span style="color:#66d9ef">object</span> sender, EventArgs e)
</span></span><span style="display:flex;"><span>        {
</span></span><span style="display:flex;"><span>            <span style="color:#75715e">// TODO: Handle our click</span>
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>}</span></span></code></pre></div><p>With WPF we can also attach an event listener directly to the button, but we can <em>also</em> attach an event listener to an <em>ancestor</em> of the button (a component further up the element tree).  The click event will &ldquo;bubble&rdquo; up the element tree, and each successive parent will have the opportunity to handle it.  I.e. we can define a button in the <code>ChildControl</code>:</p>
<div class="wrap-code highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-xml" data-lang="xml"><span style="display:flex;"><span><span style="color:#f92672">&lt;UserControl</span> <span style="color:#a6e22e">x:Class=</span><span style="color:#e6db74">&#34;WpfApp1.ChildControl&#34;</span>
</span></span><span style="display:flex;"><span>             <span style="color:#a6e22e">xmlns=</span><span style="color:#e6db74">&#34;http://schemas.microsoft.com/winfx/2006/xaml/presentation&#34;</span>
</span></span><span style="display:flex;"><span>             <span style="color:#a6e22e">xmlns:x=</span><span style="color:#e6db74">&#34;http://schemas.microsoft.com/winfx/2006/xaml&#34;</span>
</span></span><span style="display:flex;"><span>             <span style="color:#a6e22e">xmlns:mc=</span><span style="color:#e6db74">&#34;http://schemas.openxmlformats.org/markup-compatibility/2006&#34;</span> 
</span></span><span style="display:flex;"><span>             <span style="color:#a6e22e">xmlns:d=</span><span style="color:#e6db74">&#34;http://schemas.microsoft.com/expression/blend/2008&#34;</span> 
</span></span><span style="display:flex;"><span>             <span style="color:#a6e22e">xmlns:local=</span><span style="color:#e6db74">&#34;clr-namespace:WpfApp1&#34;</span>
</span></span><span style="display:flex;"><span>             <span style="color:#a6e22e">mc:Ignorable=</span><span style="color:#e6db74">&#34;d&#34;</span> 
</span></span><span style="display:flex;"><span>             <span style="color:#a6e22e">d:DesignHeight=</span><span style="color:#e6db74">&#34;450&#34;</span> <span style="color:#a6e22e">d:DesignWidth=</span><span style="color:#e6db74">&#34;800&#34;</span><span style="color:#f92672">&gt;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">&lt;Grid&gt;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">&lt;Button</span> <span style="color:#a6e22e">Name=</span><span style="color:#e6db74">&#34;IncrementButton&#34;</span><span style="color:#f92672">&gt;</span>Count<span style="color:#f92672">&lt;/Button&gt;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">&lt;/Grid&gt;</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">&lt;/UserControl&gt;</span></span></span></code></pre></div><p>And add an instance of <code>ChildControl</code> to our <code>MainWindow</code>:</p>
<div class="wrap-code highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-csharp" data-lang="csharp"><span style="display:flex;"><span>&lt;Window x:Class=<span style="color:#e6db74">&#34;WpfApp1.MainWindow&#34;</span>
</span></span><span style="display:flex;"><span>        xmlns=<span style="color:#e6db74">&#34;http://schemas.microsoft.com/winfx/2006/xaml/presentation&#34;</span>
</span></span><span style="display:flex;"><span>        xmlns:x=<span style="color:#e6db74">&#34;http://schemas.microsoft.com/winfx/2006/xaml&#34;</span>
</span></span><span style="display:flex;"><span>        xmlns:d=<span style="color:#e6db74">&#34;http://schemas.microsoft.com/expression/blend/2008&#34;</span>
</span></span><span style="display:flex;"><span>        xmlns:mc=<span style="color:#e6db74">&#34;http://schemas.openxmlformats.org/markup-compatibility/2006&#34;</span>
</span></span><span style="display:flex;"><span>        xmlns:local=<span style="color:#e6db74">&#34;clr-namespace:WpfApp1&#34;</span>
</span></span><span style="display:flex;"><span>        mc:Ignorable=<span style="color:#e6db74">&#34;d&#34;</span>
</span></span><span style="display:flex;"><span>        Title=<span style="color:#e6db74">&#34;MainWindow&#34;</span> Height=<span style="color:#e6db74">&#34;450&#34;</span> Width=<span style="color:#e6db74">&#34;800&#34;</span>&gt;
</span></span><span style="display:flex;"><span>    &lt;Grid Button.Click=<span style="color:#e6db74">&#34;HandleClick&#34;</span>&gt;
</span></span><span style="display:flex;"><span>        &lt;local:ChildControl/&gt;        
</span></span><span style="display:flex;"><span>    &lt;/Grid&gt;
</span></span><span style="display:flex;"><span>&lt;/Window&gt;</span></span></code></pre></div><p>Note that in our <code>&lt;Grid&gt;</code> we attached a <code>Button.Click</code> handler?  The attached listener, <code>HandleClick</code>, will be invoked for <em>all</em> <code>Click</code> events arising from <code>Buttons</code> that are nested under the <code>&lt;Grid&gt;</code> in the elements tree.  We can then write this event handler in the codebehind of our <code>MainWindow</code>:</p>
<div class="wrap-code highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-csharp" data-lang="csharp"><span style="display:flex;"><span><span style="color:#66d9ef">namespace</span> WpfApp1
</span></span><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">/// &lt;summary&gt;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">/// Interaction logic for MainWindow.xaml</span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">/// &lt;/summary&gt;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">partial</span> <span style="color:#66d9ef">class</span> <span style="color:#a6e22e">MainWindow</span> : Window
</span></span><span style="display:flex;"><span>    {
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">public</span> MainWindow()
</span></span><span style="display:flex;"><span>        {
</span></span><span style="display:flex;"><span>            InitializeComponent();
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">private</span> <span style="color:#66d9ef">void</span> HandleClick(Object sender, RoutedEventArgs e)
</span></span><span style="display:flex;"><span>        {
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">if</span>(e.OriginalSource <span style="color:#66d9ef">is</span> Button button &amp;&amp; button.Name == <span style="color:#e6db74">&#34;IncrementButton&#34;</span>)
</span></span><span style="display:flex;"><span>            {
</span></span><span style="display:flex;"><span>                <span style="color:#75715e">// TODO: Handle increment;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>                e.Handled = <span style="color:#66d9ef">true</span>;
</span></span><span style="display:flex;"><span>            }
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>}</span></span></code></pre></div><p>Note that because this event listener will be triggered for <em>all</em> buttons, we need to make sure it&rsquo;s a button we care about - so we cast the <code>OriginalSource</code> of the event to be a button and check its <code>Name</code> property.  We use the <code>RoutedEventArgs.OriginalSource</code> because the <code>sender</code> won&rsquo;t necessarily be the specific control the event originated in - in this case it actually is the <code>Grid</code> containing the button.  Also, note that we mark <code>e.Handled</code> as <code>true</code>.  This tells WPF it can stop &ldquo;bubbling&rdquo; the event, as we have taken care of it.</p>
<p>We&rsquo;ll cover routed events in more detail in the upcoming <a href="https://ksu-cs-textbooks.github.io/cis400/2-desktop-development/05-dependency-objects/">Dependency Objects</a>
 chapter, but for now you need to know that the GUI events you know from Windows Forms (Click, Select, Focus, Blur), are all routed events in WPF, and therefore take a <code>RoutedEventArgs</code> object instead of the event arguments you may be used to.</p>

            <footer class="footline">

            </footer>
          </article>

    
    
          <article class="default">
            <header class="headline">
            </header>
<h1 id="collectionchanged">CollectionChanged</h1>

<p>The <code>PropertyChanged</code> event notifies us when a <em>property</em> of an object changes, which covers most of our GUI notification needs.  However, there are some concepts that aren&rsquo;t covered by it - specifically, when an item is added or removed from a collection.  We use a different event, <code>NotifyCollectionChanged</code> to convey when this occurs.</p>
<h3 id="the-inotifycollectionchanged-interface">The INotifyCollectionChanged Interface</h3>
<p>The <code>INotifyCollectionChanged</code> interface defined in the <code>System.Collections.Specialized</code> namespace indicates the collection implements the <code>NotifyCollectionChangedEventHandler</code>, i.e.:</p>
<div class="wrap-code highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-csharp" data-lang="csharp"><span style="display:flex;"><span><span style="color:#66d9ef">public</span> <span style="color:#66d9ef">event</span> NotifyCollectionChangedEventHandler? NotifyCollectionChanged;</span></span></code></pre></div><p>And, as you would expect, this event is triggered any time the collection&rsquo;s contents change, much like the <code>PropertyChanged</code> event we discussed earlier was triggered when a property changed.  However, the <code>NotifyCollectionChangedEventArgs</code> provides a <em>lot</em> more information than we saw with the <code>PropertyChangedEventArgs</code>,as you can see in the UML diagram below:</p>
<p>
<a href="#image-bc7ee8d42854b246dd9a631d4e1a2f94" class="lightbox-link">
<img src="https://ksu-cs-textbooks.github.io/cis400/images/2.3.9.1.png" alt="UML or NotifyCollectionChangedEventArgs and PropertyChangedEventArgs" style="height: auto; width: auto;" loading="lazy">
</a>
<a href="javascript:history.back();" class="lightbox" id="image-bc7ee8d42854b246dd9a631d4e1a2f94">
<img src="https://ksu-cs-textbooks.github.io/cis400/images/2.3.9.1.png" alt="UML or NotifyCollectionChangedEventArgs and PropertyChangedEventArgs" class="lightbox-image" loading="lazy">
</a></p>
<p>With <code>PropertyChangedEventArgs</code> we simply provide the name of the property that is changing.  But with <code>NotifyCollectionChangedEventArgs</code>, we are describing both <em>what</em> the change is (i.e. an Add, Remove, Replace, Move, or Reset), and what item(s) we affected.  So if the action was adding an item, the <code>NotifyCollectionChangedEventArgs</code> will let us know what item was added to the collection, and possibly at what position it was added at.</p>
<p>When implementing the <code>INotifyCollectionChanged</code> interface, you must supply a <a href="https://docs.microsoft.com/en-us/dotnet/api/system.collections.specialized.notifycollectionchangedeventargs?view=net-5.0" target="_blank"><code>NotifyCollectionChangedEventArgs</code> object</a> that describes the change to the collection.  This class has multiple constructors, and you must select the correct one, or your code will cause a runtime error when the event is invoked.</p>

  
  
<div class="box notices cstyle info">
  <div class="box-label"><i class="fa-fw fas fa-info-circle"></i> Info</div>
  <div class="box-content">

<p>You might be wondering why <code>PropertyChangedEventArgs</code> contains so little information compared to <code>NotifyCollectionChangedEventArgs</code>.  Most notably, the <em>old</em> and <em>new</em> values of the property could have been included. I suspect the reason they were not is that there are many times where you don&rsquo;t actually need to know what the property value is - just that it changed, and you can always retrieve that value once you know you need to.</p>
<p>In contrast, there are situations where a GUI displaying a collection may have hundreds of entries. Identifying <em>exactly</em> which ones have changed means that only those entries need to be modified in the GUI.  If we didn&rsquo;t have that information, we&rsquo;d have to retrieve the <em>entire</em> collection and re-render it, which can be a very computationally expensive process.</p>
<p>But ultimately, the two interfaces were developed by different teams at different times, which probably accounts for most of the differences.</p>
</div>
</div>
<h4 id="notifycollectionchangedaction">NotifyCollectionChangedAction</h4>
<p>The only property of the <code>NotifyCollectionChangedArgs</code> that will <em>always</em> be populated is the <code>Action</code> property.  The type of htis property is the <code>NotifyCollectionChangedAction</code> enumeration, and its values (and what they represent) are:</p>
<ul>
<li><code>NotifyCollectionChangedAction.Add</code> - one or more items were added to the collection</li>
<li><code>NotifyCollectionChangedAction.Move</code> - an item was moved in the collection</li>
<li><code>NotifyCollectionChangedAction.Remove</code> - one or more items were removed from the collection</li>
<li><code>NotifyCollectionChangedAction.Replace</code> - an item was replaced in the collection</li>
<li><code>NotifyCollectionChangedAction.Reset</code> - drastic changes were made to the collection</li>
</ul>
<h4 id="notifycollectionchangedeventargs-constructors">NotifyCollectionChangedEventArgs Constructors</h4>
<p>A second feature you probably noticed from the UML is that there are a <em>lot</em> of constructors for the <code>NotifyCollectionChangedEventArgs</code>.  Each represents a different situation, and you must pick the appropriate one.</p>
<p>For example, the <code>NotifyCollectionChangedEventArgs(NotifyCollectionChangedAction)</code> constructor represents a <code>NotifyCollectionChangedAction.Reset</code> change. This indicates the collection&rsquo;s content changed <em>dramatically</em>, and the best recourse for a GUI is to ask for the full collection again and rebuild the display.  You should <em>only</em> use this one-argument constructor for a Reset action.</p>

  
  
<div class="box notices cstyle warning">
  <div class="box-label"><i class="fa-fw fas fa-exclamation-triangle"></i> Warning</div>
  <div class="box-content">

<p>In C#, there is no mechanism for limiting a constructor to specific argument values. So you actually <em>can</em> call the above constructor for a different kind of event, i.e.:</p>
<div class="wrap-code highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-csharp" data-lang="csharp"><span style="display:flex;"><span><span style="color:#66d9ef">new</span> NotifyCollectionChangedEventArgs(NotifyCollectionChangedAction.Add);</span></span></code></pre></div><p>However, doing so will throw a <code>InvalidArgumentException</code> when the code is actually executed.</p>
</div>
</div>
<p>In general, if you are adding or removing an <code>object</code>, you need to provide the <code>object</code> to the constructor. If you are adding or removing multiple objects, you will need to provide an <code>IList</code> of the affected objects.  And you may also need to provide the object&rsquo;s index in the collection. You can read more about the available constructors and their uses in the <a href="https://learn.microsoft.com/en-us/dotnet/api/system.collections.specialized.notifycollectionchangedeventargs.-ctor?view=net-6.0#system-collections-specialized-notifycollectionchangedeventargs-ctor%28system-collections-specialized-notifycollectionchangedaction-system-object%29" target="_blank">Microsoft Documentation</a>
.</p>

            <footer class="footline">

            </footer>
          </article>

    
    
          <article class="default">
            <header class="headline">
            </header>
<h1 id="testing-generic-events">Testing Generic Events</h1>

<p>In the testing chapter, we introduced the XUnit assertion for testing events, <code>Assert.Raises&lt;T&gt;</code>.  Let&rsquo;s imagine a doorbell class that raises a <code>Ring</code> event when it is pressed, with information about the door, which can be used to do things like ring a physical bell, or send a text notification:</p>
<div class="wrap-code highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-csharp" data-lang="csharp"><span style="display:flex;"><span><span style="color:#75715e">/// &lt;summary&gt;</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">/// A class representing details of a ring event </span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">/// &lt;/summary&gt;</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">public</span> <span style="color:#66d9ef">class</span> <span style="color:#a6e22e">RingEventArgs</span> : EventArgs 
</span></span><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">private</span> <span style="color:#66d9ef">string</span> _door;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">/// &lt;summary&gt;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">/// The identity of the door for which the doorbell was activated</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">string</span> Door =&gt; _door;
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">/// &lt;summary&gt;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">/// Constructs a new RingEventArgs </span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">/// &lt;/summary&gt;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">public</span> RingEventArgs(<span style="color:#66d9ef">string</span> door) 
</span></span><span style="display:flex;"><span>    {
</span></span><span style="display:flex;"><span>      _door = door;
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">/// &lt;summary&gt;</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">/// A class representing a doorbell</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">/// &lt;/summary&gt;</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">public</span> <span style="color:#66d9ef">class</span> <span style="color:#a6e22e">Doorbell</span>
</span></span><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">/// &lt;summary&gt;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">/// An event triggered when the doorbell rings </span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">/// &lt;/summary&gt;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">event</span> EventHandler&lt;RingEventArgs&gt; Ring;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">/// &lt;summary&gt;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">/// The name of the door where this doorbell is mounted </span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">/// &lt;/summary&gt;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">string</span> Identifier {<span style="color:#66d9ef">get</span>; <span style="color:#66d9ef">set</span>;}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">/// &lt;summary&gt;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">/// Handles the end of the incubation period </span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">/// by triggering a Hatch event </span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">/// &lt;/summary&gt;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">void</span> Push() 
</span></span><span style="display:flex;"><span>    {
</span></span><span style="display:flex;"><span>        Ring?.Invoke(<span style="color:#66d9ef">this</span>, <span style="color:#66d9ef">new</span> RingEventArgs(Identifier));
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>}</span></span></code></pre></div><p>To test this doorbell, we&rsquo;d want to make sure that the <code>Ring</code> event is invoked when the <code>Push()</code> method is called.  The <code>Assert.Raises&lt;T&gt;</code> does exactly this:</p>
<div class="wrap-code highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-csharp" data-lang="csharp"><span style="display:flex;"><span><span style="color:#a6e22e">[Fact]</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">public</span> <span style="color:#66d9ef">void</span> PressingDoorbellShouldRaiseRingEvent
</span></span><span style="display:flex;"><span>Doorbell db = <span style="color:#66d9ef">new</span> Doorbell();
</span></span><span style="display:flex;"><span>Assert.Raises&lt;RingEventArgs&gt;(
</span></span><span style="display:flex;"><span>  handler =&gt; db.Ring += handler,
</span></span><span style="display:flex;"><span>  handler =&gt; db.Ring -= handler, 
</span></span><span style="display:flex;"><span>  () =&gt; {
</span></span><span style="display:flex;"><span>    db.Push();
</span></span><span style="display:flex;"><span>  });</span></span></code></pre></div><p>This code may be a bit confusing at first, so let&rsquo;s step through it.  The <code>&lt;T&gt;</code> is the type of event arguments we expect to receive, in this case, <code>RingEventArgs</code>.  The first argument is a lambda expression that attaches an event handler <code>handler</code> (provided by the <code>Assert.Raises</code> method) to our object to test, <code>db</code>.  The second argument is a lambda expression that removes the event handler <code>handler</code>.  The third is an action (also written as a lambda expression) that should trigger the event if the code we are testing is correct.</p>
<p>This approach allows us to test events declared with the generic <code>EventHandler&lt;T&gt;</code>, which is one of the reasons we prefer it.  It will not work with custom event handlers though; for those we&rsquo;ll need a different approach.</p>

            <footer class="footline">

            </footer>
          </article>

    
    
          <article class="default">
            <header class="headline">
            </header>
<h1 id="testing-custom-events">Testing Custom Events</h1>

<p>In the previous section, we discussed using XUnit&rsquo;s <code>Assert.Raises&lt;T&gt;</code> to test generic events (events declared with the <code>EventHandler&lt;T&gt;</code> generic).  However, this approach does not work with non-generic events, like <code>PropertyChanged</code> and <code>CollectionChanged</code>.  That is why XUnit provides an <code>Assert.PropertyChanged()</code> method.  Unfortunately, it does not offer a corresponding test for <code>CollectionChanged</code>.  So to test for this expectation we will need to write our own assertions.</p>
<p>To do that, we need to understand how assertions in the XUnit framework work.  Essentially, they test the truthfulness of what is being asserted (i.e. two values are equal, a collection contains an item, etc.).  If the assertion is not true, then the code raises an exception - specifically, a <code>XunitException</code> or a class derived from it. This class provides a <code>UserMessage</code> (the message you get when the test fails) and a <code>StackTrace</code> (the lines describing where the error was thrown). With this in mind, we can write our own assertion method.  Let&rsquo;s start with a simple example that asserts the value of a string is &ldquo;Hello World&rdquo;:</p>
<div class="wrap-code highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-csharp" data-lang="csharp"><span style="display:flex;"><span><span style="color:#66d9ef">public</span> <span style="color:#66d9ef">static</span> <span style="color:#66d9ef">class</span> <span style="color:#a6e22e">MyAssert</span>
</span></span><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">class</span> <span style="color:#a6e22e">HelloWorldAssertionException</span>: XunitException 
</span></span><span style="display:flex;"><span>  {
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">public</span> HelloWorldAssertionException(<span style="color:#66d9ef">string</span> actual) : <span style="color:#66d9ef">base</span>(<span style="color:#e6db74">$&#34;Expected \&#34;</span>Hello World<span style="color:#960050;background-color:#1e0010">\</span><span style="color:#e6db74">&#34; but instead saw \&#34;{actual}\&#34;&#34;</span>) {}
</span></span><span style="display:flex;"><span>  }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">static</span> <span style="color:#66d9ef">void</span> HelloWorld(<span style="color:#66d9ef">string</span> phrase)
</span></span><span style="display:flex;"><span>  {
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">if</span>(phrase != <span style="color:#e6db74">&#34;Hello World&#34;</span>) <span style="color:#66d9ef">throw</span> <span style="color:#66d9ef">new</span> HelloWorldException(phrase);
</span></span><span style="display:flex;"><span>  }
</span></span><span style="display:flex;"><span>}</span></span></code></pre></div><p>Note that we use the <code>base</code> keyword to execute the <code>XunitException</code> constructor as part of the <code>HelloWorldAssertionException</code>, and pass along the <code>string</code> parameter <code>actual</code>.  Then the body of the <code>XunitException</code> constructor does all the work of setting values, so the body of our constructor is empty.</p>
<p>Now we can use this assertion in our own tests:</p>
<div class="wrap-code highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-csharp" data-lang="csharp"><span style="display:flex;"><span><span style="color:#a6e22e">[Theory]</span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">[InlineData(&#34;Hello World&#34;)]</span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">[InlineData(&#34;Hello Bob&#34;)]</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">public</span> <span style="color:#66d9ef">void</span> ShouldBeHelloWorld(<span style="color:#66d9ef">string</span> phrase)
</span></span><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>  MyAssert.HelloWorld(phrase);
</span></span><span style="display:flex;"><span>}</span></span></code></pre></div><p>The first <code>InlineData</code> will pass, and the second will fail with the report <code>Expected &quot;Hello World&quot; but instead saw Hello Bob</code>.</p>
<p>This was of course, a silly example, but it shows the basic concepts.  We would probably never use this in our own work, as <code>Assert.Equal()</code> can do the same thing.  Now let&rsquo;s look at a more complex example that we <em>would</em> use.</p>
<h2 id="assertions-for-collectionchanged">Assertions for CollectionChanged</h2>
<p>As we discussed previously, the <code>CollectionChanged</code> event cannot be tested with the Xunit <code>Assert.Throws</code>.  So this is a great candidate for custom assertions.  To be thorough, we should test <em>all</em> the possible actions (and we would do this if expanding the Xunit library).  But for how we plan to use it, we really only need two actions covered - adding and removing items <em>one at a time</em> from the collection.  Let&rsquo;s start with our exception definitions:</p>
<div class="wrap-code highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-csharp" data-lang="csharp"><span style="display:flex;"><span><span style="color:#66d9ef">public</span> <span style="color:#66d9ef">static</span> <span style="color:#66d9ef">class</span> <span style="color:#a6e22e">MyAssert</span>
</span></span><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">class</span> <span style="color:#a6e22e">NotifyCollectionChangedNotTriggeredException</span>: XunitException 
</span></span><span style="display:flex;"><span>  {
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">public</span> NotifyCollectionChangedNotTriggeredException(NotifyCollectionChangedAction expectedAction) : <span style="color:#66d9ef">base</span>(<span style="color:#e6db74">$&#34;Expected a NotifyCollectionChanged event with an action of {expectedAction} to be invoked, but saw none.&#34;</span>) {}
</span></span><span style="display:flex;"><span>  }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">class</span> <span style="color:#a6e22e">NotifyCollectionChangedWrongActionException</span>: XunitException 
</span></span><span style="display:flex;"><span>  {
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">public</span> NotifyCollectionChangedWrongActionException(NotifyCollectionChangedAction expectedAction, NotifyCollectionChangedAction actualAction) : <span style="color:#66d9ef">base</span>(<span style="color:#e6db74">$&#34;Expected a NotifyCollectionChanged event with an action of {expectedAction} to be invoked, but saw {actualAction}&#34;</span>) {}
</span></span><span style="display:flex;"><span>  }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">class</span> <span style="color:#a6e22e">NotifyCollectionChangedAddException</span>: XunitException 
</span></span><span style="display:flex;"><span>  {
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">public</span> NotifyCollectionChangedAddException(<span style="color:#66d9ef">object</span> expected, <span style="color:#66d9ef">object</span> actual) : <span style="color:#66d9ef">base</span>(<span style="color:#e6db74">$&#34;Expected a NotifyCollectionChanged event with an action of Add and object {expected} but instead saw {actual}&#34;</span>) {}
</span></span><span style="display:flex;"><span>  }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">class</span> <span style="color:#a6e22e">NotifyCollectionChangedRemoveException</span> : XunitException
</span></span><span style="display:flex;"><span>  {
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">public</span> NotifyCollectionChangedRemoveException(<span style="color:#66d9ef">object</span> expectedItem, <span style="color:#66d9ef">int</span> expectedIndex, <span style="color:#66d9ef">object</span> actualItem, <span style="color:#66d9ef">int</span> actualIndex) : <span style="color:#66d9ef">base</span>(<span style="color:#e6db74">$&#34;Expected a NotifyCollectionChanged event with an action of Remove and object {expectedItem} at index {expectedIndex} but instead saw {actualItem} at index  {actualIndex}&#34;</span>) {}
</span></span><span style="display:flex;"><span>  }
</span></span><span style="display:flex;"><span>}</span></span></code></pre></div><p>We have four different exceptions, each with a very specific message conveying what the failure was due to - no event being triggered, an event with the wrong action being triggered, or an event with the wrong information being triggered.  We could also handle this with one exception class using multiple constructors (much like the <code>NotifyCollectionChangedEventArgs</code> does).</p>
<p>Then we need to write our assertions, which are more involved than our previous example as 1) the event uses a generic type, so our assertion also must be a generic, and 2) we need to handle an event - so we need to attach an event handler, and trigger code that should make that event occur.  Let&rsquo;s start with defining the signature of the <code>Add</code> method:</p>
<div class="wrap-code highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-csharp" data-lang="csharp"><span style="display:flex;"><span><span style="color:#66d9ef">public</span> <span style="color:#66d9ef">static</span> <span style="color:#66d9ef">class</span> <span style="color:#a6e22e">MyAssert</span> {
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">static</span> <span style="color:#66d9ef">void</span> NotifyCollectionChangedAdd&lt;T&gt;(INotifyCollectionChanged collection, T item, Action testCode) 
</span></span><span style="display:flex;"><span>  {
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">// Assertion tests here.</span>
</span></span><span style="display:flex;"><span>  }
</span></span><span style="display:flex;"><span>}</span></span></code></pre></div><p>We use the generic type <code>T</code> to allow our assertion to be used with any kind of collection - and the second parameter <code>item</code> is <em>also</em> this type.  That is the object we are trying to add to the <code>collection</code>.  Finally, the <code>Action</code> is the code the test will execute that would, in theory, add <code>item</code> to <code>collection</code>.  Let&rsquo;s flesh out the method body now:</p>
<div class="wrap-code highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-csharp" data-lang="csharp"><span style="display:flex;"><span><span style="color:#66d9ef">public</span> <span style="color:#66d9ef">static</span> <span style="color:#66d9ef">class</span> <span style="color:#a6e22e">MyAssert</span>
</span></span><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">static</span> <span style="color:#66d9ef">void</span> NotifyCollectionChangedAdd&lt;T&gt;(INotifyCollectionChanged collection, T newItem, Action testCode)
</span></span><span style="display:flex;"><span>  {
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">// A flag to indicate if the event triggered successfully</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">bool</span> notifySucceeded = <span style="color:#66d9ef">false</span>;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">// An event handler to attach to the INotifyCollectionChanged and be </span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">// notified when the Add event occurs.</span>
</span></span><span style="display:flex;"><span>    NotifyCollectionChangedEventHandler handler = (sender, args) =&gt;
</span></span><span style="display:flex;"><span>    {
</span></span><span style="display:flex;"><span>      <span style="color:#75715e">// Make sure the event is an Add event</span>
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">if</span> (args.Action != NotifyCollectionChangedAction.Add)
</span></span><span style="display:flex;"><span>      {
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">throw</span> <span style="color:#66d9ef">new</span> NotifyCollectionChangedWrongActionException(NotifyCollectionChangedAction.Add, args.Action);
</span></span><span style="display:flex;"><span>      }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>      <span style="color:#75715e">// Make sure we added just one item</span>
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">if</span> (args.NewItems?.Count != <span style="color:#ae81ff">1</span>)
</span></span><span style="display:flex;"><span>      {
</span></span><span style="display:flex;"><span>        <span style="color:#75715e">// We&#39;ll use the collection of added items as the second argument</span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">throw</span> <span style="color:#66d9ef">new</span> NotifyCollectionChangedAddException(newItem, args.NewItems);
</span></span><span style="display:flex;"><span>      }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>      <span style="color:#75715e">// Make sure the added item is what we expected</span>
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">if</span> (!args.NewItems[<span style="color:#ae81ff">0</span>].Equals(newItem))
</span></span><span style="display:flex;"><span>      {
</span></span><span style="display:flex;"><span>        <span style="color:#75715e">// Here we only have one item in the changed collection, so we&#39;ll report it directly</span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">throw</span> <span style="color:#66d9ef">new</span> NotifyCollectionChangedAddException(newItem, args.NewItems[<span style="color:#ae81ff">0</span>]);
</span></span><span style="display:flex;"><span>      } 
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>      <span style="color:#75715e">// If we reach this point, the NotifyCollectionChanged event was triggered successfully</span>
</span></span><span style="display:flex;"><span>      <span style="color:#75715e">// and contains the correct item! We&#39;ll set the flag to true so we know.</span>
</span></span><span style="display:flex;"><span>      notifySucceeded = <span style="color:#66d9ef">true</span>;
</span></span><span style="display:flex;"><span>    };
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">// Now we connect the event handler </span>
</span></span><span style="display:flex;"><span>    collection.CollectionChanged += handler;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">// And attempt to trigger the event by running the actionCode</span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">// We place this in a try/catch to be able to utilize the finally </span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">// clause, but don&#39;t actually catch any exceptions</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">try</span>
</span></span><span style="display:flex;"><span>    {
</span></span><span style="display:flex;"><span>      testCode();
</span></span><span style="display:flex;"><span>      <span style="color:#75715e">// After this code has been run, our handler should have </span>
</span></span><span style="display:flex;"><span>      <span style="color:#75715e">// triggered, and if all went well, the notifySucceed is true</span>
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">if</span> (!notifySucceeded)
</span></span><span style="display:flex;"><span>      {
</span></span><span style="display:flex;"><span>        <span style="color:#75715e">// If notifySucceed is false, the event was not triggered</span>
</span></span><span style="display:flex;"><span>        <span style="color:#75715e">// We throw an exception denoting that</span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">throw</span> <span style="color:#66d9ef">new</span> NotifyCollectionChangedNotTriggeredException(NotifyCollectionChangedAction.Add);
</span></span><span style="display:flex;"><span>      }
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">// We don&#39;t actually want to catch an exception - we want it to </span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">// bubble up and be reported as a failing test.  So we don&#39;t </span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">// have a catch () {} clause to this try/catch.</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">finally</span>
</span></span><span style="display:flex;"><span>    {
</span></span><span style="display:flex;"><span>      <span style="color:#75715e">// However, we *do* want to remove the event handler. We do </span>
</span></span><span style="display:flex;"><span>      <span style="color:#75715e">// this in a finally block so it will happen even if we do </span>
</span></span><span style="display:flex;"><span>      <span style="color:#75715e">// have an exception occur. </span>
</span></span><span style="display:flex;"><span>      collection.CollectionChanged -= handler;
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>  }
</span></span><span style="display:flex;"><span>}</span></span></code></pre></div><p>Now we can test this in our code.  For example, if we had a collection of <code>ShoppingList</code> objects named <code>shoppingLists</code> that implemented <code>INotifyCollectionChanged</code>, we could test adding a new shopping list, <code>shoppingList</code>, to it with:</p>
<div class="wrap-code highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-csharp" data-lang="csharp"><span style="display:flex;"><span><span style="color:#66d9ef">var</span> newList = <span style="color:#66d9ef">new</span> ShoppingList();
</span></span><span style="display:flex;"><span>MyAssert.NotifyCollectionChangedAdd(shoppingLists, newList, () =&gt; {
</span></span><span style="display:flex;"><span>  shoppingLists.Add(newList);
</span></span><span style="display:flex;"><span>});</span></span></code></pre></div><p>Note that we didn&rsquo;t need to explicitly state <code>T</code> in this case is <code>ShoppingList</code> - the compiler infers this from the arguments supplied to the method.</p>
<p>Our assertion method handles adding a <em>single</em> item. We can use method <em>overloading</em> providing another method of the same name with different arguments to handle when <em>multiple</em> items are added. For that case, the signature might look like:</p>
<div class="wrap-code highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-csharp" data-lang="csharp"><span style="display:flex;"><span><span style="color:#66d9ef">public</span> <span style="color:#66d9ef">static</span> <span style="color:#66d9ef">void</span> NotifyCollectionChangedAdd&lt;T&gt;(INotifyCollectionChanged collection, ICollection&lt;T&gt; items, Action testCode) 
</span></span><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>  <span style="color:#75715e">// Assertion tests here.</span>
</span></span><span style="display:flex;"><span>}</span></span></code></pre></div><p>We&rsquo;d also want to write assertion methods for handling removing items, and any other actions we might need to test.  I&rsquo;ll leave these as exercises for the reader.</p>

            <footer class="footline">

            </footer>
          </article>

    
    
          <article class="default">
            <header class="headline">
            </header>
<h1 id="summary">Summary</h1>

<p>In this chapter we discussed the Windows Message Loop and Queue, and how messages provided to this loop are transformed into C# events by the <code>Application</code> class.  We examined C#&rsquo;s approach to events, which is a more flexible form of message passing.  We learned how to write both C# event listeners and handlers, and how to invoke event handlers with <code>Invoke()</code>.  We also learned how to create and trigger our own custom events with custom event arguments.</p>
<p>In addition, we learned about the <code>INotifyPropertyChanged</code> interface, and how it can be used to notify listeners that one of an Object&rsquo;s properties have changed through a <code>NotifyPropertyChanged</code> event handler.  We also saw how to test our implementations of <code>INotifyPropertyChanged</code> using xUnit.  In our next chapter on <a href="https://ksu-cs-textbooks.github.io/cis400/2-desktop-development/04-data-binding/">Data Binding</a>
, we will see how this interface is used by Windows Presentation Foundation to update user interfaces automatically when bound data objects change.</p>
<p>We saw that Windows Presentation Foundation also uses Routed Events, which can bubble up the elements tree and be handled by any ancestor element.  This approach replaces many of the familiar UI events from Windows Forms.  We&rsquo;ll take a deeper look at this approach, including defining our own Routed Events and alternative behaviors like &ldquo;tunnelling&rdquo; down the elements tree in the upcoming <a href="https://ksu-cs-textbooks.github.io/cis400/2-desktop-development/05-dependency-objects/">Dependency Objects</a>
 chapter.</p>
<p>Finally, we discussed testing strategies for testing if our events work as expected.  We revisited the Xunit <code>Assert.Raises&lt;t&gt;()</code> and discussed how it works with generic event handlers.  We also saw how for non-generic event handlers, we may have to author our own assertions, and even created one for the <code>CollectionChanged</code> event.</p>

            <footer class="footline">

            </footer>
          </article>

          </section>

        </div>
      </main>
    
<div class="git-footer">
<p class="theme-version-footer">5.18.0</p>
<p>Last modified by: 
            <i class='fas fa-user'></i> Russell Feldhausen
            <i class='fas fa-calendar'></i> <a href="https://gitlab.cs.ksu.edu/cs-textbooks/cis400-textbook/-/commit/681e5c9c43e3ac6de614c2cc74487702fd43cab7">Aug 10, 2023</a>
</p>
</div>

    
    </div>
    <script src="https://ksu-cs-textbooks.github.io/cis400/js/clipboard.min.js?1707765073" defer></script>
    <script src="https://ksu-cs-textbooks.github.io/cis400/js/perfect-scrollbar.min.js?1707765073" defer></script>
    <script src="https://ksu-cs-textbooks.github.io/cis400/js/theme.js?1707765073" defer></script>
  </body>
</html>
