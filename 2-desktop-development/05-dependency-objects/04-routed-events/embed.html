




	
	
		

	
	
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		
		

	
	
		

	
	
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		
		

	
	
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		
		

	
	
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		
		

	
	
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		
		

	
	
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		
		

	
	
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		
		

	
	
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		
		
		

	
	
		

	
	
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		
		

	
	
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		
		

	
	
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		
		

	
	
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		
		

	
	
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		
		

	
	
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		
		
		

	
	
		

	
	
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		
		

	
	
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		
		

	
	
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		
		

	
	
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		
		

	
	
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		
		

	
	
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		
		
		

	
	
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		
		

	
	
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		
<!DOCTYPE html>
<html lang="en" dir="ltr">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="height=device-height, width=device-width, initial-scale=1.0, minimum-scale=1.0">
    <meta name="generator" content="Hugo 0.117.0">
    <meta name="generator" content="Relearn 5.18.0">
    <meta name="description" content="K-State CIS 400 Textbook">
    <meta name="author" content="Nathan Bean">
    <title>Routed Events :: K-State CIS 400 Textbook</title>
    <link href="https://ksu-cs-textbooks.github.io/cis400/2-desktop-development/05-dependency-objects/04-routed-events/index.html" rel="canonical" type="text/html" title="Routed Events :: K-State CIS 400 Textbook">
    <link href="https://ksu-cs-textbooks.github.io/cis400/2-desktop-development/05-dependency-objects/04-routed-events/index.xml" rel="alternate" type="application/rss+xml" title="Routed Events :: K-State CIS 400 Textbook">
    <link href="https://ksu-cs-textbooks.github.io/cis400/2-desktop-development/05-dependency-objects/04-routed-events/index.print.html" rel="alternate" type="text/html" title="Routed Events :: K-State CIS 400 Textbook">
    <link href="https://ksu-cs-textbooks.github.io/cis400/2-desktop-development/05-dependency-objects/04-routed-events/tele.html" rel="alternate" type="text/html" title="Routed Events :: K-State CIS 400 Textbook">
    <!-- https://github.com/filamentgroup/loadCSS/blob/master/README.md#how-to-use -->
    <link href="https://ksu-cs-textbooks.github.io/cis400/css/fontawesome-all.min.css?1694206428" rel="stylesheet" media="print" onload="this.media='all';this.onload=null;"><noscript><link href="https://ksu-cs-textbooks.github.io/cis400/css/fontawesome-all.min.css?1694206428" rel="stylesheet"></noscript>
    <link href="https://ksu-cs-textbooks.github.io/cis400/css/nucleus.css?1694206428" rel="stylesheet">
    <link href="https://ksu-cs-textbooks.github.io/cis400/css/auto-complete.css?1694206428" rel="stylesheet" media="print" onload="this.media='all';this.onload=null;"><noscript><link href="https://ksu-cs-textbooks.github.io/cis400/css/auto-complete.css?1694206428" rel="stylesheet"></noscript>
    <link href="https://ksu-cs-textbooks.github.io/cis400/css/perfect-scrollbar.min.css?1694206428" rel="stylesheet">
    <link href="https://ksu-cs-textbooks.github.io/cis400/css/fonts.css?1694206428" rel="stylesheet" media="print" onload="this.media='all';this.onload=null;"><noscript><link href="https://ksu-cs-textbooks.github.io/cis400/css/fonts.css?1694206428" rel="stylesheet"></noscript>
    <link href="https://ksu-cs-textbooks.github.io/cis400/css/theme.css?1694206428" rel="stylesheet">
    <link href="https://ksu-cs-textbooks.github.io/cis400/css/theme-auto.css?1694206428" rel="stylesheet" id="variant-style">
    <link href="https://ksu-cs-textbooks.github.io/cis400/css/variant.css?1694206428" rel="stylesheet">
    <link href="https://ksu-cs-textbooks.github.io/cis400/css/print.css?1694206428" rel="stylesheet" media="print">
    <link href="https://ksu-cs-textbooks.github.io/cis400/css/ie.css?1694206428" rel="stylesheet">
    <script src="https://ksu-cs-textbooks.github.io/cis400/js/url.js?1694206428"></script>
    <script src="https://ksu-cs-textbooks.github.io/cis400/js/variant.js?1694206428"></script>
    <script>
      // hack to let hugo tell us how to get to the root when using relativeURLs, it needs to be called *url= for it to do its magic:
      // https://github.com/gohugoio/hugo/blob/145b3fcce35fbac25c7033c91c1b7ae6d1179da8/transform/urlreplacers/absurlreplacer.go#L72
      window.index_js_url="https://ksu-cs-textbooks.github.io/cis400/index.search.js";
      var root_url="https://ksu-cs-textbooks.github.io/cis400/";
      var baseUri=root_url.replace(/\/$/, '');
      // translations
      window.T_Copy_to_clipboard = 'Copy to clipboard';
      window.T_Copied_to_clipboard = 'Copied to clipboard!';
      window.T_Copy_link_to_clipboard = 'Copy link to clipboard';
      window.T_Link_copied_to_clipboard = 'Copied link to clipboard!';
      window.T_No_results_found = 'No results found for \u0022{0}\u0022';
      window.T_N_results_found = '{1} results found for \u0022{0}\u0022';
      // some further base stuff
      var baseUriFull='https:\/\/ksu-cs-textbooks.github.io\/cis400/';
      window.variants && variants.init( [ 'auto', 'light-theme', 'dark-theme' ] );
    </script>
    
    <link href="https://ksu-cs-textbooks.github.io/cis400/css/custom.css?1694206428" rel="stylesheet">

  </head>
  <body class="mobile-support embed disableInlineCopyToClipboard" data-url="https://ksu-cs-textbooks.github.io/cis400/2-desktop-development/05-dependency-objects/04-routed-events/embed.html">
    <div id="body" class="default-animation">
      
      
      
      <main id="body-inner" class="highlightable default" tabindex="-1">
        <div class="flex-block-wrapper">
          <article class="default">
    
    
    
<p>Another aspect of WPF elements are <em>routed events</em>.  Just as <em>dependency properties</em> are similar to regular C# properties, but add additional functionality, <em>routed events</em> are similar to regular C# events, but provide additional functionality.  One of the most important of these is the ability of the routed event to &ldquo;bubble&rdquo; up the <a href="https://ksu-cs-textbooks.github.io/cis400/2-desktop-development/02-element-tree/">elements tree</a>
.  Essentially, the event will be passed up each successive WPF element until one chooses to &ldquo;handle&rdquo; it, or the top of the tree is reached (in which case the event is ignored).  This routed event functionality is managed by the <a href="https://docs.microsoft.com/en-us/dotnet/api/system.windows.uielement?view=netcore-3.1" target="_blank"><code>UIElement</code></a>
 base class, a third base class shared by all WPF elements.</p>
<p>Let&rsquo;s consider the two buttons we declared in our <code>&lt;NumberBox&gt;</code>.  When clicked, these each trigger a <code>Click</code> routed event.  We could attach a handler to each button, but it is also possible to instead attach it to any other element up the tree; for example, our <code>&lt;Grid&gt;</code>:</p>
<div class="wrap-code highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-xml" data-lang="xml"><span style="display:flex;"><span><span style="color:#f92672">&lt;UserControl</span> <span style="color:#a6e22e">x:Class=</span><span style="color:#e6db74">&#34;CustomDependencyObjectExample.NumberBox&#34;</span>
</span></span><span style="display:flex;"><span>             <span style="color:#a6e22e">xmlns=</span><span style="color:#e6db74">&#34;http://schemas.microsoft.com/winfx/2006/xaml/presentation&#34;</span>
</span></span><span style="display:flex;"><span>             <span style="color:#a6e22e">xmlns:x=</span><span style="color:#e6db74">&#34;http://schemas.microsoft.com/winfx/2006/xaml&#34;</span>
</span></span><span style="display:flex;"><span>             <span style="color:#a6e22e">xmlns:mc=</span><span style="color:#e6db74">&#34;http://schemas.openxmlformats.org/markup-compatibility/2006&#34;</span>
</span></span><span style="display:flex;"><span>             <span style="color:#a6e22e">xmlns:d=</span><span style="color:#e6db74">&#34;http://schemas.microsoft.com/expression/blend/2008&#34;</span>
</span></span><span style="display:flex;"><span>             <span style="color:#a6e22e">xmlns:local=</span><span style="color:#e6db74">&#34;clr-namespace:CustomDependencyObjectExample&#34;</span>
</span></span><span style="display:flex;"><span>             <span style="color:#a6e22e">mc:Ignorable=</span><span style="color:#e6db74">&#34;d&#34;</span>
</span></span><span style="display:flex;"><span>             <span style="color:#a6e22e">d:DesignHeight=</span><span style="color:#e6db74">&#34;50&#34;</span> <span style="color:#a6e22e">d:DesignWidth=</span><span style="color:#e6db74">&#34;200&#34;</span><span style="color:#f92672">&gt;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">&lt;Grid</span> <span style="color:#a6e22e">Button.Click=</span><span style="color:#e6db74">&#34;HandleButtonClick&#34;</span><span style="color:#f92672">&gt;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">&lt;Grid.ColumnDefinitions&gt;</span>
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">&lt;ColumnDefinition/&gt;</span>
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">&lt;ColumnDefinition</span> <span style="color:#a6e22e">Width=</span><span style="color:#e6db74">&#34;2*&#34;</span><span style="color:#f92672">/&gt;</span>
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">&lt;ColumnDefinition/&gt;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">&lt;/Grid.ColumnDefinitions&gt;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">&lt;Button</span> <span style="color:#a6e22e">Grid.Column=</span><span style="color:#e6db74">&#34;0&#34;</span> <span style="color:#a6e22e">Name=</span><span style="color:#e6db74">&#34;Increment&#34;</span><span style="color:#f92672">&gt;</span>+<span style="color:#f92672">&lt;/Button&gt;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">&lt;TextBox</span> <span style="color:#a6e22e">Grid.Column=</span><span style="color:#e6db74">&#34;1&#34;</span> <span style="color:#a6e22e">Text=</span><span style="color:#e6db74">&#34;{Binding Path=Value, RelativeSource={RelativeSource Mode=FindAncestor, AncestorType=local:NumberBox}}&#34;</span><span style="color:#f92672">/&gt;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">&lt;Button</span> <span style="color:#a6e22e">Grid.Column=</span><span style="color:#e6db74">&#34;2&#34;</span> <span style="color:#a6e22e">Name=</span><span style="color:#e6db74">&#34;Decrement&#34;</span><span style="color:#f92672">&gt;</span>-<span style="color:#f92672">&lt;/Button&gt;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">&lt;/Grid&gt;</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">&lt;/UserControl&gt;</span></span></span></code></pre></div><p>We&rsquo;d need to define <code>HandleButtonClick</code> in our codebehind:</p>
<div class="wrap-code highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-csharp" data-lang="csharp"><span style="display:flex;"><span><span style="color:#75715e">/// &lt;summary&gt;</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">/// Handles the click of the increment or decrement button</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">/// &lt;/summary&gt;</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">/// &lt;param name=&#34;sender&#34;&gt;The button clicked&lt;/param&gt;</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">/// &lt;param name=&#34;e&#34;&gt;The event arguments&lt;/param&gt;</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">void</span> HandleButtonClick(<span style="color:#66d9ef">object</span> sender, RoutedEventArgs e)
</span></span><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">if</span>(sender <span style="color:#66d9ef">is</span> Button button)
</span></span><span style="display:flex;"><span>    {
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">switch</span>(button.Name)
</span></span><span style="display:flex;"><span>        {
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">case</span> <span style="color:#e6db74">&#34;Increment&#34;</span>:
</span></span><span style="display:flex;"><span>                Value += Step;
</span></span><span style="display:flex;"><span>                <span style="color:#66d9ef">break</span>;
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">case</span> <span style="color:#e6db74">&#34;Decrement&#34;</span>:
</span></span><span style="display:flex;"><span>                Value -= Step;
</span></span><span style="display:flex;"><span>                <span style="color:#66d9ef">break</span>;
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>    e.Handled = <span style="color:#66d9ef">true</span>;
</span></span><span style="display:flex;"><span>}</span></span></code></pre></div><p>When either button is clicked, it creates a <code>Button.Click</code> event.  As the buttons don&rsquo;t handle it, the event bubbles to the next element in the elements tree - in this case, the <code>&lt;Grid&gt;</code>.  As the <code>&lt;Grid&gt;</code> <em>does</em> attach a <code>Button.Click</code> listener, the event is passed to <code>HandleButtonClick</code>.  In this method we use the button&rsquo;s <code>Name</code> property to decide the correct action to take.  Also, note that we set the <code>RoutedEventArgs.Handled</code> property to <code>true</code>.  This lets WPF know that we&rsquo;ve taken care of the event, and it does not need to bubble up any farther (if we didn&rsquo;t, we could process the event <em>again</em> further up the elements tree).</p>
<p>Much like dependency properties, we can declare our own routed events.  These also use a <code>Register()</code> method, but for events this is a static method of the <code>EventHandler</code> class:  <code>EventManger.Register(string eventName, RoutingStrategy routing, Type eventHandlerType, Type controlType)</code>.  The first argument is a string, which is the name of the event, the second is one of the values from the <code>RoutingStrategy</code> enum, the third is the type of event handler, and the fourth is the type of the control it is declared in.  This <code>Register()</code> method returns a <code>RoutedEvent</code> that is used as a key when registering event listeners, which we typically store in a <code>public static readonly RoutedEvent</code> field.</p>
<p>The <code>RoutingStrategy</code> options are</p>
<ul>
<li><code>RoutingStrategy.Bubble</code> - which travels up the elements tree through ancestor nodes</li>
<li><code>RoutingStrategy.Tunnel</code> - which travels down the elements tree through descendant nodes</li>
<li><code>RoutingStrategy.Direct</code> - which can only be handled by the source element</li>
</ul>
<p>Let&rsquo;s create an example routed event for our <code>NumberBox</code>.  Let&rsquo;s assume we define two more routed properties <code>MinValue</code> and <code>MaxValue</code>, and that any time we change the value of our <code>NumberBox</code> it must fall within this range, or be clamped to one of those values.  To make it easer for UI designers to provide user feedback, we&rsquo;ll create a <code>NumberBox.ValueClamped</code> event that will trigger in these circumstances.  We need to register our new routed event:</p>
<div class="wrap-code highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-csharp" data-lang="csharp"><span style="display:flex;"><span><span style="color:#75715e">/// &lt;summary&gt;</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">/// Identifies the NumberBox.ValueClamped event</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">/// &lt;/summary&gt;</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">public</span> <span style="color:#66d9ef">static</span> <span style="color:#66d9ef">readonly</span> RoutedEvent ValueClampedEvent = EventManager.RegisterRoutedEvent(nameof(ValueClamped), RoutingStrategy.Bubble, <span style="color:#66d9ef">typeof</span>(RoutedEventHandler), <span style="color:#66d9ef">typeof</span>(NumberBox));</span></span></code></pre></div><p>Also like dependency properties also need to declare a corresponding C# property, routed events need to declare a corresponding C# event:</p>
<div class="wrap-code highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-csharp" data-lang="csharp"><span style="display:flex;"><span><span style="color:#75715e">/// &lt;summary&gt;</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">/// Event that is triggered when the value of this NumberBox changes</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">/// &lt;/summary&gt;</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">public</span> <span style="color:#66d9ef">event</span> RoutedEventHandler ValueClamped
</span></span><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">add</span> { AddHandler(ValueClampedEvent, <span style="color:#66d9ef">value</span>); }
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">remove</span> { RemoveHandler(ValueClampedEvent, <span style="color:#66d9ef">value</span>); }
</span></span><span style="display:flex;"><span>}</span></span></code></pre></div><p>Finally, we would want to raise this event whenever the value is clamped.  This can be done with the <code>RaiseEvent(RoutedEventArgs)</code> method defined on the <code>UIElement</code> base class that we inherit in our custom controls.  But where should we place this call?</p>
<p>You might think we would do this in the <code>HandleButtonClick()</code> method, and we could, but that misses when a user types a number <em>directly into the textbox</em>, as well as when <code>Value</code> is updated through a two-way binding.  Instead, we&rsquo;ll utilize the callback functionality available in the <code>FrameworkPropertyMetadata</code> for the <code>Value</code> property.  Since the dependency property and its metadata are both <code>static</code>, our callback also needs to be declared <code>static</code>:</p>
<div class="wrap-code highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-csharp" data-lang="csharp"><span style="display:flex;"><span><span style="color:#75715e">/// &lt;summary&gt;</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">/// Callback for the ValueProperty, which clamps the Value to the range</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">/// defined by MinValue and MaxValue</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">/// &lt;/summary&gt;</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">/// &lt;param name=&#34;sender&#34;&gt;The NumberBox whose value is changing&lt;/param&gt;</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">/// &lt;param name=&#34;e&#34;&gt;The event args&lt;/param&gt;</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">static</span> <span style="color:#66d9ef">void</span> HandleValueChanged(DependencyObject sender, DependencyPropertyChangedEventArgs e)
</span></span><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">if</span>(e.Property.Name == <span style="color:#e6db74">&#34;Value&#34;</span> &amp;&amp; sender <span style="color:#66d9ef">is</span> NumberBox box)
</span></span><span style="display:flex;"><span>    {
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">if</span>(box.Value &lt; box.MinValue)
</span></span><span style="display:flex;"><span>        {
</span></span><span style="display:flex;"><span>            box.Value = box.MinValue;
</span></span><span style="display:flex;"><span>            box.RaiseEvent(<span style="color:#66d9ef">new</span> RoutedEventArgs(ValueClampedEvent));
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">if</span>(box.Value &gt; box.MaxValue)
</span></span><span style="display:flex;"><span>        {
</span></span><span style="display:flex;"><span>            box.Value = box.MaxValue;
</span></span><span style="display:flex;"><span>            box.RaiseEvent(<span style="color:#66d9ef">new</span> RoutedEventArgs(ValueClampedEvent));
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>}</span></span></code></pre></div><p>Note that since this method is static, we must get the instance of the <code>NumberBox</code> by casting the <code>sender</code>.  We also double-check the property name, though this is not strictly necessary as the method is private and only we should be invoking it from within this class.</p>
<p>Now we need to refactor our <code>Value</code> dependency property registration to use this callback:</p>
<div class="wrap-code highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-csharp" data-lang="csharp"><span style="display:flex;"><span><span style="color:#75715e">/// &lt;summary&gt;</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">/// Identifies the NumberBox.Value XAML attached property</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">/// &lt;/summary&gt;</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">public</span> <span style="color:#66d9ef">static</span> <span style="color:#66d9ef">readonly</span> DependencyProperty ValueProperty = DependencyProperty.Register(<span style="color:#e6db74">&#34;Value&#34;</span>, <span style="color:#66d9ef">typeof</span>(<span style="color:#66d9ef">double</span>), <span style="color:#66d9ef">typeof</span>(NumberBox), <span style="color:#66d9ef">new</span> FrameworkPropertyMetadata(<span style="color:#ae81ff">0</span>, FrameworkPropertyMetadataOptions.AffectsRender | FrameworkPropertyMetadataOptions.BindsTwoWayByDefault, HandleValueChanged));</span></span></code></pre></div><p>By adding the callback to the dependency property, we ensure that <em>any time it changes</em>, regardless of the method the change occurs by, we will ensure the value is clamped to the specified range.</p>
<p>There are additional options for dependency property callbacks, including validation callbacks and the ability to coerce values.  See <a href="https://docs.microsoft.com/en-us/dotnet/desktop/wpf/advanced/dependency-property-callbacks-and-validation?view=netframeworkdesktop-4.8" target="_blank">the documentation</a>
 for details.</p>

            <footer class="footline">

            </footer>
          </article>
        </div>
      </main>
    </div>
    
    
    
    <script src="https://ksu-cs-textbooks.github.io/cis400/js/clipboard.min.js?1694206429" defer></script>
    <script src="https://ksu-cs-textbooks.github.io/cis400/js/perfect-scrollbar.min.js?1694206429" defer></script>
    <script src="https://ksu-cs-textbooks.github.io/cis400/js/theme.js?1694206429" defer></script>
  </body>
</html>
