<!doctype html><html lang=en-us dir=ltr itemscope itemtype=http://schema.org/Article><head><meta charset=utf-8><meta name=viewport content="height=device-height,width=device-width,initial-scale=1,minimum-scale=1"><meta name=generator content="Hugo 0.128.0"><meta name=generator content="Relearn 6.0.0"><meta name=description content="Before you start this exercise, you should:
Set up your Azure account (see the previous section). Sign into Visual Studio using the same account as you used for Azure Open your Movie Site project from your previous web data exercises. If you right-click on the project name in the Solution Explorer, you can choose publish from the context menu:
The first time you choose this option in a project, it will launch a publish wizard."><meta name=author content="Nathan Bean"><meta name=twitter:card content="summary"><meta name=twitter:title content="Deploying our Movie Site to Azure :: K-State CIS 400 Textbook"><meta name=twitter:description content="Before you start this exercise, you should:
Set up your Azure account (see the previous section). Sign into Visual Studio using the same account as you used for Azure Open your Movie Site project from your previous web data exercises. If you right-click on the project name in the Solution Explorer, you can choose publish from the context menu:
The first time you choose this option in a project, it will launch a publish wizard."><meta property="og:url" content="https://textbooks.cs.ksu.edu/cis400/c-exercises-s23/13-deployment/02-deploying/embed.html"><meta property="og:site_name" content="K-State CIS 400 Textbook"><meta property="og:title" content="Deploying our Movie Site to Azure :: K-State CIS 400 Textbook"><meta property="og:description" content="Before you start this exercise, you should:
Set up your Azure account (see the previous section). Sign into Visual Studio using the same account as you used for Azure Open your Movie Site project from your previous web data exercises. If you right-click on the project name in the Solution Explorer, you can choose publish from the context menu:
The first time you choose this option in a project, it will launch a publish wizard."><meta property="og:locale" content="en-us"><meta property="og:type" content="article"><meta property="article:section" content="Exercises"><meta property="article:published_time" content="2018-08-24T10:53:26-05:00"><meta property="article:modified_time" content="2024-06-27T14:36:54-05:00"><meta itemprop=name content="Deploying our Movie Site to Azure :: K-State CIS 400 Textbook"><meta itemprop=description content="Before you start this exercise, you should:
Set up your Azure account (see the previous section). Sign into Visual Studio using the same account as you used for Azure Open your Movie Site project from your previous web data exercises. If you right-click on the project name in the Solution Explorer, you can choose publish from the context menu:
The first time you choose this option in a project, it will launch a publish wizard."><meta itemprop=datePublished content="2018-08-24T10:53:26-05:00"><meta itemprop=dateModified content="2024-06-27T14:36:54-05:00"><meta itemprop=wordCount content="1153"><title>Deploying our Movie Site to Azure :: K-State CIS 400 Textbook</title>
<link href=https://textbooks.cs.ksu.edu/cis400/c-exercises-s23/13-deployment/02-deploying/ rel=canonical type=text/html title="Deploying our Movie Site to Azure :: K-State CIS 400 Textbook"><link href=/cis400/c-exercises-s23/13-deployment/02-deploying/index.xml rel=alternate type=application/rss+xml title="Deploying our Movie Site to Azure :: K-State CIS 400 Textbook"><link href=/cis400/c-exercises-s23/13-deployment/02-deploying/index.print.html rel=alternate type=text/html title="Deploying our Movie Site to Azure :: K-State CIS 400 Textbook"><link href=/cis400/c-exercises-s23/13-deployment/02-deploying/tele.html rel=alternate type=text/html title="Deploying our Movie Site to Azure :: K-State CIS 400 Textbook"><link href=/cis400/css/fontawesome-all.min.css?1724347200 rel=stylesheet media=print onload='this.media="all",this.onload=null'><noscript><link href=/cis400/css/fontawesome-all.min.css?1724347200 rel=stylesheet></noscript><link href=/cis400/css/nucleus.css?1724347200 rel=stylesheet><link href=/cis400/css/auto-complete.css?1724347200 rel=stylesheet media=print onload='this.media="all",this.onload=null'><noscript><link href=/cis400/css/auto-complete.css?1724347200 rel=stylesheet></noscript><link href=/cis400/css/perfect-scrollbar.min.css?1724347200 rel=stylesheet><link href=/cis400/css/fonts.css?1724347200 rel=stylesheet media=print onload='this.media="all",this.onload=null'><noscript><link href=/cis400/css/fonts.css?1724347200 rel=stylesheet></noscript><link href=/cis400/css/theme.css?1724347200 rel=stylesheet><link href=/cis400/css/theme-light-theme.css?1724347200 rel=stylesheet id=R-variant-style><link href=/cis400/css/chroma-relearn-light.css?1724347200 rel=stylesheet id=R-variant-chroma-style><link href=/cis400/css/variant.css?1724347200 rel=stylesheet><link href=/cis400/css/print.css?1724347200 rel=stylesheet media=print><script>window.relearn=window.relearn||{},window.relearn.relBasePath="../../..",window.relearn.relBaseUri="../../../..",window.relearn.absBaseUri="https://textbooks.cs.ksu.edu/cis400",window.index_js_url="/cis400/index.search.js",window.variants&&variants.init(["light-theme"]),window.T_Copy_to_clipboard=`Copy to clipboard`,window.T_Copied_to_clipboard=`Copied to clipboard!`,window.T_Copy_link_to_clipboard=`Copy link to clipboard`,window.T_Link_copied_to_clipboard=`Copied link to clipboard!`,window.T_Reset_view=`Reset view`,window.T_View_reset=`View reset!`,window.T_No_results_found=`No results found for "{0}"`,window.T_N_results_found=`{1} results found for "{0}"`</script><link href=/cis400/css/custom.css?1724347200 rel=stylesheet></head><body class="mobile-support embed disableInlineCopyToClipboard" data-url=/cis400/c-exercises-s23/13-deployment/02-deploying/embed.html><div id=R-body class=default-animation><div id=R-body-overlay></div><div id=R-main-overlay></div><main id=R-body-inner class="highlightable default" tabindex=-1><div class=flex-block-wrapper><article class=default><p>Before you start this exercise, you should:</p><ol><li>Set up your Azure account (see the <a href=https://textbooks.cs.ksu.edu/cis400/c-exercises-s23/13-deployment/01-azure/ rel=external target=_blank>previous section</a>).</li><li><a href="https://docs.microsoft.com/en-us/visualstudio/ide/signing-in-to-visual-studio?view=vs-2019" rel=external target=_blank>Sign into Visual Studio</a> using the same account as you used for Azure</li></ol><iframe width=560 height=315 src=https://www.youtube.com/embed/rFgET9SLZTk frameborder=0 allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" allowfullscreen></iframe><p>Open your Movie Site project from your previous web data exercises. If you right-click on the project name in the Solution Explorer, you can choose <code>publish</code> from the context menu:</p><p><a href=#R-image-bc5128afd02e0871a40a07504435d48a class=lightbox-link><img alt="The Publish option in the Solution Explorer" class="border lazy lightbox noshadow figure-image" loading=lazy src=/cis400/images/c.13.2.1.png style=height:auto;width:auto></a>
<a href=javascript:history.back(); class=lightbox-back id=R-image-bc5128afd02e0871a40a07504435d48a><img alt="The Publish option in the Solution Explorer" class="border lazy lightbox noshadow lightbox-image" loading=lazy src=/cis400/images/c.13.2.1.png></a></p><p>The first time you choose this option in a project, it will launch a publish wizard. The first step is to choose your deployment target:</p><p><a href=#R-image-c96bf13292574bee74ac5979ee533801 class=lightbox-link><img alt="Deployment Targets in the Publish Wizard" class="border lazy lightbox noshadow figure-image" loading=lazy src=/cis400/images/c.13.2.2.png style=height:auto;width:auto></a>
<a href=javascript:history.back(); class=lightbox-back id=R-image-c96bf13292574bee74ac5979ee533801><img alt="Deployment Targets in the Publish Wizard" class="border lazy lightbox noshadow lightbox-image" loading=lazy src=/cis400/images/c.13.2.2.png></a></p><p>For this exercise, we&rsquo;ll choose &ldquo;Azure&rdquo;, but feel free to explore the other options. Once you&rsquo;ve chosen Azure and clicked the <code>Next</code> button, you&rsquo;ll see the second step of the wizard, which seeks more detail on your deployment target:</p><p><a href=#R-image-d22c44c0ec50b48303900c366048dca5 class=lightbox-link><img alt="Azure Deployment Targets in the Publish Wizard" class="border lazy lightbox noshadow figure-image" loading=lazy src=/cis400/images/c.13.2.3.png style=height:auto;width:auto></a>
<a href=javascript:history.back(); class=lightbox-back id=R-image-d22c44c0ec50b48303900c366048dca5><img alt="Azure Deployment Targets in the Publish Wizard" class="border lazy lightbox noshadow lightbox-image" loading=lazy src=/cis400/images/c.13.2.3.png></a></p><p>The options here include deploying to a Windows or Linux infrastructure, or as a Docker image, or as an Azure VM (in which case you would need to set up the OS and environment). Let&rsquo;s choose the &ldquo;Linux&rdquo; option and click <code>Next</code> to reach the next step in the wizard.</p><p><a href=#R-image-1b4890e9c3cd6d4c343aa87a0c8be3db class=lightbox-link><img alt="Azure App Service in the Publish Wizard" class="border lazy lightbox noshadow figure-image" loading=lazy src=/cis400/images/c.13.2.4.png style=height:auto;width:auto></a>
<a href=javascript:history.back(); class=lightbox-back id=R-image-1b4890e9c3cd6d4c343aa87a0c8be3db><img alt="Azure App Service in the Publish Wizard" class="border lazy lightbox noshadow lightbox-image" loading=lazy src=/cis400/images/c.13.2.4.png></a></p><p>This step lists the subscription(s) available to your account, as well as any Resource Groups and App Services you have created. Most likely the latter two are empty, and your Subscription will be &ldquo;Azure for Students&rdquo; (this is the $100 of credit you receive as a K-State student). If you have used Azure previously, you may have additional options. For this project, choose the &ldquo;Create a new Azure App Service&mldr;&rdquo;</p><p>This launches another dialog, for creating a new App Service:</p><p><a href=#R-image-bf387bd7c22c7bb30107b1ece1090e81 class=lightbox-link><img alt="App Service creation dialog" class="border lazy lightbox noshadow figure-image" loading=lazy src=/cis400/images/c.13.2.5.png style=height:auto;width:auto></a>
<a href=javascript:history.back(); class=lightbox-back id=R-image-bf387bd7c22c7bb30107b1ece1090e81><img alt="App Service creation dialog" class="border lazy lightbox noshadow lightbox-image" loading=lazy src=/cis400/images/c.13.2.5.png></a></p><p>You may change the name to any available name (by default it will be your project name followed by a timestamp). When you&rsquo;re happy with your name, click the <code>Create</code> button. It will take a few minutes to create your App Service, so please be patient. Once it finishes, you&rsquo;ll be back in the Wizard with your new app service selected:</p><p><a href=#R-image-dfe714218925e714ddebbd66d4da2ff7 class=lightbox-link><img alt="Finishing the Publish Wizard" class="border lazy lightbox noshadow figure-image" loading=lazy src=/cis400/images/c.13.2.6.png style=height:auto;width:auto></a>
<a href=javascript:history.back(); class=lightbox-back id=R-image-dfe714218925e714ddebbd66d4da2ff7><img alt="Finishing the Publish Wizard" class="border lazy lightbox noshadow lightbox-image" loading=lazy src=/cis400/images/c.13.2.6.png></a></p><p>Go ahead and click the <code>Finish</code> button. This will close the wizard and return you to Visual Studio, where the Publish configuration screen is now visible:</p><p><a href=#R-image-a1c95035279677495b2b4e841f425575 class=lightbox-link><img alt="The Publish Configuration" class="border lazy lightbox noshadow figure-image" loading=lazy src=/cis400/images/c.13.2.7.png style=height:auto;width:auto></a>
<a href=javascript:history.back(); class=lightbox-back id=R-image-a1c95035279677495b2b4e841f425575><img alt="The Publish Configuration" class="border lazy lightbox noshadow lightbox-image" loading=lazy src=/cis400/images/c.13.2.7.png></a></p><p>Two elements are important here - the <em>Site URL</em> is the URL where you will be able to visit your published web application (after you publish it), and the <code>Publish</code> button launches the publishing process. Go ahead and click the <code>Publish</code> button. It will take a few minutes, but you&rsquo;ll see the project is built and deployed to the Azure service. When the process completes, it will open your site in the default web browser (or you can navigate there using the supplied URL).</p><p>Your published website will now look something like this:</p><p><a href=#R-image-8ddaf8f0074164b9daf7fddde9492196 class=lightbox-link><img alt="The published website" class="border lazy lightbox noshadow figure-image" loading=lazy src=/cis400/images/c.13.2.8.png style=height:auto;width:auto></a>
<a href=javascript:history.back(); class=lightbox-back id=R-image-8ddaf8f0074164b9daf7fddde9492196><img alt="The published website" class="border lazy lightbox noshadow lightbox-image" loading=lazy src=/cis400/images/c.13.2.8.png></a></p><p>While the website is now loaded and functional, it does not look like our debug build - it seems to be missing all of our styles! If we inspect the CSS in the browser development tools, we&rsquo;ll see that it is loading <em>site.min.css</em>, and this file contains the minified boilerplate CSS from the original site template, but none of the changes we made! If we examine our <em>Layout.csthml</em> template file, we can find the lines where the <code>&lt;link></code> element for the CSS is defined:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-html data-lang=html><span class=line><span class=cl><span class=p>&lt;</span><span class=nt>environment</span> <span class=na>include</span><span class=o>=</span><span class=s>&#34;Development&#34;</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>    <span class=p>&lt;</span><span class=nt>link</span> <span class=na>rel</span><span class=o>=</span><span class=s>&#34;stylesheet&#34;</span> <span class=na>href</span><span class=o>=</span><span class=s>&#34;~/css/site.css&#34;</span> <span class=na>asp-append-version</span><span class=o>=</span><span class=s>&#34;true&#34;</span> <span class=p>/&gt;</span>
</span></span><span class=line><span class=cl><span class=p>&lt;/</span><span class=nt>environment</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl><span class=p>&lt;</span><span class=nt>environment</span> <span class=na>exclude</span><span class=o>=</span><span class=s>&#34;Development&#34;</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>    <span class=p>&lt;</span><span class=nt>link</span> <span class=na>rel</span><span class=o>=</span><span class=s>&#34;stylesheet&#34;</span> <span class=na>href</span><span class=o>=</span><span class=s>&#34;~/css/site.min.css&#34;</span> <span class=na>asp-append-version</span><span class=o>=</span><span class=s>&#34;true&#34;</span> <span class=p>/&gt;</span>
</span></span><span class=line><span class=cl><span class=p>&lt;/</span><span class=nt>environment</span><span class=p>&gt;</span></span></span></code></pre></div><p>Notice the use of the ASP.NET-specific <code>&lt;environment></code> element? This conditionally includes its children based on the environment the web server is running in. Debug mode corresponds to our &ldquo;Development&rdquo; environment, so in debug we are including <em>site.css</em>. However, when we run it in &ldquo;Production&rdquo; mode, i.e. in our Azure service, we&rsquo;re instead using <em>site.min.css</em>. This is intended to be a minified and bundled version of <em>site.css</em>. Minification is a transpiling process where we strip out unnecessary content, i.e. whitespace and comments. Bundling refers to gathering multiple files - i.e. multiple CSS files, and combining them into a single file (this is helpful if we like to keep our CSS rules separated according to what pages they correspond to).</p><p>The issue is that the <em>site.min.css</em> file is not currently being updated when we build our project - instead we&rsquo;re still using the example file that came with the project template. We&rsquo;ll need to install and configure a NuGet package within the Movie project to enable this extra building step. You can read more about bundling and minification within ASP.NET Core <a href=https://docs.microsoft.com/aspnet/core/client-side/bundling-and-minification rel=external target=_blank>here</a>.</p><p>Start by selecting <code>Tools > NuGet Package Manager > Manage Nuget Packages for Solution...</code> from the <code>Tools</code> menu:</p><p><a href=#R-image-ece29736eb961d58c685779110ad1820 class=lightbox-link><img alt="Launching the NuGet Package Manager" class="border lazy lightbox noshadow figure-image" loading=lazy src=/cis400/images/c.13.2.9.png style=height:auto;width:auto></a>
<a href=javascript:history.back(); class=lightbox-back id=R-image-ece29736eb961d58c685779110ad1820><img alt="Launching the NuGet Package Manager" class="border lazy lightbox noshadow lightbox-image" loading=lazy src=/cis400/images/c.13.2.9.png></a></p><p>This loads the NuGet Package Manager, which allows us to install additional components into our project. By default it starts with the &ldquo;Installed&rdquo; tab, which shows which packages are currently installed. Not surprisingly, we have several Microsoft.NETCore packages - these contain the library code for .NETCore and for procesing Razor pages. We also have a third-party library, Newtonsoft.Json, which is used to parse the JSON database file. We&rsquo;ll want to install a new package, so select the &ldquo;Browse&rdquo; tab:</p><p><a href=#R-image-727a40948c6a1d1d550a68ac21528de1 class=lightbox-link><img alt="The NuGet Package Manager" class="border lazy lightbox noshadow figure-image" loading=lazy src=/cis400/images/c.13.2.10.png style=height:auto;width:auto></a>
<a href=javascript:history.back(); class=lightbox-back id=R-image-727a40948c6a1d1d550a68ac21528de1><img alt="The NuGet Package Manager" class="border lazy lightbox noshadow lightbox-image" loading=lazy src=/cis400/images/c.13.2.10.png></a></p><p>Then type into the search box &ldquo;BuildBundlerMinifier&rdquo;. The corresponding package should show up in the results below. This tool will add the bundling and minification step to the build process of Visual Studio. Clicking on the project will open a checklist allowing you to choose which projects you want to install the package into. Check the box next to the <em>Movies</em> project, and then click the <code>Install</code> button.</p><p><a href=#R-image-b30b24f0469fb12cbe37f148f55832d5 class=lightbox-link><img alt="Installing the BuildBundlerMinifier Package" class="border lazy lightbox noshadow figure-image" loading=lazy src=/images/c.13.2.11.png style=height:auto;width:auto></a>
<a href=javascript:history.back(); class=lightbox-back id=R-image-b30b24f0469fb12cbe37f148f55832d5><img alt="Installing the BuildBundlerMinifier Package" class="border lazy lightbox noshadow lightbox-image" loading=lazy src=/images/c.13.2.11.png></a></p><p>YOu will need to click <code>Ok</code> in the confirmation dialog, and then the package will be installed. Visual Studio will report that the <em>bundleconfig.json</em> files does not exist. This file configures the new package to create the minified bundle file - we&rsquo;ll need to add it. It should be created at the root of the Move project, and it consists of a simple JSON structure:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-json data-lang=json><span class=line><span class=cl><span class=p>[</span>
</span></span><span class=line><span class=cl>  <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;outputFileName&#34;</span><span class=p>:</span> <span class=s2>&#34;wwwroot/css/site.min.css&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;inputFiles&#34;</span><span class=p>:</span> <span class=p>[</span>
</span></span><span class=line><span class=cl>      <span class=s2>&#34;wwwroot/css/site.css&#34;</span>
</span></span><span class=line><span class=cl>    <span class=p>]</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>]</span></span></span></code></pre></div><p>The <code>"outputFileName"</code> is the name of the file we want to write to (in this case, _site.min.css), and the <code>"inputFiles"</code> is an array containing file names of all the files we want to bundle (in this case, <em>site.css</em>). If we had additional CSS files in our project, we could also list those here as well, and all of the listed files would be combined into the single output file.</p><p>We can bundle and minify Javascript files the same way, by adding a second JSON object defining the <code>"outputFileName"</code> for the minified and bundled Javascript file (which we conventionally give the extension <em>.min.js</em>), and an <code>"inputFiles"</code> array consisting of all the JavaScript files we want to bundle.</p><p>With this change, now whenever we build our project, we will also rebuild the minified <em>site.min.css</em> file. Click the <code>Publish</code> button in the Publish screen again, and when the project finishes loading, you&rsquo;ll now see the CSS rules being applied to your site:</p><p><a href=#R-image-846d26d0491d8217a210ebcfda10bcb3 class=lightbox-link><img alt="Final Deployed Site" class="border lazy lightbox noshadow figure-image" loading=lazy src=/cis400/images/c.13.2.12.png style=height:auto;width:auto></a>
<a href=javascript:history.back(); class=lightbox-back id=R-image-846d26d0491d8217a210ebcfda10bcb3><img alt="Final Deployed Site" class="border lazy lightbox noshadow lightbox-image" loading=lazy src=/cis400/images/c.13.2.12.png></a></p><p>That&rsquo;s all there is to it! You now have a published ASP.NET Core Web Application that can be accessed from any internet-connected browser!</p><p>Turn in the URL to your published site. After it is graded, feel free to take down your Azure service.</p><footer class=footline></footer></article></div></main></div><script src=/cis400/js/clipboard.min.js?1724347200 defer></script><script src=/cis400/js/perfect-scrollbar.min.js?1724347200 defer></script><script src=/cis400/js/theme.js?1724347200 defer></script><script src=/cis400/js/embed-iframe.js?1724347200 defer></script></body></html>