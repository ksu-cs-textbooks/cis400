<!doctype html><html lang=en-us dir=ltr itemscope itemtype=http://schema.org/Article><head><meta charset=utf-8><meta name=viewport content="height=device-height,width=device-width,initial-scale=1,minimum-scale=1"><meta name=generator content="Hugo 0.128.0"><meta name=generator content="Relearn 6.0.0"><meta name=description content="Doing the Work"><meta name=author content="Nathan Bean"><meta name=twitter:card content="summary"><meta name=twitter:title content="Exercises :: K-State CIS 400 Textbook"><meta name=twitter:description content="Doing the Work"><meta property="og:url" content="https://textbooks.cs.ksu.edu/cis400/c-exercises-s23/"><meta property="og:site_name" content="K-State CIS 400 Textbook"><meta property="og:title" content="Exercises :: K-State CIS 400 Textbook"><meta property="og:description" content="Doing the Work"><meta property="og:locale" content="en-us"><meta property="og:type" content="website"><meta itemprop=name content="Exercises :: K-State CIS 400 Textbook"><meta itemprop=description content="Doing the Work"><meta itemprop=datePublished content="2018-08-24T10:53:05-05:00"><meta itemprop=dateModified content="2023-11-06T10:09:57-06:00"><meta itemprop=wordCount content="3"><title>Exercises :: K-State CIS 400 Textbook</title>
<link href=https://textbooks.cs.ksu.edu/cis400/c-exercises-s23/ rel=canonical type=text/html title="Exercises :: K-State CIS 400 Textbook"><link href=/cis400/c-exercises-s23/index.xml rel=alternate type=application/rss+xml title="Exercises :: K-State CIS 400 Textbook"><link href=/cis400/c-exercises-s23/tele.html rel=alternate type=text/html title="Exercises :: K-State CIS 400 Textbook"><link href=/cis400/c-exercises-s23/embed.html rel=alternate type=text/html title="Exercises :: K-State CIS 400 Textbook"><link href=/cis400/css/fontawesome-all.min.css?1719517098 rel=stylesheet media=print onload='this.media="all",this.onload=null'><noscript><link href=/cis400/css/fontawesome-all.min.css?1719517098 rel=stylesheet></noscript><link href=/cis400/css/nucleus.css?1719517098 rel=stylesheet><link href=/cis400/css/auto-complete.css?1719517098 rel=stylesheet media=print onload='this.media="all",this.onload=null'><noscript><link href=/cis400/css/auto-complete.css?1719517098 rel=stylesheet></noscript><link href=/cis400/css/perfect-scrollbar.min.css?1719517098 rel=stylesheet><link href=/cis400/css/fonts.css?1719517098 rel=stylesheet media=print onload='this.media="all",this.onload=null'><noscript><link href=/cis400/css/fonts.css?1719517098 rel=stylesheet></noscript><link href=/cis400/css/theme.css?1719517098 rel=stylesheet><link href=/cis400/css/theme-auto.css?1719517098 rel=stylesheet id=R-variant-style><link href=/cis400/css/chroma-auto.css?1719517098 rel=stylesheet id=R-variant-chroma-style><link href=/cis400/css/variant.css?1719517098 rel=stylesheet><link href=/cis400/css/print.css?1719517098 rel=stylesheet media=print><link href=/cis400/css/format-print.css?1719517098 rel=stylesheet><script src=/cis400/js/variant.js?1719517098></script><script>window.relearn=window.relearn||{},window.relearn.relBasePath="..",window.relearn.relBaseUri="../..",window.relearn.absBaseUri="https://textbooks.cs.ksu.edu/cis400",window.index_js_url="/cis400/index.search.js",window.variants&&variants.init(["auto","light-theme","dark-theme"]),window.T_Copy_to_clipboard=`Copy to clipboard`,window.T_Copied_to_clipboard=`Copied to clipboard!`,window.T_Copy_link_to_clipboard=`Copy link to clipboard`,window.T_Link_copied_to_clipboard=`Copied link to clipboard!`,window.T_Reset_view=`Reset view`,window.T_View_reset=`View reset!`,window.T_No_results_found=`No results found for "{0}"`,window.T_N_results_found=`{1} results found for "{0}"`</script><link href=/cis400/css/custom.css?1719517098 rel=stylesheet></head><body class="mobile-support print disableInlineCopyToClipboard" data-url=/cis400/c-exercises-s23/><div id=R-body class=default-animation><div id=R-body-overlay></div><nav id=R-topbar><div class=topbar-wrapper><div class=topbar-sidebar-divider></div><div class="topbar-area topbar-area-start" data-area=start><div class="topbar-button topbar-button-sidebar" data-content-empty=disable data-width-s=show data-width-m=hide data-width-l=hide><button class=topbar-control onclick=toggleNav() type=button title="Menu (CTRL+ALT+n)"><i class="fa-fw fas fa-bars"></i></button></div></div><ol class="topbar-breadcrumbs breadcrumbs highlightable" itemscope itemtype=http://schema.org/BreadcrumbList><li itemscope itemtype=https://schema.org/ListItem itemprop=itemListElement><span itemprop=name>Exercises</span><meta itemprop=position content="1"></li></ol><div class="topbar-area topbar-area-end" data-area=end><div class="topbar-button topbar-button-prev" data-content-empty=disable data-width-s=show data-width-m=show data-width-l=show><a class=topbar-control href=/cis400/b-git-and-github/13-adding-documentation-files/ title="Adding Documentation Files (ðŸ¡)"><i class="fa-fw fas fa-chevron-left"></i></a></div><div class="topbar-button topbar-button-next" data-content-empty=disable data-width-s=show data-width-m=show data-width-l=show><a class=topbar-control href=/cis400/c-exercises-s23/01-encapsulation/ title="Encapsulation (ðŸ¡’)"><i class="fa-fw fas fa-chevron-right"></i></a></div></div></div></nav><div id=R-main-overlay></div><main id=R-body-inner class="highlightable chapter narrow" tabindex=-1><div class=flex-block-wrapper><article class=chapter><header class=headline></header><div class=article-subheading>Chapter C</div><h1 id=exercises>Exercises</h1><p>Doing the Work</p><footer class=footline></footer></article><section><h1 class=a11y-only>Subsections of Exercises</h1><article class=default><header class=headline></header><h1 id=encapsulation>Encapsulation</h1><h3 id=part-1>Part 1</h3><p>Follow the tutorial in the following video:</p><a href="https://www.youtube.com/watch?v=y2hEQz3d66w">YouTube Video</a><h3 id=part-2>Part 2</h3><p>Then add the remaining static methods to the <code>VectorMath</code> class (<code>Scale</code>, <code>DotProduct</code>, <code>CrossProduct</code>, <code>Magnitude</code>, <code>Normalize</code>) following the structure laid out in this UML class diagram:</p><p><a href=#R-image-cc097e86bdf8ed6f781999bbdaaeb696 class=lightbox-link><img alt="The Encapsulation Exercise Class Diagram" class="border lazy lightbox noshadow figure-image" loading=lazy src=/cis400/images/c.1.1.png style=height:auto;width:auto></a>
<a href=javascript:history.back(); class=lightbox-back id=R-image-cc097e86bdf8ed6f781999bbdaaeb696><img alt="The Encapsulation Exercise Class Diagram" class="border lazy lightbox noshadow lightbox-image" loading=lazy src=/cis400/images/c.1.1.png></a></p><p>The vector operations these methods should compute are:</p><span class="math align-center">$$\vec{a}+\vec{b}= \langle a_x + b_x, a_y + b_y, a_z + b_z \rangle \tag{Vector Addition}$$
$$\vec{a}-\vec{b}= \langle a_x - b_x, a_y - b_y, a_z - b_z \rangle \tag{Vector Subtraction}$$
$$\vec{a} \cdot s= \langle a_x \cdot s, a_y \cdot s, a_z \cdot s \rangle \tag{Vector Scaling}$$
$$\vec{a} \cdot \vec{b} = \langle a_x b_x + a_y b_y + a_z b_z \rangle \tag{Vector Dot Product}$$
$$\vec{a} \times \vec{b} = \langle
a_y b_z - a_z b_y,
a_z b_x - a_x b_z,
a_x b_y - a_y b_x \rangle \tag{Vector Cross Product}$$
$$||\vec{a}|| = \sqrt{a_x^2 + a_y^2 + a_z^2} \tag{Vector Magnitude}$$
$$\hat{u} = \frac{\vec{u}}{||\vec{u}||} \tag{Vector Normalization}$$</span><p>You can uncomment the tests in the <code>VectorMathUnitTests</code> class and then run them to verify your work.</p><h3 id=submit-a-release>Submit A Release</h3><p><a href=https://textbooks.cs.ksu.edu/cis400/b-git-and-github/12-release/ rel=external target=_blank>Create a release</a> of your project code on GitHub and submit its URL.</p><footer class=footline></footer></article><article class=default><header class=headline></header><h1 id=documentation-exercise>Documentation Exercise</h1><a href="https://www.youtube.com/watch?v=HIhGlC0lJoQ">YouTube Video</a><footer class=footline></footer></article><article class=default><header class=headline></header><h1 id=testing-exercise>Testing Exercise</h1><a href="https://www.youtube.com/watch?v=yMa2Lqmw9O8">YouTube Video</a><footer class=footline></footer></article><article class=default><header class=headline></header><h1 id=polymorphism-exercise>Polymorphism Exercise</h1><a href="https://www.youtube.com/watch?v=Gi6MLfz2n7M">YouTube Video</a><footer class=footline></footer></article><article class=default><header class=headline></header><h1 id=wpf-exercise>WPF Exercise</h1><a href="https://www.youtube.com/watch?v=blh16iEEQBE">YouTube Video</a><footer class=footline></footer></article><article class=default><header class=headline></header><h1 id=elements-tree-exercise>Elements Tree Exercise</h1><a href="https://www.youtube.com/watch?v=H9PUbS8kU-Q">YouTube Video</a><footer class=footline></footer></article><article class=default><header class=headline></header><h1 id=events-exercise>Events Exercise</h1><a href="https://www.youtube.com/watch?v=0Q3rvZW8gyE">YouTube Video</a><footer class=footline></footer></article><article class=default><header class=headline></header><h1 id=data-binding-exercise>Data Binding Exercise</h1><a href="https://www.youtube.com/watch?v=nwN1lbFaBvc">YouTube Video</a><footer class=footline></footer></article><article class=default><header class=headline></header><h1 id=dependency-property-exercise>Dependency Property Exercise</h1><a href="https://www.youtube.com/watch?v=rsAtGn9rrOU">YouTube Video</a><footer class=footline></footer></article><article class=default><header class=headline></header><h1 id=razor-pages-exercise>Razor Pages Exercise</h1><a href="https://www.youtube.com/watch?v=NXSgmSWz8tc">YouTube Video</a><p>Now that you know how to create Razor pages, let&rsquo;s see what makes them useful for creating dynamic web pages.</p><h2 id=initial-project>Initial Project</h2><p>We&rsquo;ll start with a simple ASP.NET web app using Razor Pages to display a database of movies. This app consists of a single page, <code>Index</code> that will be used to display the details of the movies in the database. It also contains classes representing an individual movie (<code>Movie</code>) and the movie database (<code>MovieDatabase</code>).</p><p>You can clone the starting project from the GitHub Classroom url provided in the Canvas Assignment (for students in the CIS 400 course), or directly from the GitHub <a href=https://github.com/ksu-cis/movie-site.git rel=external target=_blank>repo</a> (for other readers).</p><h3 id=movie-class>Movie Class</h3><p>Here is the starting point of a class representing a movie:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-csharp data-lang=csharp><span class=line><span class=cl>    <span class=cs>/// &lt;summary&gt;</span>
</span></span><span class=line><span class=cl>    <span class=cs>/// A class representing a Movie</span>
</span></span><span class=line><span class=cl>    <span class=cs>/// &lt;/summary&gt;</span>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=k>class</span> <span class=nc>Movie</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=cs>/// &lt;summary&gt;</span>
</span></span><span class=line><span class=cl>        <span class=cs>/// Gets and sets the title of the movie</span>
</span></span><span class=line><span class=cl>        <span class=cs>/// &lt;/summary&gt;</span>
</span></span><span class=line><span class=cl>        <span class=kd>public</span> <span class=kt>string</span> <span class=n>Title</span> <span class=p>{</span> <span class=k>get</span><span class=p>;</span> <span class=k>set</span><span class=p>;</span> <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=cs>/// &lt;summary&gt;</span>
</span></span><span class=line><span class=cl>        <span class=cs>/// Gets and sets the Motion Picture Association of America Rating</span>
</span></span><span class=line><span class=cl>        <span class=cs>/// &lt;/summary&gt;</span>
</span></span><span class=line><span class=cl>        <span class=kd>public</span> <span class=kt>string</span> <span class=n>MPAARating</span> <span class=p>{</span> <span class=k>get</span><span class=p>;</span> <span class=k>set</span><span class=p>;</span> <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=cs>/// &lt;summary&gt;</span>
</span></span><span class=line><span class=cl>        <span class=cs>/// Gets and sets the primary genre of the movie</span>
</span></span><span class=line><span class=cl>        <span class=cs>/// &lt;/summary&gt;</span>
</span></span><span class=line><span class=cl>        <span class=kd>public</span> <span class=kt>string</span> <span class=n>MajorGenre</span> <span class=p>{</span> <span class=k>get</span><span class=p>;</span> <span class=k>set</span><span class=p>;</span> <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=cs>/// &lt;summary&gt;</span>
</span></span><span class=line><span class=cl>        <span class=cs>/// Gets and sets the Internet Movie Database rating of the movie</span>
</span></span><span class=line><span class=cl>        <span class=cs>/// &lt;/summary&gt;</span>
</span></span><span class=line><span class=cl>        <span class=kd>public</span> <span class=kt>float?</span> <span class=n>IMDBRating</span> <span class=p>{</span> <span class=k>get</span><span class=p>;</span> <span class=k>set</span><span class=p>;</span> <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=cs>/// &lt;summary&gt;</span>
</span></span><span class=line><span class=cl>        <span class=cs>/// Gets and sets the Rotten Tomatoes rating of the movie</span>
</span></span><span class=line><span class=cl>        <span class=cs>/// &lt;/summary&gt;</span>
</span></span><span class=line><span class=cl>        <span class=kd>public</span> <span class=kt>float?</span> <span class=n>RottenTomatoesRating</span> <span class=p>{</span> <span class=k>get</span><span class=p>;</span> <span class=k>set</span><span class=p>;</span> <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span></span></span></code></pre></div><p>As you can see, it&rsquo;s a pretty simple data class.</p><p>However, we do have one new thing we haven&rsquo;t seen before - a new use of the question mark symbol (<code>?</code>) in <code>float?</code>. This indicates a <a href=https://docs.microsoft.com/en-us/dotnet/csharp/language-reference/builtin-types/nullable-value-types rel=external target=_blank>nullable type</a>, i.e. in addition to the possible float values, the variable can also be <code>null</code>.</p><p>Remember, a <code>float</code> is a value type, and normally you cannot set a value type to <code>null</code>. By making it a nullable type, we effectively have wrapped it in an object (technically, a <code>Nullable&lt;T></code> object). So instead of <code>RottenTomatoesRating</code> referencing the memory where the value of the float is stored, it is now storing a <em>reference</em> to that location in memory. This reference can itself be <code>null</code> if it isn&rsquo;t pointing anywhere.</p><p>We need all of these properties to have the possibility to be <code>null</code>, as the data we are working with does not have values for all of them. Let&rsquo;s look at that data next.</p><h3 id=serialized-movie-data>Serialized Movie Data</h3><p>The <em>movies.json</em> file contains data in a JSON format. JSON stands for <em>Javascript Serialization Object Notation</em>. As the name suggests, it is a <a href=https://en.wikipedia.org/wiki/Serialization rel=external target=_blank>serialization</a> format - a way of expressing the state of a data object in text. While it originates with JavaScript, JSON has become a popular format for exchanging data in many programming languages. Let&rsquo;s take a closer look at this file&rsquo;s structure.</p><p>The first movie in the file is <em>The Land Girls</em>:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-json data-lang=json><span class=line><span class=cl><span class=p>[</span>
</span></span><span class=line><span class=cl>  <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;Title&#34;</span><span class=p>:</span> <span class=s2>&#34;The Land Girls&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;USGross&#34;</span><span class=p>:</span> <span class=mi>146083</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;WorldWideGross&#34;</span><span class=p>:</span> <span class=mi>146083</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;USDVDSales&#34;</span><span class=p>:</span> <span class=kc>null</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;ProductionBudget&#34;</span><span class=p>:</span> <span class=mi>8000000</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;ReleaseDate&#34;</span><span class=p>:</span> <span class=s2>&#34;Jun 12 1998&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;MPAARating&#34;</span><span class=p>:</span> <span class=s2>&#34;R&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;RunningTime&#34;</span><span class=p>:</span> <span class=kc>null</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;Distributor&#34;</span><span class=p>:</span> <span class=s2>&#34;Gramercy&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;Source&#34;</span><span class=p>:</span> <span class=kc>null</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;MajorGenre&#34;</span><span class=p>:</span> <span class=kc>null</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;CreativeType&#34;</span><span class=p>:</span> <span class=kc>null</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;Director&#34;</span><span class=p>:</span> <span class=kc>null</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;RottenTomatoesRating&#34;</span><span class=p>:</span> <span class=kc>null</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;IMDBRating&#34;</span><span class=p>:</span> <span class=mf>6.1</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;IMDBVotes&#34;</span><span class=p>:</span> <span class=mi>1071</span>
</span></span><span class=line><span class=cl>  <span class=p>},</span>
</span></span><span class=line><span class=cl>  <span class=err>...</span>
</span></span><span class=line><span class=cl><span class=p>]</span></span></span></code></pre></div><p>The outer square brackets (<code>[</code>, <code>]</code>) indicate that the file contents represent an array. The curly braces (<code>{</code>, <code>}</code>) indicate an object - thus the file represents an array of objects. Each object consists of key/value pairs, i.e. <code>"Title": "The Land Girls"</code> indicates the title of the film. We&rsquo;re using a library to deserialize these JSON objects into our C# <code>Movie</code> object structure, so we need the keys to match the property names in that structure.</p><p>As you can see with this entry, many of the values are <code>null</code>. This is why we needed to introduce nullables into our data object - otherwise when we deserialized this object in our C# code, our program would crash when it tried to set one of the value properties to <code>null</code>.</p><h3 id=the-moviedatabase-class>The MovieDatabase Class</h3><p>Now let&rsquo;s look at the <code>MovieDatabase</code> class:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-csharp data-lang=csharp><span class=line><span class=cl>    <span class=cs>/// &lt;summary&gt;</span>
</span></span><span class=line><span class=cl>    <span class=cs>/// A class representing a database of movies</span>
</span></span><span class=line><span class=cl>    <span class=cs>/// &lt;/summary&gt;</span>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=kd>static</span> <span class=k>class</span> <span class=nc>MovieDatabase</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=kd>private</span> <span class=kd>static</span> <span class=n>List</span><span class=p>&lt;</span><span class=n>Movie</span><span class=p>&gt;</span> <span class=n>movies</span> <span class=p>=</span> <span class=k>new</span> <span class=n>List</span><span class=p>&lt;</span><span class=n>Movie</span><span class=p>&gt;();</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=cs>/// &lt;summary&gt;</span>
</span></span><span class=line><span class=cl>        <span class=cs>/// Loads the movie database from the JSON file</span>
</span></span><span class=line><span class=cl>        <span class=cs>/// &lt;/summary&gt;</span>
</span></span><span class=line><span class=cl>        <span class=kd>static</span> <span class=n>MovieDatabase</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>            
</span></span><span class=line><span class=cl>            <span class=k>using</span> <span class=p>(</span><span class=n>StreamReader</span> <span class=n>file</span> <span class=p>=</span> <span class=n>System</span><span class=p>.</span><span class=n>IO</span><span class=p>.</span><span class=n>File</span><span class=p>.</span><span class=n>OpenText</span><span class=p>(</span><span class=s>&#34;movies.json&#34;</span><span class=p>))</span>
</span></span><span class=line><span class=cl>            <span class=p>{</span>
</span></span><span class=line><span class=cl>                <span class=kt>string</span> <span class=n>json</span> <span class=p>=</span> <span class=n>file</span><span class=p>.</span><span class=n>ReadToEnd</span><span class=p>();</span>
</span></span><span class=line><span class=cl>                <span class=n>movies</span> <span class=p>=</span> <span class=n>JsonConvert</span><span class=p>.</span><span class=n>DeserializeObject</span><span class=p>&lt;</span><span class=n>List</span><span class=p>&lt;</span><span class=n>Movie</span><span class=p>&gt;&gt;(</span><span class=n>json</span><span class=p>);</span>
</span></span><span class=line><span class=cl>            <span class=p>}</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=cs>/// &lt;summary&gt;</span>
</span></span><span class=line><span class=cl>        <span class=cs>/// Gets all movies in the database</span>
</span></span><span class=line><span class=cl>        <span class=cs>/// &lt;/summary&gt;</span>
</span></span><span class=line><span class=cl>        <span class=kd>public</span> <span class=kd>static</span> <span class=n>IEnumerable</span><span class=p>&lt;</span><span class=n>Movie</span><span class=p>&gt;</span> <span class=n>All</span> <span class=p>{</span> <span class=k>get</span> <span class=p>{</span> <span class=k>return</span> <span class=n>movies</span><span class=p>;</span> <span class=p>}</span> <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span></span></span></code></pre></div><p>There are a couple of interesting features. First, the class is <code>static</code>, which means we cannot construct an instance of it - there will only ever be <em>one</em> instance, and we&rsquo;ll reference it directly from its class name, <code>MovieDatabase</code>. As a static class, all of its fields, methods, and properties must likewise be declared <code>static</code>. If these are public, then we can access them directly from the class name, i.e. to access the <code>All</code> property, we would invoke <code>MovieDatabase.All</code>.</p><p>Notice that we have declared a <a href=https://docs.microsoft.com/en-us/dotnet/csharp/programming-guide/classes-and-structs/static-constructors rel=external target=_blank>static constructor</a> for the class. This will be invoked the first time the class is used in the program, and only that one time (as after that, the one static instance of the class exists). Since we cannot construct a static class directly, there is no reason to add an access modifier (<code>public</code>, <code>protected</code>, or <code>private</code>).</p><p>The usual reason to have a static constructor is to do some kind of initialization, and that is what we are doing here. We are loading the JSON file, and using the <code>JsonConvert.DeserializeObject&lt;T>()</code> method to convert the JSON into a <code>List&lt;Movie></code>. This method is part of the <a href=https://www.newtonsoft.com/json rel=external target=_blank>JSON.net</a> library from Newtonsoft - which is provided to us through a Nuget package. If you look under the <em>Dependencies</em> entry in the solution explorer, you can find a <em>Packages</em> list that contains <em>Newtonsoft.JSON</em>, this library.</p><p><a href=https://www.nuget.org/ rel=external target=_blank>Nuget</a> is a package manager that allows developers to publish .NET libraries they have created for other developers to use. It is a source of many useful libraries, and if you become a professional .NET developer, it is probably a resource you will find yourself using often.</p><h2 id=displaying-a-list-of-movie-titles>Displaying a list of Movie Titles</h2><p>Okay, now that we&rsquo;re familiar with the starter code, let&rsquo;s turn our attention to the task at hand - we&rsquo;d like to display all the movies in our database on the <code>Index</code> razor page.</p><h3 id=refactoring-indexcshtml>Refactoring Index.cshtml</h3><p>Let&rsquo;s start by looking at our Page class, <code>Index.cshtml</code>:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-html data-lang=html><span class=line><span class=cl>@page
</span></span><span class=line><span class=cl>@model IndexModel
</span></span><span class=line><span class=cl>@{
</span></span><span class=line><span class=cl>    ViewData[&#34;Title&#34;] = &#34;Home page&#34;;
</span></span><span class=line><span class=cl>}
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=p>&lt;</span><span class=nt>h1</span><span class=p>&gt;</span>Hello World<span class=p>&lt;/</span><span class=nt>h1</span><span class=p>&gt;</span></span></span></code></pre></div><p>Let&rsquo;s change the header <code>Hello World</code> to say <code>Movies</code>. And below that, let&rsquo;s declare an unordered list of movie titles, and put the first few titles in list items:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-html data-lang=html><span class=line><span class=cl><span class=p>&lt;</span><span class=nt>h1</span><span class=p>&gt;</span>Movies<span class=p>&lt;/</span><span class=nt>h1</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl><span class=p>&lt;</span><span class=nt>ul</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>    <span class=p>&lt;</span><span class=nt>li</span><span class=p>&gt;</span>The Land Girls<span class=p>&lt;/</span><span class=nt>li</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>    <span class=p>&lt;</span><span class=nt>li</span><span class=p>&gt;</span>First Love, Last Rites<span class=p>&lt;/</span><span class=nt>li</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>    <span class=p>&lt;</span><span class=nt>li</span><span class=p>&gt;</span>I Married a Strange Person<span class=p>&lt;/</span><span class=nt>li</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl><span class=p>&lt;/</span><span class=nt>ul</span><span class=p>&gt;</span></span></span></code></pre></div><p>Go ahead and run your program. Your page should look like:</p><p><a href=#R-image-cf6f1bcd940cf4fe05b1562b42ab8f04 class=lightbox-link><img alt="The refactored index page" class="border lazy lightbox noshadow figure-image" loading=lazy src=/cis400/images/6.7.1.png style=height:auto;width:auto></a>
<a href=javascript:history.back(); class=lightbox-back id=R-image-cf6f1bcd940cf4fe05b1562b42ab8f04><img alt="The refactored index page" class="border lazy lightbox noshadow lightbox-image" loading=lazy src=/cis400/images/6.7.1.png></a></p><p>This approach would work fine, but there are 3,201 entries in our database - do you really want to do that by hand?</p><p>Instead, let&rsquo;s leverage the power of Razor templates, and use some C# code to iterate through each entry in the database. We can do this with a <code>foreach</code> loop, just like you might do in a regular C# class:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-csharp data-lang=csharp><span class=line><span class=cl><span class=p>&lt;</span><span class=n>h1</span><span class=p>&gt;</span><span class=n>Movies</span><span class=p>&lt;/</span><span class=n>h1</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl><span class=p>&lt;</span><span class=n>ul</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>    <span class=n>@foreach</span><span class=p>(</span><span class=n>Movie</span> <span class=n>movie</span> <span class=k>in</span> <span class=n>MovieDatabase</span><span class=p>.</span><span class=n>All</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=p>&lt;</span><span class=n>li</span><span class=p>&gt;</span><span class=n>@movie</span><span class=p>.</span><span class=n>Title</span><span class=p>&lt;/</span><span class=n>li</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>&lt;/</span><span class=n>ul</span><span class=p>&gt;</span></span></span></code></pre></div><p>Notice that inside the body of the <code>foreach</code> loop, we use regular HTML to declare a list item element (<code>&lt;li></code>). But for the <em>content</em> of that element, we are using the <code>movie.Title</code> property. As this is prefaced with an at symbol (<code>@</code>), the Razor template engine evaluates it as a C# expression, and concatenates the result (the movie&rsquo;s title) into the list item. Thus, for the first item in the database, <code>&lt;li>The Land Girls&lt;/li></code>.</p><p>Each of these is in turn concatenated into the page as the <code>foreach</code> loop is processed, resulting in a list of all the movie titles in the database. Run the program and see for yourself:</p><p><a href=#R-image-2f68637f1a1cd62a701dba84d1865e11 class=lightbox-link><img alt="The full list of movies" class="border lazy lightbox noshadow figure-image" loading=lazy src=/cis400/images/6.7.2.png style=height:auto;width:auto></a>
<a href=javascript:history.back(); class=lightbox-back id=R-image-2f68637f1a1cd62a701dba84d1865e11><img alt="The full list of movies" class="border lazy lightbox noshadow lightbox-image" loading=lazy src=/cis400/images/6.7.2.png></a></p><p>They&rsquo;re all there. You can scroll all the way to the bottom.</p><h3 id=adding-some-detail>Adding Some Detail</h3><p>It might be interesting to see more information about the movies than just the title. Let&rsquo;s take advantage of the details in our <code>Movie</code> class by expanding what is shown:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-csharp data-lang=csharp><span class=line><span class=cl><span class=p>&lt;</span><span class=n>h1</span><span class=p>&gt;</span><span class=n>Movies</span><span class=p>&lt;/</span><span class=n>h1</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl><span class=p>&lt;</span><span class=n>ul</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>    <span class=n>@foreach</span><span class=p>(</span><span class=n>Movie</span> <span class=n>movie</span> <span class=k>in</span> <span class=n>MovieDatabase</span><span class=p>.</span><span class=n>All</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=p>&lt;</span><span class=n>li</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>            <span class=p>&lt;</span><span class=n>h3</span><span class=p>&gt;</span><span class=n>@movie</span><span class=p>.</span><span class=n>Title</span><span class=p>&lt;/</span><span class=n>h3</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>            <span class=p>&lt;</span><span class=n>div</span><span class=p>&gt;</span><span class=n>@movie</span><span class=p>.</span><span class=n>MPAARating</span><span class=p>&lt;/</span><span class=n>div</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>            <span class=p>&lt;</span><span class=n>div</span><span class=p>&gt;</span><span class=n>@movie</span><span class=p>.</span><span class=n>MajorGenre</span><span class=p>&lt;/</span><span class=n>div</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>        <span class=p>&lt;/</span><span class=n>li</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>&lt;/</span><span class=n>ul</span><span class=p>&gt;</span></span></span></code></pre></div><p>Notice that unlike our WPF XAML, we can nest as many children in an HTML element as we want! If we run the program now:</p><p><a href=#R-image-8bf9383c874937bab22c6192986ed9a0 class=lightbox-link><img alt="The detailed movie list" class="border lazy lightbox noshadow figure-image" loading=lazy src=/cis400/images/6.7.3.png style=height:auto;width:auto></a>
<a href=javascript:history.back(); class=lightbox-back id=R-image-8bf9383c874937bab22c6192986ed9a0><img alt="The detailed movie list" class="border lazy lightbox noshadow lightbox-image" loading=lazy src=/cis400/images/6.7.3.png></a></p><p>Well, it works, but it&rsquo;s also underwhelming (and a bit difficult to interpret). Notice that our first few movies don&rsquo;t have all the rating properties, so there are large blank spaces.</p><p>Let&rsquo;s take advantage of Razor&rsquo;s ability to use conditionals to leave those blanks out:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-csharp data-lang=csharp><span class=line><span class=cl><span class=p>&lt;</span><span class=n>h1</span><span class=p>&gt;</span><span class=n>Movies</span><span class=p>&lt;/</span><span class=n>h1</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl><span class=p>&lt;</span><span class=n>ul</span> <span class=n>class</span><span class=p>=</span><span class=s>&#34;movie-list&#34;</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>    <span class=n>@foreach</span><span class=p>(</span><span class=n>Movie</span> <span class=n>movie</span> <span class=k>in</span> <span class=n>MovieDatabase</span><span class=p>.</span><span class=n>All</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=p>&lt;</span><span class=n>li</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>            <span class=p>&lt;</span><span class=n>h3</span> <span class=n>class</span><span class=p>=</span><span class=s>&#34;title&#34;</span><span class=p>&gt;</span><span class=n>@movie</span><span class=p>.</span><span class=n>Title</span><span class=p>&lt;/</span><span class=n>h3</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>            <span class=n>@if</span> <span class=p>(</span><span class=n>movie</span><span class=p>.</span><span class=n>MPAARating</span> <span class=p>!=</span> <span class=kc>null</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            <span class=p>{</span>
</span></span><span class=line><span class=cl>                <span class=p>&lt;</span><span class=n>div</span> <span class=n>class</span><span class=p>=</span><span class=s>&#34;mpaa&#34;</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>                    <span class=n>Rated</span> <span class=n>@movie</span><span class=p>.</span><span class=n>MPAARating</span>
</span></span><span class=line><span class=cl>                <span class=p>&lt;/</span><span class=n>div</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>            <span class=p>}</span>
</span></span><span class=line><span class=cl>            <span class=n>@if</span> <span class=p>(</span><span class=n>movie</span><span class=p>.</span><span class=n>MajorGenre</span> <span class=p>!=</span> <span class=kc>null</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            <span class=p>{</span>
</span></span><span class=line><span class=cl>                <span class=p>&lt;</span><span class=n>div</span> <span class=n>class</span><span class=p>=</span><span class=s>&#34;genre&#34;</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>                    <span class=n>@movie</span><span class=p>.</span><span class=n>MajorGenre</span>
</span></span><span class=line><span class=cl>                <span class=p>&lt;/</span><span class=n>div</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>            <span class=p>}</span>
</span></span><span class=line><span class=cl>        <span class=p>&lt;/</span><span class=n>li</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>&lt;/</span><span class=n>ul</span><span class=p>&gt;</span></span></span></code></pre></div><p>We&rsquo;ve also added the text &ldquo;Rated&rdquo; before our <code>MPAARating</code>, so the entry will now read &ldquo;Rated R&rdquo; for an R-rated movie, &ldquo;Rated G&rdquo; for a g-rated movie, and so on.</p><p>We also added class attributes to the <code>&lt;h3></code> and each <code>&lt;div></code>, as well as the movie list itself. We&rsquo;ll use these to style our elements.</p><h3 id=adding-some-style>Adding Some Style</h3><p>We can find our CSS rules for the project in <em>wwwroot/css/site.js</em>.</p><p>Let&rsquo;s start with the unordered list itself. We can select it with the <code>ul.movie-list</code> selector. We&rsquo;ll remove any padding and margins, and add a solid line above it:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-css data-lang=css><span class=line><span class=cl><span class=nt>ul</span><span class=p>.</span><span class=nc>movie-list</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>padding</span><span class=p>:</span> <span class=mi>0</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=k>margin</span><span class=p>:</span> <span class=mi>0</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=k>border-top</span><span class=p>:</span> <span class=mi>1</span><span class=kt>px</span> <span class=kc>solid</span> <span class=kc>gray</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span></span></span></code></pre></div><p>We&rsquo;ll then select each list item that is a child of that list with <code>ul.movie-list > li</code>. We&rsquo;ll remove the bullet, add a lighter border at the bottom to separate our items, and put a 10-pixel margin all the way around:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-css data-lang=css><span class=line><span class=cl><span class=nt>ul</span><span class=p>.</span><span class=nc>movie-list</span> <span class=o>&gt;</span> <span class=nt>li</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>list-style-type</span><span class=p>:</span> <span class=kc>none</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=k>border-bottom</span><span class=p>:</span> <span class=mi>1</span><span class=kt>px</span> <span class=kc>solid</span> <span class=kc>lightgray</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=k>margin</span><span class=p>:</span> <span class=mi>10</span><span class=kt>px</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span></span></span></code></pre></div><p>You might wonder why we put the list in an unordered list at all, if we&rsquo;re just going to change all its default styles. Remember, HTML provides the <em>structure</em> as well as the content. By putting the items in a list, we&rsquo;re signifying that the items <em>are a list</em>. We are conveying semantic meaning with the structure we use.</p><p>Remember, it&rsquo;s not just humans that read the internet. Many bots and algorithms do as well, and they typically won&rsquo;t use the lens of CSS styling - they&rsquo;ll be reading the raw HTML.</p><p>We&rsquo;ll make our title headers a dark slate gray, have a slightly larger-then-normal text, and remove the margins so that there are no large space between the header and the text is directly above and beneath them:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-css data-lang=css><span class=line><span class=cl><span class=p>.</span><span class=nc>title</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>color</span><span class=p>:</span> <span class=kc>darkslategray</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=k>font-size</span><span class=p>:</span> <span class=mf>1.2</span><span class=kt>rem</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=k>margin</span><span class=p>:</span> <span class=mi>0</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span></span></span></code></pre></div><p>Finally, let&rsquo;s lighten the color of the MPAA rating and genre:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-css data-lang=css><span class=line><span class=cl><span class=p>.</span><span class=nc>mpaa</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>color</span><span class=p>:</span> <span class=kc>slategray</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=p>.</span><span class=nc>genre</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>color</span><span class=p>:</span> <span class=kc>lightslategray</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span></span></span></code></pre></div><h3 id=adding-some-ratings>Adding Some Ratings</h3><p>While the MPAA ratings convey the age-appropriateness of a movie, the IMDB and Rotten Tomatoes ratings provide a sense of how much people <em>enjoy</em> the films. Since this probably information our readers might want to see to help them judge what films to look at, it might be nice to call attention to them in some way.</p><p>What if we put them into their own boxes, and position them on the right side of the screen, opposite the title? Something like:</p><p><a href=#R-image-d0f60f1a27f5409121ee032b4089448b class=lightbox-link><img alt="Mockup of styled list item" class="border lazy lightbox noshadow figure-image" loading=lazy src=/cis400/images/6.7.4.png style=height:auto;width:auto></a>
<a href=javascript:history.back(); class=lightbox-back id=R-image-d0f60f1a27f5409121ee032b4089448b><img alt="Mockup of styled list item" class="border lazy lightbox noshadow lightbox-image" loading=lazy src=/cis400/images/6.7.4.png></a></p><p>There are many ways of accomplishing this look, including the <code>float</code> property or using a <code>&lt;table></code> element. But let&rsquo;s turn to one of the newer and more powerful css layout features, the flexbox layout.</p><p>We&rsquo;ll start by refactoring our HTML slightly, to divide our <code>&lt;li></code> into two <code>&lt;div></code>s, one containing our current details for the movie, and one for the viewer ratings:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-html data-lang=html><span class=line><span class=cl>      <span class=p>&lt;</span><span class=nt>li</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>        <span class=p>&lt;</span><span class=nt>div</span> <span class=na>class</span><span class=o>=</span><span class=s>&#34;details&#34;</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>            <span class=p>&lt;</span><span class=nt>h3</span><span class=p>&gt;</span>@movie.Title<span class=p>&lt;/</span><span class=nt>h3</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>            @if (movie.MPAARating != null)
</span></span><span class=line><span class=cl>            {
</span></span><span class=line><span class=cl>                <span class=p>&lt;</span><span class=nt>div</span> <span class=na>class</span><span class=o>=</span><span class=s>&#34;mpaa&#34;</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>                    Rated @movie.MPAARating
</span></span><span class=line><span class=cl>                <span class=p>&lt;/</span><span class=nt>div</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>            }
</span></span><span class=line><span class=cl>            @if (movie.MajorGenre != null)
</span></span><span class=line><span class=cl>            {
</span></span><span class=line><span class=cl>                <span class=p>&lt;</span><span class=nt>div</span> <span class=na>class</span><span class=o>=</span><span class=s>&#34;genre&#34;</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>                    @movie.MajorGenre
</span></span><span class=line><span class=cl>                <span class=p>&lt;/</span><span class=nt>div</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>            }
</span></span><span class=line><span class=cl>        <span class=p>&lt;/</span><span class=nt>div</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>        <span class=p>&lt;</span><span class=nt>div</span> <span class=na>class</span><span class=o>=</span><span class=s>&#34;ratings&#34;</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>            @if (movie.IMDBRating != null)
</span></span><span class=line><span class=cl>            {
</span></span><span class=line><span class=cl>                <span class=p>&lt;</span><span class=nt>div</span> <span class=na>class</span><span class=o>=</span><span class=s>&#34;imdb&#34;</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>                    @movie.IMDBRating
</span></span><span class=line><span class=cl>                <span class=p>&lt;/</span><span class=nt>div</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>            }
</span></span><span class=line><span class=cl>            @if (movie.RottenTomatoesRating != null)
</span></span><span class=line><span class=cl>            {
</span></span><span class=line><span class=cl>                <span class=p>&lt;</span><span class=nt>div</span> <span class=na>class</span><span class=o>=</span><span class=s>&#34;rotten-tomatoes&#34;</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>                    @movie.RottenTomatoesRating
</span></span><span class=line><span class=cl>                <span class=p>&lt;/</span><span class=nt>div</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>            }
</span></span><span class=line><span class=cl>        <span class=p>&lt;/</span><span class=nt>div</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>    <span class=p>&lt;/</span><span class=nt>li</span><span class=p>&gt;</span></span></span></code></pre></div><p>Now we&rsquo;ll apply the flexbox properties and a minimum height to the list item:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-css data-lang=css><span class=line><span class=cl><span class=nt>ul</span><span class=p>.</span><span class=nc>movie-list</span> <span class=o>&gt;</span> <span class=nt>li</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>display</span><span class=p>:</span> <span class=kc>flex</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=k>flex-direction</span><span class=p>:</span> <span class=kc>row</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=k>align-items</span><span class=p>:</span> <span class=kc>flex-start</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=k>justify-content</span><span class=p>:</span> <span class=kc>space-between</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=k>min-height</span><span class=p>:</span> <span class=mi>50</span><span class=kt>px</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span></span></span></code></pre></div><p>These can be combined with our earlier rule block with the same selector, or they can be declared separately.</p><p>We&rsquo;ll also use flexbox to make our ratings appear side-by-side:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-css data-lang=css><span class=line><span class=cl><span class=p>.</span><span class=nc>ratings</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>display</span><span class=p>:</span> <span class=kc>flex</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=k>flex-direction</span><span class=p>:</span> <span class=kc>row</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span></span></span></code></pre></div><p>And use some styles to add the border, center the text, and use gray for the text and border colors:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-css data-lang=css><span class=line><span class=cl><span class=p>.</span><span class=nc>imdb</span><span class=o>,</span> <span class=p>.</span><span class=nc>rotten-tomatoes</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>color</span><span class=p>:</span> <span class=kc>gray</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=k>border</span><span class=p>:</span> <span class=mi>1</span><span class=kt>px</span> <span class=kc>solid</span> <span class=kc>gray</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=k>width</span><span class=p>:</span> <span class=mi>60</span><span class=kt>px</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=k>text-align</span><span class=p>:</span> <span class=kc>center</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=k>font-size</span><span class=p>:</span> <span class=mf>1.2</span><span class=kt>rem</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span></span></span></code></pre></div><p>Notice that we can use the comma to allow more than one selector to share a rule.</p><p>It might be nice to label the two ratings, as Rotten Tomatoes is on a 100-point scale, and IMDB uses a 10-point scale. We could go back and apply this in the HTML, but it is a good opportunity to show off the <code>::before</code> pseduo-selector, which allows us to create HTML elements using css:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-css data-lang=css><span class=line><span class=cl><span class=p>.</span><span class=nc>imdb</span><span class=p>::</span><span class=nd>before</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>content</span><span class=p>:</span> <span class=s2>&#34;IMDB&#34;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=k>display</span><span class=p>:</span> <span class=kc>block</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=k>font-size</span><span class=p>:</span> <span class=mi>1</span><span class=kt>rem</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=p>.</span><span class=nc>rotten-tomatoes</span><span class=p>::</span><span class=nd>before</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>content</span><span class=p>:</span> <span class=s2>&#34;Rotten&#34;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=k>display</span><span class=p>:</span> <span class=kc>block</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=k>font-size</span><span class=p>:</span> <span class=mi>1</span><span class=kt>rem</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span></span></span></code></pre></div><p>If you run your code at this point, you may notice your <code>&lt;h3></code> styles have stopped applying. If we look at the selector, we&rsquo;ll see why. It is currently: <code>ul.movie-list > li > h3</code>, which indicates the <code>&lt;h3></code> it applies to should be a direct child of the <code>&lt;li></code> tag. We could swap to using <code>h3</code> instead, but this would apply to <em>all</em> <code>&lt;h3></code> tags on our page. Instead, let&rsquo;s swap the <code>></code> for a space <code></code>, which indicates a descendant instead of a direct child. In fact, we could drop the <code>li</code> as well:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-css data-lang=css><span class=line><span class=cl><span class=nt>ul</span><span class=p>.</span><span class=nc>movie-list</span>  <span class=nt>h3</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>font-size</span><span class=p>:</span> <span class=mf>1.2</span><span class=kt>rem</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=k>margin-bottom</span><span class=p>:</span> <span class=mi>0</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=k>color</span><span class=p>:</span> <span class=kc>darkslategray</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span></span></span></code></pre></div><p>The end result is very close to our sketch:</p><p><a href=#R-image-d51fafba909cba8035aa3ccef4a52469 class=lightbox-link><img alt="The end result" class="border lazy lightbox noshadow figure-image" loading=lazy src=/cis400/images/6.7.5.png style=height:auto;width:auto></a>
<a href=javascript:history.back(); class=lightbox-back id=R-image-d51fafba909cba8035aa3ccef4a52469><img alt="The end result" class="border lazy lightbox noshadow lightbox-image" loading=lazy src=/cis400/images/6.7.5.png></a></p><p>Clearly, CSS is a powerful tool. It can be challenging to learn, but if you are going to be involved in web development, it is time well spent.</p><p>The <a href=https://developer.mozilla.org/en-US/docs/Web/CSS rel=external target=_blank>MDN CSS documentation</a> and the <a href=https://css-tricks.com/ rel=external target=_blank>CSS-Tricks site</a> are both excellent references for learning CSS.</p><footer class=footline></footer></article><article class=chapter><header class=headline></header><div class=article-subheading>Chapter 11</div><h1 id=responsive-design>Responsive Design</h1><p>Fitting the Screen</p><footer class=footline></footer></article><section><h1 class=a11y-only>Subsections of Responsive Design</h1><article class=default><header class=headline></header><h1 id=media--rule>Media @ Rule</h1><p>The <code>@media</code> rule was originally introduced in CSS version 2. It was used to differentiate between different kinds of devices, i.e. a computer screen, printer, etc. Only the print type saw broad adoption, but it remains useful. Let&rsquo;s see how we can use it.</p><p>If we look at our <em>Pages/Index.cshtml</em> page, we can find an <code>&lt;aside></code> element that contains a banner advertisement for Bernie&rsquo;s. The <code>&lt;aside></code> element is a <em>semantic element</em> - one that implies a specific meaning for what it contains. The meaning it implies is something &rsquo;extra&rsquo; to the page that isn&rsquo;t part of its main thrust - in this case, an advertisement.</p><p>Beyond implying a meaning, it&rsquo;s equivalent to a <code>&lt;div></code> element, it is simply a block-level element that divides up the page and can be used to attach CSS rules.</p><p>Let&rsquo;s assume that we <em>don&rsquo;t</em> want this to appear on the page when we print it. Let&rsquo;s add a <code>class</code> of <code>"advertisement"</code> to it:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-html data-lang=html><span class=line><span class=cl><span class=p>&lt;</span><span class=nt>aside</span> <span class=na>class</span><span class=o>=</span><span class=s>&#34;advertisement&#34;</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>    <span class=p>&lt;</span><span class=nt>img</span> <span class=na>src</span><span class=o>=</span><span class=s>&#34;~/img/ad.png&#34;</span> <span class=na>alt</span><span class=o>=</span><span class=s>&#34;Eat at Bernies!&#34;</span><span class=p>/&gt;</span>
</span></span><span class=line><span class=cl><span class=p>&lt;/</span><span class=nt>aside</span><span class=p>&gt;</span></span></span></code></pre></div><p>And in our <em>wwwroot/css/site.css</em>, let&rsquo;s create an <code>@media</code> rule for printing:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-css data-lang=css><span class=line><span class=cl><span class=p>@</span><span class=k>media</span> <span class=nt>print</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=p>.</span><span class=nc>advertisement</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=k>display</span><span class=p>:</span> <span class=kc>none</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span></span></span></code></pre></div><p>Any CSS enclosed in the curly braces following <code>@media print</code> will <em>only</em> be applied when the page is printed. In that case, we set any element with the class <code>advertisement</code> to not display. Try running the program, and in the browser, select <em>print preview</em>.</p><p><a href=#R-image-65b2218b0307bddabb8f45aaeefa15e1 class=lightbox-link><img alt="The printed webpage" class="border lazy lightbox noshadow figure-image" loading=lazy src=/cis400/images/3.3.2.1.png style=height:auto;width:auto></a>
<a href=javascript:history.back(); class=lightbox-back id=R-image-65b2218b0307bddabb8f45aaeefa15e1><img alt="The printed webpage" class="border lazy lightbox noshadow lightbox-image" loading=lazy src=/cis400/images/3.3.2.1.png></a></p><p>The advertisement does not appear! But it still shows up in the browser.</p><p>This simple technique can be used to easily create printer-friendly versions of your webpage by changing colors to gray tones, replacing fonts, and removing elements that will require a lot of ink to print.</p><p>But the media @ rule is also the basis for an even more powerful mechanism, <em>media queries</em>, which we&rsquo;ll look at next.</p><footer class=footline></footer></article><article class=default><header class=headline></header><h1 id=media-queries>Media Queries</h1><p>In CSS3, the <code>@media</code> rule was extended to include the concept of <em>media queries</em>, a technique that allows us to conditionally apply CSS rules using a broader range of values. Some of the most commonly used are:</p><ul><li>The width and the height of the viewport (the area on-screen)</li><li>The width and height of the device (the monitor, phone, or other screen)</li><li>The orientation (landscape or portrait)</li><li>The resolution</li></ul><p>Media queries are primarily used to enable <em>responsive design</em>, which refers to your page re-arranging itself for display on different devices.</p><p>A media query expands the <code>@media</code> rule that we used previously. It consists of the <code>@media</code> keyword followed by an optional media type (<code>all</code>, <code>print</code>, <code>screen</code>, or <code>speech</code>), and then any media features we want to query for within parenthesis.</p><p>Let&rsquo;s start with a simple example. Let&rsquo;s change the color of our <code>h1</code> elements based on the orientation of the screen. Add these two rules to your <em>wwwroot/css/site.css</em>:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-css data-lang=css><span class=line><span class=cl><span class=p>@</span><span class=k>media</span> <span class=o>(</span><span class=nt>orientation</span><span class=o>:</span> <span class=nt>landscape</span><span class=o>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nt>h1</span> <span class=p>{</span> <span class=k>color</span><span class=p>:</span> <span class=kc>green</span><span class=p>;</span> <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=p>@</span><span class=k>media</span> <span class=o>(</span><span class=nt>orientation</span><span class=o>:</span> <span class=nt>portrait</span><span class=o>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nt>h1</span> <span class=p>{</span> <span class=k>color</span><span class=p>:</span> <span class=kc>orange</span><span class=p>;</span> <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span></span></span></code></pre></div><p>Now if you run your server, the <code>&lt;h1></code> elements will probably be green. Resize your window until it is taller than it is wide, and they will turn orange.</p><h2 id=using-chrome-developer-tools>Using Chrome Developer Tools</h2><p>While we can definitely stretch our browser window to try different sizes, there are far better tools available. Let&rsquo;s see how Chrome&rsquo;s Developer Tools can make our lives as a developer easier.</p><p>First, set Visual Studio to use Chrome as the browser it launches your website with. From the build target dropdown, select the &lsquo;Web Browser&rsquo; option, and select &lsquo;Google Chrome&rsquo;:</p><p><a href=#R-image-112dc64c4729efa5984c6317aa390d00 class=lightbox-link><img alt="Setting Chrome as the build target" class="border lazy lightbox noshadow figure-image" loading=lazy src=/cis400/images/3.3.3.1.png style=height:auto;width:auto></a>
<a href=javascript:history.back(); class=lightbox-back id=R-image-112dc64c4729efa5984c6317aa390d00><img alt="Setting Chrome as the build target" class="border lazy lightbox noshadow lightbox-image" loading=lazy src=/cis400/images/3.3.3.1.png></a></p><p>Now run your program. When Chrome loads, turn on developer tools by either pressing <code>CTRL</code> + <code>SHIFT</code> + <code>I</code> or right-clicking on the page and selecting &lsquo;Inspect&rsquo;. This launches the developer tools in their own pane in the window. At the top of the developer pane is an icon that resembles a cellphone in front of a screen.</p><p><a href=#R-image-c4803c28ad739738ac93460a48ceeaef class=lightbox-link><img alt="The Device Toolbar toggle button" class="border lazy lightbox noshadow figure-image" loading=lazy src=/cis400/images/3.3.3.2.png style=height:auto;width:auto></a>
<a href=javascript:history.back(); class=lightbox-back id=R-image-c4803c28ad739738ac93460a48ceeaef><img alt="The Device Toolbar toggle button" class="border lazy lightbox noshadow lightbox-image" loading=lazy src=/cis400/images/3.3.3.2.png></a></p><p>Clicking it will toggle the device toolbar, which allows you to emulate different devices, choosing from several common phones and tables, or use the &lsquo;responsive&rsquo; category to set a custom size:</p><p><a href=#R-image-5ac047cae7f9e7aac4fd5bf8a412a574 class=lightbox-link><img alt="The device selection dropdown" class="border lazy lightbox noshadow figure-image" loading=lazy src=/cis400/images/3.3.3.3.png style=height:auto;width:auto></a>
<a href=javascript:history.back(); class=lightbox-back id=R-image-5ac047cae7f9e7aac4fd5bf8a412a574><img alt="The device selection dropdown" class="border lazy lightbox noshadow lightbox-image" loading=lazy src=/cis400/images/3.3.3.3.png></a></p><p>In addition, you can change the orientation of the device with the rotate button:</p><p><a href=#R-image-27288643868940092cd71e70a1ce58d0 class=lightbox-link><img alt="The device selection dropdown" class="border lazy lightbox noshadow figure-image" loading=lazy src=/cis400/images/3.3.3.4.png style=height:auto;width:auto></a>
<a href=javascript:history.back(); class=lightbox-back id=R-image-27288643868940092cd71e70a1ce58d0><img alt="The device selection dropdown" class="border lazy lightbox noshadow lightbox-image" loading=lazy src=/cis400/images/3.3.3.4.png></a></p><p>Try selecting a mobile phone and then using the rotate button to change the orientation. Watch how your <code>&lt;h1></code> elements change color!</p><p>Next we&rsquo;ll look at how we use media queries in responsive design.</p><div class="box notices cstyle note"><div class=box-label><i class="fa-fw fas fa-exclamation-circle"></i> Note</div><div class=box-content><p>Developer tools are actually a part of all modern web browsers, so if you prefer to use a different browser you can learn its tools instead. Here are links to the documentation for the major browsers:</p><ul><li><a href=https://developers.google.com/web/tools/chrome-devtools rel=external target=_blank>Chrome DevTools</a></li><li><a href=https://docs.microsoft.com/en-us/microsoft-edge/devtools-guide rel=external target=_blank>Edge Developer Tools</a></li><li><a href=https://developer.mozilla.org/en-US/docs/Tools rel=external target=_blank>Firefox Developer Tools</a></li><li><a href=https://developer.apple.com/safari/tools/ rel=external target=_blank>Safari Developer Tools</a><br>Â </li></ul></div></div><footer class=footline></footer></article><article class=default><header class=headline></header><h1 id=float-based-responsive-layout>Float-based Responsive Layout</h1><p>Now that we have seen the concept of responsive breakpoints, let&rsquo;s put them to use creating a layout for our web page. Currently we have three <code>&lt;div></code> elements, each with a header and placeholder text. We&rsquo;d like to arrange these into a row of three columns if the screen is large enough, and collapse them into a single column on smaller screens, such as a mobile phone.</p><p>We&rsquo;re going to explore several strategies for accomplishing this. First, we&rsquo;ll look at float-based layouts. This is an older strategy for creating columns, and it is based on the <code>float</code> css property which is traditionally used to float images and figures to the right or left of a body of text.</p><p>We can instead leverage it to create columns by setting each <code>&lt;div></code> we intend to behave as a column to have a <code>float: left;</code> property. This makes each column float to the left of the one after it. Let&rsquo;s give it a try.</p><p>First, in your <em>Pages/Index.cshtml</em>, we&rsquo;ll add a class to the outermost div, just under the <code>&lt;aside></code> we manipulated previously:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-html data-lang=html><span class=line><span class=cl><span class=p>&lt;</span><span class=nt>aside</span> <span class=na>class</span><span class=o>=</span><span class=s>&#34;advertisement&#34;</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>    <span class=p>&lt;</span><span class=nt>img</span> <span class=na>src</span><span class=o>=</span><span class=s>&#34;~/img/ad.png&#34;</span> <span class=na>alt</span><span class=o>=</span><span class=s>&#34;Eat at Bernies!&#34;</span><span class=p>/&gt;</span>
</span></span><span class=line><span class=cl><span class=p>&lt;/</span><span class=nt>aside</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl><span class=p>&lt;</span><span class=nt>div</span> <span class=na>class</span><span class=o>=</span><span class=s>&#34;float-columns&#34;</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>    <span class=p>&lt;</span><span class=nt>div</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>        <span class=p>&lt;</span><span class=nt>h1</span><span class=p>&gt;</span>Column One<span class=p>&lt;/</span><span class=nt>h1</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>        ...</span></span></code></pre></div><p>Then we&rsquo;ll add setting the <code>float</code> property in our <em>wwwroot/css/site.css</em>:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-css data-lang=css><span class=line><span class=cl><span class=p>.</span><span class=nc>float-columns</span> <span class=o>&gt;</span> <span class=nt>div</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>float</span><span class=p>:</span> <span class=kc>left</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=k>width</span><span class=p>:</span> <span class=mi>33</span><span class=kt>%</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span></span></span></code></pre></div><p>We use the child selection operator <code>></code> to apply the css rules to all <code>&lt;div></code> elements that are a direct child of the <code>&lt;div></code> we gave the class of <code>float-columns</code> to. We&rsquo;ll make each of those children <code>&lt;div></code> elements behave like columns by making them float to the left of the column declared after them, and set them each to be roughly 1/3 the width of the page with <code>width: 33%</code>.</p><p>If we run the page now, we&rsquo;ll see that we have our columns:</p><p><a href=#R-image-ed383fe62921dfb4d34a1d83adc813c8 class=lightbox-link><img alt="The three-column float layout" class="border lazy lightbox noshadow figure-image" loading=lazy src=/cis400/images/3.3.5.1.png style=height:auto;width:auto></a>
<a href=javascript:history.back(); class=lightbox-back id=R-image-ed383fe62921dfb4d34a1d83adc813c8><img alt="The three-column float layout" class="border lazy lightbox noshadow lightbox-image" loading=lazy src=/cis400/images/3.3.5.1.png></a></p><p>But when you scroll down, you&rsquo;ll also see a problem:</p><p><a href=#R-image-9b04194983f1e2a2937efafa7baaa108 class=lightbox-link><img alt="A float error" class="border lazy lightbox noshadow figure-image" loading=lazy src=/cis400/images/3.3.5.2.png style=height:auto;width:auto></a>
<a href=javascript:history.back(); class=lightbox-back id=R-image-9b04194983f1e2a2937efafa7baaa108><img alt="A float error" class="border lazy lightbox noshadow lightbox-image" loading=lazy src=/cis400/images/3.3.5.2.png></a></p><p>Because the use of <code>float</code> takes elements out of the usual flow layout algorithm, the elements that follow them often end up in unexpected positions. We have to explicitly turn the normal flow layout back on when we&rsquo;re done with our floating elements with a <code>clear</code> property, which can be <code>left</code>, <code>right</code>, or <code>both</code>.</p><p>This normally is done by adding an empty div with the <code>clear: both</code> rule applied after the last column; a technique called a <a href=https://developer.mozilla.org/en-US/docs/Web/CSS/clear rel=external target=_blank>clearfix</a>. Let&rsquo;s go ahead and declare our clearfix class in <em>wwwroot/css/site.css</em>:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-css data-lang=css><span class=line><span class=cl><span class=p>.</span><span class=nc>clearfix</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>clear</span><span class=p>:</span> <span class=kc>both</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span></span></span></code></pre></div><p>And then in our <em>Pages/Index.cshtml</em>, we&rsquo;ll add a <code>&lt;div></code> element with that class, just after our containing <code>&lt;div></code> (it will be the last element in the file):</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-html data-lang=html><span class=line><span class=cl><span class=p>&lt;</span><span class=nt>div</span> <span class=na>class</span><span class=o>=</span><span class=s>&#34;clearfix&#34;</span><span class=p>&gt;&lt;/</span><span class=nt>div</span><span class=p>&gt;</span></span></span></code></pre></div><p>Now when we render the page, we&rsquo;ll see the columns behave as expected:</p><p>!The float error fixed](/images/3.3.5.3.png)</p><p>However, our page is not responsive at this point. So we&rsquo;ll need to add a media query to establish a responsive breakpoint for smaller screens. Let&rsquo;s use 490 pixels as our breakpoint. We&rsquo;ll need to add this new rule <em>below</em> the ones we created for our <code>.float-columns</code> in <em>wwwroot/css/site.css</em>, as we will be overriding those when the media query is true:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-css data-lang=css><span class=line><span class=cl><span class=p>@</span><span class=k>media</span> <span class=o>(</span><span class=nt>max-width</span><span class=o>:</span> <span class=nt>490px</span><span class=o>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=c>/* Reset the columns to render with the flow of the page */</span>
</span></span><span class=line><span class=cl>    <span class=p>.</span><span class=nc>float-columns</span> <span class=o>&gt;</span> <span class=nt>div</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=k>float</span><span class=p>:</span> <span class=kc>none</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=k>width</span><span class=p>:</span> <span class=mi>100</span><span class=kt>%</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span></span></span></code></pre></div><p>We simply reverse the rules we applied to the columns by setting the properties back to their defaults. Now the columns will change to their stacked appearance when we look at the site on a smaller screen.</p><footer class=footline></footer></article><article class=default><header class=headline></header><h1 id=responsive-setup>Responsive Setup</h1><p>In web development, <em>Responsive Design</em> means making your webpages adjust to the device they are displayed on. This is especially important today, where a user might be browsing the web from a desktop, a tablet, a phone, or even a console built into a refrigerator, a car, or an airplane seat!</p><p>Before we go farther, there are a couple of concepts we need to understand. The first is the <em>device width</em> and <em>device height</em>, which are the actual size of the device&rsquo;s screen. Next is the <em>viewport</em>, which is the area of the screen that the web browser actually gets to render into, and has its own width and height. The viewport width and height can be smaller than the device width and height, as is the case when the browser is displayed in a window that is not maximized. In that case, only the area of the browser window (less the toolbars) is the viewport.</p><p>A viewport can also be <em>larger</em> than the device width and height. When mobile phones first started allowing users to browse the web, they had tiny screens. Phone manufacturers had to decide how to display webpages that were never designed for these devices. They settled on an approach of setting the viewport to a size consistent with computer monitors of the day, and then scaling the entire page down to fit onto the actual screen. The result was you could see the entire webpage, but it was tiny.</p><p><a href=#R-image-e7c695b2b1ff2bd9f6231dd8078f388d class=lightbox-link><img alt="Viewports on Mobile Devices" class="border lazy lightbox noshadow figure-image" loading=lazy src=/cis400/images/3.3.4.0.jpg style=height:auto;width:auto></a>
<a href=javascript:history.back(); class=lightbox-back id=R-image-e7c695b2b1ff2bd9f6231dd8078f388d><img alt="Viewports on Mobile Devices" class="border lazy lightbox noshadow lightbox-image" loading=lazy src=/cis400/images/3.3.4.0.jpg></a></p><p>This remains the default behavior of mobile browsers to this day - and because the viewport is not aligned with the device size, media queries targeting the viewport also do not correctly account for device size.</p><h2 id=the-viewport-meta-tag>The Viewport Meta Tag</h2><p>However, this can be overridden through the use of a <code>&lt;meta></code> element. The <code>&lt;meta></code> element must be placed in the <code>&lt;head></code> of a webpage, and applies some kind of metadata to the webpage. Historically, it was used to supply key words to search engines, but this practice was routinely abused and search engines have ceased to rely on it. However, other kinds of metadata can be added with a <code>&lt;meta></code> element, and one of the most important for responsive design overrides the default viewport settings. Thus, a responsive webpage should always declare the following <code>&lt;meta></code> tag:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-html data-lang=html><span class=line><span class=cl><span class=p>&lt;</span><span class=nt>meta</span> <span class=na>name</span><span class=o>=</span><span class=s>&#34;viewport&#34;</span> <span class=na>content</span><span class=o>=</span><span class=s>&#34;width=device-width, initial-scale=1&#34;</span><span class=p>&gt;</span></span></span></code></pre></div><p>This tells the browser to set the width of the viewport to the width of the device, and to not scale the final rendering of the webpage (scale is on a range of 0 to 1, where 1 is 100%). This ensures that the viewport and the device sizes are the same.</p><p>If you look in your project&rsquo;s _Pages/Shared/<em>Layout.cshtml</em> file, you will notice that this <code>&lt;meta></code> tag is already defined. In fact, it is included as biolerplate in all ASP.NET projects generated by Visual Studio that include Razor pages. But if you find yourself writing pages from scratch that you want to be responsive, you&rsquo;ll need to add this. You can read more about it on <a href=https://developer.mozilla.org/en-US/docs/Mozilla/Mobile/Viewport_meta_tag rel=external target=_blank>MDN</a>.</p><h2 id=responsive-breakpoints>Responsive Breakpoints</h2><p>Once we know our viewport is set up to be the same size as our device, we can turn our attention to using media queries to respond to different widths of screens. For example, we can define all the CSS rules we would normally use, and then a media query that would limit those for a smaller screen - say under 750 pixels. Let&rsquo;s try this out by adding a border to our aside, and changing its appearance in a smaller screen:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-css data-lang=css><span class=line><span class=cl><span class=nt>aside</span> <span class=p>{</span> <span class=k>border</span><span class=p>:</span> <span class=mi>5</span><span class=kt>px</span> <span class=kc>solid</span> <span class=kc>gray</span><span class=p>;</span> <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=p>@</span><span class=k>media</span> <span class=o>(</span><span class=nt>max-width</span><span class=o>:</span> <span class=nt>750px</span><span class=o>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=c>/* applies when the screen is under 750 pixels wide */</span>
</span></span><span class=line><span class=cl>    <span class=nt>aside</span> <span class=p>{</span> <span class=k>border</span><span class=p>:</span> <span class=mi>3</span><span class=kt>px</span> <span class=kc>dashed</span> <span class=kc>gray</span><span class=p>;</span> <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span></span></span></code></pre></div><p>Now when the viewport is wider than 750 pixels, you&rsquo;ll see a solid gray border around the banner ad:</p><p><a href=#R-image-4efbb5d404ec42aaf68e35d4770a0559 class=lightbox-link><img alt="Added Border on the Banner Ad" class="border lazy lightbox noshadow figure-image" loading=lazy src=/cis400/images/3.3.4.1.png style=height:auto;width:auto></a>
<a href=javascript:history.back(); class=lightbox-back id=R-image-4efbb5d404ec42aaf68e35d4770a0559><img alt="Added Border on the Banner Ad" class="border lazy lightbox noshadow lightbox-image" loading=lazy src=/cis400/images/3.3.4.1.png></a></p><p>And if you size down your viewport, you&rsquo;ll see that banner go to a smaller dashed gray:</p><p><a href=#R-image-de68e9bb7227be1982a7bdfbdc51f6e9 class=lightbox-link><img alt="Border at medium viewport size" class="border lazy lightbox noshadow figure-image" loading=lazy src=/cis400/images/3.3.4.2.png style=height:auto;width:auto></a>
<a href=javascript:history.back(); class=lightbox-back id=R-image-de68e9bb7227be1982a7bdfbdc51f6e9><img alt="Border at medium viewport size" class="border lazy lightbox noshadow lightbox-image" loading=lazy src=/cis400/images/3.3.4.2.png></a></p><p>We can extend this approach by adding <em>another</em> media query for even smaller screens, say those under 490 pixels:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-css data-lang=css><span class=line><span class=cl><span class=p>@</span><span class=k>media</span> <span class=o>(</span><span class=nt>max-width</span><span class=o>:</span> <span class=nt>490px</span><span class=o>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=c>/* applies when the screen is under 490 pixels wide */</span>
</span></span><span class=line><span class=cl>    <span class=nt>aside</span> <span class=p>{</span> <span class=k>border</span><span class=p>:</span> <span class=mi>2</span><span class=kt>px</span> <span class=kc>dotted</span> <span class=kc>gray</span><span class=p>;</span> <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span></span></span></code></pre></div><p>As this rule is declared <em>after</em> the first two border rules, it will <em>override</em> them both, replacing the values for the border (note, any previously declared rules that have not been overridden will continue to apply). Now if you size your screen even smaller:</p><p><a href=#R-image-503bffe426975fdd265b878c2403a5de class=lightbox-link><img alt="Border at small viewport size" class="border lazy lightbox noshadow figure-image" loading=lazy src=/images/3.3.4.3.png style=height:auto;width:auto></a>
<a href=javascript:history.back(); class=lightbox-back id=R-image-503bffe426975fdd265b878c2403a5de><img alt="Border at small viewport size" class="border lazy lightbox noshadow lightbox-image" loading=lazy src=/images/3.3.4.3.png></a></p><p>This strategy of using successively smaller media queries to override CSS styles at different screen widths is known as <em>responsive breakpoints</em>, because at those widths you specify, the appearance of your page changes.</p><p>It is a good idea to have the starting point of your page (when no media queries are applied) be a normal desktop resolution so that your site appears normal in very old browsers.</p><footer class=footline></footer></article><article class=default><header class=headline></header><h1 id=flex-based-responsive-layout>Flex-based Responsive Layout</h1><p>Now, the float-based layout is really a bit of a hack, as the intent of the <code>float</code> property is really for the embedding of images and callouts to the sides of text content. Unfortunately, floats and tables were the only mechanisms in earlier versions of CSS to allow for more nuanced layouts.</p><p>However, that has changed with CSS3, which has introduced several new layout algorithms to supplement the traditional flow and table ones. One of these is <a href=https://css-tricks.com/snippets/css/a-guide-to-flexbox/ rel=external target=_blank>flexbox</a>, which we will explore now.</p><p>Flexbox provides an alternative means for laying out HTML elements within a containing element. You set the containing element&rsquo;s <code>display</code> property to <code>flex</code>, and choose a <code>flex-direction</code> (<code>row</code>, <code>column</code>, <code>row-reverse</code>, or <code>column-reverse</code>).</p><p>It is very easy to set up our three-column layout with flexbox. Let&rsquo;s do so now.</p><p>First, we&rsquo;ll change the class we are applying to our containing <code>div</code> element in <em>Pages/Index.cshtml</em>. Let&rsquo;s use <code>"flex-columns"</code> instead of our previous <code>"float-columns"</code>:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-html data-lang=html><span class=line><span class=cl><span class=p>&lt;</span><span class=nt>aside</span> <span class=na>class</span><span class=o>=</span><span class=s>&#34;advertisement&#34;</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>    <span class=p>&lt;</span><span class=nt>img</span> <span class=na>src</span><span class=o>=</span><span class=s>&#34;~/img/ad.png&#34;</span> <span class=na>alt</span><span class=o>=</span><span class=s>&#34;Eat at Bernies!&#34;</span><span class=p>/&gt;</span>
</span></span><span class=line><span class=cl><span class=p>&lt;/</span><span class=nt>aside</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl><span class=p>&lt;</span><span class=nt>div</span> <span class=na>class</span><span class=o>=</span><span class=s>&#34;flex-columns&#34;</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>    <span class=p>&lt;</span><span class=nt>div</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>        <span class=p>&lt;</span><span class=nt>h1</span><span class=p>&gt;</span>Column One<span class=p>&lt;/</span><span class=nt>h1</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>        ...</span></span></code></pre></div><p>We can then add additional CSS rules to our <em>wwwroot/css/site.css</em> to apply the flex layout:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-css data-lang=css><span class=line><span class=cl><span class=p>.</span><span class=nc>flex-columns</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>display</span><span class=p>:</span> <span class=kc>flex</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=k>flex-direction</span><span class=p>:</span> <span class=kc>row</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span></span></span></code></pre></div><p>Now if we run our program and look at our page, we&rsquo;ll see that the flex algorithm has automatically arranged the children <code>&lt;div></code> elements into three equally-sized columns for us!</p><p><a href=#R-image-3273b260132642c64c563a0789379af7 class=lightbox-link><img alt="Flex-based columns layout" class="border lazy lightbox noshadow figure-image" loading=lazy src=/cis400/images/3.3.6.1.png style=height:auto;width:auto></a>
<a href=javascript:history.back(); class=lightbox-back id=R-image-3273b260132642c64c563a0789379af7><img alt="Flex-based columns layout" class="border lazy lightbox noshadow lightbox-image" loading=lazy src=/cis400/images/3.3.6.1.png></a></p><p>Moreover, if we were to add or remove columns, the layout would automatically change to keep them balanced. You can also apply a number of additional properties to provide more fine-grained control of the layout; the CSS Tricks <a href=https://css-tricks.com/snippets/css/a-guide-to-flexbox/ rel=external target=_blank>A Complete Guide to Flexbox</a> offers a great guide to the details.</p><p>Now to make our layout responsive, we just need to switch the direction of our container:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-css data-lang=css><span class=line><span class=cl><span class=p>@</span><span class=k>media</span> <span class=o>(</span><span class=nt>max-width</span><span class=o>:</span> <span class=nt>490px</span><span class=o>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=p>.</span><span class=nc>flex-columns</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=k>flex-direction</span><span class=p>:</span> <span class=kc>column</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span></span></span></code></pre></div><p>Now when we view our page on a smaller screen, it will use columns instead of rows!</p><p><a href=#R-image-9f3e1ccc25e09c162564e41fb7e14161 class=lightbox-link><img alt="Single Column Flex Layout" class="border lazy lightbox noshadow figure-image" loading=lazy src=/cis400/images/3.3.6.2.png style=height:auto;width:auto></a>
<a href=javascript:history.back(); class=lightbox-back id=R-image-9f3e1ccc25e09c162564e41fb7e14161><img alt="Single Column Flex Layout" class="border lazy lightbox noshadow lightbox-image" loading=lazy src=/cis400/images/3.3.6.2.png></a></p><p>We also no longer need to bother with a clearfix <code>&lt;div></code>, though leaving the one we created in the prior example in place won&rsquo;t cause any problems.</p><footer class=footline></footer></article><article class=default><header class=headline></header><h1 id=grid-based>Grid-based</h1><p>TODO: float based responsive layouts</p><footer class=footline></footer></article><article class=default><header class=headline></header><h1 id=summary>Summary</h1><p>TODO: float based responsive layouts</p><footer class=footline></footer></article></section><article class=default><header class=headline></header><h1 id=web-data>Web Data</h1><p>Now that we&rsquo;ve seen how to dynamically create the content of a Razor Page on the server, we should turn our attention to how we can do so based on our user&rsquo;s needs. Consider the example application we have been developing - it exposes a database of movie information to the user. How might a user want to use this database? They might want to find the details for a specific movie - who directed it, when was it released, etc. They might be looking for a movie they want to watch in a favorite genre. They might be looking to find all the movies directed by a favorite director&mldr; there are a lot of possibilities.</p><p>As software developers, we need to anticipate how our users will likely want to use the software we are developing. And with that in mind, we need to develop user interfaces that allow the user to communicate those needs to the software we are writing as concisely as possible. Remember that in HTTP, all communication between the client (and its user) and the server (our web application), is mediated through the request-response mechanism:</p><p><a href=#R-image-99275b7c0098f21f753d7977eeea0eb6 class=lightbox-link><img alt="Request-Response Mechanism" class="border lazy lightbox noshadow figure-image" loading=lazy src=/cis400/images/request-response-pattern.png style=height:auto;width:auto></a>
<a href=javascript:history.back(); class=lightbox-back id=R-image-99275b7c0098f21f753d7977eeea0eb6><img alt="Request-Response Mechanism" class="border lazy lightbox noshadow lightbox-image" loading=lazy src=/cis400/images/request-response-pattern.png></a></p><p>Thus, any information the user wants to supply the server is typically communicated <em>through</em> a request. HTML provides a mechanism for enabling this communication in a structured way - forms. A <code>&lt;form></code> element, when submitted, serializes the values of all <code>&lt;input></code> elements contained within it and submits them to the server in the request.</p><p>The values in the form are serialized (converted into text) and submitted with the request. Exactly how this serialization happens depends on the kind of request. For GET requests the serialized data is added to the url as the query string. For POST requests, the serialized data is sent as the body of the request.</p><p>You can usually use either form (except when uploading files, which must be POSTed). However, you might think about the semantics of each action. A GET request is for retrieving something <em>from</em> the server, so any data your sending is about modifying that request. Thus, search and filter requests make sense as a GET request. A POST request is about sending something <em>to</em> the server, thus account creation, blog posts, and so on make sense as a POST request.</p><div class="box notices cstyle info"><div class=box-label><i class="fa-fw fas fa-info-circle"></i> Info</div><div class=box-content><p>When sent using secure HTTP (HTTPS), both the query string portion of the URL and the request body are encrypted, so there is no difference in the in-transit security. However, browsers typically store the full URL in the history, so if sensitive information is being sent, you might want to use POST requests.</p></div></div><footer class=footline></footer></article><section><h1 class=a11y-only>Subsections of Web Data</h1><article class=default><header class=headline></header><h1 id=adding-search-to-the-movie-site>Adding Search to the Movie Site</h1><p>Let&rsquo;s add a search form and functionality to our movie website. We&rsquo;ll add this to our <em>Index.cshtml</em> page, just above the <code>&lt;h1></code> element:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-html data-lang=html><span class=line><span class=cl>    <span class=p>&lt;</span><span class=nt>form</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>        <span class=p>&lt;</span><span class=nt>input</span> <span class=na>type</span><span class=o>=</span><span class=s>&#34;text&#34;</span> <span class=na>name</span><span class=o>=</span><span class=s>&#34;SearchTerms&#34;</span><span class=p>/&gt;</span>
</span></span><span class=line><span class=cl>        <span class=p>&lt;</span><span class=nt>input</span> <span class=na>type</span><span class=o>=</span><span class=s>&#34;submit&#34;</span> <span class=na>value</span><span class=o>=</span><span class=s>&#34;Search&#34;</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>    <span class=p>&lt;/</span><span class=nt>form</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>    <span class=p>&lt;</span><span class=nt>h1</span><span class=p>&gt;</span>Movie Results<span class=p>&lt;/</span><span class=nt>h1</span><span class=p>&gt;</span></span></span></code></pre></div><p>We&rsquo;ll also change the <code>&lt;h1></code> contents to &ldquo;Movie Results&rdquo;.</p><p>Try typing a search term into the search box, and click the <em>search</em> button. Has anything changed?</p><h3 id=the-request-object>The Request Object</h3><p>When you click the <em>search</em> button, the browser serializes your form, and makes a request against your server including the search terms. By default this request is a <strong>GET</strong> request, and the contents of the form are serialized using <a href=https://developer.mozilla.org/en-US/docs/Glossary/percent-encoding rel=external target=_blank>urlencoding (aka percent encoding)</a>, a special string format. This string is then appended to the requested url as the <a href=https://developer.mozilla.org/en-US/docs/Web/API/Location/search rel=external target=_blank>query string (aka search string)</a> - a series of key-value pairs proceeded by the question mark symbol(<code>?</code>) and separated by the ampersand (<code>&</code>).</p><p>This data is made available to us in our PageModel <em>Index.cshtml.cs</em> by ASP.NET. Let&rsquo;s take a look at it now. Notice the method <code>public void OnGet()</code>? This method is invoked <em>every time the page is requested using a GET request</em>. Thus, if we need to do some initialization and/or processing, this would be the place to do it.</p><p>Inside the PageModel, we can access the request data using the <code>Request</code> object. The exact string can be accessed with <code>Request.QueryString</code>, or the parsed and deserialized results can be accessed from <code>Request.Query</code>. Let&rsquo;s use the latter to pull out the search terms:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-csharp data-lang=csharp><span class=line><span class=cl>    <span class=kd>public</span> <span class=k>void</span> <span class=n>OnGet</span><span class=p>()</span> 
</span></span><span class=line><span class=cl>    <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=n>String</span> <span class=n>terms</span> <span class=p>=</span> <span class=n>Request</span><span class=p>.</span><span class=n>Query</span><span class=p>[</span><span class=s>&#34;SearchTerms&#34;</span><span class=p>];</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span></span></span></code></pre></div><p>We can store that value, and make it available to the page itself, by creating a public property. Let&rsquo;s create one named <code>SearchTerms</code>:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-csharp data-lang=csharp><span class=line><span class=cl>    <span class=kd>public</span> <span class=kt>string</span> <span class=n>SearchTerms</span> <span class=p>{</span> <span class=k>get</span><span class=p>;</span> <span class=k>set</span><span class=p>;</span> <span class=p>}</span></span></span></code></pre></div><p>And we&rsquo;ll refactor our <code>OnGet()</code> to store the search terms coming in from the request:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-csharp data-lang=csharp><span class=line><span class=cl>    <span class=kd>public</span> <span class=k>void</span> <span class=n>OnGet</span><span class=p>()</span> 
</span></span><span class=line><span class=cl>    <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=n>SearchTerms</span> <span class=p>=</span> <span class=n>Request</span><span class=p>.</span><span class=n>Query</span><span class=p>[</span><span class=s>&#34;SearchTerms&#34;</span><span class=p>];</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span></span></span></code></pre></div><p>Now we can refactor our input element to use that public property from our model as its default value:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-html data-lang=html><span class=line><span class=cl>    <span class=p>&lt;</span><span class=nt>input</span> <span class=na>type</span><span class=o>=</span><span class=s>&#34;text&#34;</span> <span class=na>name</span><span class=o>=</span><span class=s>&#34;SearchTerms&#34;</span> <span class=na>value</span><span class=o>=</span><span class=s>&#34;@Model.SearchTerms&#34;</span><span class=p>/&gt;</span></span></span></code></pre></div><p>The first time we visit the index page, the <code>SearchTerms</code> value will be null, so our input would have <code>value=""</code>. The browser interprets this as empty. If we add a search term and click the <em>search</em> button, we&rsquo;ll see the page reload. And since <code>@Model.SearchTerms</code> has a value this time, we&rsquo;ll see that string appear in search box!</p><p>Now we just need to search for those terms&mldr;</p><h3 id=adding-search-to-the-database>Adding Search to the Database</h3><p>We&rsquo;ll start by defining a new static method in our <em>MovieDatabase.cs</em> file to search for movies using the search terms:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-csharp data-lang=csharp><span class=line><span class=cl>    <span class=cs>/// &lt;summary&gt;</span>
</span></span><span class=line><span class=cl>    <span class=cs>/// Searches the database for matching movies</span>
</span></span><span class=line><span class=cl>    <span class=cs>/// &lt;/summary&gt;</span>
</span></span><span class=line><span class=cl>    <span class=cs>/// &lt;param name=&#34;terms&#34;&gt;The terms to search for&lt;/param&gt;</span>
</span></span><span class=line><span class=cl>    <span class=cs>/// &lt;returns&gt;A collection of movies&lt;/returns&gt;</span>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=kd>static</span> <span class=n>IEnumerable</span><span class=p>&lt;</span><span class=n>Movie</span><span class=p>&gt;</span> <span class=n>Search</span><span class=p>(</span><span class=kt>string</span> <span class=n>terms</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=c1>// TODO: Search database</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span></span></span></code></pre></div><p>We&rsquo;ll need a collection of results that implements the <code>IEnumerable&lt;T></code> interface. Let&rsquo;s use the familiar <code>List&lt;T></code>:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-csharp data-lang=csharp><span class=line><span class=cl>    <span class=n>List</span><span class=p>&lt;</span><span class=n>Movie</span><span class=p>&gt;</span> <span class=n>results</span> <span class=p>=</span> <span class=k>new</span> <span class=n>List</span><span class=p>&lt;</span><span class=n>Movie</span><span class=p>&gt;();</span></span></span></code></pre></div><p>Now, there is a chance that the search terms we receive are <code>null</code>. If that&rsquo;s the case, we would either 1) return <em>all</em> the movies, or 2) return <em>no</em> movies. You can choose either option, but for now, I&rsquo;ll return all movies</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-csharp data-lang=csharp><span class=line><span class=cl>    <span class=c1>// Return all movies if there are no search terms</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span><span class=p>(</span><span class=n>terms</span> <span class=p>==</span> <span class=kc>null</span><span class=p>)</span> <span class=k>return</span> <span class=n>All</span><span class=p>;</span></span></span></code></pre></div><p>If we <em>do</em> have search terms, we need to add any movies from our database that include those terms in the title. This requires us to check <em>each movie</em> in our database:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-csharp data-lang=csharp><span class=line><span class=cl>    <span class=c1>// return each movie in the database containing the terms substring</span>
</span></span><span class=line><span class=cl>    <span class=k>foreach</span><span class=p>(</span><span class=n>Movie</span> <span class=n>movie</span> <span class=k>in</span> <span class=n>All</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span><span class=p>(</span><span class=n>movie</span><span class=p>.</span><span class=n>Title</span><span class=p>.</span><span class=n>Contains</span><span class=p>(</span><span class=n>terms</span><span class=p>,</span> <span class=n>StringComparison</span><span class=p>.</span><span class=n>InvariantCultureIgnoreCase</span><span class=p>))</span> 
</span></span><span class=line><span class=cl>        <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=n>results</span><span class=p>.</span><span class=n>Add</span><span class=p>(</span><span class=n>movie</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>   </span></span></code></pre></div><p>We&rsquo;ll use <a href="https://docs.microsoft.com/en-us/dotnet/api/system.string.contains?view=netframework-4.8" rel=external target=_blank>String.Contains()</a> to determine if our terms are a <em>substring</em> within the title, ignoring case differences. If we find it, we&rsquo;ll add the movie to our <code>results</code> list.</p><p>Finally, we&rsquo;ll return that list:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-csharp data-lang=csharp><span class=line><span class=cl>    <span class=k>return</span> <span class=n>results</span><span class=p>;</span></span></span></code></pre></div><p>Now, we can refactor our <em>Index.cshtml.cs</em> to use this new search method:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-csharp data-lang=csharp><span class=line><span class=cl>    <span class=cs>/// &lt;summary&gt;</span>
</span></span><span class=line><span class=cl>    <span class=cs>/// The movies to display on the index page </span>
</span></span><span class=line><span class=cl>    <span class=cs>/// &lt;/summary&gt;</span>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=n>IEnumerable</span><span class=p>&lt;</span><span class=n>Movie</span><span class=p>&gt;</span> <span class=n>Movies</span> <span class=p>{</span> <span class=k>get</span><span class=p>;</span> <span class=kd>protected</span> <span class=k>set</span><span class=p>;</span> <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=cs>/// &lt;summary&gt;</span>
</span></span><span class=line><span class=cl>    <span class=cs>/// The current search terms </span>
</span></span><span class=line><span class=cl>    <span class=cs>/// &lt;/summary&gt;</span>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=kt>string</span> <span class=n>SearchTerms</span> <span class=p>{</span> <span class=k>get</span><span class=p>;</span> <span class=k>set</span><span class=p>;</span> <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=cs>/// &lt;summary&gt;</span>
</span></span><span class=line><span class=cl>    <span class=cs>/// Gets the search results for display on the page</span>
</span></span><span class=line><span class=cl>    <span class=cs>/// &lt;/summary&gt;</span>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=k>void</span> <span class=n>OnGet</span><span class=p>()</span> 
</span></span><span class=line><span class=cl>    <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=n>SearchTerms</span> <span class=p>=</span> <span class=n>Request</span><span class=p>.</span><span class=n>Query</span><span class=p>[</span><span class=s>&#34;SearchTerms&#34;</span><span class=p>];</span>
</span></span><span class=line><span class=cl>        <span class=n>Movies</span> <span class=p>=</span> <span class=n>MovieDatabase</span><span class=p>.</span><span class=n>Search</span><span class=p>(</span><span class=n>SearchTerms</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span></span></span></code></pre></div><p>We&rsquo;ll also need ot refactor our <em>Index.cshtml.cs</em> to use the search results, instead of the entire database:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-html data-lang=html><span class=line><span class=cl><span class=p>&lt;</span><span class=nt>ul</span> <span class=na>class</span><span class=o>=</span><span class=s>&#34;movie-list&#34;</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>    @foreach(Movie movie in @Model.Movies)
</span></span><span class=line><span class=cl>    {
</span></span><span class=line><span class=cl>        <span class=p>&lt;</span><span class=nt>li</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>            <span class=p>&lt;</span><span class=nt>div</span> <span class=na>class</span><span class=o>=</span><span class=s>&#34;details&#34;</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>                <span class=p>&lt;</span><span class=nt>h3</span> <span class=na>class</span><span class=o>=</span><span class=s>&#34;title&#34;</span><span class=p>&gt;</span>@movie.Title<span class=p>&lt;/</span><span class=nt>h3</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>                <span class=p>&lt;</span><span class=nt>div</span> <span class=na>class</span><span class=o>=</span><span class=s>&#34;mpaa&#34;</span><span class=p>&gt;</span>@movie.MPAARating<span class=p>&lt;/</span><span class=nt>div</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>                <span class=p>&lt;</span><span class=nt>div</span> <span class=na>class</span><span class=o>=</span><span class=s>&#34;genre&#34;</span><span class=p>&gt;</span>@movie.MajorGenre<span class=p>&lt;/</span><span class=nt>div</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>            <span class=p>&lt;/</span><span class=nt>div</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>            <span class=p>&lt;</span><span class=nt>div</span> <span class=na>class</span><span class=o>=</span><span class=s>&#34;ratings&#34;</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>                @if(movie.IMDBRating != null)
</span></span><span class=line><span class=cl>                {
</span></span><span class=line><span class=cl>                    <span class=p>&lt;</span><span class=nt>div</span> <span class=na>class</span><span class=o>=</span><span class=s>&#34;imdb&#34;</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>                        @movie.IMDBRating
</span></span><span class=line><span class=cl>                    <span class=p>&lt;/</span><span class=nt>div</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>                }
</span></span><span class=line><span class=cl>                @if(movie.RottenTomatoesRating != null)
</span></span><span class=line><span class=cl>                {
</span></span><span class=line><span class=cl>                    <span class=p>&lt;</span><span class=nt>div</span> <span class=na>class</span><span class=o>=</span><span class=s>&#34;rotten-tomatoes&#34;</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>                        @movie.RottenTomatoesRating
</span></span><span class=line><span class=cl>                    <span class=p>&lt;/</span><span class=nt>div</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>                }
</span></span><span class=line><span class=cl>            <span class=p>&lt;/</span><span class=nt>div</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>        <span class=p>&lt;/</span><span class=nt>li</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>    }
</span></span><span class=line><span class=cl><span class=p>&lt;/</span><span class=nt>ul</span><span class=p>&gt;</span></span></span></code></pre></div><p>If we try running the project again, and searching for the term &ldquo;Love&rdquo;&mldr; it crashes? What is going on?</p><p><a href=#R-image-d8bdb3bdb7438b6a307c3fc4965ddf56 class=lightbox-link><img alt="The Encountered Exception" class="border lazy lightbox noshadow figure-image" loading=lazy src=/cis400/images/6.8.2.png style=height:auto;width:auto></a>
<a href=javascript:history.back(); class=lightbox-back id=R-image-d8bdb3bdb7438b6a307c3fc4965ddf56><img alt="The Encountered Exception" class="border lazy lightbox noshadow lightbox-image" loading=lazy src=/cis400/images/6.8.2.png></a></p><p>Notice that the error is a <code>NullReferenceException</code>, and occurs in our <code>if</code> statement checking the title.</p><h3 id=bad-data>Bad Data</h3><p>If we think about what variables are involved in the line <code>if(movie.Title.Contains(terms, StringComparison.InvariantCultureIgnoreCase))</code>, we have:</p><ul><li><code>movie</code></li><li><code>movie.Title</code></li><li><code>terms</code></li></ul><p>Which of these three values can be null? We know for certain <code>terms</code> is not, as we test for the null value and return if it exists just before this portion of our code. Similarly, <code>movie</code> cannot be null, as it is an entry in the list provided by <code>All</code>, and if it were null, our page would have crashed before we added searching. That leaves <code>movie.Title</code> as a possibility.</p><p>If we comb through the data in <em>movies.json</em>, we find on line 54957 a movie with <code>null</code> for a title:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-json data-lang=json><span class=line><span class=cl>  <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;Title&#34;</span><span class=p>:</span> <span class=kc>null</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;USGross&#34;</span><span class=p>:</span> <span class=mi>26403</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;WorldwideGross&#34;</span><span class=p>:</span> <span class=mi>3080493</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;USDVDSales&#34;</span><span class=p>:</span> <span class=kc>null</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;ProductionBudget&#34;</span><span class=p>:</span> <span class=mi>3700000</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;ReleaseDate&#34;</span><span class=p>:</span> <span class=s2>&#34;Nov 03 2006&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;MPAARating&#34;</span><span class=p>:</span> <span class=s2>&#34;Not Rated&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;RunningTime&#34;</span><span class=p>:</span> <span class=mi>85</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;Distributor&#34;</span><span class=p>:</span> <span class=s2>&#34;IFC Films&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;Source&#34;</span><span class=p>:</span> <span class=s2>&#34;Original Screenplay&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;MajorGenre&#34;</span><span class=p>:</span> <span class=s2>&#34;Thriller/Suspense&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;CreativeType&#34;</span><span class=p>:</span> <span class=s2>&#34;Contemporary Fiction&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;Director&#34;</span><span class=p>:</span> <span class=kc>null</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;RottenTomatoesRating&#34;</span><span class=p>:</span> <span class=mi>39</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;IMDBRating&#34;</span><span class=p>:</span> <span class=mf>6.6</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;IMDBVotes&#34;</span><span class=p>:</span> <span class=mi>11986</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span><span class=err>,</span></span></span></code></pre></div><p>Working from the provided metadata, we can eventually identify the film as one titled <a href=https://en.wikipedia.org/wiki/Unknown_(2006_film) rel=external target=_blank>Unknown</a>. It would seem that whomever wrote the script to create this JSON file interpreted &ldquo;Unknown&rdquo; to mean the title was unknown (hence null), rather than the literal word &ldquo;Unknown&rdquo;.</p><p>If we dig deeper into the JSON file, we can find other issues. For example, the JSON identifies the controversial film <a href=https://en.wikipedia.org/wiki/The_Birth_of_a_Nation rel=external target=_blank>Birth of a Nation</a> as being released in 2015, when it was actually the first full-length theatrical film ever released, in <em>1915</em>! Most likely the original database from which these entries were derived only used two digits for the year, i.e. <code>15</code>, and the scripter who converted it to JSON chose a threshold date to determine if it was released in the 20 or 21st century, i.e.:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-csharp data-lang=csharp><span class=line><span class=cl><span class=k>if</span><span class=p>(</span><span class=n>date</span> <span class=p>&lt;</span> <span class=m>28</span><span class=p>)</span> 
</span></span><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=n>date</span> <span class=p>+=</span> <span class=m>2000</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl><span class=k>else</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=n>date</span> <span class=p>+=</span> <span class=m>1900</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span></span></span></code></pre></div><p>The earliest movie release date in the JSON is 1928, for &ldquo;The Broadway Melody&rdquo;, which suggests that <em>all</em> the movies released between 1915 and 1928 have been mislabeled as being released in the 21st century!</p><p>Unfortunately, these kinds of errors are rampant in databases, so as software developers we must be aware that our data may well be <em>dirty</em> - containing erroneous values, and anticipate these errors much like we do with user input. It is a good idea to clean up and fix these errors in our database so that it will be more reliable, but we also need to check for potential errors in our own code, as the database could be updated with more junk data in the future. Thus, we&rsquo;ll add a <code>null</code> check to our <code>if</code> statement in <em>MovieDatabase.cs</em>:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-csharp data-lang=csharp><span class=line><span class=cl><span class=k>if</span><span class=p>(</span><span class=n>movie</span><span class=p>.</span><span class=n>Title</span> <span class=p>!=</span> <span class=kc>null</span> <span class=p>&amp;&amp;</span> <span class=n>movie</span><span class=p>.</span><span class=n>Title</span><span class=p>.</span><span class=n>Contains</span><span class=p>(</span><span class=n>terms</span><span class=p>,</span> <span class=n>StringComparison</span><span class=p>.</span><span class=n>InvariantCultureIgnoreCase</span><span class=p>))</span> </span></span></code></pre></div><p>This will protect us against a <code>NullReferenceException</code> when our movie titles are null. Now if you try the search again, you should see the results:</p><p><a href=#R-image-0d437921d1cd13ff3f777fa78ed25945 class=lightbox-link><img alt="The Search Results for &ldquo;Love&rdquo;" class="border lazy lightbox noshadow figure-image" loading=lazy src=/cis400/images/6.8.3.png style=height:auto;width:auto></a>
<a href=javascript:history.back(); class=lightbox-back id=R-image-0d437921d1cd13ff3f777fa78ed25945><img alt="The Search Results for &ldquo;Love&rdquo;" class="border lazy lightbox noshadow lightbox-image" loading=lazy src=/cis400/images/6.8.3.png></a></p><footer class=footline></footer></article><article class=default><header class=headline></header><h1 id=adding-categorical-filters-to-the-movie-site>Adding Categorical Filters to the Movie Site</h1><p>Let&rsquo;s add some filters to the page as well. We&rsquo;ll start with <em>categorical</em> filters, i.e. filtering by category. Let&rsquo;s start by filtering for MPAA Rating. We know that there are only a handful of ratings issued by the Motion Picture Association of America - G, PG, PG-13, R, and NC-17. We might be tempted to use an enumeration to represent these values, but in C# an enumeration cannot have strings for values. Nor can we use the hyphen (<code>-</code>) in an enumeration name.</p><h2 id=defining-the-mpaa-ratings>Defining the MPAA Ratings</h2><p>So let&rsquo;s define a string array with our MPAA values, and make it accessible from our <code>MovieDatabase</code> class:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-csharp data-lang=csharp><span class=line><span class=cl>    <span class=cs>/// &lt;summary&gt;</span>
</span></span><span class=line><span class=cl>    <span class=cs>/// Gets the possible MPAARatings</span>
</span></span><span class=line><span class=cl>    <span class=cs>/// &lt;/summary&gt;</span>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=kd>static</span> <span class=kt>string</span><span class=p>[]</span> <span class=n>MPAARatings</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=k>get</span> <span class=p>=&gt;</span> <span class=k>new</span> <span class=kt>string</span><span class=p>[]</span>
</span></span><span class=line><span class=cl>        <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=s>&#34;G&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=s>&#34;PG&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=s>&#34;PG-13&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=s>&#34;R&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=s>&#34;NC-17&#34;</span>
</span></span><span class=line><span class=cl>        <span class=p>};</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span></span></span></code></pre></div><p>Now in our <code>&lt;form></code> in <em>Index.cshtml</em> we can add a checkbox for each of these possible values:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-html data-lang=html><span class=line><span class=cl><span class=p>&lt;</span><span class=nt>form</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>   <span class=p>&lt;</span><span class=nt>input</span> <span class=na>type</span><span class=o>=</span><span class=s>&#34;text&#34;</span> <span class=na>name</span><span class=o>=</span><span class=s>&#34;SearchTerms&#34;</span> <span class=na>value</span><span class=o>=</span><span class=s>&#34;@Model.SearchTerms&#34;</span><span class=p>/&gt;</span>
</span></span><span class=line><span class=cl>    <span class=p>&lt;</span><span class=nt>input</span> <span class=na>type</span><span class=o>=</span><span class=s>&#34;submit&#34;</span> <span class=na>value</span><span class=o>=</span><span class=s>&#34;Search&#34;</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>    @foreach  (string rating in MovieDatabase.MPAARating) 
</span></span><span class=line><span class=cl>    {
</span></span><span class=line><span class=cl>        <span class=p>&lt;</span><span class=nt>label</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>            <span class=p>&lt;</span><span class=nt>input</span> <span class=na>type</span><span class=o>=</span><span class=s>&#34;checkbox&#34;</span> <span class=na>name</span><span class=o>=</span><span class=s>&#34;MPAARatings&#34;</span> <span class=na>value</span><span class=o>=</span><span class=s>&#34;@rating&#34;</span><span class=p>/&gt;</span>
</span></span><span class=line><span class=cl>            @rating
</span></span><span class=line><span class=cl>        <span class=p>&lt;/</span><span class=nt>label</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>    }
</span></span><span class=line><span class=cl><span class=p>&lt;/</span><span class=nt>form</span><span class=p>&gt;</span></span></span></code></pre></div><p>If you try running the project now, and check a few boxes, you&rsquo;ll see the query string results look something like:</p><div class=highlight><pre tabindex=0><code>?SearchTerms=&amp;MPAARatings=G&amp;MPAARatings=PG-13</code></pre></div><p>Notice how the key <em>MPAARatings</em> is repeated twice? What would that look like in our PageModel? We can find out; declare a <code>var</code> to hold the value in the <code>OnGet()</code> method of <em>Index.cshtml.cs</em>:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-csharp data-lang=csharp><span class=line><span class=cl>    <span class=kt>var</span> <span class=n>MPAARatings</span> <span class=p>=</span> <span class=n>Request</span><span class=p>.</span><span class=n>Query</span><span class=p>[</span><span class=s>&#34;MPAARatings&#34;</span><span class=p>];</span></span></span></code></pre></div><p>If we add a breakpoint on this line, and run our code, then check several boxes (you&rsquo;ll have to <em>continue</em> the first time you hit the breakpoint), then step over the line, we&rsquo;ll see that the var <code>MPAA</code> rating is set to a <em>string collection</em>. We could therefore store it in an array property in <em>Index.cshtml.cs</em>, much like we did with our <code>SearchTerms</code>:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-csharp data-lang=csharp><span class=line><span class=cl>    <span class=cs>/// &lt;summary&gt;</span>
</span></span><span class=line><span class=cl>    <span class=cs>/// The filtered MPAA Ratings</span>
</span></span><span class=line><span class=cl>    <span class=cs>/// &lt;/summary&gt;</span>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=kt>string</span><span class=p>[]</span> <span class=n>MPAARatings</span> <span class=p>{</span> <span class=k>get</span><span class=p>;</span> <span class=k>set</span><span class=p>;</span> <span class=p>}</span></span></span></code></pre></div><p>And we can refactor the line we just added to <code>OnGet()</code> to use this new property:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-csharp data-lang=csharp><span class=line><span class=cl>    <span class=n>MPAARatings</span> <span class=p>=</span> <span class=n>Request</span><span class=p>.</span><span class=n>Query</span><span class=p>[</span><span class=s>&#34;MPAARatings&#34;</span><span class=p>];</span></span></span></code></pre></div><p>Then, in our <em>Index.cshtml</em> Razor Page, we can refactor the checkbox to be checked if we filtered against this rating in our last request:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-html data-lang=html><span class=line><span class=cl>    <span class=p>&lt;</span><span class=nt>input</span> <span class=na>type</span><span class=o>=</span><span class=s>&#34;checkbox&#34;</span> <span class=na>name</span><span class=o>=</span><span class=s>&#34;MPAARatings&#34;</span> <span class=na>value</span><span class=o>=</span><span class=s>&#34;@rating&#34;</span> <span class=na>checked</span><span class=o>=</span><span class=s>&#34;@Model.MPAARatings.Contains(rating)&#34;</span><span class=p>/&gt;</span></span></span></code></pre></div><p>Now our filters stick around when we submit the search request. That just leaves making the filters actually <em>work</em>.</p><h2 id=applying-mpaa-rating-filters>Applying MPAA Rating Filters</h2><p>Let&rsquo;s add another method to our <code>MovieDatabase</code> class, <code>FilterByMPAARating()</code>:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-csharp data-lang=csharp><span class=line><span class=cl>    <span class=cs>/// &lt;summary&gt;</span>
</span></span><span class=line><span class=cl>    <span class=cs>/// Filters the provided collection of movies</span>
</span></span><span class=line><span class=cl>    <span class=cs>/// &lt;/summary&gt;</span>
</span></span><span class=line><span class=cl>    <span class=cs>/// &lt;param name=&#34;movies&#34;&gt;The collection of movies to filter&lt;/param&gt;</span>
</span></span><span class=line><span class=cl>    <span class=cs>/// &lt;param name=&#34;ratings&#34;&gt;The ratings to include&lt;/param&gt;</span>
</span></span><span class=line><span class=cl>    <span class=cs>/// &lt;returns&gt;A collection containing only movies that match the filter&lt;/returns&gt;</span>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=kd>static</span> <span class=n>IEnumerable</span><span class=p>&lt;</span><span class=n>Movie</span><span class=p>&gt;</span> <span class=n>FilterByMPAARating</span><span class=p>(</span><span class=n>IEnumerable</span><span class=p>&lt;</span><span class=n>Movie</span><span class=p>&gt;</span> <span class=n>movies</span><span class=p>,</span> <span class=n>IEnumerable</span><span class=p>&lt;</span><span class=kt>string</span><span class=p>&gt;</span> <span class=n>ratings</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=c1>// TODO: Filter the list</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=p>}</span></span></span></code></pre></div><p>Notice that in <em>this</em> method, we accept an <code>IEnumerable&lt;Movie></code> parameter. This is the list of movies we want to filter. We use this, instead of the <code>All()</code> we did in the <code>Search()</code> method, as we would want to filter the <em>results</em> of a search.</p><p>Let&rsquo;s do a null/empty check, and just return this shortlist if no filters are specified:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-csharp data-lang=csharp><span class=line><span class=cl>    <span class=c1>// If no filter is specified, just return the provided collection</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=p>(</span><span class=n>ratings</span> <span class=p>==</span> <span class=kc>null</span> <span class=p>||</span> <span class=n>ratings</span><span class=p>.</span><span class=n>Count</span><span class=p>()</span> <span class=p>==</span> <span class=m>0</span><span class=p>)</span> <span class=k>return</span> <span class=n>movies</span><span class=p>;</span></span></span></code></pre></div><p>Otherwise, we&rsquo;ll use the same process we did before. Start with an empty list of movies, and iterate over the collection seeing if any match. However, as we have <em>two</em> collections (the movies <em>and</em> the ratings), we&rsquo;ll see if the ratings collection contains the supplied movie&rsquo;s rating.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-csharp data-lang=csharp><span class=line><span class=cl>    <span class=c1>// Filter the supplied collection of movies</span>
</span></span><span class=line><span class=cl>    <span class=n>List</span><span class=p>&lt;</span><span class=n>Movie</span><span class=p>&gt;</span> <span class=n>results</span> <span class=p>=</span> <span class=k>new</span> <span class=n>List</span><span class=p>&lt;</span><span class=n>Movie</span><span class=p>&gt;();</span>
</span></span><span class=line><span class=cl>    <span class=k>foreach</span><span class=p>(</span><span class=n>Movie</span> <span class=n>movie</span> <span class=k>in</span> <span class=n>movies</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span><span class=p>(</span><span class=n>movie</span><span class=p>.</span><span class=n>MPAARating</span> <span class=p>!=</span> <span class=kc>null</span> <span class=p>&amp;&amp;</span> <span class=n>ratings</span><span class=p>.</span><span class=n>Contains</span><span class=p>(</span><span class=n>movie</span><span class=p>.</span><span class=n>MPAARating</span><span class=p>))</span>
</span></span><span class=line><span class=cl>        <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=n>results</span><span class=p>.</span><span class=n>Add</span><span class=p>(</span><span class=n>movie</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span></span></span></code></pre></div><p>Finally, we&rsquo;ll return our results:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-csharp data-lang=csharp><span class=line><span class=cl>    <span class=k>return</span> <span class=n>results</span><span class=p>;</span></span></span></code></pre></div><p>Now, back in our PageModel <em>Index.cshtml.cs</em>, we&rsquo;ll apply our filter to the results of our search. The refactored <code>OnGet()</code> should then be:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-csharp data-lang=csharp><span class=line><span class=cl>    <span class=kd>public</span> <span class=k>void</span> <span class=n>OnGet</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=n>SearchTerms</span> <span class=p>=</span> <span class=n>Request</span><span class=p>.</span><span class=n>Query</span><span class=p>[</span><span class=s>&#34;SearchTerms&#34;</span><span class=p>];</span>
</span></span><span class=line><span class=cl>        <span class=n>MPAARatings</span> <span class=p>=</span> <span class=n>Request</span><span class=p>.</span><span class=n>Query</span><span class=p>[</span><span class=s>&#34;MPAARatings&#34;</span><span class=p>];</span>
</span></span><span class=line><span class=cl>        <span class=n>Movies</span> <span class=p>=</span> <span class=n>MovieDatabase</span><span class=p>.</span><span class=n>Search</span><span class=p>(</span><span class=n>SearchTerms</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=n>Movies</span> <span class=p>=</span> <span class=n>MovieDatabase</span><span class=p>.</span><span class=n>FilterByMPAARating</span><span class=p>(</span><span class=n>Movies</span><span class=p>,</span> <span class=n>MPAARatings</span><span class=p>);</span>        
</span></span><span class=line><span class=cl>    <span class=p>}</span></span></span></code></pre></div><p>Now we can run a search with filters applied. For example, searching for the word &ldquo;Love&rdquo; and movies that are PG or PG-13 yields:</p><p><a href=#R-image-60cc4115d9a440bd6484695513e5d07a class=lightbox-link><img alt="Filtered Search Results" class="border lazy lightbox noshadow figure-image" loading=lazy src=/cis400/images/6.8.4.png style=height:auto;width:auto></a>
<a href=javascript:history.back(); class=lightbox-back id=R-image-60cc4115d9a440bd6484695513e5d07a><img alt="Filtered Search Results" class="border lazy lightbox noshadow lightbox-image" loading=lazy src=/cis400/images/6.8.4.png></a></p><p>You might be wondering why <em>Cloverfield</em> is listed. But remember, we&rsquo;re searching by substring, and C <strong>LOVE</strong> rfield contains love!</p><h2 id=filtering-by-genre>Filtering by Genre</h2><p>Let&rsquo;s add filters for genre next. But what genres should be included? This is not as clear-cut as our MPAA rating, as there is no standards organization that says &ldquo;these are the only offical genres that exist.&rdquo; In fact, new genres emerge from time to time. So a better source of this info might just be to see what Genres are defined in our data, i.e.:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-csharp data-lang=csharp><span class=line><span class=cl>    <span class=n>HashSet</span><span class=p>&lt;</span><span class=kt>string</span><span class=p>&gt;</span> <span class=n>genres</span> <span class=p>=</span> <span class=k>new</span> <span class=n>HashSet</span><span class=p>&lt;</span><span class=kt>string</span><span class=p>&gt;();</span>
</span></span><span class=line><span class=cl>    <span class=k>foreach</span><span class=p>(</span><span class=n>Movie</span> <span class=n>movie</span> <span class=k>in</span> <span class=n>All</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span><span class=p>(</span><span class=n>movie</span><span class=p>.</span><span class=n>MajorGenre</span> <span class=p>!=</span> <span class=kc>null</span><span class=p>)</span> 
</span></span><span class=line><span class=cl>        <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=n>genres</span><span class=p>.</span><span class=n>Add</span><span class=p>(</span><span class=n>movie</span><span class=p>.</span><span class=n>MajorGenre</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span></span></span></code></pre></div><p>Here we use a <a href="https://docs.microsoft.com/en-us/dotnet/api/system.collections.generic.hashset-1?view=netframework-4.8" rel=external target=_blank>HashSet</a> instead of a list, as it only adds each unique item once. Duplicates are ignored.</p><p>But where would this code go? We could place it in a getter for <code>MovieDatabase.Genres</code>:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-csharp data-lang=csharp><span class=line><span class=cl>    <span class=kd>public</span> <span class=n>IEnumerable</span><span class=p>&lt;</span><span class=kt>string</span><span class=p>&gt;</span> <span class=n>Genres</span> 
</span></span><span class=line><span class=cl>    <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=k>get</span> 
</span></span><span class=line><span class=cl>        <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=n>HashSet</span><span class=p>&lt;</span><span class=kt>string</span><span class=p>&gt;</span> <span class=n>genres</span> <span class=p>=</span> <span class=k>new</span> <span class=n>HashSet</span><span class=p>&lt;</span><span class=kt>string</span><span class=p>&gt;();</span>
</span></span><span class=line><span class=cl>            <span class=k>foreach</span><span class=p>(</span><span class=n>Movie</span> <span class=n>movie</span> <span class=k>in</span> <span class=n>All</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>                <span class=k>if</span><span class=p>(</span><span class=n>movie</span><span class=p>.</span><span class=n>MajorGenre</span> <span class=p>!=</span> <span class=kc>null</span><span class=p>)</span> 
</span></span><span class=line><span class=cl>                <span class=p>{</span>
</span></span><span class=line><span class=cl>                    <span class=n>genres</span><span class=p>.</span><span class=n>Add</span><span class=p>(</span><span class=n>movie</span><span class=p>.</span><span class=n>MajorGenre</span><span class=p>);</span>
</span></span><span class=line><span class=cl>                <span class=p>}</span>
</span></span><span class=line><span class=cl>            <span class=p>}</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span></span></span></code></pre></div><p>But this means that every time we want to access it, we&rsquo;ll search through all the movies&mldr; This is an O(n) operation, and will make our website slower.</p><p>Instead, let&rsquo;s create a private static variable in the <code>MovieDatabase</code> class to <em>cache</em> this collection as an array of strings:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-csharp data-lang=csharp><span class=line><span class=cl>    <span class=c1>// The genres represented in the database</span>
</span></span><span class=line><span class=cl>    <span class=kd>private</span> <span class=kd>static</span> <span class=kt>string</span><span class=p>[]</span> <span class=n>_genres</span><span class=p>;</span></span></span></code></pre></div><p>And expose it with a public static property:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-csharp data-lang=csharp><span class=line><span class=cl>    <span class=cs>/// &lt;summary&gt;</span>
</span></span><span class=line><span class=cl>    <span class=cs>/// Gets the movie genres represented in the database </span>
</span></span><span class=line><span class=cl>    <span class=cs>/// &lt;/summary&gt;</span>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=kd>static</span> <span class=kt>string</span><span class=p>[]</span> <span class=n>Genres</span> <span class=p>=&gt;</span> <span class=n>_genres</span><span class=p>;</span></span></span></code></pre></div><p>And finally, we&rsquo;ll populate this array in the static constructor of <code>MovieDatabase</code>, after the JSON file has been processed:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-csharp data-lang=csharp><span class=line><span class=cl>    <span class=n>HashSet</span><span class=p>&lt;</span><span class=kt>string</span><span class=p>&gt;</span> <span class=n>genreSet</span> <span class=p>=</span> <span class=k>new</span> <span class=n>HashSet</span><span class=p>&lt;</span><span class=kt>string</span><span class=p>&gt;();</span>
</span></span><span class=line><span class=cl>    <span class=k>foreach</span><span class=p>(</span><span class=n>Movie</span> <span class=n>movie</span> <span class=k>in</span> <span class=n>_movies</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span><span class=p>(</span><span class=n>movie</span><span class=p>.</span><span class=n>MajorGenre</span> <span class=p>!=</span> <span class=kc>null</span><span class=p>)</span> 
</span></span><span class=line><span class=cl>        <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=n>genreSet</span><span class=p>.</span><span class=n>Add</span><span class=p>(</span><span class=n>movie</span><span class=p>.</span><span class=n>MajorGenre</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=n>_genres</span> <span class=p>=</span> <span class=n>genreSet</span><span class=p>.</span><span class=n>ToArray</span><span class=p>();</span></span></span></code></pre></div><p>This approach means the finding of genres only happens once, and getting the <code>Genre</code> property is a constant-time O(1) operation.</p><p>We can implement the filters for the genres in the same way as we did for the MPAA filters; I&rsquo;ll leave that as an exercise for the reader.</p><footer class=footline></footer></article><article class=default><header class=headline></header><h1 id=adding-categorical-filters-to-the-movie-site>Adding Categorical Filters to the Movie Site</h1><p>Let&rsquo;s add some filters to the page as well. We&rsquo;ll start with <em>categorical</em> filters, i.e. filtering by category. Let&rsquo;s start by filtering for MPAA Rating. We know that there are only a handful of ratings issued by the Motion Picture Association of America - G, PG, PG-13, R, and NC-17. We might be tempted to use an enumeration to represent these values, but in C# an enumeration cannot have strings for values. Nor can we use the hyphen (<code>-</code>) in an enumeration name.</p><h2 id=defining-the-mpaa-ratings>Defining the MPAA Ratings</h2><p>So let&rsquo;s define a string array with our MPAA values, and make it accessible from our <code>MovieDatabase</code> class:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-csharp data-lang=csharp><span class=line><span class=cl>    <span class=cs>/// &lt;summary&gt;</span>
</span></span><span class=line><span class=cl>    <span class=cs>/// Gets the possible MPAARatings</span>
</span></span><span class=line><span class=cl>    <span class=cs>/// &lt;/summary&gt;</span>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=kd>static</span> <span class=kt>string</span><span class=p>[]</span> <span class=n>MPAARatings</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=k>get</span> <span class=p>=&gt;</span> <span class=k>new</span> <span class=kt>string</span><span class=p>[]</span>
</span></span><span class=line><span class=cl>        <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=s>&#34;G&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=s>&#34;PG&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=s>&#34;PG-13&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=s>&#34;R&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=s>&#34;NC-17&#34;</span>
</span></span><span class=line><span class=cl>        <span class=p>};</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span></span></span></code></pre></div><p>Now in our <code>&lt;form></code> in <em>Index.cshtml</em> we can add a checkbox for each of these possible values:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-html data-lang=html><span class=line><span class=cl><span class=p>&lt;</span><span class=nt>form</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>   <span class=p>&lt;</span><span class=nt>input</span> <span class=na>type</span><span class=o>=</span><span class=s>&#34;text&#34;</span> <span class=na>name</span><span class=o>=</span><span class=s>&#34;SearchTerms&#34;</span> <span class=na>value</span><span class=o>=</span><span class=s>&#34;@Model.SearchTerms&#34;</span><span class=p>/&gt;</span>
</span></span><span class=line><span class=cl>    <span class=p>&lt;</span><span class=nt>input</span> <span class=na>type</span><span class=o>=</span><span class=s>&#34;submit&#34;</span> <span class=na>value</span><span class=o>=</span><span class=s>&#34;Search&#34;</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>    @foreach  (string rating in MovieDatabase.MPAARating) 
</span></span><span class=line><span class=cl>    {
</span></span><span class=line><span class=cl>        <span class=p>&lt;</span><span class=nt>label</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>            <span class=p>&lt;</span><span class=nt>input</span> <span class=na>type</span><span class=o>=</span><span class=s>&#34;checkbox&#34;</span> <span class=na>name</span><span class=o>=</span><span class=s>&#34;MPAARatings&#34;</span> <span class=na>value</span><span class=o>=</span><span class=s>&#34;@rating&#34;</span><span class=p>/&gt;</span>
</span></span><span class=line><span class=cl>            @rating
</span></span><span class=line><span class=cl>        <span class=p>&lt;/</span><span class=nt>label</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>    }
</span></span><span class=line><span class=cl><span class=p>&lt;/</span><span class=nt>form</span><span class=p>&gt;</span></span></span></code></pre></div><p>If you try running the project now, and check a few boxes, you&rsquo;ll see the query string results look something like:</p><div class=highlight><pre tabindex=0><code>?SearchTerms=&amp;MPAARatings=G&amp;MPAARatings=PG-13</code></pre></div><p>Notice how the key <em>MPAARatings</em> is repeated twice? What would that look like in our PageModel? We can find out; declare a <code>var</code> to hold the value in the <code>OnGet()</code> method of <em>Index.cshtml.cs</em>:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-csharp data-lang=csharp><span class=line><span class=cl>    <span class=kt>var</span> <span class=n>MPAARatings</span> <span class=p>=</span> <span class=n>Request</span><span class=p>.</span><span class=n>Query</span><span class=p>[</span><span class=s>&#34;MPAARatings&#34;</span><span class=p>];</span></span></span></code></pre></div><p>If we add a breakpoint on this line, and run our code, then check several boxes (you&rsquo;ll have to <em>continue</em> the first time you hit the breakpoint), then step over the line, we&rsquo;ll see that the var <code>MPAA</code> rating is set to a <em>string collection</em>. We could therefore store it in an array property in <em>Index.cshtml.cs</em>, much like we did with our <code>SearchTerms</code>:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-csharp data-lang=csharp><span class=line><span class=cl>    <span class=cs>/// &lt;summary&gt;</span>
</span></span><span class=line><span class=cl>    <span class=cs>/// The filtered MPAA Ratings</span>
</span></span><span class=line><span class=cl>    <span class=cs>/// &lt;/summary&gt;</span>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=kt>string</span><span class=p>[]</span> <span class=n>MPAARatings</span> <span class=p>{</span> <span class=k>get</span><span class=p>;</span> <span class=k>set</span><span class=p>;</span> <span class=p>}</span></span></span></code></pre></div><p>And we can refactor the line we just added to <code>OnGet()</code> to use this new property:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-csharp data-lang=csharp><span class=line><span class=cl>    <span class=n>MPAARatings</span> <span class=p>=</span> <span class=n>Request</span><span class=p>.</span><span class=n>Query</span><span class=p>[</span><span class=s>&#34;MPAARatings&#34;</span><span class=p>];</span></span></span></code></pre></div><p>Then, in our <em>Index.cshtml</em> Razor Page, we can refactor the checkbox to be checked if we filtered against this rating in our last request:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-html data-lang=html><span class=line><span class=cl>    <span class=p>&lt;</span><span class=nt>input</span> <span class=na>type</span><span class=o>=</span><span class=s>&#34;checkbox&#34;</span> <span class=na>name</span><span class=o>=</span><span class=s>&#34;MPAARatings&#34;</span> <span class=na>value</span><span class=o>=</span><span class=s>&#34;@rating&#34;</span> <span class=na>checked</span><span class=o>=</span><span class=s>&#34;@Model.MPAARatings.Contains(rating)&#34;</span><span class=p>/&gt;</span></span></span></code></pre></div><p>Now our filters stick around when we submit the search request. That just leaves making the filters actually <em>work</em>.</p><h2 id=applying-mpaa-rating-filters>Applying MPAA Rating Filters</h2><p>Let&rsquo;s add another method to our <code>MovieDatabase</code> class, <code>FilterByMPAARating()</code>:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-csharp data-lang=csharp><span class=line><span class=cl>    <span class=cs>/// &lt;summary&gt;</span>
</span></span><span class=line><span class=cl>    <span class=cs>/// Filters the provided collection of movies</span>
</span></span><span class=line><span class=cl>    <span class=cs>/// &lt;/summary&gt;</span>
</span></span><span class=line><span class=cl>    <span class=cs>/// &lt;param name=&#34;movies&#34;&gt;The collection of movies to filter&lt;/param&gt;</span>
</span></span><span class=line><span class=cl>    <span class=cs>/// &lt;param name=&#34;ratings&#34;&gt;The ratings to include&lt;/param&gt;</span>
</span></span><span class=line><span class=cl>    <span class=cs>/// &lt;returns&gt;A collection containing only movies that match the filter&lt;/returns&gt;</span>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=kd>static</span> <span class=n>IEnumerable</span><span class=p>&lt;</span><span class=n>Movie</span><span class=p>&gt;</span> <span class=n>FilterByMPAARating</span><span class=p>(</span><span class=n>IEnumerable</span><span class=p>&lt;</span><span class=n>Movie</span><span class=p>&gt;</span> <span class=n>movies</span><span class=p>,</span> <span class=n>IEnumerable</span><span class=p>&lt;</span><span class=kt>string</span><span class=p>&gt;</span> <span class=n>ratings</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=c1>// TODO: Filter the list</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=p>}</span></span></span></code></pre></div><p>Notice that in <em>this</em> method, we accept an <code>IEnumerable&lt;Movie></code> parameter. This is the list of movies we want to filter. We use this, instead of the <code>All()</code> we did in the <code>Search()</code> method, as we would want to filter the <em>results</em> of a search.</p><p>Let&rsquo;s do a null/empty check, and just return this shortlist if no filters are specified:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-csharp data-lang=csharp><span class=line><span class=cl>    <span class=c1>// If no filter is specified, just return the provided collection</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=p>(</span><span class=n>ratings</span> <span class=p>==</span> <span class=kc>null</span> <span class=p>||</span> <span class=n>ratings</span><span class=p>.</span><span class=n>Count</span><span class=p>()</span> <span class=p>==</span> <span class=m>0</span><span class=p>)</span> <span class=k>return</span> <span class=n>movies</span><span class=p>;</span></span></span></code></pre></div><p>Otherwise, we&rsquo;ll use the same process we did before. Start with an empty list of movies, and iterate over the collection seeing if any match. However, as we have <em>two</em> collections (the movies <em>and</em> the ratings), we&rsquo;ll see if the ratings collection contains the supplied movie&rsquo;s rating.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-csharp data-lang=csharp><span class=line><span class=cl>    <span class=c1>// Filter the supplied collection of movies</span>
</span></span><span class=line><span class=cl>    <span class=n>List</span><span class=p>&lt;</span><span class=n>Movie</span><span class=p>&gt;</span> <span class=n>results</span> <span class=p>=</span> <span class=k>new</span> <span class=n>List</span><span class=p>&lt;</span><span class=n>Movie</span><span class=p>&gt;();</span>
</span></span><span class=line><span class=cl>    <span class=k>foreach</span><span class=p>(</span><span class=n>Movie</span> <span class=n>movie</span> <span class=k>in</span> <span class=n>movies</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span><span class=p>(</span><span class=n>movie</span><span class=p>.</span><span class=n>MPAARating</span> <span class=p>!=</span> <span class=kc>null</span> <span class=p>&amp;&amp;</span> <span class=n>ratings</span><span class=p>.</span><span class=n>Contains</span><span class=p>(</span><span class=n>movie</span><span class=p>.</span><span class=n>MPAARating</span><span class=p>))</span>
</span></span><span class=line><span class=cl>        <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=n>results</span><span class=p>.</span><span class=n>Add</span><span class=p>(</span><span class=n>movie</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span></span></span></code></pre></div><p>Finally, we&rsquo;ll return our results:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-csharp data-lang=csharp><span class=line><span class=cl>    <span class=k>return</span> <span class=n>results</span><span class=p>;</span></span></span></code></pre></div><p>Now, back in our PageModel <em>Index.cshtml.cs</em>, we&rsquo;ll apply our filter to the results of our search. The refactored <code>OnGet()</code> should then be:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-csharp data-lang=csharp><span class=line><span class=cl>    <span class=kd>public</span> <span class=k>void</span> <span class=n>OnGet</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=n>SearchTerms</span> <span class=p>=</span> <span class=n>Request</span><span class=p>.</span><span class=n>Query</span><span class=p>[</span><span class=s>&#34;SearchTerms&#34;</span><span class=p>];</span>
</span></span><span class=line><span class=cl>        <span class=n>MPAARatings</span> <span class=p>=</span> <span class=n>Request</span><span class=p>.</span><span class=n>Query</span><span class=p>[</span><span class=s>&#34;MPAARatings&#34;</span><span class=p>];</span>
</span></span><span class=line><span class=cl>        <span class=n>Movies</span> <span class=p>=</span> <span class=n>MovieDatabase</span><span class=p>.</span><span class=n>Search</span><span class=p>(</span><span class=n>SearchTerms</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=n>Movies</span> <span class=p>=</span> <span class=n>MovieDatabase</span><span class=p>.</span><span class=n>FilterByMPAARating</span><span class=p>(</span><span class=n>Movies</span><span class=p>,</span> <span class=n>MPAARatings</span><span class=p>);</span>        
</span></span><span class=line><span class=cl>    <span class=p>}</span></span></span></code></pre></div><p>Now we can run a search with filters applied. For example, searching for the word &ldquo;Love&rdquo; and movies that are PG or PG-13 yields:</p><p><a href=#R-image-2e9106b1b2a57d26ce78a0297f8b7c39 class=lightbox-link><img alt="Filtered Search Results" class="border lazy lightbox noshadow figure-image" loading=lazy src=/cis400/images/6.8.4.png style=height:auto;width:auto></a>
<a href=javascript:history.back(); class=lightbox-back id=R-image-2e9106b1b2a57d26ce78a0297f8b7c39><img alt="Filtered Search Results" class="border lazy lightbox noshadow lightbox-image" loading=lazy src=/cis400/images/6.8.4.png></a></p><p>You might be wondering why <em>Cloverfield</em> is listed. But remember, we&rsquo;re searching by substring, and C <strong>LOVE</strong> rfield contains love!</p><h2 id=filtering-by-genre>Filtering by Genre</h2><p>Let&rsquo;s add filters for genre next. But what genres should be included? This is not as clear-cut as our MPAA rating, as there is no standards organization that says &ldquo;these are the only offical genres that exist.&rdquo; In fact, new genres emerge from time to time. So a better source of this info might just be to see what Genres are defined in our data, i.e.:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-csharp data-lang=csharp><span class=line><span class=cl>    <span class=n>HashSet</span><span class=p>&lt;</span><span class=kt>string</span><span class=p>&gt;</span> <span class=n>genres</span> <span class=p>=</span> <span class=k>new</span> <span class=n>HashSet</span><span class=p>&lt;</span><span class=kt>string</span><span class=p>&gt;();</span>
</span></span><span class=line><span class=cl>    <span class=k>foreach</span><span class=p>(</span><span class=n>Movie</span> <span class=n>movie</span> <span class=k>in</span> <span class=n>All</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span><span class=p>(</span><span class=n>movie</span><span class=p>.</span><span class=n>MajorGenre</span> <span class=p>!=</span> <span class=kc>null</span><span class=p>)</span> 
</span></span><span class=line><span class=cl>        <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=n>genres</span><span class=p>.</span><span class=n>Add</span><span class=p>(</span><span class=n>movie</span><span class=p>.</span><span class=n>MajorGenre</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span></span></span></code></pre></div><p>Here we use a <a href="https://docs.microsoft.com/en-us/dotnet/api/system.collections.generic.hashset-1?view=netframework-4.8" rel=external target=_blank>HashSet</a> instead of a list, as it only adds each unique item once. Duplicates are ignored.</p><p>But where would this code go? We could place it in a getter for <code>MovieDatabase.Genres</code>:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-csharp data-lang=csharp><span class=line><span class=cl>    <span class=kd>public</span> <span class=n>IEnumerable</span><span class=p>&lt;</span><span class=kt>string</span><span class=p>&gt;</span> <span class=n>Genres</span> 
</span></span><span class=line><span class=cl>    <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=k>get</span> 
</span></span><span class=line><span class=cl>        <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=n>HashSet</span><span class=p>&lt;</span><span class=kt>string</span><span class=p>&gt;</span> <span class=n>genres</span> <span class=p>=</span> <span class=k>new</span> <span class=n>HashSet</span><span class=p>&lt;</span><span class=kt>string</span><span class=p>&gt;();</span>
</span></span><span class=line><span class=cl>            <span class=k>foreach</span><span class=p>(</span><span class=n>Movie</span> <span class=n>movie</span> <span class=k>in</span> <span class=n>All</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>                <span class=k>if</span><span class=p>(</span><span class=n>movie</span><span class=p>.</span><span class=n>MajorGenre</span> <span class=p>!=</span> <span class=kc>null</span><span class=p>)</span> 
</span></span><span class=line><span class=cl>                <span class=p>{</span>
</span></span><span class=line><span class=cl>                    <span class=n>genres</span><span class=p>.</span><span class=n>Add</span><span class=p>(</span><span class=n>movie</span><span class=p>.</span><span class=n>MajorGenre</span><span class=p>);</span>
</span></span><span class=line><span class=cl>                <span class=p>}</span>
</span></span><span class=line><span class=cl>            <span class=p>}</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span></span></span></code></pre></div><p>But this means that every time we want to access it, we&rsquo;ll search through all the movies&mldr; This is an O(n) operation, and will make our website slower.</p><p>Instead, let&rsquo;s create a private static variable in the <code>MovieDatabase</code> class to <em>cache</em> this collection as an array of strings:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-csharp data-lang=csharp><span class=line><span class=cl>    <span class=c1>// The genres represented in the database</span>
</span></span><span class=line><span class=cl>    <span class=kd>private</span> <span class=kd>static</span> <span class=kt>string</span><span class=p>[]</span> <span class=n>_genres</span><span class=p>;</span></span></span></code></pre></div><p>And expose it with a public static property:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-csharp data-lang=csharp><span class=line><span class=cl>    <span class=cs>/// &lt;summary&gt;</span>
</span></span><span class=line><span class=cl>    <span class=cs>/// Gets the movie genres represented in the database </span>
</span></span><span class=line><span class=cl>    <span class=cs>/// &lt;/summary&gt;</span>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=kd>static</span> <span class=kt>string</span><span class=p>[]</span> <span class=n>Genres</span> <span class=p>=&gt;</span> <span class=n>_genres</span><span class=p>;</span></span></span></code></pre></div><p>And finally, we&rsquo;ll populate this array in the static constructor of <code>MovieDatabase</code>, after the JSON file has been processed:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-csharp data-lang=csharp><span class=line><span class=cl>    <span class=n>HashSet</span><span class=p>&lt;</span><span class=kt>string</span><span class=p>&gt;</span> <span class=n>genreSet</span> <span class=p>=</span> <span class=k>new</span> <span class=n>HashSet</span><span class=p>&lt;</span><span class=kt>string</span><span class=p>&gt;();</span>
</span></span><span class=line><span class=cl>    <span class=k>foreach</span><span class=p>(</span><span class=n>Movie</span> <span class=n>movie</span> <span class=k>in</span> <span class=n>_movies</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span><span class=p>(</span><span class=n>movie</span><span class=p>.</span><span class=n>MajorGenre</span> <span class=p>!=</span> <span class=kc>null</span><span class=p>)</span> 
</span></span><span class=line><span class=cl>        <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=n>genreSet</span><span class=p>.</span><span class=n>Add</span><span class=p>(</span><span class=n>movie</span><span class=p>.</span><span class=n>MajorGenre</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=n>_genres</span> <span class=p>=</span> <span class=n>genreSet</span><span class=p>.</span><span class=n>ToArray</span><span class=p>();</span></span></span></code></pre></div><p>This approach means the finding of genres only happens once, and getting the <code>Genre</code> property is a constant-time O(1) operation.</p><p>We can implement the filters for the genres in the same way as we did for the MPAA filters; I&rsquo;ll leave that as an exercise for the reader.</p><footer class=footline></footer></article><article class=default><header class=headline></header><h1 id=adding-categorical-filters-to-the-movie-site>Adding Categorical Filters to the Movie Site</h1><p>Let&rsquo;s add some filters to the page as well. We&rsquo;ll start with <em>categorical</em> filters, i.e. filtering by category. Let&rsquo;s start by filtering for MPAA Rating. We know that there are only a handful of ratings issued by the Motion Picture Association of America - G, PG, PG-13, R, and NC-17. We might be tempted to use an enumeration to represent these values, but in C# an enumeration cannot have strings for values. Nor can we use the hyphen (<code>-</code>) in an enumeration name.</p><h2 id=defining-the-mpaa-ratings>Defining the MPAA Ratings</h2><p>So let&rsquo;s define a string array with our MPAA values, and make it accessible from our <code>MovieDatabase</code> class:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-csharp data-lang=csharp><span class=line><span class=cl>    <span class=cs>/// &lt;summary&gt;</span>
</span></span><span class=line><span class=cl>    <span class=cs>/// Gets the possible MPAARatings</span>
</span></span><span class=line><span class=cl>    <span class=cs>/// &lt;/summary&gt;</span>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=kd>static</span> <span class=kt>string</span><span class=p>[]</span> <span class=n>MPAARatings</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=k>get</span> <span class=p>=&gt;</span> <span class=k>new</span> <span class=kt>string</span><span class=p>[]</span>
</span></span><span class=line><span class=cl>        <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=s>&#34;G&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=s>&#34;PG&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=s>&#34;PG-13&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=s>&#34;R&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=s>&#34;NC-17&#34;</span>
</span></span><span class=line><span class=cl>        <span class=p>};</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span></span></span></code></pre></div><p>Now in our <code>&lt;form></code> in <em>Index.cshtml</em> we can add a checkbox for each of these possible values:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-html data-lang=html><span class=line><span class=cl><span class=p>&lt;</span><span class=nt>form</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>   <span class=p>&lt;</span><span class=nt>input</span> <span class=na>type</span><span class=o>=</span><span class=s>&#34;text&#34;</span> <span class=na>name</span><span class=o>=</span><span class=s>&#34;SearchTerms&#34;</span> <span class=na>value</span><span class=o>=</span><span class=s>&#34;@Model.SearchTerms&#34;</span><span class=p>/&gt;</span>
</span></span><span class=line><span class=cl>    <span class=p>&lt;</span><span class=nt>input</span> <span class=na>type</span><span class=o>=</span><span class=s>&#34;submit&#34;</span> <span class=na>value</span><span class=o>=</span><span class=s>&#34;Search&#34;</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>    @foreach  (string rating in MovieDatabase.MPAARatings) 
</span></span><span class=line><span class=cl>    {
</span></span><span class=line><span class=cl>        <span class=p>&lt;</span><span class=nt>label</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>            <span class=p>&lt;</span><span class=nt>input</span> <span class=na>type</span><span class=o>=</span><span class=s>&#34;checkbox&#34;</span> <span class=na>name</span><span class=o>=</span><span class=s>&#34;MPAARatings&#34;</span> <span class=na>value</span><span class=o>=</span><span class=s>&#34;@rating&#34;</span><span class=p>/&gt;</span>
</span></span><span class=line><span class=cl>            @rating
</span></span><span class=line><span class=cl>        <span class=p>&lt;/</span><span class=nt>label</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>    }
</span></span><span class=line><span class=cl><span class=p>&lt;/</span><span class=nt>form</span><span class=p>&gt;</span></span></span></code></pre></div><p>If you try running the project now, and check a few boxes, you&rsquo;ll see the query string results look something like:</p><div class=highlight><pre tabindex=0><code>?SearchTerms=&amp;MPAARatings=G&amp;MPAARatings=PG-13</code></pre></div><p>Notice how the key <em>MPAARatings</em> is repeated twice? What would that look like in our PageModel? We can find out; declare a <code>var</code> to hold the value in the <code>OnGet()</code> method of <em>Index.cshtml.cs</em>:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-csharp data-lang=csharp><span class=line><span class=cl>    <span class=kt>var</span> <span class=n>MPAARatings</span> <span class=p>=</span> <span class=n>Request</span><span class=p>.</span><span class=n>Query</span><span class=p>[</span><span class=s>&#34;MPAARatings&#34;</span><span class=p>];</span></span></span></code></pre></div><p>If we add a breakpoint on this line, and run our code, then check several boxes (you&rsquo;ll have to <em>continue</em> the first time you hit the breakpoint), then step over the line, we&rsquo;ll see that the var <code>MPAA</code> rating is set to a <em>string collection</em>. We could therefore store it in an array property in <em>Index.cshtml.cs</em>, much like we did with our <code>SearchTerms</code>:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-csharp data-lang=csharp><span class=line><span class=cl>    <span class=cs>/// &lt;summary&gt;</span>
</span></span><span class=line><span class=cl>    <span class=cs>/// The filtered MPAA Ratings</span>
</span></span><span class=line><span class=cl>    <span class=cs>/// &lt;/summary&gt;</span>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=kt>string</span><span class=p>[]</span> <span class=n>MPAARatings</span> <span class=p>{</span> <span class=k>get</span><span class=p>;</span> <span class=k>set</span><span class=p>;</span> <span class=p>}</span></span></span></code></pre></div><p>And we can refactor the line we just added to <code>OnGet()</code> to use this new property:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-csharp data-lang=csharp><span class=line><span class=cl>    <span class=n>MPAARatings</span> <span class=p>=</span> <span class=n>Request</span><span class=p>.</span><span class=n>Query</span><span class=p>[</span><span class=s>&#34;MPAARatings&#34;</span><span class=p>];</span></span></span></code></pre></div><p>Then, in our <em>Index.cshtml</em> Razor Page, we can refactor the checkbox to be checked if we filtered against this rating in our last request:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-html data-lang=html><span class=line><span class=cl>    <span class=p>&lt;</span><span class=nt>input</span> <span class=na>type</span><span class=o>=</span><span class=s>&#34;checkbox&#34;</span> <span class=na>name</span><span class=o>=</span><span class=s>&#34;MPAARatings&#34;</span> <span class=na>value</span><span class=o>=</span><span class=s>&#34;@rating&#34;</span> <span class=na>checked</span><span class=o>=</span><span class=s>&#34;@Model.MPAARatings.Contains(rating)&#34;</span><span class=p>/&gt;</span></span></span></code></pre></div><p>Now our filters stick around when we submit the search request. That just leaves making the filters actually <em>work</em>.</p><h2 id=applying-mpaa-rating-filters>Applying MPAA Rating Filters</h2><p>Let&rsquo;s add another method to our <code>MovieDatabase</code> class, <code>FilterByMPAARating()</code>:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-csharp data-lang=csharp><span class=line><span class=cl>    <span class=cs>/// &lt;summary&gt;</span>
</span></span><span class=line><span class=cl>    <span class=cs>/// Filters the provided collection of movies</span>
</span></span><span class=line><span class=cl>    <span class=cs>/// &lt;/summary&gt;</span>
</span></span><span class=line><span class=cl>    <span class=cs>/// &lt;param name=&#34;movies&#34;&gt;The collection of movies to filter&lt;/param&gt;</span>
</span></span><span class=line><span class=cl>    <span class=cs>/// &lt;param name=&#34;ratings&#34;&gt;The ratings to include&lt;/param&gt;</span>
</span></span><span class=line><span class=cl>    <span class=cs>/// &lt;returns&gt;A collection containing only movies that match the filter&lt;/returns&gt;</span>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=kd>static</span> <span class=n>IEnumerable</span><span class=p>&lt;</span><span class=n>Movie</span><span class=p>&gt;</span> <span class=n>FilterByMPAARating</span><span class=p>(</span><span class=n>IEnumerable</span><span class=p>&lt;</span><span class=n>Movie</span><span class=p>&gt;</span> <span class=n>movies</span><span class=p>,</span> <span class=n>IEnumerable</span><span class=p>&lt;</span><span class=kt>string</span><span class=p>&gt;</span> <span class=n>ratings</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=c1>// TODO: Filter the list</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=p>}</span></span></span></code></pre></div><p>Notice that in <em>this</em> method, we accept an <code>IEnumerable&lt;Movie></code> parameter. This is the list of movies we want to filter. We use this, instead of the <code>All()</code> we did in the <code>Search()</code> method, as we would want to filter the <em>results</em> of a search.</p><p>Let&rsquo;s do a null/empty check, and just return this shortlist if no filters are specified:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-csharp data-lang=csharp><span class=line><span class=cl>    <span class=c1>// If no filter is specified, just return the provided collection</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=p>(</span><span class=n>ratings</span> <span class=p>==</span> <span class=kc>null</span> <span class=p>||</span> <span class=n>ratings</span><span class=p>.</span><span class=n>Count</span><span class=p>()</span> <span class=p>==</span> <span class=m>0</span><span class=p>)</span> <span class=k>return</span> <span class=n>movies</span><span class=p>;</span></span></span></code></pre></div><p>Otherwise, we&rsquo;ll use the same process we did before. Start with an empty list of movies, and iterate over the collection seeing if any match. However, as we have <em>two</em> collections (the movies <em>and</em> the ratings), we&rsquo;ll see if the ratings collection contains the supplied movie&rsquo;s rating.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-csharp data-lang=csharp><span class=line><span class=cl>    <span class=c1>// Filter the supplied collection of movies</span>
</span></span><span class=line><span class=cl>    <span class=n>List</span><span class=p>&lt;</span><span class=n>Movie</span><span class=p>&gt;</span> <span class=n>results</span> <span class=p>=</span> <span class=k>new</span> <span class=n>List</span><span class=p>&lt;</span><span class=n>Movie</span><span class=p>&gt;();</span>
</span></span><span class=line><span class=cl>    <span class=k>foreach</span><span class=p>(</span><span class=n>Movie</span> <span class=n>movie</span> <span class=k>in</span> <span class=n>movies</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span><span class=p>(</span><span class=n>movie</span><span class=p>.</span><span class=n>MPAARating</span> <span class=p>!=</span> <span class=kc>null</span> <span class=p>&amp;&amp;</span> <span class=n>ratings</span><span class=p>.</span><span class=n>Contains</span><span class=p>(</span><span class=n>movie</span><span class=p>.</span><span class=n>MPAARating</span><span class=p>))</span>
</span></span><span class=line><span class=cl>        <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=n>results</span><span class=p>.</span><span class=n>Add</span><span class=p>(</span><span class=n>movie</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span></span></span></code></pre></div><p>Finally, we&rsquo;ll return our results:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-csharp data-lang=csharp><span class=line><span class=cl>    <span class=k>return</span> <span class=n>results</span><span class=p>;</span></span></span></code></pre></div><p>Now, back in our PageModel <em>Index.cshtml.cs</em>, we&rsquo;ll apply our filter to the results of our search. The refactored <code>OnGet()</code> should then be:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-csharp data-lang=csharp><span class=line><span class=cl>    <span class=kd>public</span> <span class=k>void</span> <span class=n>OnGet</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=n>SearchTerms</span> <span class=p>=</span> <span class=n>Request</span><span class=p>.</span><span class=n>Query</span><span class=p>[</span><span class=s>&#34;SearchTerms&#34;</span><span class=p>];</span>
</span></span><span class=line><span class=cl>        <span class=n>MPAARatings</span> <span class=p>=</span> <span class=n>Request</span><span class=p>.</span><span class=n>Query</span><span class=p>[</span><span class=s>&#34;MPAARatings&#34;</span><span class=p>];</span>
</span></span><span class=line><span class=cl>        <span class=n>Movies</span> <span class=p>=</span> <span class=n>MovieDatabase</span><span class=p>.</span><span class=n>Search</span><span class=p>(</span><span class=n>SearchTerms</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=n>Movies</span> <span class=p>=</span> <span class=n>MovieDatabase</span><span class=p>.</span><span class=n>FilterByMPAARating</span><span class=p>(</span><span class=n>Movies</span><span class=p>,</span> <span class=n>MPAARatings</span><span class=p>);</span>        
</span></span><span class=line><span class=cl>    <span class=p>}</span></span></span></code></pre></div><p>Now we can run a search with filters applied. For example, searching for the word &ldquo;Love&rdquo; and movies that are PG or PG-13 yields:</p><p><a href=#R-image-290cbbd660c648564c950e6d293d37dd class=lightbox-link><img alt="Filtered Search Results" class="border lazy lightbox noshadow figure-image" loading=lazy src=/cis400/images/6.8.4.png style=height:auto;width:auto></a>
<a href=javascript:history.back(); class=lightbox-back id=R-image-290cbbd660c648564c950e6d293d37dd><img alt="Filtered Search Results" class="border lazy lightbox noshadow lightbox-image" loading=lazy src=/cis400/images/6.8.4.png></a></p><p>You might be wondering why <em>Cloverfield</em> is listed. But remember, we&rsquo;re searching by substring, and C <strong>LOVE</strong> rfield contains love!</p><h2 id=filtering-by-genre>Filtering by Genre</h2><p>Let&rsquo;s add filters for genre next. But what genres should be included? This is not as clear-cut as our MPAA rating, as there is no standards organization that says &ldquo;these are the only offical genres that exist.&rdquo; In fact, new genres emerge from time to time. So a better source of this info might just be to see what Genres are defined in our data, i.e.:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-csharp data-lang=csharp><span class=line><span class=cl>    <span class=n>HashSet</span><span class=p>&lt;</span><span class=kt>string</span><span class=p>&gt;</span> <span class=n>genres</span> <span class=p>=</span> <span class=k>new</span> <span class=n>HashSet</span><span class=p>&lt;</span><span class=kt>string</span><span class=p>&gt;();</span>
</span></span><span class=line><span class=cl>    <span class=k>foreach</span><span class=p>(</span><span class=n>Movie</span> <span class=n>movie</span> <span class=k>in</span> <span class=n>All</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span><span class=p>(</span><span class=n>movie</span><span class=p>.</span><span class=n>MajorGenre</span> <span class=p>!=</span> <span class=kc>null</span><span class=p>)</span> 
</span></span><span class=line><span class=cl>        <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=n>genres</span><span class=p>.</span><span class=n>Add</span><span class=p>(</span><span class=n>movie</span><span class=p>.</span><span class=n>MajorGenre</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span></span></span></code></pre></div><p>Here we use a <a href="https://docs.microsoft.com/en-us/dotnet/api/system.collections.generic.hashset-1?view=netframework-4.8" rel=external target=_blank>HashSet</a> instead of a list, as it only adds each unique item once. Duplicates are ignored.</p><p>But where would this code go? We could place it in a getter for <code>MovieDatabase.Genres</code>:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-csharp data-lang=csharp><span class=line><span class=cl>    <span class=kd>public</span> <span class=n>IEnumerable</span><span class=p>&lt;</span><span class=kt>string</span><span class=p>&gt;</span> <span class=n>Genres</span> 
</span></span><span class=line><span class=cl>    <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=k>get</span> 
</span></span><span class=line><span class=cl>        <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=n>HashSet</span><span class=p>&lt;</span><span class=kt>string</span><span class=p>&gt;</span> <span class=n>genres</span> <span class=p>=</span> <span class=k>new</span> <span class=n>HashSet</span><span class=p>&lt;</span><span class=kt>string</span><span class=p>&gt;();</span>
</span></span><span class=line><span class=cl>            <span class=k>foreach</span><span class=p>(</span><span class=n>Movie</span> <span class=n>movie</span> <span class=k>in</span> <span class=n>All</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>                <span class=k>if</span><span class=p>(</span><span class=n>movie</span><span class=p>.</span><span class=n>MajorGenre</span> <span class=p>!=</span> <span class=kc>null</span><span class=p>)</span> 
</span></span><span class=line><span class=cl>                <span class=p>{</span>
</span></span><span class=line><span class=cl>                    <span class=n>genres</span><span class=p>.</span><span class=n>Add</span><span class=p>(</span><span class=n>movie</span><span class=p>.</span><span class=n>MajorGenre</span><span class=p>);</span>
</span></span><span class=line><span class=cl>                <span class=p>}</span>
</span></span><span class=line><span class=cl>            <span class=p>}</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span></span></span></code></pre></div><p>But this means that every time we want to access it, we&rsquo;ll search through all the movies&mldr; This is an O(n) operation, and will make our website slower.</p><p>Instead, let&rsquo;s create a private static variable in the <code>MovieDatabase</code> class to <em>cache</em> this collection as an array of strings:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-csharp data-lang=csharp><span class=line><span class=cl>    <span class=c1>// The genres represented in the database</span>
</span></span><span class=line><span class=cl>    <span class=kd>private</span> <span class=kd>static</span> <span class=kt>string</span><span class=p>[]</span> <span class=n>_genres</span><span class=p>;</span></span></span></code></pre></div><p>And expose it with a public static property:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-csharp data-lang=csharp><span class=line><span class=cl>    <span class=cs>/// &lt;summary&gt;</span>
</span></span><span class=line><span class=cl>    <span class=cs>/// Gets the movie genres represented in the database </span>
</span></span><span class=line><span class=cl>    <span class=cs>/// &lt;/summary&gt;</span>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=kd>static</span> <span class=kt>string</span><span class=p>[]</span> <span class=n>Genres</span> <span class=p>=&gt;</span> <span class=n>_genres</span><span class=p>;</span></span></span></code></pre></div><p>And finally, we&rsquo;ll populate this array in the static constructor of <code>MovieDatabase</code>, after the JSON file has been processed:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-csharp data-lang=csharp><span class=line><span class=cl>    <span class=n>HashSet</span><span class=p>&lt;</span><span class=kt>string</span><span class=p>&gt;</span> <span class=n>genreSet</span> <span class=p>=</span> <span class=k>new</span> <span class=n>HashSet</span><span class=p>&lt;</span><span class=kt>string</span><span class=p>&gt;();</span>
</span></span><span class=line><span class=cl>    <span class=k>foreach</span><span class=p>(</span><span class=n>Movie</span> <span class=n>movie</span> <span class=k>in</span> <span class=n>_movies</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span><span class=p>(</span><span class=n>movie</span><span class=p>.</span><span class=n>MajorGenre</span> <span class=p>!=</span> <span class=kc>null</span><span class=p>)</span> 
</span></span><span class=line><span class=cl>        <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=n>genreSet</span><span class=p>.</span><span class=n>Add</span><span class=p>(</span><span class=n>movie</span><span class=p>.</span><span class=n>MajorGenre</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=n>_genres</span> <span class=p>=</span> <span class=n>genreSet</span><span class=p>.</span><span class=n>ToArray</span><span class=p>();</span></span></span></code></pre></div><p>This approach means the finding of genres only happens once, and getting the <code>Genre</code> property is a constant-time O(1) operation.</p><p>We can implement the filters for the genres in the same way as we did for the MPAA filters; I&rsquo;ll leave that as an exercise for the reader.</p><footer class=footline></footer></article><article class=default><header class=headline></header><h1 id=adding-categorical-filters-to-the-movie-site>Adding Categorical Filters to the Movie Site</h1><p>Let&rsquo;s add some filters to the page as well. We&rsquo;ll start with <em>categorical</em> filters, i.e. filtering by category. Let&rsquo;s start by filtering for MPAA Rating. We know that there are only a handful of ratings issued by the Motion Picture Association of America - G, PG, PG-13, R, and NC-17. We might be tempted to use an enumeration to represent these values, but in C# an enumeration cannot have strings for values. Nor can we use the hyphen (<code>-</code>) in an enumeration name.</p><h2 id=defining-the-mpaa-ratings>Defining the MPAA Ratings</h2><p>So let&rsquo;s define a string array with our MPAA values, and make it accessible from our <code>MovieDatabase</code> class:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-csharp data-lang=csharp><span class=line><span class=cl>    <span class=cs>/// &lt;summary&gt;</span>
</span></span><span class=line><span class=cl>    <span class=cs>/// Gets the possible MPAARatings</span>
</span></span><span class=line><span class=cl>    <span class=cs>/// &lt;/summary&gt;</span>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=kd>static</span> <span class=kt>string</span><span class=p>[]</span> <span class=n>MPAARatings</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=k>get</span> <span class=p>=&gt;</span> <span class=k>new</span> <span class=kt>string</span><span class=p>[]</span>
</span></span><span class=line><span class=cl>        <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=s>&#34;G&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=s>&#34;PG&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=s>&#34;PG-13&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=s>&#34;R&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=s>&#34;NC-17&#34;</span>
</span></span><span class=line><span class=cl>        <span class=p>};</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span></span></span></code></pre></div><p>Now in our <code>&lt;form></code> in <em>Index.cshtml</em> we can add a checkbox for each of these possible values:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-html data-lang=html><span class=line><span class=cl><span class=p>&lt;</span><span class=nt>form</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>   <span class=p>&lt;</span><span class=nt>input</span> <span class=na>type</span><span class=o>=</span><span class=s>&#34;text&#34;</span> <span class=na>name</span><span class=o>=</span><span class=s>&#34;SearchTerms&#34;</span> <span class=na>value</span><span class=o>=</span><span class=s>&#34;@Model.SearchTerms&#34;</span><span class=p>/&gt;</span>
</span></span><span class=line><span class=cl>    <span class=p>&lt;</span><span class=nt>input</span> <span class=na>type</span><span class=o>=</span><span class=s>&#34;submit&#34;</span> <span class=na>value</span><span class=o>=</span><span class=s>&#34;Search&#34;</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>    @foreach  (string rating in MovieDatabase.MPAARatings) 
</span></span><span class=line><span class=cl>    {
</span></span><span class=line><span class=cl>        <span class=p>&lt;</span><span class=nt>label</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>            <span class=p>&lt;</span><span class=nt>input</span> <span class=na>type</span><span class=o>=</span><span class=s>&#34;checkbox&#34;</span> <span class=na>name</span><span class=o>=</span><span class=s>&#34;MPAARatings&#34;</span> <span class=na>value</span><span class=o>=</span><span class=s>&#34;@rating&#34;</span><span class=p>/&gt;</span>
</span></span><span class=line><span class=cl>            @rating
</span></span><span class=line><span class=cl>        <span class=p>&lt;/</span><span class=nt>label</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>    }
</span></span><span class=line><span class=cl><span class=p>&lt;/</span><span class=nt>form</span><span class=p>&gt;</span></span></span></code></pre></div><p>If you try running the project now, and check a few boxes, you&rsquo;ll see the query string results look something like:</p><div class=highlight><pre tabindex=0><code>?SearchTerms=&amp;MPAARatings=G&amp;MPAARatings=PG-13</code></pre></div><p>Notice how the key <em>MPAARatings</em> is repeated twice? What would that look like in our PageModel? We can find out; declare a <code>var</code> to hold the value in the <code>OnGet()</code> method of <em>Index.cshtml.cs</em>:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-csharp data-lang=csharp><span class=line><span class=cl>    <span class=kt>var</span> <span class=n>MPAARatings</span> <span class=p>=</span> <span class=n>Request</span><span class=p>.</span><span class=n>Query</span><span class=p>[</span><span class=s>&#34;MPAARatings&#34;</span><span class=p>];</span></span></span></code></pre></div><p>If we add a breakpoint on this line, and run our code, then check several boxes (you&rsquo;ll have to <em>continue</em> the first time you hit the breakpoint), then step over the line, we&rsquo;ll see that the var <code>MPAA</code> rating is set to a <em>string collection</em>. We could therefore store it in an array property in <em>Index.cshtml.cs</em>, much like we did with our <code>SearchTerms</code>:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-csharp data-lang=csharp><span class=line><span class=cl>    <span class=cs>/// &lt;summary&gt;</span>
</span></span><span class=line><span class=cl>    <span class=cs>/// The filtered MPAA Ratings</span>
</span></span><span class=line><span class=cl>    <span class=cs>/// &lt;/summary&gt;</span>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=kt>string</span><span class=p>[]</span> <span class=n>MPAARatings</span> <span class=p>{</span> <span class=k>get</span><span class=p>;</span> <span class=k>set</span><span class=p>;</span> <span class=p>}</span></span></span></code></pre></div><p>And we can refactor the line we just added to <code>OnGet()</code> to use this new property:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-csharp data-lang=csharp><span class=line><span class=cl>    <span class=n>MPAARatings</span> <span class=p>=</span> <span class=n>Request</span><span class=p>.</span><span class=n>Query</span><span class=p>[</span><span class=s>&#34;MPAARatings&#34;</span><span class=p>];</span></span></span></code></pre></div><p>Then, in our <em>Index.cshtml</em> Razor Page, we can refactor the checkbox to be checked if we filtered against this rating in our last request:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-html data-lang=html><span class=line><span class=cl>    <span class=p>&lt;</span><span class=nt>input</span> <span class=na>type</span><span class=o>=</span><span class=s>&#34;checkbox&#34;</span> <span class=na>name</span><span class=o>=</span><span class=s>&#34;MPAARatings&#34;</span> <span class=na>value</span><span class=o>=</span><span class=s>&#34;@rating&#34;</span> <span class=na>checked</span><span class=o>=</span><span class=s>&#34;@Model.MPAARatings.Contains(rating)&#34;</span><span class=p>/&gt;</span></span></span></code></pre></div><p>Now our filters stick around when we submit the search request. That just leaves making the filters actually <em>work</em>.</p><h2 id=applying-mpaa-rating-filters>Applying MPAA Rating Filters</h2><p>Let&rsquo;s add another method to our <code>MovieDatabase</code> class, <code>FilterByMPAARating()</code>:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-csharp data-lang=csharp><span class=line><span class=cl>    <span class=cs>/// &lt;summary&gt;</span>
</span></span><span class=line><span class=cl>    <span class=cs>/// Filters the provided collection of movies</span>
</span></span><span class=line><span class=cl>    <span class=cs>/// &lt;/summary&gt;</span>
</span></span><span class=line><span class=cl>    <span class=cs>/// &lt;param name=&#34;movies&#34;&gt;The collection of movies to filter&lt;/param&gt;</span>
</span></span><span class=line><span class=cl>    <span class=cs>/// &lt;param name=&#34;ratings&#34;&gt;The ratings to include&lt;/param&gt;</span>
</span></span><span class=line><span class=cl>    <span class=cs>/// &lt;returns&gt;A collection containing only movies that match the filter&lt;/returns&gt;</span>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=kd>static</span> <span class=n>IEnumerable</span><span class=p>&lt;</span><span class=n>Movie</span><span class=p>&gt;</span> <span class=n>FilterByMPAARating</span><span class=p>(</span><span class=n>IEnumerable</span><span class=p>&lt;</span><span class=n>Movie</span><span class=p>&gt;</span> <span class=n>movies</span><span class=p>,</span> <span class=n>IEnumerable</span><span class=p>&lt;</span><span class=kt>string</span><span class=p>&gt;</span> <span class=n>ratings</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=c1>// TODO: Filter the list</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=p>}</span></span></span></code></pre></div><p>Notice that in <em>this</em> method, we accept an <code>IEnumerable&lt;Movie></code> parameter. This is the list of movies we want to filter. We use this, instead of the <code>All()</code> we did in the <code>Search()</code> method, as we would want to filter the <em>results</em> of a search.</p><p>Let&rsquo;s do a null/empty check, and just return this shortlist if no filters are specified:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-csharp data-lang=csharp><span class=line><span class=cl>    <span class=c1>// If no filter is specified, just return the provided collection</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=p>(</span><span class=n>ratings</span> <span class=p>==</span> <span class=kc>null</span> <span class=p>||</span> <span class=n>ratings</span><span class=p>.</span><span class=n>Count</span><span class=p>()</span> <span class=p>==</span> <span class=m>0</span><span class=p>)</span> <span class=k>return</span> <span class=n>movies</span><span class=p>;</span></span></span></code></pre></div><p>Otherwise, we&rsquo;ll use the same process we did before. Start with an empty list of movies, and iterate over the collection seeing if any match. However, as we have <em>two</em> collections (the movies <em>and</em> the ratings), we&rsquo;ll see if the ratings collection contains the supplied movie&rsquo;s rating.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-csharp data-lang=csharp><span class=line><span class=cl>    <span class=c1>// Filter the supplied collection of movies</span>
</span></span><span class=line><span class=cl>    <span class=n>List</span><span class=p>&lt;</span><span class=n>Movie</span><span class=p>&gt;</span> <span class=n>results</span> <span class=p>=</span> <span class=k>new</span> <span class=n>List</span><span class=p>&lt;</span><span class=n>Movie</span><span class=p>&gt;();</span>
</span></span><span class=line><span class=cl>    <span class=k>foreach</span><span class=p>(</span><span class=n>Movie</span> <span class=n>movie</span> <span class=k>in</span> <span class=n>movies</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span><span class=p>(</span><span class=n>movie</span><span class=p>.</span><span class=n>MPAARating</span> <span class=p>!=</span> <span class=kc>null</span> <span class=p>&amp;&amp;</span> <span class=n>ratings</span><span class=p>.</span><span class=n>Contains</span><span class=p>(</span><span class=n>movie</span><span class=p>.</span><span class=n>MPAARating</span><span class=p>))</span>
</span></span><span class=line><span class=cl>        <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=n>results</span><span class=p>.</span><span class=n>Add</span><span class=p>(</span><span class=n>movie</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span></span></span></code></pre></div><p>Finally, we&rsquo;ll return our results:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-csharp data-lang=csharp><span class=line><span class=cl>    <span class=k>return</span> <span class=n>results</span><span class=p>;</span></span></span></code></pre></div><p>Now, back in our PageModel <em>Index.cshtml.cs</em>, we&rsquo;ll apply our filter to the results of our search. The refactored <code>OnGet()</code> should then be:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-csharp data-lang=csharp><span class=line><span class=cl>    <span class=kd>public</span> <span class=k>void</span> <span class=n>OnGet</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=n>SearchTerms</span> <span class=p>=</span> <span class=n>Request</span><span class=p>.</span><span class=n>Query</span><span class=p>[</span><span class=s>&#34;SearchTerms&#34;</span><span class=p>];</span>
</span></span><span class=line><span class=cl>        <span class=n>MPAARatings</span> <span class=p>=</span> <span class=n>Request</span><span class=p>.</span><span class=n>Query</span><span class=p>[</span><span class=s>&#34;MPAARatings&#34;</span><span class=p>];</span>
</span></span><span class=line><span class=cl>        <span class=n>Movies</span> <span class=p>=</span> <span class=n>MovieDatabase</span><span class=p>.</span><span class=n>Search</span><span class=p>(</span><span class=n>SearchTerms</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=n>Movies</span> <span class=p>=</span> <span class=n>MovieDatabase</span><span class=p>.</span><span class=n>FilterByMPAARating</span><span class=p>(</span><span class=n>Movies</span><span class=p>,</span> <span class=n>MPAARatings</span><span class=p>);</span>        
</span></span><span class=line><span class=cl>    <span class=p>}</span></span></span></code></pre></div><p>Now we can run a search with filters applied. For example, searching for the word &ldquo;Love&rdquo; and movies that are PG or PG-13 yields:</p><p><a href=#R-image-429d6b861ab66ee93b5fb262001f1bab class=lightbox-link><img alt="Filtered Search Results" class="border lazy lightbox noshadow figure-image" loading=lazy src=/cis400/images/6.8.4.png style=height:auto;width:auto></a>
<a href=javascript:history.back(); class=lightbox-back id=R-image-429d6b861ab66ee93b5fb262001f1bab><img alt="Filtered Search Results" class="border lazy lightbox noshadow lightbox-image" loading=lazy src=/cis400/images/6.8.4.png></a></p><p>You might be wondering why <em>Cloverfield</em> is listed. But remember, we&rsquo;re searching by substring, and C <strong>LOVE</strong> rfield contains love!</p><h2 id=filtering-by-genre>Filtering by Genre</h2><p>Let&rsquo;s add filters for genre next. But what genres should be included? This is not as clear-cut as our MPAA rating, as there is no standards organization that says &ldquo;these are the only offical genres that exist.&rdquo; In fact, new genres emerge from time to time. So a better source of this info might just be to see what Genres are defined in our data, i.e.:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-csharp data-lang=csharp><span class=line><span class=cl>    <span class=n>HashSet</span><span class=p>&lt;</span><span class=kt>string</span><span class=p>&gt;</span> <span class=n>genres</span> <span class=p>=</span> <span class=k>new</span> <span class=n>HashSet</span><span class=p>&lt;</span><span class=kt>string</span><span class=p>&gt;();</span>
</span></span><span class=line><span class=cl>    <span class=k>foreach</span><span class=p>(</span><span class=n>Movie</span> <span class=n>movie</span> <span class=k>in</span> <span class=n>All</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span><span class=p>(</span><span class=n>movie</span><span class=p>.</span><span class=n>MajorGenre</span> <span class=p>!=</span> <span class=kc>null</span><span class=p>)</span> 
</span></span><span class=line><span class=cl>        <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=n>genres</span><span class=p>.</span><span class=n>Add</span><span class=p>(</span><span class=n>movie</span><span class=p>.</span><span class=n>MajorGenre</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span></span></span></code></pre></div><p>Here we use a <a href="https://docs.microsoft.com/en-us/dotnet/api/system.collections.generic.hashset-1?view=netframework-4.8" rel=external target=_blank>HashSet</a> instead of a list, as it only adds each unique item once. Duplicates are ignored.</p><p>But where would this code go? We could place it in a getter for <code>MovieDatabase.Genres</code>:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-csharp data-lang=csharp><span class=line><span class=cl>    <span class=kd>public</span> <span class=n>IEnumerable</span><span class=p>&lt;</span><span class=kt>string</span><span class=p>&gt;</span> <span class=n>Genres</span> 
</span></span><span class=line><span class=cl>    <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=k>get</span> 
</span></span><span class=line><span class=cl>        <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=n>HashSet</span><span class=p>&lt;</span><span class=kt>string</span><span class=p>&gt;</span> <span class=n>genres</span> <span class=p>=</span> <span class=k>new</span> <span class=n>HashSet</span><span class=p>&lt;</span><span class=kt>string</span><span class=p>&gt;();</span>
</span></span><span class=line><span class=cl>            <span class=k>foreach</span><span class=p>(</span><span class=n>Movie</span> <span class=n>movie</span> <span class=k>in</span> <span class=n>All</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>                <span class=k>if</span><span class=p>(</span><span class=n>movie</span><span class=p>.</span><span class=n>MajorGenre</span> <span class=p>!=</span> <span class=kc>null</span><span class=p>)</span> 
</span></span><span class=line><span class=cl>                <span class=p>{</span>
</span></span><span class=line><span class=cl>                    <span class=n>genres</span><span class=p>.</span><span class=n>Add</span><span class=p>(</span><span class=n>movie</span><span class=p>.</span><span class=n>MajorGenre</span><span class=p>);</span>
</span></span><span class=line><span class=cl>                <span class=p>}</span>
</span></span><span class=line><span class=cl>            <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>            <span class=k>return</span> <span class=n>genres</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span></span></span></code></pre></div><p>But this means that every time we want to access it, we&rsquo;ll search through all the movies&mldr; This is an O(n) operation, and will make our website slower.</p><p>Instead, let&rsquo;s create a private static variable in the <code>MovieDatabase</code> class to <em>cache</em> this collection as an array of strings:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-csharp data-lang=csharp><span class=line><span class=cl>    <span class=c1>// The genres represented in the database</span>
</span></span><span class=line><span class=cl>    <span class=kd>private</span> <span class=kd>static</span> <span class=kt>string</span><span class=p>[]</span> <span class=n>_genres</span><span class=p>;</span></span></span></code></pre></div><p>And expose it with a public static property:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-csharp data-lang=csharp><span class=line><span class=cl>    <span class=cs>/// &lt;summary&gt;</span>
</span></span><span class=line><span class=cl>    <span class=cs>/// Gets the movie genres represented in the database </span>
</span></span><span class=line><span class=cl>    <span class=cs>/// &lt;/summary&gt;</span>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=kd>static</span> <span class=kt>string</span><span class=p>[]</span> <span class=n>Genres</span> <span class=p>=&gt;</span> <span class=n>_genres</span><span class=p>;</span></span></span></code></pre></div><p>And finally, we&rsquo;ll populate this array in the static constructor of <code>MovieDatabase</code>, after the JSON file has been processed:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-csharp data-lang=csharp><span class=line><span class=cl>    <span class=n>HashSet</span><span class=p>&lt;</span><span class=kt>string</span><span class=p>&gt;</span> <span class=n>genreSet</span> <span class=p>=</span> <span class=k>new</span> <span class=n>HashSet</span><span class=p>&lt;</span><span class=kt>string</span><span class=p>&gt;();</span>
</span></span><span class=line><span class=cl>    <span class=k>foreach</span><span class=p>(</span><span class=n>Movie</span> <span class=n>movie</span> <span class=k>in</span> <span class=n>_movies</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span><span class=p>(</span><span class=n>movie</span><span class=p>.</span><span class=n>MajorGenre</span> <span class=p>!=</span> <span class=kc>null</span><span class=p>)</span> 
</span></span><span class=line><span class=cl>        <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=n>genreSet</span><span class=p>.</span><span class=n>Add</span><span class=p>(</span><span class=n>movie</span><span class=p>.</span><span class=n>MajorGenre</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=n>_genres</span> <span class=p>=</span> <span class=n>genreSet</span><span class=p>.</span><span class=n>ToArray</span><span class=p>();</span></span></span></code></pre></div><p>This approach means the finding of genres only happens once, and getting the <code>Genre</code> property is a constant-time O(1) operation.</p><p>We can implement the filters for the genres in the same way as we did for the MPAA filters; I&rsquo;ll leave that as an exercise for the reader.</p><footer class=footline></footer></article><article class=default><header class=headline></header><h1 id=adding-categorical-filters-to-the-movie-site>Adding Categorical Filters to the Movie Site</h1><p>Let&rsquo;s add some filters to the page as well. We&rsquo;ll start with <em>categorical</em> filters, i.e. filtering by category. Let&rsquo;s start by filtering for MPAA Rating. We know that there are only a handful of ratings issued by the Motion Picture Association of America - G, PG, PG-13, R, and NC-17. We might be tempted to use an enumeration to represent these values, but in C# an enumeration cannot have strings for values. Nor can we use the hyphen (<code>-</code>) in an enumeration name.</p><h2 id=defining-the-mpaa-ratings>Defining the MPAA Ratings</h2><p>So let&rsquo;s define a string array with our MPAA values, and make it accessible from our <code>MovieDatabase</code> class:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-csharp data-lang=csharp><span class=line><span class=cl>    <span class=cs>/// &lt;summary&gt;</span>
</span></span><span class=line><span class=cl>    <span class=cs>/// Gets the possible MPAARatings</span>
</span></span><span class=line><span class=cl>    <span class=cs>/// &lt;/summary&gt;</span>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=kd>static</span> <span class=kt>string</span><span class=p>[]</span> <span class=n>MPAARatings</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=k>get</span> <span class=p>=&gt;</span> <span class=k>new</span> <span class=kt>string</span><span class=p>[]</span>
</span></span><span class=line><span class=cl>        <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=s>&#34;G&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=s>&#34;PG&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=s>&#34;PG-13&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=s>&#34;R&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=s>&#34;NC-17&#34;</span>
</span></span><span class=line><span class=cl>        <span class=p>};</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span></span></span></code></pre></div><p>Now in our <code>&lt;form></code> in <em>Index.cshtml</em> we can add a checkbox for each of these possible values:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-html data-lang=html><span class=line><span class=cl><span class=p>&lt;</span><span class=nt>form</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>   <span class=p>&lt;</span><span class=nt>input</span> <span class=na>type</span><span class=o>=</span><span class=s>&#34;text&#34;</span> <span class=na>name</span><span class=o>=</span><span class=s>&#34;SearchTerms&#34;</span> <span class=na>value</span><span class=o>=</span><span class=s>&#34;@Model.SearchTerms&#34;</span><span class=p>/&gt;</span>
</span></span><span class=line><span class=cl>    <span class=p>&lt;</span><span class=nt>input</span> <span class=na>type</span><span class=o>=</span><span class=s>&#34;submit&#34;</span> <span class=na>value</span><span class=o>=</span><span class=s>&#34;Search&#34;</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>    @foreach  (string rating in MovieDatabase.MPAARatings) 
</span></span><span class=line><span class=cl>    {
</span></span><span class=line><span class=cl>        <span class=p>&lt;</span><span class=nt>label</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>            <span class=p>&lt;</span><span class=nt>input</span> <span class=na>type</span><span class=o>=</span><span class=s>&#34;checkbox&#34;</span> <span class=na>name</span><span class=o>=</span><span class=s>&#34;MPAARatings&#34;</span> <span class=na>value</span><span class=o>=</span><span class=s>&#34;@rating&#34;</span><span class=p>/&gt;</span>
</span></span><span class=line><span class=cl>            @rating
</span></span><span class=line><span class=cl>        <span class=p>&lt;/</span><span class=nt>label</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>    }
</span></span><span class=line><span class=cl><span class=p>&lt;/</span><span class=nt>form</span><span class=p>&gt;</span></span></span></code></pre></div><p>If you try running the project now, and check a few boxes, you&rsquo;ll see the query string results look something like:</p><div class=highlight><pre tabindex=0><code>?SearchTerms=&amp;MPAARatings=G&amp;MPAARatings=PG-13</code></pre></div><p>Notice how the key <em>MPAARatings</em> is repeated twice? What would that look like in our PageModel? We can find out; declare a <code>var</code> to hold the value in the <code>OnGet()</code> method of <em>Index.cshtml.cs</em>:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-csharp data-lang=csharp><span class=line><span class=cl>    <span class=kt>var</span> <span class=n>MPAARatings</span> <span class=p>=</span> <span class=n>Request</span><span class=p>.</span><span class=n>Query</span><span class=p>[</span><span class=s>&#34;MPAARatings&#34;</span><span class=p>];</span></span></span></code></pre></div><p>If we add a breakpoint on this line, and run our code, then check several boxes (you&rsquo;ll have to <em>continue</em> the first time you hit the breakpoint), then step over the line, we&rsquo;ll see that the var <code>MPAA</code> rating is set to a <em>string collection</em>. We could therefore store it in an array property in <em>Index.cshtml.cs</em>, much like we did with our <code>SearchTerms</code>:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-csharp data-lang=csharp><span class=line><span class=cl>    <span class=cs>/// &lt;summary&gt;</span>
</span></span><span class=line><span class=cl>    <span class=cs>/// The filtered MPAA Ratings</span>
</span></span><span class=line><span class=cl>    <span class=cs>/// &lt;/summary&gt;</span>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=kt>string</span><span class=p>[]</span> <span class=n>MPAARatings</span> <span class=p>{</span> <span class=k>get</span><span class=p>;</span> <span class=k>set</span><span class=p>;</span> <span class=p>}</span></span></span></code></pre></div><p>And we can refactor the line we just added to <code>OnGet()</code> to use this new property:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-csharp data-lang=csharp><span class=line><span class=cl>    <span class=n>MPAARatings</span> <span class=p>=</span> <span class=n>Request</span><span class=p>.</span><span class=n>Query</span><span class=p>[</span><span class=s>&#34;MPAARatings&#34;</span><span class=p>];</span></span></span></code></pre></div><p>Then, in our <em>Index.cshtml</em> Razor Page, we can refactor the checkbox to be checked if we filtered against this rating in our last request:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-html data-lang=html><span class=line><span class=cl>    <span class=p>&lt;</span><span class=nt>input</span> <span class=na>type</span><span class=o>=</span><span class=s>&#34;checkbox&#34;</span> <span class=na>name</span><span class=o>=</span><span class=s>&#34;MPAARatings&#34;</span> <span class=na>value</span><span class=o>=</span><span class=s>&#34;@rating&#34;</span> <span class=na>checked</span><span class=o>=</span><span class=s>&#34;@Model.MPAARatings.Contains(rating)&#34;</span><span class=p>/&gt;</span></span></span></code></pre></div><p>Now our filters stick around when we submit the search request. That just leaves making the filters actually <em>work</em>.</p><h2 id=applying-mpaa-rating-filters>Applying MPAA Rating Filters</h2><p>Let&rsquo;s add another method to our <code>MovieDatabase</code> class, <code>FilterByMPAARating()</code>:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-csharp data-lang=csharp><span class=line><span class=cl>    <span class=cs>/// &lt;summary&gt;</span>
</span></span><span class=line><span class=cl>    <span class=cs>/// Filters the provided collection of movies</span>
</span></span><span class=line><span class=cl>    <span class=cs>/// &lt;/summary&gt;</span>
</span></span><span class=line><span class=cl>    <span class=cs>/// &lt;param name=&#34;movies&#34;&gt;The collection of movies to filter&lt;/param&gt;</span>
</span></span><span class=line><span class=cl>    <span class=cs>/// &lt;param name=&#34;ratings&#34;&gt;The ratings to include&lt;/param&gt;</span>
</span></span><span class=line><span class=cl>    <span class=cs>/// &lt;returns&gt;A collection containing only movies that match the filter&lt;/returns&gt;</span>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=kd>static</span> <span class=n>IEnumerable</span><span class=p>&lt;</span><span class=n>Movie</span><span class=p>&gt;</span> <span class=n>FilterByMPAARating</span><span class=p>(</span><span class=n>IEnumerable</span><span class=p>&lt;</span><span class=n>Movie</span><span class=p>&gt;</span> <span class=n>movies</span><span class=p>,</span> <span class=n>IEnumerable</span><span class=p>&lt;</span><span class=kt>string</span><span class=p>&gt;</span> <span class=n>ratings</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=c1>// TODO: Filter the list</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=p>}</span></span></span></code></pre></div><p>Notice that in <em>this</em> method, we accept an <code>IEnumerable&lt;Movie></code> parameter. This is the list of movies we want to filter. We use this, instead of the <code>All()</code> we did in the <code>Search()</code> method, as we would want to filter the <em>results</em> of a search.</p><p>Let&rsquo;s do a null/empty check, and just return this shortlist if no filters are specified:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-csharp data-lang=csharp><span class=line><span class=cl>    <span class=c1>// If no filter is specified, just return the provided collection</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=p>(</span><span class=n>ratings</span> <span class=p>==</span> <span class=kc>null</span> <span class=p>||</span> <span class=n>ratings</span><span class=p>.</span><span class=n>Count</span><span class=p>()</span> <span class=p>==</span> <span class=m>0</span><span class=p>)</span> <span class=k>return</span> <span class=n>movies</span><span class=p>;</span></span></span></code></pre></div><p>Otherwise, we&rsquo;ll use the same process we did before. Start with an empty list of movies, and iterate over the collection seeing if any match. However, as we have <em>two</em> collections (the movies <em>and</em> the ratings), we&rsquo;ll see if the ratings collection contains the supplied movie&rsquo;s rating.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-csharp data-lang=csharp><span class=line><span class=cl>    <span class=c1>// Filter the supplied collection of movies</span>
</span></span><span class=line><span class=cl>    <span class=n>List</span><span class=p>&lt;</span><span class=n>Movie</span><span class=p>&gt;</span> <span class=n>results</span> <span class=p>=</span> <span class=k>new</span> <span class=n>List</span><span class=p>&lt;</span><span class=n>Movie</span><span class=p>&gt;();</span>
</span></span><span class=line><span class=cl>    <span class=k>foreach</span><span class=p>(</span><span class=n>Movie</span> <span class=n>movie</span> <span class=k>in</span> <span class=n>movies</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span><span class=p>(</span><span class=n>movie</span><span class=p>.</span><span class=n>MPAARating</span> <span class=p>!=</span> <span class=kc>null</span> <span class=p>&amp;&amp;</span> <span class=n>ratings</span><span class=p>.</span><span class=n>Contains</span><span class=p>(</span><span class=n>movie</span><span class=p>.</span><span class=n>MPAARating</span><span class=p>))</span>
</span></span><span class=line><span class=cl>        <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=n>results</span><span class=p>.</span><span class=n>Add</span><span class=p>(</span><span class=n>movie</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span></span></span></code></pre></div><p>Finally, we&rsquo;ll return our results:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-csharp data-lang=csharp><span class=line><span class=cl>    <span class=k>return</span> <span class=n>results</span><span class=p>;</span></span></span></code></pre></div><p>Now, back in our PageModel <em>Index.cshtml.cs</em>, we&rsquo;ll apply our filter to the results of our search. The refactored <code>OnGet()</code> should then be:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-csharp data-lang=csharp><span class=line><span class=cl>    <span class=kd>public</span> <span class=k>void</span> <span class=n>OnGet</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=n>SearchTerms</span> <span class=p>=</span> <span class=n>Request</span><span class=p>.</span><span class=n>Query</span><span class=p>[</span><span class=s>&#34;SearchTerms&#34;</span><span class=p>];</span>
</span></span><span class=line><span class=cl>        <span class=n>MPAARatings</span> <span class=p>=</span> <span class=n>Request</span><span class=p>.</span><span class=n>Query</span><span class=p>[</span><span class=s>&#34;MPAARatings&#34;</span><span class=p>];</span>
</span></span><span class=line><span class=cl>        <span class=n>Movies</span> <span class=p>=</span> <span class=n>MovieDatabase</span><span class=p>.</span><span class=n>Search</span><span class=p>(</span><span class=n>SearchTerms</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=n>Movies</span> <span class=p>=</span> <span class=n>MovieDatabase</span><span class=p>.</span><span class=n>FilterByMPAARating</span><span class=p>(</span><span class=n>Movies</span><span class=p>,</span> <span class=n>MPAARatings</span><span class=p>);</span>        
</span></span><span class=line><span class=cl>    <span class=p>}</span></span></span></code></pre></div><p>Now we can run a search with filters applied. For example, searching for the word &ldquo;Love&rdquo; and movies that are PG or PG-13 yields:</p><p><a href=#R-image-6180fc1d0ad641c9a52546fa0b8f2428 class=lightbox-link><img alt="Filtered Search Results" class="border lazy lightbox noshadow figure-image" loading=lazy src=/cis400/images/6.8.4.png style=height:auto;width:auto></a>
<a href=javascript:history.back(); class=lightbox-back id=R-image-6180fc1d0ad641c9a52546fa0b8f2428><img alt="Filtered Search Results" class="border lazy lightbox noshadow lightbox-image" loading=lazy src=/cis400/images/6.8.4.png></a></p><p>You might be wondering why <em>Cloverfield</em> is listed. But remember, we&rsquo;re searching by substring, and C <strong>LOVE</strong> rfield contains love!</p><h2 id=filtering-by-genre>Filtering by Genre</h2><p>Let&rsquo;s add filters for genre next. But what genres should be included? This is not as clear-cut as our MPAA rating, as there is no standards organization that says &ldquo;these are the only offical genres that exist.&rdquo; In fact, new genres emerge from time to time. So a better source of this info might just be to see what Genres are defined in our data, i.e.:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-csharp data-lang=csharp><span class=line><span class=cl>    <span class=n>HashSet</span><span class=p>&lt;</span><span class=kt>string</span><span class=p>&gt;</span> <span class=n>genres</span> <span class=p>=</span> <span class=k>new</span> <span class=n>HashSet</span><span class=p>&lt;</span><span class=kt>string</span><span class=p>&gt;();</span>
</span></span><span class=line><span class=cl>    <span class=k>foreach</span><span class=p>(</span><span class=n>Movie</span> <span class=n>movie</span> <span class=k>in</span> <span class=n>All</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span><span class=p>(</span><span class=n>movie</span><span class=p>.</span><span class=n>MajorGenre</span> <span class=p>!=</span> <span class=kc>null</span><span class=p>)</span> 
</span></span><span class=line><span class=cl>        <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=n>genres</span><span class=p>.</span><span class=n>Add</span><span class=p>(</span><span class=n>movie</span><span class=p>.</span><span class=n>MajorGenre</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span></span></span></code></pre></div><p>Here we use a <a href="https://docs.microsoft.com/en-us/dotnet/api/system.collections.generic.hashset-1?view=netframework-4.8" rel=external target=_blank>HashSet</a> instead of a list, as it only adds each unique item once. Duplicates are ignored.</p><p>But where would this code go? We could place it in a getter for <code>MovieDatabase.Genres</code>:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-csharp data-lang=csharp><span class=line><span class=cl>    <span class=kd>public</span> <span class=kd>static</span> <span class=n>IEnumerable</span><span class=p>&lt;</span><span class=kt>string</span><span class=p>&gt;</span> <span class=n>Genres</span> 
</span></span><span class=line><span class=cl>    <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=k>get</span> 
</span></span><span class=line><span class=cl>        <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=n>HashSet</span><span class=p>&lt;</span><span class=kt>string</span><span class=p>&gt;</span> <span class=n>genres</span> <span class=p>=</span> <span class=k>new</span> <span class=n>HashSet</span><span class=p>&lt;</span><span class=kt>string</span><span class=p>&gt;();</span>
</span></span><span class=line><span class=cl>            <span class=k>foreach</span><span class=p>(</span><span class=n>Movie</span> <span class=n>movie</span> <span class=k>in</span> <span class=n>All</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>                <span class=k>if</span><span class=p>(</span><span class=n>movie</span><span class=p>.</span><span class=n>MajorGenre</span> <span class=p>!=</span> <span class=kc>null</span><span class=p>)</span> 
</span></span><span class=line><span class=cl>                <span class=p>{</span>
</span></span><span class=line><span class=cl>                    <span class=n>genres</span><span class=p>.</span><span class=n>Add</span><span class=p>(</span><span class=n>movie</span><span class=p>.</span><span class=n>MajorGenre</span><span class=p>);</span>
</span></span><span class=line><span class=cl>                <span class=p>}</span>
</span></span><span class=line><span class=cl>            <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>            <span class=k>return</span> <span class=n>genres</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span></span></span></code></pre></div><p>But this means that every time we want to access it, we&rsquo;ll search through all the movies&mldr; This is an O(n) operation, and will make our website slower.</p><p>Instead, let&rsquo;s create a private static variable in the <code>MovieDatabase</code> class to <em>cache</em> this collection as an array of strings:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-csharp data-lang=csharp><span class=line><span class=cl>    <span class=c1>// The genres represented in the database</span>
</span></span><span class=line><span class=cl>    <span class=kd>private</span> <span class=kd>static</span> <span class=kt>string</span><span class=p>[]</span> <span class=n>_genres</span><span class=p>;</span></span></span></code></pre></div><p>And expose it with a public static property:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-csharp data-lang=csharp><span class=line><span class=cl>    <span class=cs>/// &lt;summary&gt;</span>
</span></span><span class=line><span class=cl>    <span class=cs>/// Gets the movie genres represented in the database </span>
</span></span><span class=line><span class=cl>    <span class=cs>/// &lt;/summary&gt;</span>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=kd>static</span> <span class=kt>string</span><span class=p>[]</span> <span class=n>Genres</span> <span class=p>=&gt;</span> <span class=n>_genres</span><span class=p>;</span></span></span></code></pre></div><p>And finally, we&rsquo;ll populate this array in the static constructor of <code>MovieDatabase</code>, after the JSON file has been processed:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-csharp data-lang=csharp><span class=line><span class=cl>    <span class=n>HashSet</span><span class=p>&lt;</span><span class=kt>string</span><span class=p>&gt;</span> <span class=n>genreSet</span> <span class=p>=</span> <span class=k>new</span> <span class=n>HashSet</span><span class=p>&lt;</span><span class=kt>string</span><span class=p>&gt;();</span>
</span></span><span class=line><span class=cl>    <span class=k>foreach</span><span class=p>(</span><span class=n>Movie</span> <span class=n>movie</span> <span class=k>in</span> <span class=n>_movies</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span><span class=p>(</span><span class=n>movie</span><span class=p>.</span><span class=n>MajorGenre</span> <span class=p>!=</span> <span class=kc>null</span><span class=p>)</span> 
</span></span><span class=line><span class=cl>        <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=n>genreSet</span><span class=p>.</span><span class=n>Add</span><span class=p>(</span><span class=n>movie</span><span class=p>.</span><span class=n>MajorGenre</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=n>_genres</span> <span class=p>=</span> <span class=n>genreSet</span><span class=p>.</span><span class=n>ToArray</span><span class=p>();</span></span></span></code></pre></div><p>This approach means the finding of genres only happens once, and getting the <code>Genre</code> property is a constant-time O(1) operation.</p><p>We can implement the filters for the genres in the same way as we did for the MPAA filters; I&rsquo;ll leave that as an exercise for the reader.</p><footer class=footline></footer></article><article class=default><header class=headline></header><h1 id=adding-categorical-filters-to-the-movie-site>Adding Categorical Filters to the Movie Site</h1><p>Let&rsquo;s add some filters to the page as well. We&rsquo;ll start with <em>categorical</em> filters, i.e. filtering by category. Let&rsquo;s start by filtering for MPAA Rating. We know that there are only a handful of ratings issued by the Motion Picture Association of America - G, PG, PG-13, R, and NC-17. We might be tempted to use an enumeration to represent these values, but in C# an enumeration cannot have strings for values. Nor can we use the hyphen (<code>-</code>) in an enumeration name.</p><h2 id=defining-the-mpaa-ratings>Defining the MPAA Ratings</h2><p>So let&rsquo;s define a string array with our MPAA values, and make it accessible from our <code>MovieDatabase</code> class:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-csharp data-lang=csharp><span class=line><span class=cl>    <span class=cs>/// &lt;summary&gt;</span>
</span></span><span class=line><span class=cl>    <span class=cs>/// Gets the possible MPAARatings</span>
</span></span><span class=line><span class=cl>    <span class=cs>/// &lt;/summary&gt;</span>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=kd>static</span> <span class=kt>string</span><span class=p>[]</span> <span class=n>MPAARatings</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=k>get</span> <span class=p>=&gt;</span> <span class=k>new</span> <span class=kt>string</span><span class=p>[]</span>
</span></span><span class=line><span class=cl>        <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=s>&#34;G&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=s>&#34;PG&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=s>&#34;PG-13&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=s>&#34;R&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=s>&#34;NC-17&#34;</span>
</span></span><span class=line><span class=cl>        <span class=p>};</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span></span></span></code></pre></div><p>Now in our <code>&lt;form></code> in <em>Index.cshtml</em> we can add a checkbox for each of these possible values:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-html data-lang=html><span class=line><span class=cl><span class=p>&lt;</span><span class=nt>form</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>    @foreach  (string rating in MovieDatabase.MPAARatings) 
</span></span><span class=line><span class=cl>    {
</span></span><span class=line><span class=cl>        <span class=p>&lt;</span><span class=nt>label</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>            <span class=p>&lt;</span><span class=nt>input</span> <span class=na>type</span><span class=o>=</span><span class=s>&#34;checkbox&#34;</span> <span class=na>name</span><span class=o>=</span><span class=s>&#34;MPAARatings&#34;</span> <span class=na>value</span><span class=o>=</span><span class=s>&#34;@rating&#34;</span><span class=p>/&gt;</span>
</span></span><span class=line><span class=cl>            @rating
</span></span><span class=line><span class=cl>        <span class=p>&lt;/</span><span class=nt>label</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>    }
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=p>&lt;</span><span class=nt>input</span> <span class=na>type</span><span class=o>=</span><span class=s>&#34;text&#34;</span> <span class=na>name</span><span class=o>=</span><span class=s>&#34;SearchTerms&#34;</span> <span class=na>value</span><span class=o>=</span><span class=s>&#34;@Model.SearchTerms&#34;</span><span class=p>/&gt;</span>
</span></span><span class=line><span class=cl>    <span class=p>&lt;</span><span class=nt>input</span> <span class=na>type</span><span class=o>=</span><span class=s>&#34;submit&#34;</span> <span class=na>value</span><span class=o>=</span><span class=s>&#34;Search&#34;</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl><span class=p>&lt;/</span><span class=nt>form</span><span class=p>&gt;</span></span></span></code></pre></div><p>If you try running the project now, and check a few boxes, you&rsquo;ll see the query string results look something like:</p><div class=highlight><pre tabindex=0><code>?SearchTerms=&amp;MPAARatings=G&amp;MPAARatings=PG-13</code></pre></div><p>Notice how the key <em>MPAARatings</em> is repeated twice? What would that look like in our PageModel? We can find out; declare a <code>var</code> to hold the value in the <code>OnGet()</code> method of <em>Index.cshtml.cs</em>:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-csharp data-lang=csharp><span class=line><span class=cl>    <span class=kt>var</span> <span class=n>MPAARatings</span> <span class=p>=</span> <span class=n>Request</span><span class=p>.</span><span class=n>Query</span><span class=p>[</span><span class=s>&#34;MPAARatings&#34;</span><span class=p>];</span></span></span></code></pre></div><p>If we add a breakpoint on this line, and run our code, then check several boxes (you&rsquo;ll have to <em>continue</em> the first time you hit the breakpoint), then step over the line, we&rsquo;ll see that the var <code>MPAA</code> rating is set to a <em>string collection</em>. We could therefore store it in an array property in <em>Index.cshtml.cs</em>, much like we did with our <code>SearchTerms</code>:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-csharp data-lang=csharp><span class=line><span class=cl>    <span class=cs>/// &lt;summary&gt;</span>
</span></span><span class=line><span class=cl>    <span class=cs>/// The filtered MPAA Ratings</span>
</span></span><span class=line><span class=cl>    <span class=cs>/// &lt;/summary&gt;</span>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=kt>string</span><span class=p>[]</span> <span class=n>MPAARatings</span> <span class=p>{</span> <span class=k>get</span><span class=p>;</span> <span class=k>set</span><span class=p>;</span> <span class=p>}</span></span></span></code></pre></div><p>And we can refactor the line we just added to <code>OnGet()</code> to use this new property:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-csharp data-lang=csharp><span class=line><span class=cl>    <span class=n>MPAARatings</span> <span class=p>=</span> <span class=n>Request</span><span class=p>.</span><span class=n>Query</span><span class=p>[</span><span class=s>&#34;MPAARatings&#34;</span><span class=p>];</span></span></span></code></pre></div><p>Then, in our <em>Index.cshtml</em> Razor Page, we can refactor the checkbox to be checked if we filtered against this rating in our last request:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-html data-lang=html><span class=line><span class=cl>    <span class=p>&lt;</span><span class=nt>input</span> <span class=na>type</span><span class=o>=</span><span class=s>&#34;checkbox&#34;</span> <span class=na>name</span><span class=o>=</span><span class=s>&#34;MPAARatings&#34;</span> <span class=na>value</span><span class=o>=</span><span class=s>&#34;@rating&#34;</span> <span class=na>checked</span><span class=o>=</span><span class=s>&#34;@Model.MPAARatings.Contains(rating)&#34;</span><span class=p>/&gt;</span></span></span></code></pre></div><p>Now our filters stick around when we submit the search request. That just leaves making the filters actually <em>work</em>.</p><h2 id=applying-mpaa-rating-filters>Applying MPAA Rating Filters</h2><p>Let&rsquo;s add another method to our <code>MovieDatabase</code> class, <code>FilterByMPAARating()</code>:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-csharp data-lang=csharp><span class=line><span class=cl>    <span class=cs>/// &lt;summary&gt;</span>
</span></span><span class=line><span class=cl>    <span class=cs>/// Filters the provided collection of movies</span>
</span></span><span class=line><span class=cl>    <span class=cs>/// &lt;/summary&gt;</span>
</span></span><span class=line><span class=cl>    <span class=cs>/// &lt;param name=&#34;movies&#34;&gt;The collection of movies to filter&lt;/param&gt;</span>
</span></span><span class=line><span class=cl>    <span class=cs>/// &lt;param name=&#34;ratings&#34;&gt;The ratings to include&lt;/param&gt;</span>
</span></span><span class=line><span class=cl>    <span class=cs>/// &lt;returns&gt;A collection containing only movies that match the filter&lt;/returns&gt;</span>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=kd>static</span> <span class=n>IEnumerable</span><span class=p>&lt;</span><span class=n>Movie</span><span class=p>&gt;</span> <span class=n>FilterByMPAARating</span><span class=p>(</span><span class=n>IEnumerable</span><span class=p>&lt;</span><span class=n>Movie</span><span class=p>&gt;</span> <span class=n>movies</span><span class=p>,</span> <span class=n>IEnumerable</span><span class=p>&lt;</span><span class=kt>string</span><span class=p>&gt;</span> <span class=n>ratings</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=c1>// TODO: Filter the list</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=p>}</span></span></span></code></pre></div><p>Notice that in <em>this</em> method, we accept an <code>IEnumerable&lt;Movie></code> parameter. This is the list of movies we want to filter. We use this, instead of the <code>All()</code> we did in the <code>Search()</code> method, as we would want to filter the <em>results</em> of a search.</p><p>Let&rsquo;s do a null/empty check, and just return this shortlist if no filters are specified:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-csharp data-lang=csharp><span class=line><span class=cl>    <span class=c1>// If no filter is specified, just return the provided collection</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=p>(</span><span class=n>ratings</span> <span class=p>==</span> <span class=kc>null</span> <span class=p>||</span> <span class=n>ratings</span><span class=p>.</span><span class=n>Count</span><span class=p>()</span> <span class=p>==</span> <span class=m>0</span><span class=p>)</span> <span class=k>return</span> <span class=n>movies</span><span class=p>;</span></span></span></code></pre></div><p>Otherwise, we&rsquo;ll use the same process we did before. Start with an empty list of movies, and iterate over the collection seeing if any match. However, as we have <em>two</em> collections (the movies <em>and</em> the ratings), we&rsquo;ll see if the ratings collection contains the supplied movie&rsquo;s rating.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-csharp data-lang=csharp><span class=line><span class=cl>    <span class=c1>// Filter the supplied collection of movies</span>
</span></span><span class=line><span class=cl>    <span class=n>List</span><span class=p>&lt;</span><span class=n>Movie</span><span class=p>&gt;</span> <span class=n>results</span> <span class=p>=</span> <span class=k>new</span> <span class=n>List</span><span class=p>&lt;</span><span class=n>Movie</span><span class=p>&gt;();</span>
</span></span><span class=line><span class=cl>    <span class=k>foreach</span><span class=p>(</span><span class=n>Movie</span> <span class=n>movie</span> <span class=k>in</span> <span class=n>movies</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span><span class=p>(</span><span class=n>movie</span><span class=p>.</span><span class=n>MPAARatings</span> <span class=p>!=</span> <span class=kc>null</span> <span class=p>&amp;&amp;</span> <span class=n>ratings</span><span class=p>.</span><span class=n>Contains</span><span class=p>(</span><span class=n>movie</span><span class=p>.</span><span class=n>MPAARatings</span><span class=p>))</span>
</span></span><span class=line><span class=cl>        <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=n>results</span><span class=p>.</span><span class=n>Add</span><span class=p>(</span><span class=n>movie</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span></span></span></code></pre></div><p>Finally, we&rsquo;ll return our results:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-csharp data-lang=csharp><span class=line><span class=cl>    <span class=k>return</span> <span class=n>results</span><span class=p>;</span></span></span></code></pre></div><p>Now, back in our PageModel <em>Index.cshtml.cs</em>, we&rsquo;ll apply our filter to the results of our search. The refactored <code>OnGet()</code> should then be:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-csharp data-lang=csharp><span class=line><span class=cl>    <span class=kd>public</span> <span class=k>void</span> <span class=n>OnGet</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=n>SearchTerms</span> <span class=p>=</span> <span class=n>Request</span><span class=p>.</span><span class=n>Query</span><span class=p>[</span><span class=s>&#34;SearchTerms&#34;</span><span class=p>];</span>
</span></span><span class=line><span class=cl>        <span class=n>MPAARatings</span> <span class=p>=</span> <span class=n>Request</span><span class=p>.</span><span class=n>Query</span><span class=p>[</span><span class=s>&#34;MPAARatings&#34;</span><span class=p>];</span>
</span></span><span class=line><span class=cl>        <span class=n>Movies</span> <span class=p>=</span> <span class=n>MovieDatabase</span><span class=p>.</span><span class=n>Search</span><span class=p>(</span><span class=n>SearchTerms</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=n>Movies</span> <span class=p>=</span> <span class=n>MovieDatabase</span><span class=p>.</span><span class=n>FilterByMPAARating</span><span class=p>(</span><span class=n>Movies</span><span class=p>,</span> <span class=n>MPAARatings</span><span class=p>);</span>        
</span></span><span class=line><span class=cl>    <span class=p>}</span></span></span></code></pre></div><p>Now we can run a search with filters applied. For example, searching for the word &ldquo;Love&rdquo; and movies that are PG or PG-13 yields:</p><p><a href=#R-image-4323aef235e9ba7b2cc3c4be22896282 class=lightbox-link><img alt="Filtered Search Results" class="border lazy lightbox noshadow figure-image" loading=lazy src=/cis400/images/6.8.4.png style=height:auto;width:auto></a>
<a href=javascript:history.back(); class=lightbox-back id=R-image-4323aef235e9ba7b2cc3c4be22896282><img alt="Filtered Search Results" class="border lazy lightbox noshadow lightbox-image" loading=lazy src=/cis400/images/6.8.4.png></a></p><p>You might be wondering why <em>Cloverfield</em> is listed. But remember, we&rsquo;re searching by substring, and C <strong>LOVE</strong> rfield contains love!</p><h2 id=filtering-by-genre>Filtering by Genre</h2><p>Let&rsquo;s add filters for genre next. But what genres should be included? This is not as clear-cut as our MPAA rating, as there is no standards organization that says &ldquo;these are the only offical genres that exist.&rdquo; In fact, new genres emerge from time to time. So a better source of this info might just be to see what Genres are defined in our data, i.e.:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-csharp data-lang=csharp><span class=line><span class=cl>    <span class=n>HashSet</span><span class=p>&lt;</span><span class=kt>string</span><span class=p>&gt;</span> <span class=n>genres</span> <span class=p>=</span> <span class=k>new</span> <span class=n>HashSet</span><span class=p>&lt;</span><span class=kt>string</span><span class=p>&gt;();</span>
</span></span><span class=line><span class=cl>    <span class=k>foreach</span><span class=p>(</span><span class=n>Movie</span> <span class=n>movie</span> <span class=k>in</span> <span class=n>All</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span><span class=p>(</span><span class=n>movie</span><span class=p>.</span><span class=n>MajorGenre</span> <span class=p>!=</span> <span class=kc>null</span><span class=p>)</span> 
</span></span><span class=line><span class=cl>        <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=n>genres</span><span class=p>.</span><span class=n>Add</span><span class=p>(</span><span class=n>movie</span><span class=p>.</span><span class=n>MajorGenre</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span></span></span></code></pre></div><p>Here we use a <a href="https://docs.microsoft.com/en-us/dotnet/api/system.collections.generic.hashset-1?view=netframework-4.8" rel=external target=_blank>HashSet</a> instead of a list, as it only adds each unique item once. Duplicates are ignored.</p><p>But where would this code go? We could place it in a getter for <code>MovieDatabase.Genres</code>:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-csharp data-lang=csharp><span class=line><span class=cl>    <span class=kd>public</span> <span class=n>IEnumerable</span><span class=p>&lt;</span><span class=kt>string</span><span class=p>&gt;</span> <span class=n>Genres</span> 
</span></span><span class=line><span class=cl>    <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=k>get</span> 
</span></span><span class=line><span class=cl>        <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=n>HashSet</span><span class=p>&lt;</span><span class=kt>string</span><span class=p>&gt;</span> <span class=n>genres</span> <span class=p>=</span> <span class=k>new</span> <span class=n>HashSet</span><span class=p>&lt;</span><span class=kt>string</span><span class=p>&gt;();</span>
</span></span><span class=line><span class=cl>            <span class=k>foreach</span><span class=p>(</span><span class=n>Movie</span> <span class=n>movie</span> <span class=k>in</span> <span class=n>All</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>                <span class=k>if</span><span class=p>(</span><span class=n>movie</span><span class=p>.</span><span class=n>MajorGenre</span> <span class=p>!=</span> <span class=kc>null</span><span class=p>)</span> 
</span></span><span class=line><span class=cl>                <span class=p>{</span>
</span></span><span class=line><span class=cl>                    <span class=n>genres</span><span class=p>.</span><span class=n>Add</span><span class=p>(</span><span class=n>movie</span><span class=p>.</span><span class=n>MajorGenre</span><span class=p>);</span>
</span></span><span class=line><span class=cl>                <span class=p>}</span>
</span></span><span class=line><span class=cl>            <span class=p>}</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span></span></span></code></pre></div><p>But this means that every time we want to access it, we&rsquo;ll search through all the movies&mldr; This is an O(n) operation, and will make our website slower.</p><p>Instead, let&rsquo;s create a private static variable in the <code>MovieDatabase</code> class to <em>cache</em> this collection as an array of strings:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-csharp data-lang=csharp><span class=line><span class=cl>    <span class=c1>// The genres represented in the database</span>
</span></span><span class=line><span class=cl>    <span class=kd>private</span> <span class=kd>static</span> <span class=kt>string</span><span class=p>[]</span> <span class=n>_genres</span><span class=p>;</span></span></span></code></pre></div><p>And expose it with a public static property:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-csharp data-lang=csharp><span class=line><span class=cl>    <span class=cs>/// &lt;summary&gt;</span>
</span></span><span class=line><span class=cl>    <span class=cs>/// Gets the movie genres represented in the database </span>
</span></span><span class=line><span class=cl>    <span class=cs>/// &lt;/summary&gt;</span>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=kd>static</span> <span class=kt>string</span><span class=p>[]</span> <span class=n>Genres</span> <span class=p>=&gt;</span> <span class=n>_genres</span><span class=p>;</span></span></span></code></pre></div><p>And finally, we&rsquo;ll populate this array in the static constructor of <code>MovieDatabase</code>, after the JSON file has been processed:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-csharp data-lang=csharp><span class=line><span class=cl>    <span class=n>HashSet</span><span class=p>&lt;</span><span class=kt>string</span><span class=p>&gt;</span> <span class=n>genreSet</span> <span class=p>=</span> <span class=k>new</span> <span class=n>HashSet</span><span class=p>&lt;</span><span class=kt>string</span><span class=p>&gt;();</span>
</span></span><span class=line><span class=cl>    <span class=k>foreach</span><span class=p>(</span><span class=n>Movie</span> <span class=n>movie</span> <span class=k>in</span> <span class=n>_movies</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span><span class=p>(</span><span class=n>movie</span><span class=p>.</span><span class=n>MajorGenre</span> <span class=p>!=</span> <span class=kc>null</span><span class=p>)</span> 
</span></span><span class=line><span class=cl>        <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=n>genreSet</span><span class=p>.</span><span class=n>Add</span><span class=p>(</span><span class=n>movie</span><span class=p>.</span><span class=n>MajorGenre</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=n>_genres</span> <span class=p>=</span> <span class=n>genreSet</span><span class=p>.</span><span class=n>ToArray</span><span class=p>();</span></span></span></code></pre></div><p>This approach means the finding of genres only happens once, and getting the <code>Genre</code> property is a constant-time O(1) operation.</p><p>We can implement the filters for the genres in the same way as we did for the MPAA filters; I&rsquo;ll leave that as an exercise for the reader.</p><footer class=footline></footer></article><article class=default><header class=headline></header><h1 id=numerical-filters>Numerical Filters</h1><p>Let&rsquo;s tackle one of the critics ratings next. While we could create categories and use checkboxes, this doesn&rsquo;t capture the incremental values (i.e. 4.3), and it would be a <em>lot</em> of checkboxes for Rotten Tomatoes ratings! Instead, we&rsquo;ll use a <em>numerical filter</em>, which limits our possible results to a range - between a minimum and maximum value.</p><p>Moreover, let&rsquo;s clean up our Index page, as it is getting difficult to determine what filter(s) go together, and and are adding more.</p><h2 id=refactoring-the-index-page>Refactoring the Index Page</h2><p>Let&rsquo;s move the filters to a column on the left, leave the search bar above, and show our results on the right. This will require refactoring our <em>Index.cshtml</em> file:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-csharp data-lang=csharp><span class=line><span class=cl>    <span class=p>&lt;</span><span class=n>form</span> <span class=n>id</span><span class=p>=</span><span class=s>&#34;movie-database&#34;</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=p>&lt;</span><span class=n>div</span> <span class=n>id</span><span class=p>=</span><span class=s>&#34;search&#34;</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>            <span class=p>&lt;</span><span class=n>input</span> <span class=n>type</span><span class=p>=</span><span class=s>&#34;text&#34;</span> <span class=n>name</span><span class=p>=</span><span class=s>&#34;SearchTerms&#34;</span> <span class=k>value</span><span class=p>=</span><span class=s>&#34;@Model.SearchTerms&#34;</span> <span class=p>/&gt;</span>
</span></span><span class=line><span class=cl>            <span class=p>&lt;</span><span class=n>input</span> <span class=n>type</span><span class=p>=</span><span class=s>&#34;submit&#34;</span> <span class=k>value</span><span class=p>=</span><span class=s>&#34;Search&#34;</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>        <span class=p>&lt;/</span><span class=n>div</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=p>&lt;</span><span class=n>div</span> <span class=n>id</span><span class=p>=</span><span class=s>&#34;filters&#34;</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>            <span class=p>&lt;</span><span class=n>h4</span><span class=p>&gt;</span><span class=n>MPAA</span> <span class=n>Rating</span><span class=p>&lt;/</span><span class=n>h4</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>            <span class=n>@foreach</span> <span class=p>(</span><span class=kt>string</span> <span class=n>rating</span> <span class=k>in</span> <span class=n>MovieDatabase</span><span class=p>.</span><span class=n>MPAARating</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            <span class=p>{</span>
</span></span><span class=line><span class=cl>                <span class=p>&lt;</span><span class=n>label</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>                    <span class=p>&lt;</span><span class=n>input</span> <span class=n>type</span><span class=p>=</span><span class=s>&#34;checkbox&#34;</span> <span class=n>name</span><span class=p>=</span><span class=s>&#34;MPAARatings&#34;</span> <span class=k>value</span><span class=p>=</span><span class=s>&#34;@rating&#34;</span> <span class=k>checked</span><span class=p>=</span><span class=s>&#34;@Model.MPAARatings.Contains(rating)&#34;</span> <span class=p>/&gt;</span>
</span></span><span class=line><span class=cl>                    <span class=n>@rating</span>
</span></span><span class=line><span class=cl>                <span class=p>&lt;/</span><span class=n>label</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>            <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>            <span class=p>&lt;</span><span class=n>h4</span><span class=p>&gt;</span><span class=n>Genre</span><span class=p>&lt;/</span><span class=n>h4</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>            <span class=n>@foreach</span> <span class=p>(</span><span class=kt>string</span> <span class=n>genre</span> <span class=k>in</span> <span class=n>MovieDatabase</span><span class=p>.</span><span class=n>Genres</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            <span class=p>{</span>
</span></span><span class=line><span class=cl>                <span class=p>&lt;</span><span class=n>label</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>                    <span class=p>&lt;</span><span class=n>input</span> <span class=n>type</span><span class=p>=</span><span class=s>&#34;checkbox&#34;</span> <span class=n>name</span><span class=p>=</span><span class=s>&#34;Genres&#34;</span> <span class=k>value</span><span class=p>=</span><span class=s>&#34;@genre&#34;</span> <span class=p>/&gt;</span>
</span></span><span class=line><span class=cl>                    <span class=n>@genre</span>
</span></span><span class=line><span class=cl>                <span class=p>&lt;/</span><span class=n>label</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>            <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>            <span class=p>&lt;</span><span class=n>h4</span><span class=p>&gt;</span><span class=n>IMDB</span> <span class=n>Rating</span><span class=p>&lt;/</span><span class=n>h4</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>            <span class=p>&lt;</span><span class=n>div</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>                <span class=n>Between</span>
</span></span><span class=line><span class=cl>                <span class=p>&lt;</span><span class=n>input</span> <span class=n>name</span><span class=p>=</span><span class=s>&#34;IMDBMin&#34;</span> <span class=n>type</span><span class=p>=</span><span class=s>&#34;number&#34;</span> <span class=n>min</span><span class=p>=</span><span class=s>&#34;0&#34;</span> <span class=n>max</span><span class=p>=</span><span class=s>&#34;10&#34;</span> <span class=n>step</span><span class=p>=</span><span class=s>&#34;0.1&#34;</span> <span class=n>placeholder</span><span class=p>=</span><span class=s>&#34;min&#34;</span><span class=p>/&gt;</span>
</span></span><span class=line><span class=cl>                <span class=n>and</span>
</span></span><span class=line><span class=cl>                <span class=p>&lt;</span><span class=n>input</span> <span class=n>name</span><span class=p>=</span><span class=s>&#34;IMDBMax&#34;</span> <span class=n>type</span><span class=p>=</span><span class=s>&#34;number&#34;</span> <span class=n>min</span><span class=p>=</span><span class=s>&#34;0&#34;</span> <span class=n>max</span><span class=p>=</span><span class=s>&#34;10&#34;</span> <span class=n>step</span><span class=p>=</span><span class=s>&#34;0.1&#34;</span> <span class=n>placeholder</span><span class=p>=</span><span class=s>&#34;max&#34;</span><span class=p>/&gt;</span>
</span></span><span class=line><span class=cl>            <span class=p>&lt;/</span><span class=n>div</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=p>&lt;/</span><span class=n>div</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=p>&lt;</span><span class=n>div</span> <span class=n>id</span><span class=p>=</span><span class=s>&#34;results&#34;</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>            <span class=p>&lt;</span><span class=n>h1</span><span class=p>&gt;</span><span class=n>Movie</span> <span class=n>Results</span><span class=p>&lt;/</span><span class=n>h1</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>            <span class=p>&lt;</span><span class=n>ul</span> <span class=n>class</span><span class=p>=</span><span class=s>&#34;movie-list&#34;</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>                <span class=n>@foreach</span> <span class=p>(</span><span class=n>Movie</span> <span class=n>movie</span> <span class=k>in</span> <span class=n>@Model</span><span class=p>.</span><span class=n>Movies</span><span class=p>)</span>
</span></span><span class=line><span class=cl>                <span class=p>{</span>
</span></span><span class=line><span class=cl>                    <span class=p>&lt;</span><span class=n>li</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>                        <span class=p>&lt;</span><span class=n>div</span> <span class=n>class</span><span class=p>=</span><span class=s>&#34;details&#34;</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>                            <span class=p>&lt;</span><span class=n>h3</span> <span class=n>class</span><span class=p>=</span><span class=s>&#34;title&#34;</span><span class=p>&gt;</span><span class=n>@movie</span><span class=p>.</span><span class=n>Title</span><span class=p>&lt;/</span><span class=n>h3</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>                            <span class=p>&lt;</span><span class=n>div</span> <span class=n>class</span><span class=p>=</span><span class=s>&#34;mpaa&#34;</span><span class=p>&gt;</span><span class=n>@movie</span><span class=p>.</span><span class=n>MPAARating</span><span class=p>&lt;/</span><span class=n>div</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>                            <span class=p>&lt;</span><span class=n>div</span> <span class=n>class</span><span class=p>=</span><span class=s>&#34;genre&#34;</span><span class=p>&gt;</span><span class=n>@movie</span><span class=p>.</span><span class=n>MajorGenre</span><span class=p>&lt;/</span><span class=n>div</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>                        <span class=p>&lt;/</span><span class=n>div</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>                        <span class=p>&lt;</span><span class=n>div</span> <span class=n>class</span><span class=p>=</span><span class=s>&#34;ratings&#34;</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>                            <span class=n>@if</span> <span class=p>(</span><span class=n>movie</span><span class=p>.</span><span class=n>IMDBRating</span> <span class=p>!=</span> <span class=kc>null</span><span class=p>)</span>
</span></span><span class=line><span class=cl>                            <span class=p>{</span>
</span></span><span class=line><span class=cl>                                <span class=p>&lt;</span><span class=n>div</span> <span class=n>class</span><span class=p>=</span><span class=s>&#34;imdb&#34;</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>                                    <span class=n>@movie</span><span class=p>.</span><span class=n>IMDBRating</span>
</span></span><span class=line><span class=cl>                                <span class=p>&lt;/</span><span class=n>div</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>                            <span class=p>}</span>
</span></span><span class=line><span class=cl>                            <span class=n>@if</span> <span class=p>(</span><span class=n>movie</span><span class=p>.</span><span class=n>RottenTomatoesRating</span> <span class=p>!=</span> <span class=kc>null</span><span class=p>)</span>
</span></span><span class=line><span class=cl>                            <span class=p>{</span>
</span></span><span class=line><span class=cl>                                <span class=p>&lt;</span><span class=n>div</span> <span class=n>class</span><span class=p>=</span><span class=s>&#34;rotten-tomatoes&#34;</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>                                    <span class=n>@movie</span><span class=p>.</span><span class=n>RottenTomatoesRating</span>
</span></span><span class=line><span class=cl>                                <span class=p>&lt;/</span><span class=n>div</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>                            <span class=p>}</span>
</span></span><span class=line><span class=cl>                        <span class=p>&lt;/</span><span class=n>div</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>                    <span class=p>&lt;/</span><span class=n>li</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>                <span class=p>}</span>
</span></span><span class=line><span class=cl>            <span class=p>&lt;/</span><span class=n>ul</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>        <span class=p>&lt;/</span><span class=n>div</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=p>&lt;/</span><span class=n>form</span><span class=p>&gt;</span></span></span></code></pre></div><p>Most of this is simply moving elements around the page, but note that we are using inputs of <code>type=number</code> to represent our range of IMDB values. We can specify a minimum and maximum for this range, as well as an allowable increment. Also, we use the <code>placeholder</code> attribute to put text into the <code>input</code> until a value is added.</p><h2 id=adding-more-styles>Adding More Styles</h2><p>Now we&rsquo;ll need to add some rules to our <em>wwwroot/css/styles.css</em>. First, we&rsquo;ll use a <code>grid</code> for the layout of the form:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-css data-lang=css><span class=line><span class=cl><span class=nt>form</span><span class=p>#</span><span class=nn>movie-database</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>display</span><span class=p>:</span> <span class=k>grid</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=k>grid-template-columns</span><span class=p>:</span> <span class=mi>1</span><span class=n>fr</span> <span class=mi>3</span><span class=n>fr</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=k>grid-template-rows</span><span class=p>:</span> <span class=kc>auto</span> <span class=kc>auto</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span></span></span></code></pre></div><p>The right column will be three times as big as the right.</p><p>We can make our search bar span both columns with <code>grid-column-start</code> and <code>grid-column-end</code>:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-css data-lang=css><span class=line><span class=cl><span class=p>#</span><span class=nn>search</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>grid-column-start</span><span class=p>:</span> <span class=mi>1</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=k>grid-column-end</span><span class=p>:</span> <span class=mi>3</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=k>text-align</span><span class=p>:</span> <span class=kc>center</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span></span></span></code></pre></div><p>Notice too that for CSS, we start counting at 1, not 0. The filters and the results will fall in the next row automatically, each taking up their own respective grid cell. You can read more about the grid layout in <a href=https://css-tricks.com/snippets/css/complete-guide-grid/ rel=external target=_blank>A Complete Guide to Grid</a>.</p><p>Let&rsquo;s go ahead and use flexbox to lay out our filters in a column:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-css data-lang=css><span class=line><span class=cl><span class=p>#</span><span class=nn>filters</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>display</span><span class=p>:</span> <span class=kc>flex</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=k>flex-direction</span><span class=p>:</span> <span class=kc>column</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span></span></span></code></pre></div><p>And make our number inputs bigger:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-css data-lang=css><span class=line><span class=cl><span class=p>#</span><span class=nn>filters</span> <span class=nt>input</span><span class=o>[</span><span class=nt>type</span><span class=o>=</span><span class=nt>number</span><span class=o>]</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>width</span><span class=p>:</span> <span class=mi>4</span><span class=kt>rem</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span></span></span></code></pre></div><p>Notice the use of square brackets in our CSS Selector to only apply to inputs with type number.</p><p>Also, let&rsquo;s add a margin above and remove most of the margin below our <code>&lt;h4></code> elements:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-css data-lang=css><span class=line><span class=cl><span class=p>#</span><span class=nn>filters</span> <span class=nt>h4</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>margin-bottom</span><span class=p>:</span> <span class=mf>0.2</span><span class=kt>rem</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=k>margin-top</span><span class=p>:</span> <span class=mi>2</span><span class=kt>rem</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span></span></span></code></pre></div><p>The resulting page looks much cleaner:</p><p><a href=#R-image-6d7ae102e038707da02d20ddc2cee9e9 class=lightbox-link><img alt="The Styled Page" class="border lazy lightbox noshadow figure-image" loading=lazy src=/cis400/images/6.8.5.png style=height:auto;width:auto></a>
<a href=javascript:history.back(); class=lightbox-back id=R-image-6d7ae102e038707da02d20ddc2cee9e9><img alt="The Styled Page" class="border lazy lightbox noshadow lightbox-image" loading=lazy src=/cis400/images/6.8.5.png></a></p><h2 id=capturing-the-filter-values>Capturing the Filter Values</h2><p>Now we need to get the filter values from our GET request query string. We could do this like we&rsquo;ve been doing before, with:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-csharp data-lang=csharp><span class=line><span class=cl>    <span class=n>Request</span><span class=p>.</span><span class=n>Query</span><span class=p>[</span><span class=s>&#34;IMDBMin&#34;</span><span class=p>];</span></span></span></code></pre></div><p>But the returned value would be a string, so we&rsquo;d need to parse it:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-csharp data-lang=csharp><span class=line><span class=cl>    <span class=n>IMDBMin</span> <span class=p>=</span> <span class=kt>double</span><span class=p>.</span><span class=n>Parse</span><span class=p>(</span><span class=n>Request</span><span class=p>.</span><span class=n>Query</span><span class=p>[</span><span class=s>&#34;IMDBMin&#34;</span><span class=p>]);</span></span></span></code></pre></div><p>If the query was <code>null</code>, then this would evaluate to <code>NaN</code>, which we wouldn&rsquo;t want to set our <code>&lt;input></code> to&mldr;</p><p>Instead, we&rsquo;ll look at some options built into the PageModel.</p><h2 id=parameter-binding>Parameter Binding</h2><p>The first of these options is <a href=https://docs.microsoft.com/en-us/aspnet/web-api/overview/formats-and-model-binding/parameter-binding-in-aspnet-web-api rel=external target=_blank><em>Parameter Binding</em></a>. In this approach, we define parameters to our <code>OnGet()</code> method to be parsed out of the request automatically, i.e.:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-csharp data-lang=csharp><span class=line><span class=cl>    <span class=cs>/// &lt;summary&gt;</span>
</span></span><span class=line><span class=cl>    <span class=cs>/// Gets the search results for display on the page</span>
</span></span><span class=line><span class=cl>    <span class=cs>/// &lt;/summary&gt;</span>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=k>void</span> <span class=n>OnGet</span><span class=p>(</span><span class=kt>string</span> <span class=n>SearchTerms</span><span class=p>,</span> <span class=kt>string</span><span class=p>[]</span> <span class=n>MPAARatings</span><span class=p>,</span> <span class=kt>string</span><span class=p>[]</span> <span class=n>Genres</span><span class=p>,</span> <span class=kt>double?</span> <span class=n>IMDBMin</span><span class=p>,</span> <span class=kt>double?</span> <span class=n>IMDBMax</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=k>this</span><span class=p>.</span><span class=n>SearchTerms</span> <span class=p>=</span> <span class=n>SearchTerms</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=k>this</span><span class=p>.</span><span class=n>MPAARatings</span> <span class=p>=</span> <span class=n>MPAARatings</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=k>this</span><span class=p>.</span><span class=n>Genres</span> <span class=p>=</span> <span class=n>Genres</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=k>this</span><span class=p>.</span><span class=n>IMDBMin</span> <span class=p>=</span> <span class=n>IMDBMin</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=k>this</span><span class=p>.</span><span class=n>IMDBMax</span> <span class=p>=</span> <span class=n>IMDBMax</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=n>Movies</span> <span class=p>=</span> <span class=n>MovieDatabase</span><span class=p>.</span><span class=n>Search</span><span class=p>(</span><span class=n>SearchTerms</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=n>Movies</span> <span class=p>=</span> <span class=n>MovieDatabase</span><span class=p>.</span><span class=n>FilterByMPAARating</span><span class=p>(</span><span class=n>Movies</span><span class=p>,</span> <span class=n>MPAARatings</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=n>Movies</span> <span class=p>=</span> <span class=n>MovieDatabase</span><span class=p>.</span><span class=n>FilterByGenre</span><span class=p>(</span><span class=n>Movies</span><span class=p>,</span> <span class=n>Genres</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=n>Movies</span> <span class=p>=</span> <span class=n>MovieDatabase</span><span class=p>.</span><span class=n>FilterByIMDBRating</span><span class=p>(</span><span class=n>Movies</span><span class=p>,</span> <span class=n>IMDBMin</span><span class=p>,</span> <span class=n>IMDBMax</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span></span></span></code></pre></div><p>The benefit of this approach is that as long as C# knows a conversion into the type we specify, the conversion is done automatically. Note that the parameter name matches the <code>name</code> property of the corresponding <code>&lt;input></code> - this must be the case for the Razor Page to bind the parameter to the corresponding input value.</p><p>Note that we still need to assign these parameter values to the corresponding properties of our PageModel. If we don&rsquo;t, then those properties will all be <code>null</code>, and the <code>&lt;inputs></code> rendered on our page will always be blank.</p><h2 id=model-binding>Model Binding</h2><p>A second option is to use <a href="https://docs.microsoft.com/en-us/aspnet/core/mvc/models/model-binding?view=aspnetcore-3.1" rel=external target=_blank><em>Model Binding</em></a>. Model binding also automatically converts incoming form data, but in this case it binds directly to the properties of our PageModel. We indicate this form of binding with a <code>[BindProperty]</code> attribute, i.e.:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-csharp data-lang=csharp><span class=line><span class=cl><span class=kd>public</span> <span class=k>class</span> <span class=nc>IndexModel</span> <span class=p>:</span> <span class=n>PageModel</span> <span class=p>{</span>
</span></span><span class=line><span class=cl><span class=na>
</span></span></span><span class=line><span class=cl><span class=na>    [BindProperty(SupportsGet=true)]</span>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=kt>string</span> <span class=n>SearchTerms</span> <span class=p>{</span><span class=k>get</span><span class=p>;</span> <span class=k>set</span><span class=p>;}</span>
</span></span><span class=line><span class=cl><span class=na>
</span></span></span><span class=line><span class=cl><span class=na>    [BindProperty(SupportsGet=true)]</span>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=kt>string</span><span class=p>[]</span> <span class=n>MPAARatings</span> <span class=p>{</span><span class=k>get</span><span class=p>;</span> <span class=k>set</span><span class=p>;}</span>
</span></span><span class=line><span class=cl><span class=na>
</span></span></span><span class=line><span class=cl><span class=na>    [BindProperty(SupportsGet=true)]</span>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=kt>string</span><span class=p>[]</span> <span class=n>Genres</span> <span class=p>{</span><span class=k>get</span><span class=p>;</span> <span class=k>set</span><span class=p>;}</span>
</span></span><span class=line><span class=cl><span class=na>
</span></span></span><span class=line><span class=cl><span class=na>    [BindProperty(SupportsGet=true)]</span>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=kt>double?</span> <span class=n>IMDBMin</span> <span class=p>{</span><span class=k>get</span><span class=p>;</span> <span class=k>set</span><span class=p>;}</span>
</span></span><span class=line><span class=cl><span class=na>
</span></span></span><span class=line><span class=cl><span class=na>    [BindProperty(SupportsGet=true)]</span>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=kt>double?</span> <span class=n>IMDBMax</span> <span class=p>{</span><span class=k>get</span><span class=p>;</span> <span class=k>set</span><span class=p>;}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=cs>/// &lt;summary&gt;</span>
</span></span><span class=line><span class=cl>    <span class=cs>/// Gets the search results for display on the page</span>
</span></span><span class=line><span class=cl>    <span class=cs>/// &lt;/summary&gt;</span>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=k>void</span> <span class=n>OnGet</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=n>Movies</span> <span class=p>=</span> <span class=n>MovieDatabase</span><span class=p>.</span><span class=n>Search</span><span class=p>(</span><span class=n>SearchTerms</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=n>Movies</span> <span class=p>=</span> <span class=n>MovieDatabase</span><span class=p>.</span><span class=n>FilterByMPAARating</span><span class=p>(</span><span class=n>Movies</span><span class=p>,</span> <span class=n>MPAARatings</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=n>Movies</span> <span class=p>=</span> <span class=n>MovieDatabase</span><span class=p>.</span><span class=n>FilterByGenre</span><span class=p>(</span><span class=n>Movies</span><span class=p>,</span> <span class=n>Genres</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=n>Movies</span> <span class=p>=</span> <span class=n>MovieDatabase</span><span class=p>.</span><span class=n>FilterByIMDBRating</span><span class=p>(</span><span class=n>Movies</span><span class=p>,</span> <span class=n>IMDBMin</span><span class=p>,</span> <span class=n>IMDBMax</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span></span></span></code></pre></div><p>Note that with this approach, the incoming data is directly bound to the properties, so we don&rsquo;t need to do any special assignments within our <code>OnGet()</code> method. Also, note that we have to use <code>SupportsGet=true</code> in order for this binding to occur on GET requests (by default, model binding only happens with POST requests).</p><div class="box notices cstyle note"><div class=box-label><i class="fa-fw fas fa-exclamation-circle"></i> Note</div><div class=box-content><p>You only need to do <em>one</em> binding approach per property in a PageModel. I.e. you can just use the property decorator:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-csharp data-lang=csharp><span class=line><span class=cl><span class=kd>public</span> <span class=k>class</span> <span class=nc>SomePageModel</span> <span class=p>:</span> <span class=n>PageModel</span>
</span></span><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl><span class=na>    [BindProperty(SupportsGet=true)]</span>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=kt>float</span> <span class=n>SomeProperty</span> <span class=p>{</span> <span class=k>get</span><span class=p>;</span> <span class=k>set</span><span class=p>;</span> <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=k>void</span> <span class=n>OnGet</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=n>DoSomething</span><span class=p>(</span><span class=n>SomeProperty</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span></span></span></code></pre></div><p><em>or</em> you might use parameter binding:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-csharp data-lang=csharp><span class=line><span class=cl><span class=kd>public</span> <span class=k>class</span> <span class=nc>SomePageModel</span> <span class=p>:</span> <span class=n>PageModel</span>
</span></span><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=k>void</span> <span class=n>OnGet</span><span class=p>(</span><span class=kt>float</span> <span class=n>SomeProperty</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=n>DoSomething</span><span class=p>(</span><span class=n>SomeProperty</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span></span></span></code></pre></div><p><em>or</em> you can parse it from the request:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-csharp data-lang=csharp><span class=line><span class=cl><span class=kd>public</span> <span class=k>class</span> <span class=nc>SomePageModel</span> <span class=p>:</span> <span class=n>PageModel</span>
</span></span><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=k>void</span> <span class=n>OnGet</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=kt>var</span> <span class=n>someProperty</span> <span class=p>=</span> <span class=kt>float</span><span class=p>.</span><span class=n>Parse</span><span class=p>(</span><span class=n>Request</span><span class=p>.</span><span class=n>Query</span><span class=p>[</span><span class=s>&#34;SomeProperty&#34;</span><span class=p>]);</span>
</span></span><span class=line><span class=cl>        <span class=n>DoSomething</span><span class=p>(</span><span class=n>someProperty</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span></span></span></code></pre></div><p>These are all <em>different means</em> of accessing the <em>same data</em> from the incoming request.</p></div></div><p>Now all we need to do is implement the actual filter.</p><h3 id=implementing-the-imdb-rating-filter>Implementing the IMDB Rating Filter</h3><p>We&rsquo;ll define the new filter in our <code>MovieDatabase</code> class as another static method:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-csharp data-lang=csharp><span class=line><span class=cl>    <span class=cs>/// &lt;summary&gt;</span>
</span></span><span class=line><span class=cl>    <span class=cs>/// Filters the provided collection of movies</span>
</span></span><span class=line><span class=cl>    <span class=cs>/// to those with IMDB ratings falling within</span>
</span></span><span class=line><span class=cl>    <span class=cs>/// the specified range</span>
</span></span><span class=line><span class=cl>    <span class=cs>/// &lt;/summary&gt;</span>
</span></span><span class=line><span class=cl>    <span class=cs>/// &lt;param name=&#34;movies&#34;&gt;The collection of movies to filter&lt;/param&gt;</span>
</span></span><span class=line><span class=cl>    <span class=cs>/// &lt;param name=&#34;min&#34;&gt;The minimum range value&lt;/param&gt;</span>
</span></span><span class=line><span class=cl>    <span class=cs>/// &lt;param name=&#34;max&#34;&gt;The maximum range value&lt;/param&gt;</span>
</span></span><span class=line><span class=cl>    <span class=cs>/// &lt;returns&gt;The filtered movie collection&lt;/returns&gt;</span>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=kd>static</span> <span class=n>IEnumerable</span><span class=p>&lt;</span><span class=n>Movie</span><span class=p>&gt;</span> <span class=n>FilterByIMDBRating</span><span class=p>(</span><span class=n>IEnumerable</span><span class=p>&lt;</span><span class=n>Movie</span><span class=p>&gt;</span> <span class=n>movies</span><span class=p>,</span> <span class=kt>double?</span> <span class=n>min</span><span class=p>,</span> <span class=kt>double?</span> <span class=n>max</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=c1>// TODO: Filter movies</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span></span></span></code></pre></div><p>Notice that here too we use the nullable double value. So our first step is probably to do a <code>null</code> check:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-csharp data-lang=csharp><span class=line><span class=cl>    <span class=k>if</span> <span class=p>(</span><span class=n>min</span> <span class=p>==</span> <span class=kc>null</span> <span class=p>&amp;&amp;</span> <span class=n>max</span> <span class=p>==</span> <span class=kc>null</span><span class=p>)</span> <span class=k>return</span> <span class=n>movies</span><span class=p>;</span></span></span></code></pre></div><p>But what if only one is null? Should we filter for that part of the range? It wouldn&rsquo;t be hard to do:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-csharp data-lang=csharp><span class=line><span class=cl>    <span class=kt>var</span> <span class=n>results</span> <span class=p>=</span> <span class=k>new</span> <span class=n>List</span><span class=p>&lt;</span><span class=n>Movie</span><span class=p>&gt;();</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c1>// only a maximum specified</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span><span class=p>(</span><span class=n>min</span> <span class=p>==</span> <span class=kc>null</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=k>foreach</span><span class=p>(</span><span class=n>Movie</span> <span class=n>movie</span> <span class=k>in</span> <span class=n>movies</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=k>if</span> <span class=p>(</span><span class=n>movie</span><span class=p>.</span><span class=n>IMDBRating</span> <span class=p>&lt;=</span> <span class=n>max</span><span class=p>)</span> <span class=n>results</span><span class=p>.</span><span class=n>Add</span><span class=p>(</span><span class=n>movie</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=n>results</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span></span></span></code></pre></div><p>And the minimum would mirror that:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-csharp data-lang=csharp><span class=line><span class=cl>    <span class=c1>// only a minimum specified</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span><span class=p>(</span><span class=n>max</span> <span class=p>==</span> <span class=kc>null</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=k>foreach</span><span class=p>(</span><span class=n>Movie</span> <span class=n>movie</span> <span class=k>in</span> <span class=n>movies</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=k>if</span> <span class=p>(</span><span class=n>movie</span><span class=p>.</span><span class=n>IMDBRating</span> <span class=p>&gt;=</span> <span class=n>min</span><span class=p>)</span> <span class=n>results</span><span class=p>.</span><span class=n>Add</span><span class=p>(</span><span class=n>movie</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=n>results</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span></span></span></code></pre></div><p>Finally, we could handle the case where we have both a min and max value to our range:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-csharp data-lang=csharp><span class=line><span class=cl>    <span class=c1>// Both minimum and maximum specified</span>
</span></span><span class=line><span class=cl>    <span class=k>foreach</span><span class=p>(</span><span class=n>Movie</span> <span class=n>movie</span> <span class=k>in</span> <span class=n>movies</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span><span class=p>(</span><span class=n>movie</span><span class=p>.</span><span class=n>IMDBRating</span> <span class=p>&gt;=</span> <span class=n>min</span> <span class=p>&amp;&amp;</span> <span class=n>movie</span><span class=p>.</span><span class=n>IMDBRating</span> <span class=p>&lt;=</span> <span class=n>max</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=n>results</span><span class=p>.</span><span class=n>Add</span><span class=p>(</span><span class=n>movie</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=n>results</span><span class=p>;</span></span></span></code></pre></div><p>Notice too, that in each of these cases we&rsquo;re treating the range as <em>inclusive</em> (including the specified minimum and maximum). This is the behavior most casual internet users will expect. If the database and user expectations are different for your audience, you&rsquo;d want your code to match that expectation.</p><p>Now we can filter by IMDB rating:</p><p><a href=#R-image-237a864aa3116e1ab98cad03ff87255d class=lightbox-link><img alt="Filtering By IMDB" class="border lazy lightbox noshadow figure-image" loading=lazy src=/cis400/images/6.8.6.png style=height:auto;width:auto></a>
<a href=javascript:history.back(); class=lightbox-back id=R-image-237a864aa3116e1ab98cad03ff87255d><img alt="Filtering By IMDB" class="border lazy lightbox noshadow lightbox-image" loading=lazy src=/cis400/images/6.8.6.png></a></p><h2 id=finishing-up>Finishing Up</h2><p>Since we&rsquo;re displaying the Rotten Tomatoes rating, we should probably also have a filter for it. This will work almost exactly like the IMDB rating - but with the range from 0 to 100. I&rsquo;ll leave this as an exercise for the reader.</p><footer class=footline></footer></article><article class=default><header class=headline></header><h1 id=numerical-filters>Numerical Filters</h1><p>Let&rsquo;s tackle one of the critics ratings next. While we could create categories and use checkboxes, this doesn&rsquo;t capture the incremental values (i.e. 4.3), and it would be a <em>lot</em> of checkboxes for Rotten Tomatoes ratings! Instead, we&rsquo;ll use a <em>numerical filter</em>, which limits our possible results to a range - between a minimum and maximum value.</p><p>Moreover, let&rsquo;s clean up our Index page, as it is getting difficult to determine what filter(s) go together, and and are adding more.</p><h2 id=refactoring-the-index-page>Refactoring the Index Page</h2><p>Let&rsquo;s move the filters to a column on the left, leave the search bar above, and show our results on the right. This will require refactoring our <em>Index.cshtml</em> file:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-csharp data-lang=csharp><span class=line><span class=cl>    <span class=p>&lt;</span><span class=n>form</span> <span class=n>id</span><span class=p>=</span><span class=s>&#34;movie-database&#34;</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=p>&lt;</span><span class=n>div</span> <span class=n>id</span><span class=p>=</span><span class=s>&#34;search&#34;</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>            <span class=p>&lt;</span><span class=n>input</span> <span class=n>type</span><span class=p>=</span><span class=s>&#34;text&#34;</span> <span class=n>name</span><span class=p>=</span><span class=s>&#34;SearchTerms&#34;</span> <span class=k>value</span><span class=p>=</span><span class=s>&#34;@Model.SearchTerms&#34;</span> <span class=p>/&gt;</span>
</span></span><span class=line><span class=cl>            <span class=p>&lt;</span><span class=n>input</span> <span class=n>type</span><span class=p>=</span><span class=s>&#34;submit&#34;</span> <span class=k>value</span><span class=p>=</span><span class=s>&#34;Search&#34;</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>        <span class=p>&lt;/</span><span class=n>div</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=p>&lt;</span><span class=n>div</span> <span class=n>id</span><span class=p>=</span><span class=s>&#34;filters&#34;</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>            <span class=p>&lt;</span><span class=n>h4</span><span class=p>&gt;</span><span class=n>MPAA</span> <span class=n>Rating</span><span class=p>&lt;/</span><span class=n>h4</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>            <span class=n>@foreach</span> <span class=p>(</span><span class=kt>string</span> <span class=n>rating</span> <span class=k>in</span> <span class=n>MovieDatabase</span><span class=p>.</span><span class=n>MPAARating</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            <span class=p>{</span>
</span></span><span class=line><span class=cl>                <span class=p>&lt;</span><span class=n>label</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>                    <span class=p>&lt;</span><span class=n>input</span> <span class=n>type</span><span class=p>=</span><span class=s>&#34;checkbox&#34;</span> <span class=n>name</span><span class=p>=</span><span class=s>&#34;MPAARatings&#34;</span> <span class=k>value</span><span class=p>=</span><span class=s>&#34;@rating&#34;</span> <span class=k>checked</span><span class=p>=</span><span class=s>&#34;@Model.MPAARatings.Contains(rating)&#34;</span> <span class=p>/&gt;</span>
</span></span><span class=line><span class=cl>                    <span class=n>@rating</span>
</span></span><span class=line><span class=cl>                <span class=p>&lt;/</span><span class=n>label</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>            <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>            <span class=p>&lt;</span><span class=n>h4</span><span class=p>&gt;</span><span class=n>Genre</span><span class=p>&lt;/</span><span class=n>h4</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>            <span class=n>@foreach</span> <span class=p>(</span><span class=kt>string</span> <span class=n>genre</span> <span class=k>in</span> <span class=n>MovieDatabase</span><span class=p>.</span><span class=n>Genres</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            <span class=p>{</span>
</span></span><span class=line><span class=cl>                <span class=p>&lt;</span><span class=n>label</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>                    <span class=p>&lt;</span><span class=n>input</span> <span class=n>type</span><span class=p>=</span><span class=s>&#34;checkbox&#34;</span> <span class=n>name</span><span class=p>=</span><span class=s>&#34;Genres&#34;</span> <span class=k>value</span><span class=p>=</span><span class=s>&#34;@genre&#34;</span> <span class=p>/&gt;</span>
</span></span><span class=line><span class=cl>                    <span class=n>@genre</span>
</span></span><span class=line><span class=cl>                <span class=p>&lt;/</span><span class=n>label</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>            <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>            <span class=p>&lt;</span><span class=n>h4</span><span class=p>&gt;</span><span class=n>IMDB</span> <span class=n>Rating</span><span class=p>&lt;/</span><span class=n>h4</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>            <span class=p>&lt;</span><span class=n>div</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>                <span class=n>Between</span>
</span></span><span class=line><span class=cl>                <span class=p>&lt;</span><span class=n>input</span> <span class=n>name</span><span class=p>=</span><span class=s>&#34;IMDBMin&#34;</span> <span class=n>type</span><span class=p>=</span><span class=s>&#34;number&#34;</span> <span class=n>min</span><span class=p>=</span><span class=s>&#34;0&#34;</span> <span class=n>max</span><span class=p>=</span><span class=s>&#34;10&#34;</span> <span class=n>step</span><span class=p>=</span><span class=s>&#34;0.1&#34;</span> <span class=n>placeholder</span><span class=p>=</span><span class=s>&#34;min&#34;</span><span class=p>/&gt;</span>
</span></span><span class=line><span class=cl>                <span class=n>and</span>
</span></span><span class=line><span class=cl>                <span class=p>&lt;</span><span class=n>input</span> <span class=n>name</span><span class=p>=</span><span class=s>&#34;IMDBMax&#34;</span> <span class=n>type</span><span class=p>=</span><span class=s>&#34;number&#34;</span> <span class=n>min</span><span class=p>=</span><span class=s>&#34;0&#34;</span> <span class=n>max</span><span class=p>=</span><span class=s>&#34;10&#34;</span> <span class=n>step</span><span class=p>=</span><span class=s>&#34;0.1&#34;</span> <span class=n>placeholder</span><span class=p>=</span><span class=s>&#34;max&#34;</span><span class=p>/&gt;</span>
</span></span><span class=line><span class=cl>            <span class=p>&lt;/</span><span class=n>div</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=p>&lt;/</span><span class=n>div</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=p>&lt;</span><span class=n>div</span> <span class=n>id</span><span class=p>=</span><span class=s>&#34;results&#34;</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>            <span class=p>&lt;</span><span class=n>h1</span><span class=p>&gt;</span><span class=n>Movie</span> <span class=n>Results</span><span class=p>&lt;/</span><span class=n>h1</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>            <span class=p>&lt;</span><span class=n>ul</span> <span class=n>class</span><span class=p>=</span><span class=s>&#34;movie-list&#34;</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>                <span class=n>@foreach</span> <span class=p>(</span><span class=n>Movie</span> <span class=n>movie</span> <span class=k>in</span> <span class=n>@Model</span><span class=p>.</span><span class=n>Movies</span><span class=p>)</span>
</span></span><span class=line><span class=cl>                <span class=p>{</span>
</span></span><span class=line><span class=cl>                    <span class=p>&lt;</span><span class=n>li</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>                        <span class=p>&lt;</span><span class=n>div</span> <span class=n>class</span><span class=p>=</span><span class=s>&#34;details&#34;</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>                            <span class=p>&lt;</span><span class=n>h3</span> <span class=n>class</span><span class=p>=</span><span class=s>&#34;title&#34;</span><span class=p>&gt;</span><span class=n>@movie</span><span class=p>.</span><span class=n>Title</span><span class=p>&lt;/</span><span class=n>h3</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>                            <span class=p>&lt;</span><span class=n>div</span> <span class=n>class</span><span class=p>=</span><span class=s>&#34;mpaa&#34;</span><span class=p>&gt;</span><span class=n>@movie</span><span class=p>.</span><span class=n>MPAARating</span><span class=p>&lt;/</span><span class=n>div</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>                            <span class=p>&lt;</span><span class=n>div</span> <span class=n>class</span><span class=p>=</span><span class=s>&#34;genre&#34;</span><span class=p>&gt;</span><span class=n>@movie</span><span class=p>.</span><span class=n>MajorGenre</span><span class=p>&lt;/</span><span class=n>div</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>                        <span class=p>&lt;/</span><span class=n>div</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>                        <span class=p>&lt;</span><span class=n>div</span> <span class=n>class</span><span class=p>=</span><span class=s>&#34;ratings&#34;</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>                            <span class=n>@if</span> <span class=p>(</span><span class=n>movie</span><span class=p>.</span><span class=n>IMDBRating</span> <span class=p>!=</span> <span class=kc>null</span><span class=p>)</span>
</span></span><span class=line><span class=cl>                            <span class=p>{</span>
</span></span><span class=line><span class=cl>                                <span class=p>&lt;</span><span class=n>div</span> <span class=n>class</span><span class=p>=</span><span class=s>&#34;imdb&#34;</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>                                    <span class=n>@movie</span><span class=p>.</span><span class=n>IMDBRating</span>
</span></span><span class=line><span class=cl>                                <span class=p>&lt;/</span><span class=n>div</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>                            <span class=p>}</span>
</span></span><span class=line><span class=cl>                            <span class=n>@if</span> <span class=p>(</span><span class=n>movie</span><span class=p>.</span><span class=n>RottenTomatoesRating</span> <span class=p>!=</span> <span class=kc>null</span><span class=p>)</span>
</span></span><span class=line><span class=cl>                            <span class=p>{</span>
</span></span><span class=line><span class=cl>                                <span class=p>&lt;</span><span class=n>div</span> <span class=n>class</span><span class=p>=</span><span class=s>&#34;rotten-tomatoes&#34;</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>                                    <span class=n>@movie</span><span class=p>.</span><span class=n>RottenTomatoesRating</span>
</span></span><span class=line><span class=cl>                                <span class=p>&lt;/</span><span class=n>div</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>                            <span class=p>}</span>
</span></span><span class=line><span class=cl>                        <span class=p>&lt;/</span><span class=n>div</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>                    <span class=p>&lt;/</span><span class=n>li</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>                <span class=p>}</span>
</span></span><span class=line><span class=cl>            <span class=p>&lt;/</span><span class=n>ul</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>        <span class=p>&lt;/</span><span class=n>div</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=p>&lt;/</span><span class=n>form</span><span class=p>&gt;</span></span></span></code></pre></div><p>Most of this is simply moving elements around the page, but note that we are using inputs of <code>type=number</code> to represent our range of IMDB values. We can specify a minimum and maximum for this range, as well as an allowable increment. Also, we use the <code>placeholder</code> attribute to put text into the <code>input</code> until a value is added.</p><h2 id=adding-more-styles>Adding More Styles</h2><p>Now we&rsquo;ll need to add some rules to our <em>wwwroot/css/styles.css</em>. First, we&rsquo;ll use a <code>grid</code> for the layout of the form:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-css data-lang=css><span class=line><span class=cl><span class=nt>form</span><span class=p>#</span><span class=nn>movie-database</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>display</span><span class=p>:</span> <span class=k>grid</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=k>grid-template-columns</span><span class=p>:</span> <span class=mi>1</span><span class=n>fr</span> <span class=mi>3</span><span class=n>fr</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=k>grid-template-rows</span><span class=p>:</span> <span class=kc>auto</span> <span class=kc>auto</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span></span></span></code></pre></div><p>The right column will be three times as big as the left.</p><p>We can make our search bar span both columns with <code>grid-column-start</code> and <code>grid-column-end</code>:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-css data-lang=css><span class=line><span class=cl><span class=p>#</span><span class=nn>search</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>grid-column-start</span><span class=p>:</span> <span class=mi>1</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=k>grid-column-end</span><span class=p>:</span> <span class=mi>3</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=k>text-align</span><span class=p>:</span> <span class=kc>center</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span></span></span></code></pre></div><p>Notice too that for CSS, we start counting at 1, not 0. The filters and the results will fall in the next row automatically, each taking up their own respective grid cell. You can read more about the grid layout in <a href=https://css-tricks.com/snippets/css/complete-guide-grid/ rel=external target=_blank>A Complete Guide to Grid</a>.</p><p>Let&rsquo;s go ahead and use flexbox to lay out our filters in a column:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-css data-lang=css><span class=line><span class=cl><span class=p>#</span><span class=nn>filters</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>display</span><span class=p>:</span> <span class=kc>flex</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=k>flex-direction</span><span class=p>:</span> <span class=kc>column</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span></span></span></code></pre></div><p>And make our number inputs bigger:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-css data-lang=css><span class=line><span class=cl><span class=p>#</span><span class=nn>filters</span> <span class=nt>input</span><span class=o>[</span><span class=nt>type</span><span class=o>=</span><span class=nt>number</span><span class=o>]</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>width</span><span class=p>:</span> <span class=mi>4</span><span class=kt>rem</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span></span></span></code></pre></div><p>Notice the use of square brackets in our CSS Selector to only apply to inputs with type number.</p><p>Also, let&rsquo;s add a margin above and remove most of the margin below our <code>&lt;h4></code> elements:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-css data-lang=css><span class=line><span class=cl><span class=p>#</span><span class=nn>filters</span> <span class=nt>h4</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>margin-bottom</span><span class=p>:</span> <span class=mf>0.2</span><span class=kt>rem</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=k>margin-top</span><span class=p>:</span> <span class=mi>2</span><span class=kt>rem</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span></span></span></code></pre></div><p>The resulting page looks much cleaner:</p><p><a href=#R-image-bc9bebcae39e3d634285c11227f38a5a class=lightbox-link><img alt="The Styled Page" class="border lazy lightbox noshadow figure-image" loading=lazy src=/cis400/images/6.8.5.png style=height:auto;width:auto></a>
<a href=javascript:history.back(); class=lightbox-back id=R-image-bc9bebcae39e3d634285c11227f38a5a><img alt="The Styled Page" class="border lazy lightbox noshadow lightbox-image" loading=lazy src=/cis400/images/6.8.5.png></a></p><h2 id=capturing-the-filter-values>Capturing the Filter Values</h2><p>Now we need to get the filter values from our GET request query string. We could do this like we&rsquo;ve been doing before, with:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-csharp data-lang=csharp><span class=line><span class=cl>    <span class=n>Request</span><span class=p>.</span><span class=n>Query</span><span class=p>[</span><span class=s>&#34;IMDBMin&#34;</span><span class=p>];</span></span></span></code></pre></div><p>But the returned value would be a string, so we&rsquo;d need to parse it:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-csharp data-lang=csharp><span class=line><span class=cl>    <span class=n>IMDBMin</span> <span class=p>=</span> <span class=kt>double</span><span class=p>.</span><span class=n>Parse</span><span class=p>(</span><span class=n>Request</span><span class=p>.</span><span class=n>Query</span><span class=p>[</span><span class=s>&#34;IMDBMin&#34;</span><span class=p>]);</span></span></span></code></pre></div><p>If the query was <code>null</code>, then this would evaluate to <code>NaN</code>, which we wouldn&rsquo;t want to set our <code>&lt;input></code> to&mldr;</p><p>Instead, we&rsquo;ll look at some options built into the PageModel.</p><h2 id=parameter-binding>Parameter Binding</h2><p>The first of these options is <a href=https://docs.microsoft.com/en-us/aspnet/web-api/overview/formats-and-model-binding/parameter-binding-in-aspnet-web-api rel=external target=_blank><em>Parameter Binding</em></a>. In this approach, we define parameters to our <code>OnGet()</code> method to be parsed out of the request automatically, i.e.:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-csharp data-lang=csharp><span class=line><span class=cl>    <span class=cs>/// &lt;summary&gt;</span>
</span></span><span class=line><span class=cl>    <span class=cs>/// Gets the search results for display on the page</span>
</span></span><span class=line><span class=cl>    <span class=cs>/// &lt;/summary&gt;</span>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=k>void</span> <span class=n>OnGet</span><span class=p>(</span><span class=kt>string</span> <span class=n>SearchTerms</span><span class=p>,</span> <span class=kt>string</span><span class=p>[]</span> <span class=n>MPAARatings</span><span class=p>,</span> <span class=kt>string</span><span class=p>[]</span> <span class=n>Genres</span><span class=p>,</span> <span class=kt>double?</span> <span class=n>IMDBMin</span><span class=p>,</span> <span class=kt>double?</span> <span class=n>IMDBMax</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=k>this</span><span class=p>.</span><span class=n>SearchTerms</span> <span class=p>=</span> <span class=n>SearchTerms</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=k>this</span><span class=p>.</span><span class=n>MPAARatings</span> <span class=p>=</span> <span class=n>MPAARatings</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=k>this</span><span class=p>.</span><span class=n>Genres</span> <span class=p>=</span> <span class=n>Genres</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=k>this</span><span class=p>.</span><span class=n>IMDBMin</span> <span class=p>=</span> <span class=n>IMDBMin</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=k>this</span><span class=p>.</span><span class=n>IMDBMax</span> <span class=p>=</span> <span class=n>IMDBMax</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=n>Movies</span> <span class=p>=</span> <span class=n>MovieDatabase</span><span class=p>.</span><span class=n>Search</span><span class=p>(</span><span class=n>SearchTerms</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=n>Movies</span> <span class=p>=</span> <span class=n>MovieDatabase</span><span class=p>.</span><span class=n>FilterByMPAARating</span><span class=p>(</span><span class=n>Movies</span><span class=p>,</span> <span class=n>MPAARatings</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=n>Movies</span> <span class=p>=</span> <span class=n>MovieDatabase</span><span class=p>.</span><span class=n>FilterByGenre</span><span class=p>(</span><span class=n>Movies</span><span class=p>,</span> <span class=n>Genres</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=n>Movies</span> <span class=p>=</span> <span class=n>MovieDatabase</span><span class=p>.</span><span class=n>FilterByIMDBRating</span><span class=p>(</span><span class=n>Movies</span><span class=p>,</span> <span class=n>IMDBMin</span><span class=p>,</span> <span class=n>IMDBMax</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span></span></span></code></pre></div><p>The benefit of this approach is that as long as C# knows a conversion into the type we specify, the conversion is done automatically. Note that the parameter name matches the <code>name</code> property of the corresponding <code>&lt;input></code> - this must be the case for the Razor Page to bind the parameter to the corresponding input value.</p><p>Note that we still need to assign these parameter values to the corresponding properties of our PageModel. If we don&rsquo;t, then those properties will all be <code>null</code>, and the <code>&lt;inputs></code> rendered on our page will always be blank.</p><h2 id=model-binding>Model Binding</h2><p>A second option is to use <a href="https://docs.microsoft.com/en-us/aspnet/core/mvc/models/model-binding?view=aspnetcore-3.1" rel=external target=_blank><em>Model Binding</em></a>. Model binding also automatically converts incoming form data, but in this case it binds directly to the properties of our PageModel. We indicate this form of binding with a <code>[BindProperty]</code> attribute, i.e.:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-csharp data-lang=csharp><span class=line><span class=cl><span class=kd>public</span> <span class=k>class</span> <span class=nc>IndexModel</span> <span class=p>:</span> <span class=n>PageModel</span> <span class=p>{</span>
</span></span><span class=line><span class=cl><span class=na>
</span></span></span><span class=line><span class=cl><span class=na>    [BindProperty(SupportsGet=true)]</span>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=kt>string</span> <span class=n>SearchTerms</span> <span class=p>{</span><span class=k>get</span><span class=p>;</span> <span class=k>set</span><span class=p>;}</span>
</span></span><span class=line><span class=cl><span class=na>
</span></span></span><span class=line><span class=cl><span class=na>    [BindProperty(SupportsGet=true)]</span>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=kt>string</span><span class=p>[]</span> <span class=n>MPAARatings</span> <span class=p>{</span><span class=k>get</span><span class=p>;</span> <span class=k>set</span><span class=p>;}</span>
</span></span><span class=line><span class=cl><span class=na>
</span></span></span><span class=line><span class=cl><span class=na>    [BindProperty(SupportsGet=true)]</span>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=kt>string</span><span class=p>[]</span> <span class=n>Genres</span> <span class=p>{</span><span class=k>get</span><span class=p>;</span> <span class=k>set</span><span class=p>;}</span>
</span></span><span class=line><span class=cl><span class=na>
</span></span></span><span class=line><span class=cl><span class=na>    [BindProperty(SupportsGet=true)]</span>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=kt>double?</span> <span class=n>IMDBMin</span> <span class=p>{</span><span class=k>get</span><span class=p>;</span> <span class=k>set</span><span class=p>;}</span>
</span></span><span class=line><span class=cl><span class=na>
</span></span></span><span class=line><span class=cl><span class=na>    [BindProperty(SupportsGet=true)]</span>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=kt>double?</span> <span class=n>IMDBMax</span> <span class=p>{</span><span class=k>get</span><span class=p>;</span> <span class=k>set</span><span class=p>;}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=cs>/// &lt;summary&gt;</span>
</span></span><span class=line><span class=cl>    <span class=cs>/// Gets the search results for display on the page</span>
</span></span><span class=line><span class=cl>    <span class=cs>/// &lt;/summary&gt;</span>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=k>void</span> <span class=n>OnGet</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=n>Movies</span> <span class=p>=</span> <span class=n>MovieDatabase</span><span class=p>.</span><span class=n>Search</span><span class=p>(</span><span class=n>SearchTerms</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=n>Movies</span> <span class=p>=</span> <span class=n>MovieDatabase</span><span class=p>.</span><span class=n>FilterByMPAARating</span><span class=p>(</span><span class=n>Movies</span><span class=p>,</span> <span class=n>MPAARatings</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=n>Movies</span> <span class=p>=</span> <span class=n>MovieDatabase</span><span class=p>.</span><span class=n>FilterByGenre</span><span class=p>(</span><span class=n>Movies</span><span class=p>,</span> <span class=n>Genres</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=n>Movies</span> <span class=p>=</span> <span class=n>MovieDatabase</span><span class=p>.</span><span class=n>FilterByIMDBRating</span><span class=p>(</span><span class=n>Movies</span><span class=p>,</span> <span class=n>IMDBMin</span><span class=p>,</span> <span class=n>IMDBMax</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span></span></span></code></pre></div><p>Note that with this approach, the incoming data is directly bound to the properties, so we don&rsquo;t need to do any special assignments within our <code>OnGet()</code> method. Also, note that we have to use <code>SupportsGet=true</code> in order for this binding to occur on GET requests (by default, model binding only happens with POST requests).</p><div class="box notices cstyle note"><div class=box-label><i class="fa-fw fas fa-exclamation-circle"></i> Note</div><div class=box-content><p>You only need to do <em>one</em> binding approach per property in a PageModel. I.e. you can just use the property decorator:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-csharp data-lang=csharp><span class=line><span class=cl><span class=kd>public</span> <span class=k>class</span> <span class=nc>SomePageModel</span> <span class=p>:</span> <span class=n>PageModel</span>
</span></span><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl><span class=na>    [BindProperty(SupportsGet=true)]</span>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=kt>float</span> <span class=n>SomeProperty</span> <span class=p>{</span> <span class=k>get</span><span class=p>;</span> <span class=k>set</span><span class=p>;</span> <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=k>void</span> <span class=n>OnGet</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=n>DoSomething</span><span class=p>(</span><span class=n>SomeProperty</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span></span></span></code></pre></div><p><em>or</em> you might use parameter binding:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-csharp data-lang=csharp><span class=line><span class=cl><span class=kd>public</span> <span class=k>class</span> <span class=nc>SomePageModel</span> <span class=p>:</span> <span class=n>PageModel</span>
</span></span><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=k>void</span> <span class=n>OnGet</span><span class=p>(</span><span class=kt>float</span> <span class=n>SomeProperty</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=n>DoSomething</span><span class=p>(</span><span class=n>SomeProperty</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span></span></span></code></pre></div><p><em>or</em> you can parse it from the request:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-csharp data-lang=csharp><span class=line><span class=cl><span class=kd>public</span> <span class=k>class</span> <span class=nc>SomePageModel</span> <span class=p>:</span> <span class=n>PageModel</span>
</span></span><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=k>void</span> <span class=n>OnGet</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=kt>var</span> <span class=n>someProperty</span> <span class=p>=</span> <span class=kt>float</span><span class=p>.</span><span class=n>Parse</span><span class=p>(</span><span class=n>Request</span><span class=p>.</span><span class=n>Query</span><span class=p>[</span><span class=s>&#34;SomeProperty&#34;</span><span class=p>]);</span>
</span></span><span class=line><span class=cl>        <span class=n>DoSomething</span><span class=p>(</span><span class=n>someProperty</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span></span></span></code></pre></div><p>These are all <em>different means</em> of accessing the <em>same data</em> from the incoming request.</p></div></div><p>Now all we need to do is implement the actual filter.</p><h3 id=implementing-the-imdb-rating-filter>Implementing the IMDB Rating Filter</h3><p>We&rsquo;ll define the new filter in our <code>MovieDatabase</code> class as another static method:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-csharp data-lang=csharp><span class=line><span class=cl>    <span class=cs>/// &lt;summary&gt;</span>
</span></span><span class=line><span class=cl>    <span class=cs>/// Filters the provided collection of movies</span>
</span></span><span class=line><span class=cl>    <span class=cs>/// to those with IMDB ratings falling within</span>
</span></span><span class=line><span class=cl>    <span class=cs>/// the specified range</span>
</span></span><span class=line><span class=cl>    <span class=cs>/// &lt;/summary&gt;</span>
</span></span><span class=line><span class=cl>    <span class=cs>/// &lt;param name=&#34;movies&#34;&gt;The collection of movies to filter&lt;/param&gt;</span>
</span></span><span class=line><span class=cl>    <span class=cs>/// &lt;param name=&#34;min&#34;&gt;The minimum range value&lt;/param&gt;</span>
</span></span><span class=line><span class=cl>    <span class=cs>/// &lt;param name=&#34;max&#34;&gt;The maximum range value&lt;/param&gt;</span>
</span></span><span class=line><span class=cl>    <span class=cs>/// &lt;returns&gt;The filtered movie collection&lt;/returns&gt;</span>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=kd>static</span> <span class=n>IEnumerable</span><span class=p>&lt;</span><span class=n>Movie</span><span class=p>&gt;</span> <span class=n>FilterByIMDBRating</span><span class=p>(</span><span class=n>IEnumerable</span><span class=p>&lt;</span><span class=n>Movie</span><span class=p>&gt;</span> <span class=n>movies</span><span class=p>,</span> <span class=kt>double?</span> <span class=n>min</span><span class=p>,</span> <span class=kt>double?</span> <span class=n>max</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=c1>// TODO: Filter movies</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span></span></span></code></pre></div><p>Notice that here too we use the nullable double value. So our first step is probably to do a <code>null</code> check:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-csharp data-lang=csharp><span class=line><span class=cl>    <span class=k>if</span> <span class=p>(</span><span class=n>min</span> <span class=p>==</span> <span class=kc>null</span> <span class=p>&amp;&amp;</span> <span class=n>max</span> <span class=p>==</span> <span class=kc>null</span><span class=p>)</span> <span class=k>return</span> <span class=n>movies</span><span class=p>;</span></span></span></code></pre></div><p>But what if only one is null? Should we filter for that part of the range? It wouldn&rsquo;t be hard to do:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-csharp data-lang=csharp><span class=line><span class=cl>    <span class=kt>var</span> <span class=n>results</span> <span class=p>=</span> <span class=k>new</span> <span class=n>List</span><span class=p>&lt;</span><span class=n>Movie</span><span class=p>&gt;();</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c1>// only a maximum specified</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span><span class=p>(</span><span class=n>min</span> <span class=p>==</span> <span class=kc>null</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=k>foreach</span><span class=p>(</span><span class=n>Movie</span> <span class=n>movie</span> <span class=k>in</span> <span class=n>movies</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=k>if</span> <span class=p>(</span><span class=n>movie</span><span class=p>.</span><span class=n>IMDBRating</span> <span class=p>&lt;=</span> <span class=n>max</span><span class=p>)</span> <span class=n>results</span><span class=p>.</span><span class=n>Add</span><span class=p>(</span><span class=n>movie</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=n>results</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span></span></span></code></pre></div><p>And the minimum would mirror that:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-csharp data-lang=csharp><span class=line><span class=cl>    <span class=c1>// only a minimum specified</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span><span class=p>(</span><span class=n>max</span> <span class=p>==</span> <span class=kc>null</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=k>foreach</span><span class=p>(</span><span class=n>Movie</span> <span class=n>movie</span> <span class=k>in</span> <span class=n>movies</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=k>if</span> <span class=p>(</span><span class=n>movie</span><span class=p>.</span><span class=n>IMDBRating</span> <span class=p>&gt;=</span> <span class=n>min</span><span class=p>)</span> <span class=n>results</span><span class=p>.</span><span class=n>Add</span><span class=p>(</span><span class=n>movie</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=n>results</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span></span></span></code></pre></div><p>Finally, we could handle the case where we have both a min and max value to our range:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-csharp data-lang=csharp><span class=line><span class=cl>    <span class=c1>// Both minimum and maximum specified</span>
</span></span><span class=line><span class=cl>    <span class=k>foreach</span><span class=p>(</span><span class=n>Movie</span> <span class=n>movie</span> <span class=k>in</span> <span class=n>movies</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span><span class=p>(</span><span class=n>movie</span><span class=p>.</span><span class=n>IMDBRating</span> <span class=p>&gt;=</span> <span class=n>min</span> <span class=p>&amp;&amp;</span> <span class=n>movie</span><span class=p>.</span><span class=n>IMDBRating</span> <span class=p>&lt;=</span> <span class=n>max</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=n>results</span><span class=p>.</span><span class=n>Add</span><span class=p>(</span><span class=n>movie</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=n>results</span><span class=p>;</span></span></span></code></pre></div><p>Notice too, that in each of these cases we&rsquo;re treating the range as <em>inclusive</em> (including the specified minimum and maximum). This is the behavior most casual internet users will expect. If the database and user expectations are different for your audience, you&rsquo;d want your code to match that expectation.</p><p>Now we can filter by IMDB rating:</p><p><a href=#R-image-a3ce6bc4e10b4342ebd12ed176e730e6 class=lightbox-link><img alt="Filtering By IMDB" class="border lazy lightbox noshadow figure-image" loading=lazy src=/cis400/images/6.8.6.png style=height:auto;width:auto></a>
<a href=javascript:history.back(); class=lightbox-back id=R-image-a3ce6bc4e10b4342ebd12ed176e730e6><img alt="Filtering By IMDB" class="border lazy lightbox noshadow lightbox-image" loading=lazy src=/cis400/images/6.8.6.png></a></p><h2 id=finishing-up>Finishing Up</h2><p>Since we&rsquo;re displaying the Rotten Tomatoes rating, we should probably also have a filter for it. This will work almost exactly like the IMDB rating - but with the range from 0 to 100. I&rsquo;ll leave this as an exercise for the reader.</p><footer class=footline></footer></article><article class=default><header class=headline></header><h1 id=numerical-filters>Numerical Filters</h1><p>Let&rsquo;s tackle one of the critics ratings next. While we could create categories and use checkboxes, this doesn&rsquo;t capture the incremental values (i.e. 4.3), and it would be a <em>lot</em> of checkboxes for Rotten Tomatoes ratings! Instead, we&rsquo;ll use a <em>numerical filter</em>, which limits our possible results to a range - between a minimum and maximum value.</p><p>Moreover, let&rsquo;s clean up our Index page, as it is getting difficult to determine what filter(s) go together, and and are adding more.</p><h2 id=refactoring-the-index-page>Refactoring the Index Page</h2><p>Let&rsquo;s move the filters to a column on the left, leave the search bar above, and show our results on the right. This will require refactoring our <em>Index.cshtml</em> file:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-csharp data-lang=csharp><span class=line><span class=cl>    <span class=p>&lt;</span><span class=n>form</span> <span class=n>id</span><span class=p>=</span><span class=s>&#34;movie-database&#34;</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=p>&lt;</span><span class=n>div</span> <span class=n>id</span><span class=p>=</span><span class=s>&#34;search&#34;</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>            <span class=p>&lt;</span><span class=n>input</span> <span class=n>type</span><span class=p>=</span><span class=s>&#34;text&#34;</span> <span class=n>name</span><span class=p>=</span><span class=s>&#34;SearchTerms&#34;</span> <span class=k>value</span><span class=p>=</span><span class=s>&#34;@Model.SearchTerms&#34;</span> <span class=p>/&gt;</span>
</span></span><span class=line><span class=cl>            <span class=p>&lt;</span><span class=n>input</span> <span class=n>type</span><span class=p>=</span><span class=s>&#34;submit&#34;</span> <span class=k>value</span><span class=p>=</span><span class=s>&#34;Search&#34;</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>        <span class=p>&lt;/</span><span class=n>div</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=p>&lt;</span><span class=n>div</span> <span class=n>id</span><span class=p>=</span><span class=s>&#34;filters&#34;</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>            <span class=p>&lt;</span><span class=n>h4</span><span class=p>&gt;</span><span class=n>MPAA</span> <span class=n>Rating</span><span class=p>&lt;/</span><span class=n>h4</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>            <span class=n>@foreach</span> <span class=p>(</span><span class=kt>string</span> <span class=n>rating</span> <span class=k>in</span> <span class=n>MovieDatabase</span><span class=p>.</span><span class=n>MPAARatings</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            <span class=p>{</span>
</span></span><span class=line><span class=cl>                <span class=p>&lt;</span><span class=n>label</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>                    <span class=p>&lt;</span><span class=n>input</span> <span class=n>type</span><span class=p>=</span><span class=s>&#34;checkbox&#34;</span> <span class=n>name</span><span class=p>=</span><span class=s>&#34;MPAARatings&#34;</span> <span class=k>value</span><span class=p>=</span><span class=s>&#34;@rating&#34;</span> <span class=k>checked</span><span class=p>=</span><span class=s>&#34;@Model.MPAARatings.Contains(rating)&#34;</span> <span class=p>/&gt;</span>
</span></span><span class=line><span class=cl>                    <span class=n>@rating</span>
</span></span><span class=line><span class=cl>                <span class=p>&lt;/</span><span class=n>label</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>            <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>            <span class=p>&lt;</span><span class=n>h4</span><span class=p>&gt;</span><span class=n>Genre</span><span class=p>&lt;/</span><span class=n>h4</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>            <span class=n>@foreach</span> <span class=p>(</span><span class=kt>string</span> <span class=n>genre</span> <span class=k>in</span> <span class=n>MovieDatabase</span><span class=p>.</span><span class=n>Genres</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            <span class=p>{</span>
</span></span><span class=line><span class=cl>                <span class=p>&lt;</span><span class=n>label</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>                    <span class=p>&lt;</span><span class=n>input</span> <span class=n>type</span><span class=p>=</span><span class=s>&#34;checkbox&#34;</span> <span class=n>name</span><span class=p>=</span><span class=s>&#34;Genres&#34;</span> <span class=k>value</span><span class=p>=</span><span class=s>&#34;@genre&#34;</span> <span class=p>/&gt;</span>
</span></span><span class=line><span class=cl>                    <span class=n>@genre</span>
</span></span><span class=line><span class=cl>                <span class=p>&lt;/</span><span class=n>label</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>            <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>            <span class=p>&lt;</span><span class=n>h4</span><span class=p>&gt;</span><span class=n>IMDB</span> <span class=n>Rating</span><span class=p>&lt;/</span><span class=n>h4</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>            <span class=p>&lt;</span><span class=n>div</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>                <span class=n>Between</span>
</span></span><span class=line><span class=cl>                <span class=p>&lt;</span><span class=n>input</span> <span class=n>name</span><span class=p>=</span><span class=s>&#34;IMDBMin&#34;</span> <span class=n>type</span><span class=p>=</span><span class=s>&#34;number&#34;</span> <span class=n>min</span><span class=p>=</span><span class=s>&#34;0&#34;</span> <span class=n>max</span><span class=p>=</span><span class=s>&#34;10&#34;</span> <span class=n>step</span><span class=p>=</span><span class=s>&#34;0.1&#34;</span> <span class=n>placeholder</span><span class=p>=</span><span class=s>&#34;min&#34;</span><span class=p>/&gt;</span>
</span></span><span class=line><span class=cl>                <span class=n>and</span>
</span></span><span class=line><span class=cl>                <span class=p>&lt;</span><span class=n>input</span> <span class=n>name</span><span class=p>=</span><span class=s>&#34;IMDBMax&#34;</span> <span class=n>type</span><span class=p>=</span><span class=s>&#34;number&#34;</span> <span class=n>min</span><span class=p>=</span><span class=s>&#34;0&#34;</span> <span class=n>max</span><span class=p>=</span><span class=s>&#34;10&#34;</span> <span class=n>step</span><span class=p>=</span><span class=s>&#34;0.1&#34;</span> <span class=n>placeholder</span><span class=p>=</span><span class=s>&#34;max&#34;</span><span class=p>/&gt;</span>
</span></span><span class=line><span class=cl>            <span class=p>&lt;/</span><span class=n>div</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=p>&lt;/</span><span class=n>div</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=p>&lt;</span><span class=n>div</span> <span class=n>id</span><span class=p>=</span><span class=s>&#34;results&#34;</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>            <span class=p>&lt;</span><span class=n>h1</span><span class=p>&gt;</span><span class=n>Movie</span> <span class=n>Results</span><span class=p>&lt;/</span><span class=n>h1</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>            <span class=p>&lt;</span><span class=n>ul</span> <span class=n>class</span><span class=p>=</span><span class=s>&#34;movie-list&#34;</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>                <span class=n>@foreach</span> <span class=p>(</span><span class=n>Movie</span> <span class=n>movie</span> <span class=k>in</span> <span class=n>@Model</span><span class=p>.</span><span class=n>Movies</span><span class=p>)</span>
</span></span><span class=line><span class=cl>                <span class=p>{</span>
</span></span><span class=line><span class=cl>                    <span class=p>&lt;</span><span class=n>li</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>                        <span class=p>&lt;</span><span class=n>div</span> <span class=n>class</span><span class=p>=</span><span class=s>&#34;details&#34;</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>                            <span class=p>&lt;</span><span class=n>h3</span> <span class=n>class</span><span class=p>=</span><span class=s>&#34;title&#34;</span><span class=p>&gt;</span><span class=n>@movie</span><span class=p>.</span><span class=n>Title</span><span class=p>&lt;/</span><span class=n>h3</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>                            <span class=p>&lt;</span><span class=n>div</span> <span class=n>class</span><span class=p>=</span><span class=s>&#34;mpaa&#34;</span><span class=p>&gt;</span><span class=n>@movie</span><span class=p>.</span><span class=n>MPAARating</span><span class=p>&lt;/</span><span class=n>div</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>                            <span class=p>&lt;</span><span class=n>div</span> <span class=n>class</span><span class=p>=</span><span class=s>&#34;genre&#34;</span><span class=p>&gt;</span><span class=n>@movie</span><span class=p>.</span><span class=n>MajorGenre</span><span class=p>&lt;/</span><span class=n>div</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>                        <span class=p>&lt;/</span><span class=n>div</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>                        <span class=p>&lt;</span><span class=n>div</span> <span class=n>class</span><span class=p>=</span><span class=s>&#34;ratings&#34;</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>                            <span class=n>@if</span> <span class=p>(</span><span class=n>movie</span><span class=p>.</span><span class=n>IMDBRating</span> <span class=p>!=</span> <span class=kc>null</span><span class=p>)</span>
</span></span><span class=line><span class=cl>                            <span class=p>{</span>
</span></span><span class=line><span class=cl>                                <span class=p>&lt;</span><span class=n>div</span> <span class=n>class</span><span class=p>=</span><span class=s>&#34;imdb&#34;</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>                                    <span class=n>@movie</span><span class=p>.</span><span class=n>IMDBRating</span>
</span></span><span class=line><span class=cl>                                <span class=p>&lt;/</span><span class=n>div</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>                            <span class=p>}</span>
</span></span><span class=line><span class=cl>                            <span class=n>@if</span> <span class=p>(</span><span class=n>movie</span><span class=p>.</span><span class=n>RottenTomatoesRating</span> <span class=p>!=</span> <span class=kc>null</span><span class=p>)</span>
</span></span><span class=line><span class=cl>                            <span class=p>{</span>
</span></span><span class=line><span class=cl>                                <span class=p>&lt;</span><span class=n>div</span> <span class=n>class</span><span class=p>=</span><span class=s>&#34;rotten-tomatoes&#34;</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>                                    <span class=n>@movie</span><span class=p>.</span><span class=n>RottenTomatoesRating</span>
</span></span><span class=line><span class=cl>                                <span class=p>&lt;/</span><span class=n>div</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>                            <span class=p>}</span>
</span></span><span class=line><span class=cl>                        <span class=p>&lt;/</span><span class=n>div</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>                    <span class=p>&lt;/</span><span class=n>li</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>                <span class=p>}</span>
</span></span><span class=line><span class=cl>            <span class=p>&lt;/</span><span class=n>ul</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>        <span class=p>&lt;/</span><span class=n>div</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=p>&lt;/</span><span class=n>form</span><span class=p>&gt;</span></span></span></code></pre></div><p>Most of this is simply moving elements around the page, but note that we are using inputs of <code>type=number</code> to represent our range of IMDB values. We can specify a minimum and maximum for this range, as well as an allowable increment. Also, we use the <code>placeholder</code> attribute to put text into the <code>input</code> until a value is added.</p><h2 id=adding-more-styles>Adding More Styles</h2><p>Now we&rsquo;ll need to add some rules to our <em>wwwroot/css/styles.css</em>. First, we&rsquo;ll use a <code>grid</code> for the layout of the form:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-css data-lang=css><span class=line><span class=cl><span class=nt>form</span><span class=p>#</span><span class=nn>movie-database</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>display</span><span class=p>:</span> <span class=k>grid</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=k>grid-template-columns</span><span class=p>:</span> <span class=mi>1</span><span class=n>fr</span> <span class=mi>3</span><span class=n>fr</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=k>grid-template-rows</span><span class=p>:</span> <span class=kc>auto</span> <span class=kc>auto</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span></span></span></code></pre></div><p>The right column will be three times as big as the left.</p><p>We can make our search bar span both columns with <code>grid-column-start</code> and <code>grid-column-end</code>:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-css data-lang=css><span class=line><span class=cl><span class=p>#</span><span class=nn>search</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>grid-column-start</span><span class=p>:</span> <span class=mi>1</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=k>grid-column-end</span><span class=p>:</span> <span class=mi>3</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=k>text-align</span><span class=p>:</span> <span class=kc>center</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span></span></span></code></pre></div><p>Notice too that for CSS, we start counting at 1, not 0. The filters and the results will fall in the next row automatically, each taking up their own respective grid cell. You can read more about the grid layout in <a href=https://css-tricks.com/snippets/css/complete-guide-grid/ rel=external target=_blank>A Complete Guide to Grid</a>.</p><p>Let&rsquo;s go ahead and use flexbox to lay out our filters in a column:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-css data-lang=css><span class=line><span class=cl><span class=p>#</span><span class=nn>filters</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>display</span><span class=p>:</span> <span class=kc>flex</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=k>flex-direction</span><span class=p>:</span> <span class=kc>column</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span></span></span></code></pre></div><p>And make our number inputs bigger:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-css data-lang=css><span class=line><span class=cl><span class=p>#</span><span class=nn>filters</span> <span class=nt>input</span><span class=o>[</span><span class=nt>type</span><span class=o>=</span><span class=nt>number</span><span class=o>]</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>width</span><span class=p>:</span> <span class=mi>4</span><span class=kt>rem</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span></span></span></code></pre></div><p>Notice the use of square brackets in our CSS Selector to only apply to inputs with type number.</p><p>Also, let&rsquo;s add a margin above and remove most of the margin below our <code>&lt;h4></code> elements:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-css data-lang=css><span class=line><span class=cl><span class=p>#</span><span class=nn>filters</span> <span class=nt>h4</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>margin-bottom</span><span class=p>:</span> <span class=mf>0.2</span><span class=kt>rem</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=k>margin-top</span><span class=p>:</span> <span class=mi>2</span><span class=kt>rem</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span></span></span></code></pre></div><p>The resulting page looks much cleaner:</p><p><a href=#R-image-bc3d9709992e9f4ca5a20a94c0ec6c21 class=lightbox-link><img alt="The Styled Page" class="border lazy lightbox noshadow figure-image" loading=lazy src=/cis400/images/6.8.5.png style=height:auto;width:auto></a>
<a href=javascript:history.back(); class=lightbox-back id=R-image-bc3d9709992e9f4ca5a20a94c0ec6c21><img alt="The Styled Page" class="border lazy lightbox noshadow lightbox-image" loading=lazy src=/cis400/images/6.8.5.png></a></p><h2 id=capturing-the-filter-values>Capturing the Filter Values</h2><p>Now we need to get the filter values from our GET request query string. We could do this like we&rsquo;ve been doing before, with:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-csharp data-lang=csharp><span class=line><span class=cl>    <span class=n>Request</span><span class=p>.</span><span class=n>Query</span><span class=p>[</span><span class=s>&#34;IMDBMin&#34;</span><span class=p>];</span></span></span></code></pre></div><p>But the returned value would be a string, so we&rsquo;d need to parse it:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-csharp data-lang=csharp><span class=line><span class=cl>    <span class=n>IMDBMin</span> <span class=p>=</span> <span class=kt>double</span><span class=p>.</span><span class=n>Parse</span><span class=p>(</span><span class=n>Request</span><span class=p>.</span><span class=n>Query</span><span class=p>[</span><span class=s>&#34;IMDBMin&#34;</span><span class=p>]);</span></span></span></code></pre></div><p>If the query was <code>null</code>, then this would evaluate to <code>NaN</code>, which we wouldn&rsquo;t want to set our <code>&lt;input></code> to&mldr;</p><p>Instead, we&rsquo;ll look at some options built into the PageModel.</p><h2 id=parameter-binding>Parameter Binding</h2><p>The first of these options is <a href=https://docs.microsoft.com/en-us/aspnet/web-api/overview/formats-and-model-binding/parameter-binding-in-aspnet-web-api rel=external target=_blank><em>Parameter Binding</em></a>. In this approach, we define parameters to our <code>OnGet()</code> method to be parsed out of the request automatically, i.e.:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-csharp data-lang=csharp><span class=line><span class=cl>    <span class=cs>/// &lt;summary&gt;</span>
</span></span><span class=line><span class=cl>    <span class=cs>/// Gets the search results for display on the page</span>
</span></span><span class=line><span class=cl>    <span class=cs>/// &lt;/summary&gt;</span>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=k>void</span> <span class=n>OnGet</span><span class=p>(</span><span class=kt>string</span> <span class=n>SearchTerms</span><span class=p>,</span> <span class=kt>string</span><span class=p>[]</span> <span class=n>MPAARatings</span><span class=p>,</span> <span class=kt>string</span><span class=p>[]</span> <span class=n>Genres</span><span class=p>,</span> <span class=kt>double?</span> <span class=n>IMDBMin</span><span class=p>,</span> <span class=kt>double?</span> <span class=n>IMDBMax</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=k>this</span><span class=p>.</span><span class=n>SearchTerms</span> <span class=p>=</span> <span class=n>SearchTerms</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=k>this</span><span class=p>.</span><span class=n>MPAARatings</span> <span class=p>=</span> <span class=n>MPAARatings</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=k>this</span><span class=p>.</span><span class=n>Genres</span> <span class=p>=</span> <span class=n>Genres</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=k>this</span><span class=p>.</span><span class=n>IMDBMin</span> <span class=p>=</span> <span class=n>IMDBMin</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=k>this</span><span class=p>.</span><span class=n>IMDBMax</span> <span class=p>=</span> <span class=n>IMDBMax</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=n>Movies</span> <span class=p>=</span> <span class=n>MovieDatabase</span><span class=p>.</span><span class=n>Search</span><span class=p>(</span><span class=n>SearchTerms</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=n>Movies</span> <span class=p>=</span> <span class=n>MovieDatabase</span><span class=p>.</span><span class=n>FilterByMPAARating</span><span class=p>(</span><span class=n>Movies</span><span class=p>,</span> <span class=n>MPAARatings</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=n>Movies</span> <span class=p>=</span> <span class=n>MovieDatabase</span><span class=p>.</span><span class=n>FilterByGenre</span><span class=p>(</span><span class=n>Movies</span><span class=p>,</span> <span class=n>Genres</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=n>Movies</span> <span class=p>=</span> <span class=n>MovieDatabase</span><span class=p>.</span><span class=n>FilterByIMDBRating</span><span class=p>(</span><span class=n>Movies</span><span class=p>,</span> <span class=n>IMDBMin</span><span class=p>,</span> <span class=n>IMDBMax</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span></span></span></code></pre></div><p>The benefit of this approach is that as long as C# knows a conversion into the type we specify, the conversion is done automatically. Note that the parameter name matches the <code>name</code> property of the corresponding <code>&lt;input></code> - this must be the case for the Razor Page to bind the parameter to the corresponding input value.</p><p>Note that we still need to assign these parameter values to the corresponding properties of our PageModel. If we don&rsquo;t, then those properties will all be <code>null</code>, and the <code>&lt;inputs></code> rendered on our page will always be blank.</p><h2 id=model-binding>Model Binding</h2><p>A second option is to use <a href="https://docs.microsoft.com/en-us/aspnet/core/mvc/models/model-binding?view=aspnetcore-3.1" rel=external target=_blank><em>Model Binding</em></a>. Model binding also automatically converts incoming form data, but in this case it binds directly to the properties of our PageModel. We indicate this form of binding with a <code>[BindProperty]</code> attribute, i.e.:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-csharp data-lang=csharp><span class=line><span class=cl><span class=kd>public</span> <span class=k>class</span> <span class=nc>IndexModel</span> <span class=p>:</span> <span class=n>PageModel</span> <span class=p>{</span>
</span></span><span class=line><span class=cl><span class=na>
</span></span></span><span class=line><span class=cl><span class=na>    [BindProperty(SupportsGet=true)]</span>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=kt>string</span> <span class=n>SearchTerms</span> <span class=p>{</span><span class=k>get</span><span class=p>;</span> <span class=k>set</span><span class=p>;}</span>
</span></span><span class=line><span class=cl><span class=na>
</span></span></span><span class=line><span class=cl><span class=na>    [BindProperty(SupportsGet=true)]</span>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=kt>string</span><span class=p>[]</span> <span class=n>MPAARatings</span> <span class=p>{</span><span class=k>get</span><span class=p>;</span> <span class=k>set</span><span class=p>;}</span>
</span></span><span class=line><span class=cl><span class=na>
</span></span></span><span class=line><span class=cl><span class=na>    [BindProperty(SupportsGet=true)]</span>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=kt>string</span><span class=p>[]</span> <span class=n>Genres</span> <span class=p>{</span><span class=k>get</span><span class=p>;</span> <span class=k>set</span><span class=p>;}</span>
</span></span><span class=line><span class=cl><span class=na>
</span></span></span><span class=line><span class=cl><span class=na>    [BindProperty(SupportsGet=true)]</span>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=kt>double?</span> <span class=n>IMDBMin</span> <span class=p>{</span><span class=k>get</span><span class=p>;</span> <span class=k>set</span><span class=p>;}</span>
</span></span><span class=line><span class=cl><span class=na>
</span></span></span><span class=line><span class=cl><span class=na>    [BindProperty(SupportsGet=true)]</span>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=kt>double?</span> <span class=n>IMDBMax</span> <span class=p>{</span><span class=k>get</span><span class=p>;</span> <span class=k>set</span><span class=p>;}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=cs>/// &lt;summary&gt;</span>
</span></span><span class=line><span class=cl>    <span class=cs>/// Gets the search results for display on the page</span>
</span></span><span class=line><span class=cl>    <span class=cs>/// &lt;/summary&gt;</span>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=k>void</span> <span class=n>OnGet</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=n>Movies</span> <span class=p>=</span> <span class=n>MovieDatabase</span><span class=p>.</span><span class=n>Search</span><span class=p>(</span><span class=n>SearchTerms</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=n>Movies</span> <span class=p>=</span> <span class=n>MovieDatabase</span><span class=p>.</span><span class=n>FilterByMPAARating</span><span class=p>(</span><span class=n>Movies</span><span class=p>,</span> <span class=n>MPAARatings</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=n>Movies</span> <span class=p>=</span> <span class=n>MovieDatabase</span><span class=p>.</span><span class=n>FilterByGenre</span><span class=p>(</span><span class=n>Movies</span><span class=p>,</span> <span class=n>Genres</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=n>Movies</span> <span class=p>=</span> <span class=n>MovieDatabase</span><span class=p>.</span><span class=n>FilterByIMDBRating</span><span class=p>(</span><span class=n>Movies</span><span class=p>,</span> <span class=n>IMDBMin</span><span class=p>,</span> <span class=n>IMDBMax</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span></span></span></code></pre></div><p>Note that with this approach, the incoming data is directly bound to the properties, so we don&rsquo;t need to do any special assignments within our <code>OnGet()</code> method. Also, note that we have to use <code>SupportsGet=true</code> in order for this binding to occur on GET requests (by default, model binding only happens with POST requests).</p><div class="box notices cstyle note"><div class=box-label><i class="fa-fw fas fa-exclamation-circle"></i> Note</div><div class=box-content><p>You only need to do <em>one</em> binding approach per property in a PageModel. I.e. you can just use the property decorator:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-csharp data-lang=csharp><span class=line><span class=cl><span class=kd>public</span> <span class=k>class</span> <span class=nc>SomePageModel</span> <span class=p>:</span> <span class=n>PageModel</span>
</span></span><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl><span class=na>    [BindProperty(SupportsGet=true)]</span>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=kt>float</span> <span class=n>SomeProperty</span> <span class=p>{</span> <span class=k>get</span><span class=p>;</span> <span class=k>set</span><span class=p>;</span> <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=k>void</span> <span class=n>OnGet</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=n>DoSomething</span><span class=p>(</span><span class=n>SomeProperty</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span></span></span></code></pre></div><p><em>or</em> you might use parameter binding:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-csharp data-lang=csharp><span class=line><span class=cl><span class=kd>public</span> <span class=k>class</span> <span class=nc>SomePageModel</span> <span class=p>:</span> <span class=n>PageModel</span>
</span></span><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=k>void</span> <span class=n>OnGet</span><span class=p>(</span><span class=kt>float</span> <span class=n>SomeProperty</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=n>DoSomething</span><span class=p>(</span><span class=n>SomeProperty</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span></span></span></code></pre></div><p><em>or</em> you can parse it from the request:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-csharp data-lang=csharp><span class=line><span class=cl><span class=kd>public</span> <span class=k>class</span> <span class=nc>SomePageModel</span> <span class=p>:</span> <span class=n>PageModel</span>
</span></span><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=k>void</span> <span class=n>OnGet</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=kt>var</span> <span class=n>someProperty</span> <span class=p>=</span> <span class=kt>float</span><span class=p>.</span><span class=n>Parse</span><span class=p>(</span><span class=n>Request</span><span class=p>.</span><span class=n>Query</span><span class=p>[</span><span class=s>&#34;SomeProperty&#34;</span><span class=p>]);</span>
</span></span><span class=line><span class=cl>        <span class=n>DoSomething</span><span class=p>(</span><span class=n>someProperty</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span></span></span></code></pre></div><p>These are all <em>different means</em> of accessing the <em>same data</em> from the incoming request.</p></div></div><p>Now all we need to do is implement the actual filter.</p><h3 id=implementing-the-imdb-rating-filter>Implementing the IMDB Rating Filter</h3><p>We&rsquo;ll define the new filter in our <code>MovieDatabase</code> class as another static method:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-csharp data-lang=csharp><span class=line><span class=cl>    <span class=cs>/// &lt;summary&gt;</span>
</span></span><span class=line><span class=cl>    <span class=cs>/// Filters the provided collection of movies</span>
</span></span><span class=line><span class=cl>    <span class=cs>/// to those with IMDB ratings falling within</span>
</span></span><span class=line><span class=cl>    <span class=cs>/// the specified range</span>
</span></span><span class=line><span class=cl>    <span class=cs>/// &lt;/summary&gt;</span>
</span></span><span class=line><span class=cl>    <span class=cs>/// &lt;param name=&#34;movies&#34;&gt;The collection of movies to filter&lt;/param&gt;</span>
</span></span><span class=line><span class=cl>    <span class=cs>/// &lt;param name=&#34;min&#34;&gt;The minimum range value&lt;/param&gt;</span>
</span></span><span class=line><span class=cl>    <span class=cs>/// &lt;param name=&#34;max&#34;&gt;The maximum range value&lt;/param&gt;</span>
</span></span><span class=line><span class=cl>    <span class=cs>/// &lt;returns&gt;The filtered movie collection&lt;/returns&gt;</span>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=kd>static</span> <span class=n>IEnumerable</span><span class=p>&lt;</span><span class=n>Movie</span><span class=p>&gt;</span> <span class=n>FilterByIMDBRating</span><span class=p>(</span><span class=n>IEnumerable</span><span class=p>&lt;</span><span class=n>Movie</span><span class=p>&gt;</span> <span class=n>movies</span><span class=p>,</span> <span class=kt>double?</span> <span class=n>min</span><span class=p>,</span> <span class=kt>double?</span> <span class=n>max</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=c1>// TODO: Filter movies</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span></span></span></code></pre></div><p>Notice that here too we use the nullable double value. So our first step is probably to do a <code>null</code> check:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-csharp data-lang=csharp><span class=line><span class=cl>    <span class=k>if</span> <span class=p>(</span><span class=n>min</span> <span class=p>==</span> <span class=kc>null</span> <span class=p>&amp;&amp;</span> <span class=n>max</span> <span class=p>==</span> <span class=kc>null</span><span class=p>)</span> <span class=k>return</span> <span class=n>movies</span><span class=p>;</span></span></span></code></pre></div><p>But what if only one is null? Should we filter for that part of the range? It wouldn&rsquo;t be hard to do:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-csharp data-lang=csharp><span class=line><span class=cl>    <span class=kt>var</span> <span class=n>results</span> <span class=p>=</span> <span class=k>new</span> <span class=n>List</span><span class=p>&lt;</span><span class=n>Movie</span><span class=p>&gt;();</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c1>// only a maximum specified</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span><span class=p>(</span><span class=n>min</span> <span class=p>==</span> <span class=kc>null</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=k>foreach</span><span class=p>(</span><span class=n>Movie</span> <span class=n>movie</span> <span class=k>in</span> <span class=n>movies</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=k>if</span> <span class=p>(</span><span class=n>movie</span><span class=p>.</span><span class=n>IMDBRating</span> <span class=p>&lt;=</span> <span class=n>max</span><span class=p>)</span> <span class=n>results</span><span class=p>.</span><span class=n>Add</span><span class=p>(</span><span class=n>movie</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=n>results</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span></span></span></code></pre></div><p>And the minimum would mirror that:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-csharp data-lang=csharp><span class=line><span class=cl>    <span class=c1>// only a minimum specified</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span><span class=p>(</span><span class=n>max</span> <span class=p>==</span> <span class=kc>null</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=k>foreach</span><span class=p>(</span><span class=n>Movie</span> <span class=n>movie</span> <span class=k>in</span> <span class=n>movies</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=k>if</span> <span class=p>(</span><span class=n>movie</span><span class=p>.</span><span class=n>IMDBRating</span> <span class=p>&gt;=</span> <span class=n>min</span><span class=p>)</span> <span class=n>results</span><span class=p>.</span><span class=n>Add</span><span class=p>(</span><span class=n>movie</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=n>results</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span></span></span></code></pre></div><p>Finally, we could handle the case where we have both a min and max value to our range:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-csharp data-lang=csharp><span class=line><span class=cl>    <span class=c1>// Both minimum and maximum specified</span>
</span></span><span class=line><span class=cl>    <span class=k>foreach</span><span class=p>(</span><span class=n>Movie</span> <span class=n>movie</span> <span class=k>in</span> <span class=n>movies</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span><span class=p>(</span><span class=n>movie</span><span class=p>.</span><span class=n>IMDBRating</span> <span class=p>&gt;=</span> <span class=n>min</span> <span class=p>&amp;&amp;</span> <span class=n>movie</span><span class=p>.</span><span class=n>IMDBRating</span> <span class=p>&lt;=</span> <span class=n>max</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=n>results</span><span class=p>.</span><span class=n>Add</span><span class=p>(</span><span class=n>movie</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=n>results</span><span class=p>;</span></span></span></code></pre></div><p>Notice too, that in each of these cases we&rsquo;re treating the range as <em>inclusive</em> (including the specified minimum and maximum). This is the behavior most casual internet users will expect. If the database and user expectations are different for your audience, you&rsquo;d want your code to match that expectation.</p><p>Now we can filter by IMDB rating:</p><p><a href=#R-image-0622e748cb855bcc90d0379709587857 class=lightbox-link><img alt="Filtering By IMDB" class="border lazy lightbox noshadow figure-image" loading=lazy src=/cis400/images/6.8.6.png style=height:auto;width:auto></a>
<a href=javascript:history.back(); class=lightbox-back id=R-image-0622e748cb855bcc90d0379709587857><img alt="Filtering By IMDB" class="border lazy lightbox noshadow lightbox-image" loading=lazy src=/cis400/images/6.8.6.png></a></p><h2 id=finishing-up>Finishing Up</h2><p>Since we&rsquo;re displaying the Rotten Tomatoes rating, we should probably also have a filter for it. This will work almost exactly like the IMDB rating - but with the range from 0 to 100. I&rsquo;ll leave this as an exercise for the reader.</p><footer class=footline></footer></article><article class=default><header class=headline></header><h1 id=numerical-filters>Numerical Filters</h1><p>Let&rsquo;s tackle one of the critics ratings next. While we could create categories and use checkboxes, this doesn&rsquo;t capture the incremental values (i.e. 4.3), and it would be a <em>lot</em> of checkboxes for Rotten Tomatoes ratings! Instead, we&rsquo;ll use a <em>numerical filter</em>, which limits our possible results to a range - between a minimum and maximum value.</p><p>Moreover, let&rsquo;s clean up our Index page, as it is getting difficult to determine what filter(s) go together, and and are adding more.</p><h2 id=refactoring-the-index-page>Refactoring the Index Page</h2><p>Let&rsquo;s move the filters to a column on the left, leave the search bar above, and show our results on the right. This will require refactoring our <em>Index.cshtml</em> file:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-csharp data-lang=csharp><span class=line><span class=cl>    <span class=p>&lt;</span><span class=n>form</span> <span class=n>id</span><span class=p>=</span><span class=s>&#34;movie-database&#34;</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=p>&lt;</span><span class=n>div</span> <span class=n>id</span><span class=p>=</span><span class=s>&#34;search&#34;</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>            <span class=p>&lt;</span><span class=n>input</span> <span class=n>type</span><span class=p>=</span><span class=s>&#34;text&#34;</span> <span class=n>name</span><span class=p>=</span><span class=s>&#34;SearchTerms&#34;</span> <span class=k>value</span><span class=p>=</span><span class=s>&#34;@Model.SearchTerms&#34;</span> <span class=p>/&gt;</span>
</span></span><span class=line><span class=cl>            <span class=p>&lt;</span><span class=n>input</span> <span class=n>type</span><span class=p>=</span><span class=s>&#34;submit&#34;</span> <span class=k>value</span><span class=p>=</span><span class=s>&#34;Search&#34;</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>        <span class=p>&lt;/</span><span class=n>div</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=p>&lt;</span><span class=n>div</span> <span class=n>id</span><span class=p>=</span><span class=s>&#34;filters&#34;</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>            <span class=p>&lt;</span><span class=n>h4</span><span class=p>&gt;</span><span class=n>MPAA</span> <span class=n>Rating</span><span class=p>&lt;/</span><span class=n>h4</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>            <span class=n>@foreach</span> <span class=p>(</span><span class=kt>string</span> <span class=n>rating</span> <span class=k>in</span> <span class=n>MovieDatabase</span><span class=p>.</span><span class=n>MPAARatings</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            <span class=p>{</span>
</span></span><span class=line><span class=cl>                <span class=p>&lt;</span><span class=n>label</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>                    <span class=p>&lt;</span><span class=n>input</span> <span class=n>type</span><span class=p>=</span><span class=s>&#34;checkbox&#34;</span> <span class=n>name</span><span class=p>=</span><span class=s>&#34;MPAARatings&#34;</span> <span class=k>value</span><span class=p>=</span><span class=s>&#34;@rating&#34;</span> <span class=k>checked</span><span class=p>=</span><span class=s>&#34;@Model.MPAARatings.Contains(rating)&#34;</span> <span class=p>/&gt;</span>
</span></span><span class=line><span class=cl>                    <span class=n>@rating</span>
</span></span><span class=line><span class=cl>                <span class=p>&lt;/</span><span class=n>label</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>            <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>            <span class=p>&lt;</span><span class=n>h4</span><span class=p>&gt;</span><span class=n>Genre</span><span class=p>&lt;/</span><span class=n>h4</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>            <span class=n>@foreach</span> <span class=p>(</span><span class=kt>string</span> <span class=n>genre</span> <span class=k>in</span> <span class=n>MovieDatabase</span><span class=p>.</span><span class=n>Genres</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            <span class=p>{</span>
</span></span><span class=line><span class=cl>                <span class=p>&lt;</span><span class=n>label</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>                    <span class=p>&lt;</span><span class=n>input</span> <span class=n>type</span><span class=p>=</span><span class=s>&#34;checkbox&#34;</span> <span class=n>name</span><span class=p>=</span><span class=s>&#34;Genres&#34;</span> <span class=k>value</span><span class=p>=</span><span class=s>&#34;@genre&#34;</span> <span class=p>/&gt;</span>
</span></span><span class=line><span class=cl>                    <span class=n>@genre</span>
</span></span><span class=line><span class=cl>                <span class=p>&lt;/</span><span class=n>label</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>            <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>            <span class=p>&lt;</span><span class=n>h4</span><span class=p>&gt;</span><span class=n>IMDB</span> <span class=n>Rating</span><span class=p>&lt;/</span><span class=n>h4</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>            <span class=p>&lt;</span><span class=n>div</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>                <span class=n>Between</span>
</span></span><span class=line><span class=cl>                <span class=p>&lt;</span><span class=n>input</span> <span class=n>name</span><span class=p>=</span><span class=s>&#34;IMDBMin&#34;</span> <span class=n>type</span><span class=p>=</span><span class=s>&#34;number&#34;</span> <span class=n>min</span><span class=p>=</span><span class=s>&#34;0&#34;</span> <span class=n>max</span><span class=p>=</span><span class=s>&#34;10&#34;</span> <span class=n>step</span><span class=p>=</span><span class=s>&#34;0.1&#34;</span> <span class=n>placeholder</span><span class=p>=</span><span class=s>&#34;min&#34;</span><span class=p>/&gt;</span>
</span></span><span class=line><span class=cl>                <span class=n>and</span>
</span></span><span class=line><span class=cl>                <span class=p>&lt;</span><span class=n>input</span> <span class=n>name</span><span class=p>=</span><span class=s>&#34;IMDBMax&#34;</span> <span class=n>type</span><span class=p>=</span><span class=s>&#34;number&#34;</span> <span class=n>min</span><span class=p>=</span><span class=s>&#34;0&#34;</span> <span class=n>max</span><span class=p>=</span><span class=s>&#34;10&#34;</span> <span class=n>step</span><span class=p>=</span><span class=s>&#34;0.1&#34;</span> <span class=n>placeholder</span><span class=p>=</span><span class=s>&#34;max&#34;</span><span class=p>/&gt;</span>
</span></span><span class=line><span class=cl>            <span class=p>&lt;/</span><span class=n>div</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=p>&lt;/</span><span class=n>div</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=p>&lt;</span><span class=n>div</span> <span class=n>id</span><span class=p>=</span><span class=s>&#34;results&#34;</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>            <span class=p>&lt;</span><span class=n>h1</span><span class=p>&gt;</span><span class=n>Movie</span> <span class=n>Results</span><span class=p>&lt;/</span><span class=n>h1</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>            <span class=p>&lt;</span><span class=n>ul</span> <span class=n>class</span><span class=p>=</span><span class=s>&#34;movie-list&#34;</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>                <span class=n>@foreach</span> <span class=p>(</span><span class=n>Movie</span> <span class=n>movie</span> <span class=k>in</span> <span class=n>@Model</span><span class=p>.</span><span class=n>Movies</span><span class=p>)</span>
</span></span><span class=line><span class=cl>                <span class=p>{</span>
</span></span><span class=line><span class=cl>                    <span class=p>&lt;</span><span class=n>li</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>                        <span class=p>&lt;</span><span class=n>div</span> <span class=n>class</span><span class=p>=</span><span class=s>&#34;details&#34;</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>                            <span class=p>&lt;</span><span class=n>h3</span> <span class=n>class</span><span class=p>=</span><span class=s>&#34;title&#34;</span><span class=p>&gt;</span><span class=n>@movie</span><span class=p>.</span><span class=n>Title</span><span class=p>&lt;/</span><span class=n>h3</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>                            <span class=p>&lt;</span><span class=n>div</span> <span class=n>class</span><span class=p>=</span><span class=s>&#34;mpaa&#34;</span><span class=p>&gt;</span><span class=n>@movie</span><span class=p>.</span><span class=n>MPAARating</span><span class=p>&lt;/</span><span class=n>div</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>                            <span class=p>&lt;</span><span class=n>div</span> <span class=n>class</span><span class=p>=</span><span class=s>&#34;genre&#34;</span><span class=p>&gt;</span><span class=n>@movie</span><span class=p>.</span><span class=n>MajorGenre</span><span class=p>&lt;/</span><span class=n>div</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>                        <span class=p>&lt;/</span><span class=n>div</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>                        <span class=p>&lt;</span><span class=n>div</span> <span class=n>class</span><span class=p>=</span><span class=s>&#34;ratings&#34;</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>                            <span class=n>@if</span> <span class=p>(</span><span class=n>movie</span><span class=p>.</span><span class=n>IMDBRating</span> <span class=p>!=</span> <span class=kc>null</span><span class=p>)</span>
</span></span><span class=line><span class=cl>                            <span class=p>{</span>
</span></span><span class=line><span class=cl>                                <span class=p>&lt;</span><span class=n>div</span> <span class=n>class</span><span class=p>=</span><span class=s>&#34;imdb&#34;</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>                                    <span class=n>@movie</span><span class=p>.</span><span class=n>IMDBRating</span>
</span></span><span class=line><span class=cl>                                <span class=p>&lt;/</span><span class=n>div</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>                            <span class=p>}</span>
</span></span><span class=line><span class=cl>                            <span class=n>@if</span> <span class=p>(</span><span class=n>movie</span><span class=p>.</span><span class=n>RottenTomatoesRating</span> <span class=p>!=</span> <span class=kc>null</span><span class=p>)</span>
</span></span><span class=line><span class=cl>                            <span class=p>{</span>
</span></span><span class=line><span class=cl>                                <span class=p>&lt;</span><span class=n>div</span> <span class=n>class</span><span class=p>=</span><span class=s>&#34;rotten-tomatoes&#34;</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>                                    <span class=n>@movie</span><span class=p>.</span><span class=n>RottenTomatoesRating</span>
</span></span><span class=line><span class=cl>                                <span class=p>&lt;/</span><span class=n>div</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>                            <span class=p>}</span>
</span></span><span class=line><span class=cl>                        <span class=p>&lt;/</span><span class=n>div</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>                    <span class=p>&lt;/</span><span class=n>li</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>                <span class=p>}</span>
</span></span><span class=line><span class=cl>            <span class=p>&lt;/</span><span class=n>ul</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>        <span class=p>&lt;/</span><span class=n>div</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=p>&lt;/</span><span class=n>form</span><span class=p>&gt;</span></span></span></code></pre></div><p>Most of this is simply moving elements around the page, but note that we are using inputs of <code>type=number</code> to represent our range of IMDB values. We can specify a minimum and maximum for this range, as well as an allowable increment. Also, we use the <code>placeholder</code> attribute to put text into the <code>input</code> until a value is added.</p><h2 id=adding-more-styles>Adding More Styles</h2><p>Now we&rsquo;ll need to add some rules to our <em>wwwroot/css/styles.css</em>. First, we&rsquo;ll use a <code>grid</code> for the layout of the form:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-css data-lang=css><span class=line><span class=cl><span class=nt>form</span><span class=p>#</span><span class=nn>movie-database</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>display</span><span class=p>:</span> <span class=k>grid</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=k>grid-template-columns</span><span class=p>:</span> <span class=mi>1</span><span class=n>fr</span> <span class=mi>3</span><span class=n>fr</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=k>grid-template-rows</span><span class=p>:</span> <span class=kc>auto</span> <span class=kc>auto</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span></span></span></code></pre></div><p>The right column will be three times as big as the left.</p><p>We can make our search bar span both columns with <code>grid-column-start</code> and <code>grid-column-end</code>:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-css data-lang=css><span class=line><span class=cl><span class=p>#</span><span class=nn>search</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>grid-column-start</span><span class=p>:</span> <span class=mi>1</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=k>grid-column-end</span><span class=p>:</span> <span class=mi>3</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=k>text-align</span><span class=p>:</span> <span class=kc>center</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span></span></span></code></pre></div><p>Notice too that for CSS, we start counting at 1, not 0. The filters and the results will fall in the next row automatically, each taking up their own respective grid cell. You can read more about the grid layout in <a href=https://css-tricks.com/snippets/css/complete-guide-grid/ rel=external target=_blank>A Complete Guide to Grid</a>.</p><p>Let&rsquo;s go ahead and use flexbox to lay out our filters in a column:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-css data-lang=css><span class=line><span class=cl><span class=p>#</span><span class=nn>filters</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>display</span><span class=p>:</span> <span class=kc>flex</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=k>flex-direction</span><span class=p>:</span> <span class=kc>column</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span></span></span></code></pre></div><p>And make our number inputs bigger:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-css data-lang=css><span class=line><span class=cl><span class=p>#</span><span class=nn>filters</span> <span class=nt>input</span><span class=o>[</span><span class=nt>type</span><span class=o>=</span><span class=nt>number</span><span class=o>]</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>width</span><span class=p>:</span> <span class=mi>4</span><span class=kt>rem</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span></span></span></code></pre></div><p>Notice the use of square brackets in our CSS Selector to only apply to inputs with type number.</p><p>Also, let&rsquo;s add a margin above and remove most of the margin below our <code>&lt;h4></code> elements:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-css data-lang=css><span class=line><span class=cl><span class=p>#</span><span class=nn>filters</span> <span class=nt>h4</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>margin-bottom</span><span class=p>:</span> <span class=mf>0.2</span><span class=kt>rem</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=k>margin-top</span><span class=p>:</span> <span class=mi>2</span><span class=kt>rem</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span></span></span></code></pre></div><p>The resulting page looks much cleaner:</p><p><a href=#R-image-5d57531094ac0e395dc43295bad61c89 class=lightbox-link><img alt="The Styled Page" class="border lazy lightbox noshadow figure-image" loading=lazy src=/cis400/images/6.8.5.png style=height:auto;width:auto></a>
<a href=javascript:history.back(); class=lightbox-back id=R-image-5d57531094ac0e395dc43295bad61c89><img alt="The Styled Page" class="border lazy lightbox noshadow lightbox-image" loading=lazy src=/cis400/images/6.8.5.png></a></p><h2 id=capturing-the-filter-values>Capturing the Filter Values</h2><p>Now we need to get the filter values from our GET request query string. We could do this like we&rsquo;ve been doing before, with:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-csharp data-lang=csharp><span class=line><span class=cl>    <span class=n>Request</span><span class=p>.</span><span class=n>Query</span><span class=p>[</span><span class=s>&#34;IMDBMin&#34;</span><span class=p>];</span></span></span></code></pre></div><p>But the returned value would be a string, so we&rsquo;d need to parse it:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-csharp data-lang=csharp><span class=line><span class=cl>    <span class=n>IMDBMin</span> <span class=p>=</span> <span class=kt>double</span><span class=p>.</span><span class=n>Parse</span><span class=p>(</span><span class=n>Request</span><span class=p>.</span><span class=n>Query</span><span class=p>[</span><span class=s>&#34;IMDBMin&#34;</span><span class=p>]);</span></span></span></code></pre></div><p>If the query was <code>null</code>, then this would evaluate to <code>NaN</code>, which we wouldn&rsquo;t want to set our <code>&lt;input></code> to&mldr;</p><p>Instead, we&rsquo;ll look at some options built into the PageModel.</p><h2 id=parameter-binding>Parameter Binding</h2><p>The first of these options is <a href=https://docs.microsoft.com/en-us/aspnet/web-api/overview/formats-and-model-binding/parameter-binding-in-aspnet-web-api rel=external target=_blank><em>Parameter Binding</em></a>. In this approach, we define parameters to our <code>OnGet()</code> method to be parsed out of the request automatically, i.e.:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-csharp data-lang=csharp><span class=line><span class=cl>    <span class=cs>/// &lt;summary&gt;</span>
</span></span><span class=line><span class=cl>    <span class=cs>/// Gets the search results for display on the page</span>
</span></span><span class=line><span class=cl>    <span class=cs>/// &lt;/summary&gt;</span>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=k>void</span> <span class=n>OnGet</span><span class=p>(</span><span class=kt>string</span> <span class=n>SearchTerms</span><span class=p>,</span> <span class=kt>string</span><span class=p>[]</span> <span class=n>MPAARatings</span><span class=p>,</span> <span class=kt>string</span><span class=p>[]</span> <span class=n>Genres</span><span class=p>,</span> <span class=kt>double?</span> <span class=n>IMDBMin</span><span class=p>,</span> <span class=kt>double?</span> <span class=n>IMDBMax</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=k>this</span><span class=p>.</span><span class=n>SearchTerms</span> <span class=p>=</span> <span class=n>SearchTerms</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=k>this</span><span class=p>.</span><span class=n>MPAARatings</span> <span class=p>=</span> <span class=n>MPAARatings</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=k>this</span><span class=p>.</span><span class=n>Genres</span> <span class=p>=</span> <span class=n>Genres</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=k>this</span><span class=p>.</span><span class=n>IMDBMin</span> <span class=p>=</span> <span class=n>IMDBMin</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=k>this</span><span class=p>.</span><span class=n>IMDBMax</span> <span class=p>=</span> <span class=n>IMDBMax</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=n>Movies</span> <span class=p>=</span> <span class=n>MovieDatabase</span><span class=p>.</span><span class=n>Search</span><span class=p>(</span><span class=n>SearchTerms</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=n>Movies</span> <span class=p>=</span> <span class=n>MovieDatabase</span><span class=p>.</span><span class=n>FilterByMPAARating</span><span class=p>(</span><span class=n>Movies</span><span class=p>,</span> <span class=n>MPAARatings</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=n>Movies</span> <span class=p>=</span> <span class=n>MovieDatabase</span><span class=p>.</span><span class=n>FilterByGenre</span><span class=p>(</span><span class=n>Movies</span><span class=p>,</span> <span class=n>Genres</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=n>Movies</span> <span class=p>=</span> <span class=n>MovieDatabase</span><span class=p>.</span><span class=n>FilterByIMDBRating</span><span class=p>(</span><span class=n>Movies</span><span class=p>,</span> <span class=n>IMDBMin</span><span class=p>,</span> <span class=n>IMDBMax</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span></span></span></code></pre></div><p>The benefit of this approach is that as long as C# knows a conversion into the type we specify, the conversion is done automatically. Note that the parameter name matches the <code>name</code> property of the corresponding <code>&lt;input></code> - this must be the case for the Razor Page to bind the parameter to the corresponding input value.</p><p>Note that we still need to assign these parameter values to the corresponding properties of our PageModel. If we don&rsquo;t, then those properties will all be <code>null</code>, and the <code>&lt;inputs></code> rendered on our page will always be blank.</p><h2 id=model-binding>Model Binding</h2><p>A second option is to use <a href="https://docs.microsoft.com/en-us/aspnet/core/mvc/models/model-binding?view=aspnetcore-3.1" rel=external target=_blank><em>Model Binding</em></a>. Model binding also automatically converts incoming form data, but in this case it binds directly to the properties of our PageModel. We indicate this form of binding with a <code>[BindProperty]</code> attribute, i.e.:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-csharp data-lang=csharp><span class=line><span class=cl><span class=kd>public</span> <span class=k>class</span> <span class=nc>IndexModel</span> <span class=p>:</span> <span class=n>PageModel</span> <span class=p>{</span>
</span></span><span class=line><span class=cl><span class=na>
</span></span></span><span class=line><span class=cl><span class=na>    [BindProperty(SupportsGet=true)]</span>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=kt>string</span> <span class=n>SearchTerms</span> <span class=p>{</span><span class=k>get</span><span class=p>;</span> <span class=k>set</span><span class=p>;}</span>
</span></span><span class=line><span class=cl><span class=na>
</span></span></span><span class=line><span class=cl><span class=na>    [BindProperty(SupportsGet=true)]</span>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=kt>string</span><span class=p>[]</span> <span class=n>MPAARatings</span> <span class=p>{</span><span class=k>get</span><span class=p>;</span> <span class=k>set</span><span class=p>;}</span>
</span></span><span class=line><span class=cl><span class=na>
</span></span></span><span class=line><span class=cl><span class=na>    [BindProperty(SupportsGet=true)]</span>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=kt>string</span><span class=p>[]</span> <span class=n>Genres</span> <span class=p>{</span><span class=k>get</span><span class=p>;</span> <span class=k>set</span><span class=p>;}</span>
</span></span><span class=line><span class=cl><span class=na>
</span></span></span><span class=line><span class=cl><span class=na>    [BindProperty(SupportsGet=true)]</span>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=kt>double?</span> <span class=n>IMDBMin</span> <span class=p>{</span><span class=k>get</span><span class=p>;</span> <span class=k>set</span><span class=p>;}</span>
</span></span><span class=line><span class=cl><span class=na>
</span></span></span><span class=line><span class=cl><span class=na>    [BindProperty(SupportsGet=true)]</span>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=kt>double?</span> <span class=n>IMDBMax</span> <span class=p>{</span><span class=k>get</span><span class=p>;</span> <span class=k>set</span><span class=p>;}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=cs>/// &lt;summary&gt;</span>
</span></span><span class=line><span class=cl>    <span class=cs>/// Gets the search results for display on the page</span>
</span></span><span class=line><span class=cl>    <span class=cs>/// &lt;/summary&gt;</span>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=k>void</span> <span class=n>OnGet</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=n>Movies</span> <span class=p>=</span> <span class=n>MovieDatabase</span><span class=p>.</span><span class=n>Search</span><span class=p>(</span><span class=n>SearchTerms</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=n>Movies</span> <span class=p>=</span> <span class=n>MovieDatabase</span><span class=p>.</span><span class=n>FilterByMPAARating</span><span class=p>(</span><span class=n>Movies</span><span class=p>,</span> <span class=n>MPAARatings</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=n>Movies</span> <span class=p>=</span> <span class=n>MovieDatabase</span><span class=p>.</span><span class=n>FilterByGenre</span><span class=p>(</span><span class=n>Movies</span><span class=p>,</span> <span class=n>Genres</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=n>Movies</span> <span class=p>=</span> <span class=n>MovieDatabase</span><span class=p>.</span><span class=n>FilterByIMDBRating</span><span class=p>(</span><span class=n>Movies</span><span class=p>,</span> <span class=n>IMDBMin</span><span class=p>,</span> <span class=n>IMDBMax</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span></span></span></code></pre></div><p>Note that with this approach, the incoming data is directly bound to the properties, so we don&rsquo;t need to do any special assignments within our <code>OnGet()</code> method. Also, note that we have to use <code>SupportsGet=true</code> in order for this binding to occur on GET requests (by default, model binding only happens with POST requests).</p><div class="box notices cstyle note"><div class=box-label><i class="fa-fw fas fa-exclamation-circle"></i> Note</div><div class=box-content><p>You only need to do <em>one</em> binding approach per property in a PageModel. I.e. you can just use the property decorator:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-csharp data-lang=csharp><span class=line><span class=cl><span class=kd>public</span> <span class=k>class</span> <span class=nc>SomePageModel</span> <span class=p>:</span> <span class=n>PageModel</span>
</span></span><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl><span class=na>    [BindProperty(SupportsGet=true)]</span>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=kt>float</span> <span class=n>SomeProperty</span> <span class=p>{</span> <span class=k>get</span><span class=p>;</span> <span class=k>set</span><span class=p>;</span> <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=k>void</span> <span class=n>OnGet</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=n>DoSomething</span><span class=p>(</span><span class=n>SomeProperty</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span></span></span></code></pre></div><p><em>or</em> you might use parameter binding:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-csharp data-lang=csharp><span class=line><span class=cl><span class=kd>public</span> <span class=k>class</span> <span class=nc>SomePageModel</span> <span class=p>:</span> <span class=n>PageModel</span>
</span></span><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=k>void</span> <span class=n>OnGet</span><span class=p>(</span><span class=kt>float</span> <span class=n>SomeProperty</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=n>DoSomething</span><span class=p>(</span><span class=n>SomeProperty</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span></span></span></code></pre></div><p><em>or</em> you can parse it from the request:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-csharp data-lang=csharp><span class=line><span class=cl><span class=kd>public</span> <span class=k>class</span> <span class=nc>SomePageModel</span> <span class=p>:</span> <span class=n>PageModel</span>
</span></span><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=k>void</span> <span class=n>OnGet</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=kt>var</span> <span class=n>someProperty</span> <span class=p>=</span> <span class=kt>float</span><span class=p>.</span><span class=n>Parse</span><span class=p>(</span><span class=n>Request</span><span class=p>.</span><span class=n>Query</span><span class=p>[</span><span class=s>&#34;SomeProperty&#34;</span><span class=p>]);</span>
</span></span><span class=line><span class=cl>        <span class=n>DoSomething</span><span class=p>(</span><span class=n>someProperty</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span></span></span></code></pre></div><p>These are all <em>different means</em> of accessing the <em>same data</em> from the incoming request.</p></div></div><p>Now all we need to do is implement the actual filter.</p><h3 id=implementing-the-imdb-rating-filter>Implementing the IMDB Rating Filter</h3><p>We&rsquo;ll define the new filter in our <code>MovieDatabase</code> class as another static method:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-csharp data-lang=csharp><span class=line><span class=cl>    <span class=cs>/// &lt;summary&gt;</span>
</span></span><span class=line><span class=cl>    <span class=cs>/// Filters the provided collection of movies</span>
</span></span><span class=line><span class=cl>    <span class=cs>/// to those with IMDB ratings falling within</span>
</span></span><span class=line><span class=cl>    <span class=cs>/// the specified range</span>
</span></span><span class=line><span class=cl>    <span class=cs>/// &lt;/summary&gt;</span>
</span></span><span class=line><span class=cl>    <span class=cs>/// &lt;param name=&#34;movies&#34;&gt;The collection of movies to filter&lt;/param&gt;</span>
</span></span><span class=line><span class=cl>    <span class=cs>/// &lt;param name=&#34;min&#34;&gt;The minimum range value&lt;/param&gt;</span>
</span></span><span class=line><span class=cl>    <span class=cs>/// &lt;param name=&#34;max&#34;&gt;The maximum range value&lt;/param&gt;</span>
</span></span><span class=line><span class=cl>    <span class=cs>/// &lt;returns&gt;The filtered movie collection&lt;/returns&gt;</span>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=kd>static</span> <span class=n>IEnumerable</span><span class=p>&lt;</span><span class=n>Movie</span><span class=p>&gt;</span> <span class=n>FilterByIMDBRating</span><span class=p>(</span><span class=n>IEnumerable</span><span class=p>&lt;</span><span class=n>Movie</span><span class=p>&gt;</span> <span class=n>movies</span><span class=p>,</span> <span class=kt>double?</span> <span class=n>min</span><span class=p>,</span> <span class=kt>double?</span> <span class=n>max</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=c1>// TODO: Filter movies</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span></span></span></code></pre></div><p>Notice that here too we use the nullable double value. So our first step is probably to do a <code>null</code> check:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-csharp data-lang=csharp><span class=line><span class=cl>    <span class=k>if</span> <span class=p>(</span><span class=n>min</span> <span class=p>==</span> <span class=kc>null</span> <span class=p>&amp;&amp;</span> <span class=n>max</span> <span class=p>==</span> <span class=kc>null</span><span class=p>)</span> <span class=k>return</span> <span class=n>movies</span><span class=p>;</span></span></span></code></pre></div><p>But what if only one is null? Should we filter for that part of the range? It wouldn&rsquo;t be hard to do:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-csharp data-lang=csharp><span class=line><span class=cl>    <span class=kt>var</span> <span class=n>results</span> <span class=p>=</span> <span class=k>new</span> <span class=n>List</span><span class=p>&lt;</span><span class=n>Movie</span><span class=p>&gt;();</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c1>// only a maximum specified</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span><span class=p>(</span><span class=n>min</span> <span class=p>==</span> <span class=kc>null</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=k>foreach</span><span class=p>(</span><span class=n>Movie</span> <span class=n>movie</span> <span class=k>in</span> <span class=n>movies</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=k>if</span> <span class=p>(</span><span class=n>movie</span><span class=p>.</span><span class=n>IMDBRating</span> <span class=p>&lt;=</span> <span class=n>max</span><span class=p>)</span> <span class=n>results</span><span class=p>.</span><span class=n>Add</span><span class=p>(</span><span class=n>movie</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=n>results</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span></span></span></code></pre></div><p>And the minimum would mirror that:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-csharp data-lang=csharp><span class=line><span class=cl>    <span class=c1>// only a minimum specified</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span><span class=p>(</span><span class=n>max</span> <span class=p>==</span> <span class=kc>null</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=k>foreach</span><span class=p>(</span><span class=n>Movie</span> <span class=n>movie</span> <span class=k>in</span> <span class=n>movies</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=k>if</span> <span class=p>(</span><span class=n>movie</span><span class=p>.</span><span class=n>IMDBRating</span> <span class=p>&gt;=</span> <span class=n>min</span><span class=p>)</span> <span class=n>results</span><span class=p>.</span><span class=n>Add</span><span class=p>(</span><span class=n>movie</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=n>results</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span></span></span></code></pre></div><p>Finally, we could handle the case where we have both a min and max value to our range:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-csharp data-lang=csharp><span class=line><span class=cl>    <span class=c1>// Both minimum and maximum specified</span>
</span></span><span class=line><span class=cl>    <span class=k>foreach</span><span class=p>(</span><span class=n>Movie</span> <span class=n>movie</span> <span class=k>in</span> <span class=n>movies</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span><span class=p>(</span><span class=n>movie</span><span class=p>.</span><span class=n>IMDBRating</span> <span class=p>&gt;=</span> <span class=n>min</span> <span class=p>&amp;&amp;</span> <span class=n>movie</span><span class=p>.</span><span class=n>IMDBRating</span> <span class=p>&lt;=</span> <span class=n>max</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=n>results</span><span class=p>.</span><span class=n>Add</span><span class=p>(</span><span class=n>movie</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=n>results</span><span class=p>;</span></span></span></code></pre></div><p>Notice too, that in each of these cases we&rsquo;re treating the range as <em>inclusive</em> (including the specified minimum and maximum). This is the behavior most casual internet users will expect. If the database and user expectations are different for your audience, you&rsquo;d want your code to match that expectation.</p><p>Now we can filter by IMDB rating:</p><p><a href=#R-image-96fc65dfa68e9d863f3a972b927cf56d class=lightbox-link><img alt="Filtering By IMDB" class="border lazy lightbox noshadow figure-image" loading=lazy src=/cis400/images/6.8.6.png style=height:auto;width:auto></a>
<a href=javascript:history.back(); class=lightbox-back id=R-image-96fc65dfa68e9d863f3a972b927cf56d><img alt="Filtering By IMDB" class="border lazy lightbox noshadow lightbox-image" loading=lazy src=/cis400/images/6.8.6.png></a></p><h2 id=finishing-up>Finishing Up</h2><p>Since we&rsquo;re displaying the Rotten Tomatoes rating, we should probably also have a filter for it. This will work almost exactly like the IMDB rating - but with the range from 0 to 100. I&rsquo;ll leave this as an exercise for the reader.</p><footer class=footline></footer></article><article class=default><header class=headline></header><h1 id=numerical-filters>Numerical Filters</h1><p>Let&rsquo;s tackle one of the critics ratings next. While we could create categories and use checkboxes, this doesn&rsquo;t capture the incremental values (i.e. 4.3), and it would be a <em>lot</em> of checkboxes for Rotten Tomatoes ratings! Instead, we&rsquo;ll use a <em>numerical filter</em>, which limits our possible results to a range - between a minimum and maximum value.</p><p>Moreover, let&rsquo;s clean up our Index page, as it is getting difficult to determine what filter(s) go together, and and are adding more.</p><h2 id=refactoring-the-index-page>Refactoring the Index Page</h2><p>Let&rsquo;s move the filters to a column on the left, leave the search bar above, and show our results on the right. This will require refactoring our <em>Index.cshtml</em> file:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-csharp data-lang=csharp><span class=line><span class=cl>    <span class=p>&lt;</span><span class=n>form</span> <span class=n>id</span><span class=p>=</span><span class=s>&#34;movie-database&#34;</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=p>&lt;</span><span class=n>div</span> <span class=n>id</span><span class=p>=</span><span class=s>&#34;search&#34;</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>            <span class=p>&lt;</span><span class=n>input</span> <span class=n>type</span><span class=p>=</span><span class=s>&#34;text&#34;</span> <span class=n>name</span><span class=p>=</span><span class=s>&#34;SearchTerms&#34;</span> <span class=k>value</span><span class=p>=</span><span class=s>&#34;@Model.SearchTerms&#34;</span> <span class=p>/&gt;</span>
</span></span><span class=line><span class=cl>            <span class=p>&lt;</span><span class=n>input</span> <span class=n>type</span><span class=p>=</span><span class=s>&#34;submit&#34;</span> <span class=k>value</span><span class=p>=</span><span class=s>&#34;Search&#34;</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>        <span class=p>&lt;/</span><span class=n>div</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=p>&lt;</span><span class=n>div</span> <span class=n>id</span><span class=p>=</span><span class=s>&#34;filters&#34;</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>            <span class=p>&lt;</span><span class=n>h4</span><span class=p>&gt;</span><span class=n>MPAA</span> <span class=n>Rating</span><span class=p>&lt;/</span><span class=n>h4</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>            <span class=n>@foreach</span> <span class=p>(</span><span class=kt>string</span> <span class=n>rating</span> <span class=k>in</span> <span class=n>MovieDatabase</span><span class=p>.</span><span class=n>MPAARatings</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            <span class=p>{</span>
</span></span><span class=line><span class=cl>                <span class=p>&lt;</span><span class=n>label</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>                    <span class=p>&lt;</span><span class=n>input</span> <span class=n>type</span><span class=p>=</span><span class=s>&#34;checkbox&#34;</span> <span class=n>name</span><span class=p>=</span><span class=s>&#34;MPAARatings&#34;</span> <span class=k>value</span><span class=p>=</span><span class=s>&#34;@rating&#34;</span> <span class=k>checked</span><span class=p>=</span><span class=s>&#34;@Model.MPAARatings.Contains(rating)&#34;</span> <span class=p>/&gt;</span>
</span></span><span class=line><span class=cl>                    <span class=n>@rating</span>
</span></span><span class=line><span class=cl>                <span class=p>&lt;/</span><span class=n>label</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>            <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>            <span class=p>&lt;</span><span class=n>h4</span><span class=p>&gt;</span><span class=n>Genre</span><span class=p>&lt;/</span><span class=n>h4</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>            <span class=n>@foreach</span> <span class=p>(</span><span class=kt>string</span> <span class=n>genre</span> <span class=k>in</span> <span class=n>MovieDatabase</span><span class=p>.</span><span class=n>Genres</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            <span class=p>{</span>
</span></span><span class=line><span class=cl>                <span class=p>&lt;</span><span class=n>label</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>                    <span class=p>&lt;</span><span class=n>input</span> <span class=n>type</span><span class=p>=</span><span class=s>&#34;checkbox&#34;</span> <span class=n>name</span><span class=p>=</span><span class=s>&#34;Genres&#34;</span> <span class=k>value</span><span class=p>=</span><span class=s>&#34;@genre&#34;</span> <span class=k>checked</span><span class=p>=</span><span class=s>&#34;@Model.Genres.Contains(genre)&#34;</span> <span class=p>/&gt;</span>
</span></span><span class=line><span class=cl>                    <span class=n>@genre</span>
</span></span><span class=line><span class=cl>                <span class=p>&lt;/</span><span class=n>label</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>            <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>            <span class=p>&lt;</span><span class=n>h4</span><span class=p>&gt;</span><span class=n>IMDB</span> <span class=n>Rating</span><span class=p>&lt;/</span><span class=n>h4</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>            <span class=p>&lt;</span><span class=n>div</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>                <span class=p>&lt;</span><span class=n>input</span> <span class=n>name</span><span class=p>=</span><span class=s>&#34;IMDBMin&#34;</span> <span class=n>type</span><span class=p>=</span><span class=s>&#34;number&#34;</span> <span class=n>min</span><span class=p>=</span><span class=s>&#34;0&#34;</span> <span class=n>max</span><span class=p>=</span><span class=s>&#34;10&#34;</span> <span class=n>step</span><span class=p>=</span><span class=s>&#34;0.1&#34;</span> <span class=n>placeholder</span><span class=p>=</span><span class=s>&#34;min&#34;</span><span class=p>/&gt;</span>
</span></span><span class=line><span class=cl>                <span class=n>to</span>
</span></span><span class=line><span class=cl>                <span class=p>&lt;</span><span class=n>input</span> <span class=n>name</span><span class=p>=</span><span class=s>&#34;IMDBMax&#34;</span> <span class=n>type</span><span class=p>=</span><span class=s>&#34;number&#34;</span> <span class=n>min</span><span class=p>=</span><span class=s>&#34;0&#34;</span> <span class=n>max</span><span class=p>=</span><span class=s>&#34;10&#34;</span> <span class=n>step</span><span class=p>=</span><span class=s>&#34;0.1&#34;</span> <span class=n>placeholder</span><span class=p>=</span><span class=s>&#34;max&#34;</span><span class=p>/&gt;</span>
</span></span><span class=line><span class=cl>            <span class=p>&lt;/</span><span class=n>div</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=p>&lt;/</span><span class=n>div</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=p>&lt;</span><span class=n>div</span> <span class=n>id</span><span class=p>=</span><span class=s>&#34;results&#34;</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>            <span class=p>&lt;</span><span class=n>h1</span><span class=p>&gt;</span><span class=n>Movie</span> <span class=n>Results</span><span class=p>&lt;/</span><span class=n>h1</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>            <span class=p>&lt;</span><span class=n>ul</span> <span class=n>class</span><span class=p>=</span><span class=s>&#34;movie-list&#34;</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>                <span class=n>@foreach</span> <span class=p>(</span><span class=n>Movie</span> <span class=n>movie</span> <span class=k>in</span> <span class=n>@Model</span><span class=p>.</span><span class=n>Movies</span><span class=p>)</span>
</span></span><span class=line><span class=cl>                <span class=p>{</span>
</span></span><span class=line><span class=cl>                    <span class=p>&lt;</span><span class=n>li</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>                        <span class=p>&lt;</span><span class=n>div</span> <span class=n>class</span><span class=p>=</span><span class=s>&#34;details&#34;</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>                            <span class=p>&lt;</span><span class=n>h3</span> <span class=n>class</span><span class=p>=</span><span class=s>&#34;title&#34;</span><span class=p>&gt;</span><span class=n>@movie</span><span class=p>.</span><span class=n>Title</span><span class=p>&lt;/</span><span class=n>h3</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>                            <span class=p>&lt;</span><span class=n>div</span> <span class=n>class</span><span class=p>=</span><span class=s>&#34;mpaa&#34;</span><span class=p>&gt;</span><span class=n>@movie</span><span class=p>.</span><span class=n>MPAARating</span><span class=p>&lt;/</span><span class=n>div</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>                            <span class=p>&lt;</span><span class=n>div</span> <span class=n>class</span><span class=p>=</span><span class=s>&#34;genre&#34;</span><span class=p>&gt;</span><span class=n>@movie</span><span class=p>.</span><span class=n>MajorGenre</span><span class=p>&lt;/</span><span class=n>div</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>                        <span class=p>&lt;/</span><span class=n>div</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>                        <span class=p>&lt;</span><span class=n>div</span> <span class=n>class</span><span class=p>=</span><span class=s>&#34;ratings&#34;</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>                            <span class=n>@if</span> <span class=p>(</span><span class=n>movie</span><span class=p>.</span><span class=n>IMDBRating</span> <span class=p>!=</span> <span class=kc>null</span><span class=p>)</span>
</span></span><span class=line><span class=cl>                            <span class=p>{</span>
</span></span><span class=line><span class=cl>                                <span class=p>&lt;</span><span class=n>div</span> <span class=n>class</span><span class=p>=</span><span class=s>&#34;imdb&#34;</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>                                    <span class=n>@movie</span><span class=p>.</span><span class=n>IMDBRating</span>
</span></span><span class=line><span class=cl>                                <span class=p>&lt;/</span><span class=n>div</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>                            <span class=p>}</span>
</span></span><span class=line><span class=cl>                            <span class=n>@if</span> <span class=p>(</span><span class=n>movie</span><span class=p>.</span><span class=n>RottenTomatoesRating</span> <span class=p>!=</span> <span class=kc>null</span><span class=p>)</span>
</span></span><span class=line><span class=cl>                            <span class=p>{</span>
</span></span><span class=line><span class=cl>                                <span class=p>&lt;</span><span class=n>div</span> <span class=n>class</span><span class=p>=</span><span class=s>&#34;rotten-tomatoes&#34;</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>                                    <span class=n>@movie</span><span class=p>.</span><span class=n>RottenTomatoesRating</span>
</span></span><span class=line><span class=cl>                                <span class=p>&lt;/</span><span class=n>div</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>                            <span class=p>}</span>
</span></span><span class=line><span class=cl>                        <span class=p>&lt;/</span><span class=n>div</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>                    <span class=p>&lt;/</span><span class=n>li</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>                <span class=p>}</span>
</span></span><span class=line><span class=cl>            <span class=p>&lt;/</span><span class=n>ul</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>        <span class=p>&lt;/</span><span class=n>div</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=p>&lt;/</span><span class=n>form</span><span class=p>&gt;</span></span></span></code></pre></div><p>Most of this is simply moving elements around the page, but note that we are using inputs of <code>type=number</code> to represent our range of IMDB values. We can specify a minimum and maximum for this range, as well as an allowable increment. Also, we use the <code>placeholder</code> attribute to put text into the <code>input</code> until a value is added.</p><h2 id=adding-more-styles>Adding More Styles</h2><p>Now we&rsquo;ll need to add some rules to our <em>wwwroot/css/styles.css</em>. First, we&rsquo;ll use a <code>grid</code> for the layout of the form:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-css data-lang=css><span class=line><span class=cl><span class=nt>form</span><span class=p>#</span><span class=nn>movie-database</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>display</span><span class=p>:</span> <span class=k>grid</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=k>grid-template-columns</span><span class=p>:</span> <span class=mi>1</span><span class=n>fr</span> <span class=mi>3</span><span class=n>fr</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=k>grid-template-rows</span><span class=p>:</span> <span class=kc>auto</span> <span class=kc>auto</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span></span></span></code></pre></div><p>The right column will be three times as big as the left.</p><p>We can make our search bar span both columns with <code>grid-column-start</code> and <code>grid-column-end</code>:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-css data-lang=css><span class=line><span class=cl><span class=p>#</span><span class=nn>search</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>grid-column-start</span><span class=p>:</span> <span class=mi>1</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=k>grid-column-end</span><span class=p>:</span> <span class=mi>3</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=k>text-align</span><span class=p>:</span> <span class=kc>center</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span></span></span></code></pre></div><p>Notice too that for CSS, we start counting at 1, not 0. The filters and the results will fall in the next row automatically, each taking up their own respective grid cell. You can read more about the grid layout in <a href=https://css-tricks.com/snippets/css/complete-guide-grid/ rel=external target=_blank>A Complete Guide to Grid</a>.</p><p>Let&rsquo;s go ahead and use flexbox to lay out our filters in a column:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-css data-lang=css><span class=line><span class=cl><span class=p>#</span><span class=nn>filters</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>display</span><span class=p>:</span> <span class=kc>flex</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=k>flex-direction</span><span class=p>:</span> <span class=kc>column</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span></span></span></code></pre></div><p>And make our number inputs bigger:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-css data-lang=css><span class=line><span class=cl><span class=p>#</span><span class=nn>filters</span> <span class=nt>input</span><span class=o>[</span><span class=nt>type</span><span class=o>=</span><span class=nt>number</span><span class=o>]</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>width</span><span class=p>:</span> <span class=mi>4</span><span class=kt>rem</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span></span></span></code></pre></div><p>Notice the use of square brackets in our CSS Selector to only apply to inputs with type number.</p><p>Also, let&rsquo;s add a margin above and remove most of the margin below our <code>&lt;h4></code> elements:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-css data-lang=css><span class=line><span class=cl><span class=p>#</span><span class=nn>filters</span> <span class=nt>h4</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>margin-bottom</span><span class=p>:</span> <span class=mf>0.2</span><span class=kt>rem</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=k>margin-top</span><span class=p>:</span> <span class=mi>2</span><span class=kt>rem</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span></span></span></code></pre></div><p>The resulting page looks much cleaner:</p><p><a href=#R-image-c597baf406ef3416dfefa72faa6d988a class=lightbox-link><img alt="The Styled Page" class="border lazy lightbox noshadow figure-image" loading=lazy src=/cis400/images/6.8.5.png style=height:auto;width:auto></a>
<a href=javascript:history.back(); class=lightbox-back id=R-image-c597baf406ef3416dfefa72faa6d988a><img alt="The Styled Page" class="border lazy lightbox noshadow lightbox-image" loading=lazy src=/cis400/images/6.8.5.png></a></p><h2 id=capturing-the-filter-values>Capturing the Filter Values</h2><p>Now we need to get the filter values from our GET request query string. We could do this like we&rsquo;ve been doing before, with:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-csharp data-lang=csharp><span class=line><span class=cl>    <span class=n>Request</span><span class=p>.</span><span class=n>Query</span><span class=p>[</span><span class=s>&#34;IMDBMin&#34;</span><span class=p>];</span></span></span></code></pre></div><p>But the returned value would be a string, so we&rsquo;d need to parse it:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-csharp data-lang=csharp><span class=line><span class=cl>    <span class=n>IMDBMin</span> <span class=p>=</span> <span class=kt>double</span><span class=p>.</span><span class=n>Parse</span><span class=p>(</span><span class=n>Request</span><span class=p>.</span><span class=n>Query</span><span class=p>[</span><span class=s>&#34;IMDBMin&#34;</span><span class=p>]);</span></span></span></code></pre></div><p>If the query was <code>null</code>, then this would evaluate to <code>NaN</code>, which we wouldn&rsquo;t want to set our <code>&lt;input></code> to&mldr;</p><p>Instead, we&rsquo;ll look at some options built into the PageModel.</p><h2 id=parameter-binding>Parameter Binding</h2><p>The first of these options is <a href=https://docs.microsoft.com/en-us/aspnet/web-api/overview/formats-and-model-binding/parameter-binding-in-aspnet-web-api rel=external target=_blank><em>Parameter Binding</em></a>. In this approach, we define parameters to our <code>OnGet()</code> method to be parsed out of the request automatically, i.e.:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-csharp data-lang=csharp><span class=line><span class=cl>    <span class=cs>/// &lt;summary&gt;</span>
</span></span><span class=line><span class=cl>    <span class=cs>/// Gets the search results for display on the page</span>
</span></span><span class=line><span class=cl>    <span class=cs>/// &lt;/summary&gt;</span>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=k>void</span> <span class=n>OnGet</span><span class=p>(</span><span class=kt>string</span> <span class=n>SearchTerms</span><span class=p>,</span> <span class=kt>string</span><span class=p>[]</span> <span class=n>MPAARatings</span><span class=p>,</span> <span class=kt>string</span><span class=p>[]</span> <span class=n>Genres</span><span class=p>,</span> <span class=kt>double?</span> <span class=n>IMDBMin</span><span class=p>,</span> <span class=kt>double?</span> <span class=n>IMDBMax</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=k>this</span><span class=p>.</span><span class=n>SearchTerms</span> <span class=p>=</span> <span class=n>SearchTerms</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=k>this</span><span class=p>.</span><span class=n>MPAARatings</span> <span class=p>=</span> <span class=n>MPAARatings</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=k>this</span><span class=p>.</span><span class=n>Genres</span> <span class=p>=</span> <span class=n>Genres</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=k>this</span><span class=p>.</span><span class=n>IMDBMin</span> <span class=p>=</span> <span class=n>IMDBMin</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=k>this</span><span class=p>.</span><span class=n>IMDBMax</span> <span class=p>=</span> <span class=n>IMDBMax</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=n>Movies</span> <span class=p>=</span> <span class=n>MovieDatabase</span><span class=p>.</span><span class=n>Search</span><span class=p>(</span><span class=n>SearchTerms</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=n>Movies</span> <span class=p>=</span> <span class=n>MovieDatabase</span><span class=p>.</span><span class=n>FilterByMPAARating</span><span class=p>(</span><span class=n>Movies</span><span class=p>,</span> <span class=n>MPAARatings</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=n>Movies</span> <span class=p>=</span> <span class=n>MovieDatabase</span><span class=p>.</span><span class=n>FilterByGenre</span><span class=p>(</span><span class=n>Movies</span><span class=p>,</span> <span class=n>Genres</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=n>Movies</span> <span class=p>=</span> <span class=n>MovieDatabase</span><span class=p>.</span><span class=n>FilterByIMDBRating</span><span class=p>(</span><span class=n>Movies</span><span class=p>,</span> <span class=n>IMDBMin</span><span class=p>,</span> <span class=n>IMDBMax</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span></span></span></code></pre></div><p>The benefit of this approach is that as long as C# knows a conversion into the type we specify, the conversion is done automatically. Note that the parameter name matches the <code>name</code> property of the corresponding <code>&lt;input></code> - this must be the case for the Razor Page to bind the parameter to the corresponding input value.</p><p>Note that we still need to assign these parameter values to the corresponding properties of our PageModel. If we don&rsquo;t, then those properties will all be <code>null</code>, and the <code>&lt;inputs></code> rendered on our page will always be blank.</p><h2 id=model-binding>Model Binding</h2><p>A second option is to use <a href="https://docs.microsoft.com/en-us/aspnet/core/mvc/models/model-binding?view=aspnetcore-3.1" rel=external target=_blank><em>Model Binding</em></a>. Model binding also automatically converts incoming form data, but in this case it binds directly to the properties of our PageModel. We indicate this form of binding with a <code>[BindProperty]</code> attribute, i.e.:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-csharp data-lang=csharp><span class=line><span class=cl><span class=kd>public</span> <span class=k>class</span> <span class=nc>IndexModel</span> <span class=p>:</span> <span class=n>PageModel</span> <span class=p>{</span>
</span></span><span class=line><span class=cl><span class=na>
</span></span></span><span class=line><span class=cl><span class=na>    [BindProperty(SupportsGet=true)]</span>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=kt>string</span> <span class=n>SearchTerms</span> <span class=p>{</span><span class=k>get</span><span class=p>;</span> <span class=k>set</span><span class=p>;}</span>
</span></span><span class=line><span class=cl><span class=na>
</span></span></span><span class=line><span class=cl><span class=na>    [BindProperty(SupportsGet=true)]</span>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=kt>string</span><span class=p>[]</span> <span class=n>MPAARatings</span> <span class=p>{</span><span class=k>get</span><span class=p>;</span> <span class=k>set</span><span class=p>;}</span>
</span></span><span class=line><span class=cl><span class=na>
</span></span></span><span class=line><span class=cl><span class=na>    [BindProperty(SupportsGet=true)]</span>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=kt>string</span><span class=p>[]</span> <span class=n>Genres</span> <span class=p>{</span><span class=k>get</span><span class=p>;</span> <span class=k>set</span><span class=p>;}</span>
</span></span><span class=line><span class=cl><span class=na>
</span></span></span><span class=line><span class=cl><span class=na>    [BindProperty(SupportsGet=true)]</span>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=kt>double?</span> <span class=n>IMDBMin</span> <span class=p>{</span><span class=k>get</span><span class=p>;</span> <span class=k>set</span><span class=p>;}</span>
</span></span><span class=line><span class=cl><span class=na>
</span></span></span><span class=line><span class=cl><span class=na>    [BindProperty(SupportsGet=true)]</span>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=kt>double?</span> <span class=n>IMDBMax</span> <span class=p>{</span><span class=k>get</span><span class=p>;</span> <span class=k>set</span><span class=p>;}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=cs>/// &lt;summary&gt;</span>
</span></span><span class=line><span class=cl>    <span class=cs>/// Gets the search results for display on the page</span>
</span></span><span class=line><span class=cl>    <span class=cs>/// &lt;/summary&gt;</span>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=k>void</span> <span class=n>OnGet</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=n>Movies</span> <span class=p>=</span> <span class=n>MovieDatabase</span><span class=p>.</span><span class=n>Search</span><span class=p>(</span><span class=n>SearchTerms</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=n>Movies</span> <span class=p>=</span> <span class=n>MovieDatabase</span><span class=p>.</span><span class=n>FilterByMPAARating</span><span class=p>(</span><span class=n>Movies</span><span class=p>,</span> <span class=n>MPAARatings</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=n>Movies</span> <span class=p>=</span> <span class=n>MovieDatabase</span><span class=p>.</span><span class=n>FilterByGenre</span><span class=p>(</span><span class=n>Movies</span><span class=p>,</span> <span class=n>Genres</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=n>Movies</span> <span class=p>=</span> <span class=n>MovieDatabase</span><span class=p>.</span><span class=n>FilterByIMDBRating</span><span class=p>(</span><span class=n>Movies</span><span class=p>,</span> <span class=n>IMDBMin</span><span class=p>,</span> <span class=n>IMDBMax</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span></span></span></code></pre></div><p>Note that with this approach, the incoming data is directly bound to the properties, so we don&rsquo;t need to do any special assignments within our <code>OnGet()</code> method. Also, note that we have to use <code>SupportsGet=true</code> in order for this binding to occur on GET requests (by default, model binding only happens with POST requests).</p><div class="box notices cstyle note"><div class=box-label><i class="fa-fw fas fa-exclamation-circle"></i> Note</div><div class=box-content><p>You only need to do <em>one</em> binding approach per property in a PageModel. I.e. you can just use the property decorator:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-csharp data-lang=csharp><span class=line><span class=cl><span class=kd>public</span> <span class=k>class</span> <span class=nc>SomePageModel</span> <span class=p>:</span> <span class=n>PageModel</span>
</span></span><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl><span class=na>    [BindProperty(SupportsGet=true)]</span>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=kt>float</span> <span class=n>SomeProperty</span> <span class=p>{</span> <span class=k>get</span><span class=p>;</span> <span class=k>set</span><span class=p>;</span> <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=k>void</span> <span class=n>OnGet</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=n>DoSomething</span><span class=p>(</span><span class=n>SomeProperty</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span></span></span></code></pre></div><p><em>or</em> you might use parameter binding:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-csharp data-lang=csharp><span class=line><span class=cl><span class=kd>public</span> <span class=k>class</span> <span class=nc>SomePageModel</span> <span class=p>:</span> <span class=n>PageModel</span>
</span></span><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=k>void</span> <span class=n>OnGet</span><span class=p>(</span><span class=kt>float</span> <span class=n>SomeProperty</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=n>DoSomething</span><span class=p>(</span><span class=n>SomeProperty</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span></span></span></code></pre></div><p><em>or</em> you can parse it from the request:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-csharp data-lang=csharp><span class=line><span class=cl><span class=kd>public</span> <span class=k>class</span> <span class=nc>SomePageModel</span> <span class=p>:</span> <span class=n>PageModel</span>
</span></span><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=k>void</span> <span class=n>OnGet</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=kt>var</span> <span class=n>someProperty</span> <span class=p>=</span> <span class=kt>float</span><span class=p>.</span><span class=n>Parse</span><span class=p>(</span><span class=n>Request</span><span class=p>.</span><span class=n>Query</span><span class=p>[</span><span class=s>&#34;SomeProperty&#34;</span><span class=p>]);</span>
</span></span><span class=line><span class=cl>        <span class=n>DoSomething</span><span class=p>(</span><span class=n>someProperty</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span></span></span></code></pre></div><p>These are all <em>different means</em> of accessing the <em>same data</em> from the incoming request.</p></div></div><p>Now all we need to do is implement the actual filter.</p><h3 id=implementing-the-imdb-rating-filter>Implementing the IMDB Rating Filter</h3><p>We&rsquo;ll define the new filter in our <code>MovieDatabase</code> class as another static method:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-csharp data-lang=csharp><span class=line><span class=cl>    <span class=cs>/// &lt;summary&gt;</span>
</span></span><span class=line><span class=cl>    <span class=cs>/// Filters the provided collection of movies</span>
</span></span><span class=line><span class=cl>    <span class=cs>/// to those with IMDB ratings falling within</span>
</span></span><span class=line><span class=cl>    <span class=cs>/// the specified range</span>
</span></span><span class=line><span class=cl>    <span class=cs>/// &lt;/summary&gt;</span>
</span></span><span class=line><span class=cl>    <span class=cs>/// &lt;param name=&#34;movies&#34;&gt;The collection of movies to filter&lt;/param&gt;</span>
</span></span><span class=line><span class=cl>    <span class=cs>/// &lt;param name=&#34;min&#34;&gt;The minimum range value&lt;/param&gt;</span>
</span></span><span class=line><span class=cl>    <span class=cs>/// &lt;param name=&#34;max&#34;&gt;The maximum range value&lt;/param&gt;</span>
</span></span><span class=line><span class=cl>    <span class=cs>/// &lt;returns&gt;The filtered movie collection&lt;/returns&gt;</span>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=kd>static</span> <span class=n>IEnumerable</span><span class=p>&lt;</span><span class=n>Movie</span><span class=p>&gt;</span> <span class=n>FilterByIMDBRating</span><span class=p>(</span><span class=n>IEnumerable</span><span class=p>&lt;</span><span class=n>Movie</span><span class=p>&gt;</span> <span class=n>movies</span><span class=p>,</span> <span class=kt>double?</span> <span class=n>min</span><span class=p>,</span> <span class=kt>double?</span> <span class=n>max</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=c1>// TODO: Filter movies</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span></span></span></code></pre></div><p>Notice that here too we use the nullable double value. So our first step is probably to do a <code>null</code> check:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-csharp data-lang=csharp><span class=line><span class=cl>    <span class=k>if</span> <span class=p>(</span><span class=n>min</span> <span class=p>==</span> <span class=kc>null</span> <span class=p>&amp;&amp;</span> <span class=n>max</span> <span class=p>==</span> <span class=kc>null</span><span class=p>)</span> <span class=k>return</span> <span class=n>movies</span><span class=p>;</span></span></span></code></pre></div><p>But what if only one is null? Should we filter for that part of the range? It wouldn&rsquo;t be hard to do:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-csharp data-lang=csharp><span class=line><span class=cl>    <span class=kt>var</span> <span class=n>results</span> <span class=p>=</span> <span class=k>new</span> <span class=n>List</span><span class=p>&lt;</span><span class=n>Movie</span><span class=p>&gt;();</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c1>// only a maximum specified</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span><span class=p>(</span><span class=n>min</span> <span class=p>==</span> <span class=kc>null</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=k>foreach</span><span class=p>(</span><span class=n>Movie</span> <span class=n>movie</span> <span class=k>in</span> <span class=n>movies</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=k>if</span> <span class=p>(</span><span class=n>movie</span><span class=p>.</span><span class=n>IMDBRating</span> <span class=p>&lt;=</span> <span class=n>max</span><span class=p>)</span> <span class=n>results</span><span class=p>.</span><span class=n>Add</span><span class=p>(</span><span class=n>movie</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=n>results</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span></span></span></code></pre></div><p>And the minimum would mirror that:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-csharp data-lang=csharp><span class=line><span class=cl>    <span class=c1>// only a minimum specified</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span><span class=p>(</span><span class=n>max</span> <span class=p>==</span> <span class=kc>null</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=k>foreach</span><span class=p>(</span><span class=n>Movie</span> <span class=n>movie</span> <span class=k>in</span> <span class=n>movies</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=k>if</span> <span class=p>(</span><span class=n>movie</span><span class=p>.</span><span class=n>IMDBRating</span> <span class=p>&gt;=</span> <span class=n>min</span><span class=p>)</span> <span class=n>results</span><span class=p>.</span><span class=n>Add</span><span class=p>(</span><span class=n>movie</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=n>results</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span></span></span></code></pre></div><p>Finally, we could handle the case where we have both a min and max value to our range:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-csharp data-lang=csharp><span class=line><span class=cl>    <span class=c1>// Both minimum and maximum specified</span>
</span></span><span class=line><span class=cl>    <span class=k>foreach</span><span class=p>(</span><span class=n>Movie</span> <span class=n>movie</span> <span class=k>in</span> <span class=n>movies</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span><span class=p>(</span><span class=n>movie</span><span class=p>.</span><span class=n>IMDBRating</span> <span class=p>&gt;=</span> <span class=n>min</span> <span class=p>&amp;&amp;</span> <span class=n>movie</span><span class=p>.</span><span class=n>IMDBRating</span> <span class=p>&lt;=</span> <span class=n>max</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=n>results</span><span class=p>.</span><span class=n>Add</span><span class=p>(</span><span class=n>movie</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=n>results</span><span class=p>;</span></span></span></code></pre></div><p>Notice too, that in each of these cases we&rsquo;re treating the range as <em>inclusive</em> (including the specified minimum and maximum). This is the behavior most casual internet users will expect. If the database and user expectations are different for your audience, you&rsquo;d want your code to match that expectation.</p><p>Now we can filter by IMDB rating:</p><p><a href=#R-image-df8fded9023d51c7fe33bc102c2ff000 class=lightbox-link><img alt="Filtering By IMDB" class="border lazy lightbox noshadow figure-image" loading=lazy src=/cis400/images/6.8.6.png style=height:auto;width:auto></a>
<a href=javascript:history.back(); class=lightbox-back id=R-image-df8fded9023d51c7fe33bc102c2ff000><img alt="Filtering By IMDB" class="border lazy lightbox noshadow lightbox-image" loading=lazy src=/cis400/images/6.8.6.png></a></p><h2 id=finishing-up>Finishing Up</h2><p>Since we&rsquo;re displaying the Rotten Tomatoes rating, we should probably also have a filter for it. This will work almost exactly like the IMDB rating - but with the range from 0 to 100. I&rsquo;ll leave this as an exercise for the reader.</p><footer class=footline></footer></article><article class=default><header class=headline></header><h1 id=numerical-filters>Numerical Filters</h1><p>Let&rsquo;s tackle one of the critics ratings next. While we could create categories and use checkboxes, this doesn&rsquo;t capture the incremental values (i.e. 4.3), and it would be a <em>lot</em> of checkboxes for Rotten Tomatoes ratings! Instead, we&rsquo;ll use a <em>numerical filter</em>, which limits our possible results to a range - between a minimum and maximum value.</p><p>Moreover, let&rsquo;s clean up our Index page, as it is getting difficult to determine what filter(s) go together, and are adding more.</p><h2 id=refactoring-the-index-page>Refactoring the Index Page</h2><p>Let&rsquo;s move the filters to a column on the left, leave the search bar above, and show our results on the right. This will require refactoring our <em>Index.cshtml</em> file:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-csharp data-lang=csharp><span class=line><span class=cl>    <span class=p>&lt;</span><span class=n>form</span> <span class=n>id</span><span class=p>=</span><span class=s>&#34;movie-database&#34;</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=p>&lt;</span><span class=n>div</span> <span class=n>id</span><span class=p>=</span><span class=s>&#34;search&#34;</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>            <span class=p>&lt;</span><span class=n>input</span> <span class=n>type</span><span class=p>=</span><span class=s>&#34;text&#34;</span> <span class=n>name</span><span class=p>=</span><span class=s>&#34;SearchTerms&#34;</span> <span class=k>value</span><span class=p>=</span><span class=s>&#34;@Model.SearchTerms&#34;</span> <span class=p>/&gt;</span>
</span></span><span class=line><span class=cl>            <span class=p>&lt;</span><span class=n>input</span> <span class=n>type</span><span class=p>=</span><span class=s>&#34;submit&#34;</span> <span class=k>value</span><span class=p>=</span><span class=s>&#34;Search&#34;</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>        <span class=p>&lt;/</span><span class=n>div</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=p>&lt;</span><span class=n>div</span> <span class=n>id</span><span class=p>=</span><span class=s>&#34;filters&#34;</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>            <span class=p>&lt;</span><span class=n>h4</span><span class=p>&gt;</span><span class=n>MPAA</span> <span class=n>Rating</span><span class=p>&lt;/</span><span class=n>h4</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>            <span class=n>@foreach</span> <span class=p>(</span><span class=kt>string</span> <span class=n>rating</span> <span class=k>in</span> <span class=n>MovieDatabase</span><span class=p>.</span><span class=n>MPAARatings</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            <span class=p>{</span>
</span></span><span class=line><span class=cl>                <span class=p>&lt;</span><span class=n>label</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>                    <span class=p>&lt;</span><span class=n>input</span> <span class=n>type</span><span class=p>=</span><span class=s>&#34;checkbox&#34;</span> <span class=n>name</span><span class=p>=</span><span class=s>&#34;MPAARatings&#34;</span> <span class=k>value</span><span class=p>=</span><span class=s>&#34;@rating&#34;</span> <span class=k>checked</span><span class=p>=</span><span class=s>&#34;@Model.MPAARatings.Contains(rating)&#34;</span> <span class=p>/&gt;</span>
</span></span><span class=line><span class=cl>                    <span class=n>@rating</span>
</span></span><span class=line><span class=cl>                <span class=p>&lt;/</span><span class=n>label</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>            <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>            <span class=p>&lt;</span><span class=n>h4</span><span class=p>&gt;</span><span class=n>Genre</span><span class=p>&lt;/</span><span class=n>h4</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>            <span class=n>@foreach</span> <span class=p>(</span><span class=kt>string</span> <span class=n>genre</span> <span class=k>in</span> <span class=n>MovieDatabase</span><span class=p>.</span><span class=n>Genres</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            <span class=p>{</span>
</span></span><span class=line><span class=cl>                <span class=p>&lt;</span><span class=n>label</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>                    <span class=p>&lt;</span><span class=n>input</span> <span class=n>type</span><span class=p>=</span><span class=s>&#34;checkbox&#34;</span> <span class=n>name</span><span class=p>=</span><span class=s>&#34;Genres&#34;</span> <span class=k>value</span><span class=p>=</span><span class=s>&#34;@genre&#34;</span> <span class=k>checked</span><span class=p>=</span><span class=s>&#34;@Model.Genres.Contains(genre)&#34;</span> <span class=p>/&gt;</span>
</span></span><span class=line><span class=cl>                    <span class=n>@genre</span>
</span></span><span class=line><span class=cl>                <span class=p>&lt;/</span><span class=n>label</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>            <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>            <span class=p>&lt;</span><span class=n>h4</span><span class=p>&gt;</span><span class=n>IMDB</span> <span class=n>Rating</span><span class=p>&lt;/</span><span class=n>h4</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>            <span class=p>&lt;</span><span class=n>div</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>                <span class=p>&lt;</span><span class=n>input</span> <span class=n>name</span><span class=p>=</span><span class=s>&#34;IMDBMin&#34;</span> <span class=n>type</span><span class=p>=</span><span class=s>&#34;number&#34;</span> <span class=n>min</span><span class=p>=</span><span class=s>&#34;0&#34;</span> <span class=n>max</span><span class=p>=</span><span class=s>&#34;10&#34;</span> <span class=n>step</span><span class=p>=</span><span class=s>&#34;0.1&#34;</span> <span class=n>placeholder</span><span class=p>=</span><span class=s>&#34;min&#34;</span><span class=p>/&gt;</span>
</span></span><span class=line><span class=cl>                <span class=n>to</span>
</span></span><span class=line><span class=cl>                <span class=p>&lt;</span><span class=n>input</span> <span class=n>name</span><span class=p>=</span><span class=s>&#34;IMDBMax&#34;</span> <span class=n>type</span><span class=p>=</span><span class=s>&#34;number&#34;</span> <span class=n>min</span><span class=p>=</span><span class=s>&#34;0&#34;</span> <span class=n>max</span><span class=p>=</span><span class=s>&#34;10&#34;</span> <span class=n>step</span><span class=p>=</span><span class=s>&#34;0.1&#34;</span> <span class=n>placeholder</span><span class=p>=</span><span class=s>&#34;max&#34;</span><span class=p>/&gt;</span>
</span></span><span class=line><span class=cl>            <span class=p>&lt;/</span><span class=n>div</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=p>&lt;/</span><span class=n>div</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=p>&lt;</span><span class=n>div</span> <span class=n>id</span><span class=p>=</span><span class=s>&#34;results&#34;</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>            <span class=p>&lt;</span><span class=n>h1</span><span class=p>&gt;</span><span class=n>Movie</span> <span class=n>Results</span><span class=p>&lt;/</span><span class=n>h1</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>            <span class=p>&lt;</span><span class=n>ul</span> <span class=n>class</span><span class=p>=</span><span class=s>&#34;movie-list&#34;</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>                <span class=n>@foreach</span> <span class=p>(</span><span class=n>Movie</span> <span class=n>movie</span> <span class=k>in</span> <span class=n>@Model</span><span class=p>.</span><span class=n>Movies</span><span class=p>)</span>
</span></span><span class=line><span class=cl>                <span class=p>{</span>
</span></span><span class=line><span class=cl>                    <span class=p>&lt;</span><span class=n>li</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>                        <span class=p>&lt;</span><span class=n>div</span> <span class=n>class</span><span class=p>=</span><span class=s>&#34;details&#34;</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>                            <span class=p>&lt;</span><span class=n>h3</span> <span class=n>class</span><span class=p>=</span><span class=s>&#34;title&#34;</span><span class=p>&gt;</span><span class=n>@movie</span><span class=p>.</span><span class=n>Title</span><span class=p>&lt;/</span><span class=n>h3</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>                            <span class=p>&lt;</span><span class=n>div</span> <span class=n>class</span><span class=p>=</span><span class=s>&#34;mpaa&#34;</span><span class=p>&gt;</span><span class=n>@movie</span><span class=p>.</span><span class=n>MPAARating</span><span class=p>&lt;/</span><span class=n>div</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>                            <span class=p>&lt;</span><span class=n>div</span> <span class=n>class</span><span class=p>=</span><span class=s>&#34;genre&#34;</span><span class=p>&gt;</span><span class=n>@movie</span><span class=p>.</span><span class=n>MajorGenre</span><span class=p>&lt;/</span><span class=n>div</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>                        <span class=p>&lt;/</span><span class=n>div</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>                        <span class=p>&lt;</span><span class=n>div</span> <span class=n>class</span><span class=p>=</span><span class=s>&#34;ratings&#34;</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>                            <span class=n>@if</span> <span class=p>(</span><span class=n>movie</span><span class=p>.</span><span class=n>IMDBRating</span> <span class=p>!=</span> <span class=kc>null</span><span class=p>)</span>
</span></span><span class=line><span class=cl>                            <span class=p>{</span>
</span></span><span class=line><span class=cl>                                <span class=p>&lt;</span><span class=n>div</span> <span class=n>class</span><span class=p>=</span><span class=s>&#34;imdb&#34;</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>                                    <span class=n>@movie</span><span class=p>.</span><span class=n>IMDBRating</span>
</span></span><span class=line><span class=cl>                                <span class=p>&lt;/</span><span class=n>div</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>                            <span class=p>}</span>
</span></span><span class=line><span class=cl>                            <span class=n>@if</span> <span class=p>(</span><span class=n>movie</span><span class=p>.</span><span class=n>RottenTomatoesRating</span> <span class=p>!=</span> <span class=kc>null</span><span class=p>)</span>
</span></span><span class=line><span class=cl>                            <span class=p>{</span>
</span></span><span class=line><span class=cl>                                <span class=p>&lt;</span><span class=n>div</span> <span class=n>class</span><span class=p>=</span><span class=s>&#34;rotten-tomatoes&#34;</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>                                    <span class=n>@movie</span><span class=p>.</span><span class=n>RottenTomatoesRating</span>
</span></span><span class=line><span class=cl>                                <span class=p>&lt;/</span><span class=n>div</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>                            <span class=p>}</span>
</span></span><span class=line><span class=cl>                        <span class=p>&lt;/</span><span class=n>div</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>                    <span class=p>&lt;/</span><span class=n>li</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>                <span class=p>}</span>
</span></span><span class=line><span class=cl>            <span class=p>&lt;/</span><span class=n>ul</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>        <span class=p>&lt;/</span><span class=n>div</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=p>&lt;/</span><span class=n>form</span><span class=p>&gt;</span></span></span></code></pre></div><p>Most of this is simply moving elements around the page, but note that we are using inputs of <code>type=number</code> to represent our range of IMDB values. We can specify a minimum and maximum for this range, as well as an allowable increment. Also, we use the <code>placeholder</code> attribute to put text into the <code>input</code> until a value is added.</p><h2 id=adding-more-styles>Adding More Styles</h2><p>Now we&rsquo;ll need to add some rules to our <em>wwwroot/css/styles.css</em>. First, we&rsquo;ll use a <code>grid</code> for the layout of the form:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-css data-lang=css><span class=line><span class=cl><span class=nt>form</span><span class=p>#</span><span class=nn>movie-database</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>display</span><span class=p>:</span> <span class=k>grid</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=k>grid-template-columns</span><span class=p>:</span> <span class=mi>1</span><span class=n>fr</span> <span class=mi>3</span><span class=n>fr</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=k>grid-template-rows</span><span class=p>:</span> <span class=kc>auto</span> <span class=kc>auto</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span></span></span></code></pre></div><p>The right column will be three times as big as the left.</p><p>We can make our search bar span both columns with <code>grid-column-start</code> and <code>grid-column-end</code>:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-css data-lang=css><span class=line><span class=cl><span class=p>#</span><span class=nn>search</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>grid-column-start</span><span class=p>:</span> <span class=mi>1</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=k>grid-column-end</span><span class=p>:</span> <span class=mi>3</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=k>text-align</span><span class=p>:</span> <span class=kc>center</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span></span></span></code></pre></div><p>Notice too that for CSS, we start counting at 1, not 0. The filters and the results will fall in the next row automatically, each taking up their own respective grid cell. You can read more about the grid layout in <a href=https://css-tricks.com/snippets/css/complete-guide-grid/ rel=external target=_blank>A Complete Guide to Grid</a>.</p><p>Let&rsquo;s go ahead and use flexbox to lay out our filters in a column:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-css data-lang=css><span class=line><span class=cl><span class=p>#</span><span class=nn>filters</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>display</span><span class=p>:</span> <span class=kc>flex</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=k>flex-direction</span><span class=p>:</span> <span class=kc>column</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span></span></span></code></pre></div><p>And make our number inputs bigger:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-css data-lang=css><span class=line><span class=cl><span class=p>#</span><span class=nn>filters</span> <span class=nt>input</span><span class=o>[</span><span class=nt>type</span><span class=o>=</span><span class=nt>number</span><span class=o>]</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>width</span><span class=p>:</span> <span class=mi>4</span><span class=kt>rem</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span></span></span></code></pre></div><p>Notice the use of square brackets in our CSS Selector to only apply to inputs with type number.</p><p>Also, let&rsquo;s add a margin above and remove most of the margin below our <code>&lt;h4></code> elements:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-css data-lang=css><span class=line><span class=cl><span class=p>#</span><span class=nn>filters</span> <span class=nt>h4</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>margin-bottom</span><span class=p>:</span> <span class=mf>0.2</span><span class=kt>rem</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=k>margin-top</span><span class=p>:</span> <span class=mi>2</span><span class=kt>rem</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span></span></span></code></pre></div><p>The resulting page looks much cleaner:</p><p><a href=#R-image-e0c3d0c258bfed6c0d5f9792de12f295 class=lightbox-link><img alt="The Styled Page" class="border lazy lightbox noshadow figure-image" loading=lazy src=/cis400/images/6.8.5.png style=height:auto;width:auto></a>
<a href=javascript:history.back(); class=lightbox-back id=R-image-e0c3d0c258bfed6c0d5f9792de12f295><img alt="The Styled Page" class="border lazy lightbox noshadow lightbox-image" loading=lazy src=/cis400/images/6.8.5.png></a></p><h2 id=capturing-the-filter-values>Capturing the Filter Values</h2><p>Now we need to get the filter values from our GET request query string. We could do this like we&rsquo;ve been doing before, with:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-csharp data-lang=csharp><span class=line><span class=cl>    <span class=n>Request</span><span class=p>.</span><span class=n>Query</span><span class=p>[</span><span class=s>&#34;IMDBMin&#34;</span><span class=p>];</span></span></span></code></pre></div><p>But the returned value would be a string, so we&rsquo;d need to parse it:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-csharp data-lang=csharp><span class=line><span class=cl>    <span class=n>IMDBMin</span> <span class=p>=</span> <span class=kt>double</span><span class=p>.</span><span class=n>Parse</span><span class=p>(</span><span class=n>Request</span><span class=p>.</span><span class=n>Query</span><span class=p>[</span><span class=s>&#34;IMDBMin&#34;</span><span class=p>]);</span></span></span></code></pre></div><p>If the query was <code>null</code>, then this would evaluate to <code>NaN</code>, which we wouldn&rsquo;t want to set our <code>&lt;input></code> to&mldr;</p><p>Instead, we&rsquo;ll look at some options built into the PageModel.</p><h2 id=parameter-binding>Parameter Binding</h2><p>The first of these options is <a href=https://docs.microsoft.com/en-us/aspnet/web-api/overview/formats-and-model-binding/parameter-binding-in-aspnet-web-api rel=external target=_blank><em>Parameter Binding</em></a>. In this approach, we define parameters to our <code>OnGet()</code> method to be parsed out of the request automatically, i.e.:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-csharp data-lang=csharp><span class=line><span class=cl>    <span class=cs>/// &lt;summary&gt;</span>
</span></span><span class=line><span class=cl>    <span class=cs>/// Gets the search results for display on the page</span>
</span></span><span class=line><span class=cl>    <span class=cs>/// &lt;/summary&gt;</span>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=k>void</span> <span class=n>OnGet</span><span class=p>(</span><span class=kt>string</span> <span class=n>SearchTerms</span><span class=p>,</span> <span class=kt>string</span><span class=p>[]</span> <span class=n>MPAARatings</span><span class=p>,</span> <span class=kt>string</span><span class=p>[]</span> <span class=n>Genres</span><span class=p>,</span> <span class=kt>double?</span> <span class=n>IMDBMin</span><span class=p>,</span> <span class=kt>double?</span> <span class=n>IMDBMax</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=k>this</span><span class=p>.</span><span class=n>SearchTerms</span> <span class=p>=</span> <span class=n>SearchTerms</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=k>this</span><span class=p>.</span><span class=n>MPAARatings</span> <span class=p>=</span> <span class=n>MPAARatings</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=k>this</span><span class=p>.</span><span class=n>Genres</span> <span class=p>=</span> <span class=n>Genres</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=k>this</span><span class=p>.</span><span class=n>IMDBMin</span> <span class=p>=</span> <span class=n>IMDBMin</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=k>this</span><span class=p>.</span><span class=n>IMDBMax</span> <span class=p>=</span> <span class=n>IMDBMax</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=n>Movies</span> <span class=p>=</span> <span class=n>MovieDatabase</span><span class=p>.</span><span class=n>Search</span><span class=p>(</span><span class=n>SearchTerms</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=n>Movies</span> <span class=p>=</span> <span class=n>MovieDatabase</span><span class=p>.</span><span class=n>FilterByMPAARating</span><span class=p>(</span><span class=n>Movies</span><span class=p>,</span> <span class=n>MPAARatings</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=n>Movies</span> <span class=p>=</span> <span class=n>MovieDatabase</span><span class=p>.</span><span class=n>FilterByGenre</span><span class=p>(</span><span class=n>Movies</span><span class=p>,</span> <span class=n>Genres</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=n>Movies</span> <span class=p>=</span> <span class=n>MovieDatabase</span><span class=p>.</span><span class=n>FilterByIMDBRating</span><span class=p>(</span><span class=n>Movies</span><span class=p>,</span> <span class=n>IMDBMin</span><span class=p>,</span> <span class=n>IMDBMax</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span></span></span></code></pre></div><p>The benefit of this approach is that as long as C# knows a conversion into the type we specify, the conversion is done automatically. Note that the parameter name matches the <code>name</code> property of the corresponding <code>&lt;input></code> - this must be the case for the Razor Page to bind the parameter to the corresponding input value.</p><p>Note that we still need to assign these parameter values to the corresponding properties of our PageModel. If we don&rsquo;t, then those properties will all be <code>null</code>, and the <code>&lt;inputs></code> rendered on our page will always be blank.</p><h2 id=model-binding>Model Binding</h2><p>A second option is to use <a href="https://docs.microsoft.com/en-us/aspnet/core/mvc/models/model-binding?view=aspnetcore-3.1" rel=external target=_blank><em>Model Binding</em></a>. Model binding also automatically converts incoming form data, but in this case it binds directly to the properties of our PageModel. We indicate this form of binding with a <code>[BindProperty]</code> attribute, i.e.:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-csharp data-lang=csharp><span class=line><span class=cl><span class=kd>public</span> <span class=k>class</span> <span class=nc>IndexModel</span> <span class=p>:</span> <span class=n>PageModel</span> <span class=p>{</span>
</span></span><span class=line><span class=cl><span class=na>
</span></span></span><span class=line><span class=cl><span class=na>    [BindProperty(SupportsGet=true)]</span>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=kt>string</span> <span class=n>SearchTerms</span> <span class=p>{</span><span class=k>get</span><span class=p>;</span> <span class=k>set</span><span class=p>;}</span>
</span></span><span class=line><span class=cl><span class=na>
</span></span></span><span class=line><span class=cl><span class=na>    [BindProperty(SupportsGet=true)]</span>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=kt>string</span><span class=p>[]</span> <span class=n>MPAARatings</span> <span class=p>{</span><span class=k>get</span><span class=p>;</span> <span class=k>set</span><span class=p>;}</span>
</span></span><span class=line><span class=cl><span class=na>
</span></span></span><span class=line><span class=cl><span class=na>    [BindProperty(SupportsGet=true)]</span>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=kt>string</span><span class=p>[]</span> <span class=n>Genres</span> <span class=p>{</span><span class=k>get</span><span class=p>;</span> <span class=k>set</span><span class=p>;}</span>
</span></span><span class=line><span class=cl><span class=na>
</span></span></span><span class=line><span class=cl><span class=na>    [BindProperty(SupportsGet=true)]</span>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=kt>double?</span> <span class=n>IMDBMin</span> <span class=p>{</span><span class=k>get</span><span class=p>;</span> <span class=k>set</span><span class=p>;}</span>
</span></span><span class=line><span class=cl><span class=na>
</span></span></span><span class=line><span class=cl><span class=na>    [BindProperty(SupportsGet=true)]</span>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=kt>double?</span> <span class=n>IMDBMax</span> <span class=p>{</span><span class=k>get</span><span class=p>;</span> <span class=k>set</span><span class=p>;}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=cs>/// &lt;summary&gt;</span>
</span></span><span class=line><span class=cl>    <span class=cs>/// Gets the search results for display on the page</span>
</span></span><span class=line><span class=cl>    <span class=cs>/// &lt;/summary&gt;</span>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=k>void</span> <span class=n>OnGet</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=n>Movies</span> <span class=p>=</span> <span class=n>MovieDatabase</span><span class=p>.</span><span class=n>Search</span><span class=p>(</span><span class=n>SearchTerms</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=n>Movies</span> <span class=p>=</span> <span class=n>MovieDatabase</span><span class=p>.</span><span class=n>FilterByMPAARating</span><span class=p>(</span><span class=n>Movies</span><span class=p>,</span> <span class=n>MPAARatings</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=n>Movies</span> <span class=p>=</span> <span class=n>MovieDatabase</span><span class=p>.</span><span class=n>FilterByGenre</span><span class=p>(</span><span class=n>Movies</span><span class=p>,</span> <span class=n>Genres</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=n>Movies</span> <span class=p>=</span> <span class=n>MovieDatabase</span><span class=p>.</span><span class=n>FilterByIMDBRating</span><span class=p>(</span><span class=n>Movies</span><span class=p>,</span> <span class=n>IMDBMin</span><span class=p>,</span> <span class=n>IMDBMax</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span></span></span></code></pre></div><p>Note that with this approach, the incoming data is directly bound to the properties, so we don&rsquo;t need to do any special assignments within our <code>OnGet()</code> method. Also, note that we have to use <code>SupportsGet=true</code> in order for this binding to occur on GET requests (by default, model binding only happens with POST requests).</p><div class="box notices cstyle note"><div class=box-label><i class="fa-fw fas fa-exclamation-circle"></i> Note</div><div class=box-content><p>You only need to do <em>one</em> binding approach per property in a PageModel. I.e. you can just use the property decorator:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-csharp data-lang=csharp><span class=line><span class=cl><span class=kd>public</span> <span class=k>class</span> <span class=nc>SomePageModel</span> <span class=p>:</span> <span class=n>PageModel</span>
</span></span><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl><span class=na>    [BindProperty(SupportsGet=true)]</span>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=kt>float</span> <span class=n>SomeProperty</span> <span class=p>{</span> <span class=k>get</span><span class=p>;</span> <span class=k>set</span><span class=p>;</span> <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=k>void</span> <span class=n>OnGet</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=n>DoSomething</span><span class=p>(</span><span class=n>SomeProperty</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span></span></span></code></pre></div><p><em>or</em> you might use parameter binding:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-csharp data-lang=csharp><span class=line><span class=cl><span class=kd>public</span> <span class=k>class</span> <span class=nc>SomePageModel</span> <span class=p>:</span> <span class=n>PageModel</span>
</span></span><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=k>void</span> <span class=n>OnGet</span><span class=p>(</span><span class=kt>float</span> <span class=n>SomeProperty</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=n>DoSomething</span><span class=p>(</span><span class=n>SomeProperty</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span></span></span></code></pre></div><p><em>or</em> you can parse it from the request:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-csharp data-lang=csharp><span class=line><span class=cl><span class=kd>public</span> <span class=k>class</span> <span class=nc>SomePageModel</span> <span class=p>:</span> <span class=n>PageModel</span>
</span></span><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=k>void</span> <span class=n>OnGet</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=kt>var</span> <span class=n>someProperty</span> <span class=p>=</span> <span class=kt>float</span><span class=p>.</span><span class=n>Parse</span><span class=p>(</span><span class=n>Request</span><span class=p>.</span><span class=n>Query</span><span class=p>[</span><span class=s>&#34;SomeProperty&#34;</span><span class=p>]);</span>
</span></span><span class=line><span class=cl>        <span class=n>DoSomething</span><span class=p>(</span><span class=n>someProperty</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span></span></span></code></pre></div><p>These are all <em>different means</em> of accessing the <em>same data</em> from the incoming request.</p></div></div><p>Now all we need to do is implement the actual filter.</p><h3 id=implementing-the-imdb-rating-filter>Implementing the IMDB Rating Filter</h3><p>We&rsquo;ll define the new filter in our <code>MovieDatabase</code> class as another static method:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-csharp data-lang=csharp><span class=line><span class=cl>    <span class=cs>/// &lt;summary&gt;</span>
</span></span><span class=line><span class=cl>    <span class=cs>/// Filters the provided collection of movies</span>
</span></span><span class=line><span class=cl>    <span class=cs>/// to those with IMDB ratings falling within</span>
</span></span><span class=line><span class=cl>    <span class=cs>/// the specified range</span>
</span></span><span class=line><span class=cl>    <span class=cs>/// &lt;/summary&gt;</span>
</span></span><span class=line><span class=cl>    <span class=cs>/// &lt;param name=&#34;movies&#34;&gt;The collection of movies to filter&lt;/param&gt;</span>
</span></span><span class=line><span class=cl>    <span class=cs>/// &lt;param name=&#34;min&#34;&gt;The minimum range value&lt;/param&gt;</span>
</span></span><span class=line><span class=cl>    <span class=cs>/// &lt;param name=&#34;max&#34;&gt;The maximum range value&lt;/param&gt;</span>
</span></span><span class=line><span class=cl>    <span class=cs>/// &lt;returns&gt;The filtered movie collection&lt;/returns&gt;</span>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=kd>static</span> <span class=n>IEnumerable</span><span class=p>&lt;</span><span class=n>Movie</span><span class=p>&gt;</span> <span class=n>FilterByIMDBRating</span><span class=p>(</span><span class=n>IEnumerable</span><span class=p>&lt;</span><span class=n>Movie</span><span class=p>&gt;</span> <span class=n>movies</span><span class=p>,</span> <span class=kt>double?</span> <span class=n>min</span><span class=p>,</span> <span class=kt>double?</span> <span class=n>max</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=c1>// TODO: Filter movies</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span></span></span></code></pre></div><p>Notice that here too we use the nullable double value. So our first step is probably to do a <code>null</code> check:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-csharp data-lang=csharp><span class=line><span class=cl>    <span class=k>if</span> <span class=p>(</span><span class=n>min</span> <span class=p>==</span> <span class=kc>null</span> <span class=p>&amp;&amp;</span> <span class=n>max</span> <span class=p>==</span> <span class=kc>null</span><span class=p>)</span> <span class=k>return</span> <span class=n>movies</span><span class=p>;</span></span></span></code></pre></div><p>But what if only one is null? Should we filter for that part of the range? It wouldn&rsquo;t be hard to do:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-csharp data-lang=csharp><span class=line><span class=cl>    <span class=kt>var</span> <span class=n>results</span> <span class=p>=</span> <span class=k>new</span> <span class=n>List</span><span class=p>&lt;</span><span class=n>Movie</span><span class=p>&gt;();</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c1>// only a maximum specified</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span><span class=p>(</span><span class=n>min</span> <span class=p>==</span> <span class=kc>null</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=k>foreach</span><span class=p>(</span><span class=n>Movie</span> <span class=n>movie</span> <span class=k>in</span> <span class=n>movies</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=k>if</span> <span class=p>(</span><span class=n>movie</span><span class=p>.</span><span class=n>IMDBRating</span> <span class=p>&lt;=</span> <span class=n>max</span><span class=p>)</span> <span class=n>results</span><span class=p>.</span><span class=n>Add</span><span class=p>(</span><span class=n>movie</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=n>results</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span></span></span></code></pre></div><p>And the minimum would mirror that:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-csharp data-lang=csharp><span class=line><span class=cl>    <span class=c1>// only a minimum specified</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span><span class=p>(</span><span class=n>max</span> <span class=p>==</span> <span class=kc>null</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=k>foreach</span><span class=p>(</span><span class=n>Movie</span> <span class=n>movie</span> <span class=k>in</span> <span class=n>movies</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=k>if</span> <span class=p>(</span><span class=n>movie</span><span class=p>.</span><span class=n>IMDBRating</span> <span class=p>&gt;=</span> <span class=n>min</span><span class=p>)</span> <span class=n>results</span><span class=p>.</span><span class=n>Add</span><span class=p>(</span><span class=n>movie</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=n>results</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span></span></span></code></pre></div><p>Finally, we could handle the case where we have both a min and max value to our range:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-csharp data-lang=csharp><span class=line><span class=cl>    <span class=c1>// Both minimum and maximum specified</span>
</span></span><span class=line><span class=cl>    <span class=k>foreach</span><span class=p>(</span><span class=n>Movie</span> <span class=n>movie</span> <span class=k>in</span> <span class=n>movies</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span><span class=p>(</span><span class=n>movie</span><span class=p>.</span><span class=n>IMDBRating</span> <span class=p>&gt;=</span> <span class=n>min</span> <span class=p>&amp;&amp;</span> <span class=n>movie</span><span class=p>.</span><span class=n>IMDBRating</span> <span class=p>&lt;=</span> <span class=n>max</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=n>results</span><span class=p>.</span><span class=n>Add</span><span class=p>(</span><span class=n>movie</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=n>results</span><span class=p>;</span></span></span></code></pre></div><p>Notice too, that in each of these cases we&rsquo;re treating the range as <em>inclusive</em> (including the specified minimum and maximum). This is the behavior most casual internet users will expect. If the database and user expectations are different for your audience, you&rsquo;d want your code to match that expectation.</p><p>Now we can filter by IMDB rating:</p><p><a href=#R-image-ef638bfb15541ab300340ad098ab7386 class=lightbox-link><img alt="Filtering By IMDB" class="border lazy lightbox noshadow figure-image" loading=lazy src=/cis400/images/6.8.6.png style=height:auto;width:auto></a>
<a href=javascript:history.back(); class=lightbox-back id=R-image-ef638bfb15541ab300340ad098ab7386><img alt="Filtering By IMDB" class="border lazy lightbox noshadow lightbox-image" loading=lazy src=/cis400/images/6.8.6.png></a></p><h2 id=finishing-up>Finishing Up</h2><p>Since we&rsquo;re displaying the Rotten Tomatoes rating, we should probably also have a filter for it. This will work almost exactly like the IMDB rating - but with the range from 0 to 100. I&rsquo;ll leave this as an exercise for the reader.</p><footer class=footline></footer></article><article class=default><header class=headline></header><h1 id=using-linq>Using LINQ</h1><p>In our movie website, we&rsquo;ve been using a custom &ldquo;database&rdquo; object, <code>MovieDatabase</code> to provide the movie data and search and filter functionality. In professional practice, we would probably replace this with an external database program. These programs have been developed specifically for persisting and accessing data, and leverage specialized data structures like B+ trees that allow them to do searches and filters much more efficiently.</p><p>Some of the most widely adopted database programs are <em>relational databases</em> like MySQL, MsSQL, Postgres, and SQLLite. These predate object-orientation, and accept requests for data in the form of SQL (Structured Query Language). You will learn more about these databases and how to use them in CIS560.</p><h2 id=linq>LINQ</h2><p>Microsoft, inspired by SQL, introduced Language Integrated Query (LINQ) in 2007 to bring the concept of a query language into .NET. LINQ allows you to construct queries in either chained method calls or in a syntax similar to SQL that can operate on collections or relational databases.</p><p>For relational databases, LINQ queries are converted internally to SQL queries, and dispatched to the database. But their real power is that they can also be used with any collection that supports either the <code>IEnumerable</code> or <code>IEnumerable&lt;T></code> interfaces. LINQ can be used to replace the kinds of filter and search functions we wrote for our <code>MovieDatabase</code>. Let&rsquo;s try it out with our movie website.</p><p>LINQ operates through extension methods, so we need to be sure to add the LINQ namespace to our CS files where we are going to employ them. We&rsquo;ll be adding our LINQ commands to our page model, so sure that is the case with your <em>Pages/Index.cshtml.cs</em>:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-csharp data-lang=csharp><span class=line><span class=cl><span class=k>using</span> <span class=nn>System.Linq</span><span class=p>;</span></span></span></code></pre></div><p>Adding this using statement will bring in all the extension methods for LINQ, and will also prompt Visual Studio to recognize the query-style syntax.</p><h2 id=searching-with-linq>Searching with LINQ</h2><p>One of the most useful extension methods in LINQ is <a href="https://docs.microsoft.com/en-us/dotnet/api/system.linq.enumerable.where?view=netcore-3.1" rel=external target=_blank>Where()</a>. It can be invoked on any <code>IEnumerable</code> and accepts a <code>Func</code> (a delegate type). This delegate takes a single argument - the current item being enumerated over, and its body should return a boolean value - <code>true</code> if the item should be included in the results, and <code>false</code> if it should not.</p><p>We can thus use our existing <code>SearchTerms</code> property as the basis for our test: <code>movie => movie.Title != null && movie.Title.Contains(SearchTerms)</code> (note that with lambda expressions, if the result is single expression we can omit the <code>{}</code> and the <code>return</code> is implied). Also note that we incorporate the null check directly into the expression using the boolean and <code>&&</code> operator.</p><p>We can replace our current search with a <code>Where()</code> call invoking this method:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-csharp data-lang=csharp><span class=line><span class=cl><span class=n>Movies</span> <span class=p>=</span> <span class=n>MovieDatabase</span><span class=p>.</span><span class=n>All</span><span class=p>.</span><span class=n>Where</span><span class=p>(</span><span class=n>movie</span> <span class=p>=&gt;</span> <span class=n>movie</span><span class=p>.</span><span class=n>Title</span> <span class=p>!=</span> <span class=kc>null</span> <span class=p>&amp;&amp;</span> <span class=n>movie</span><span class=p>.</span><span class=n>Title</span><span class=p>.</span><span class=n>Contains</span><span class=p>(</span><span class=n>SearchTerms</span><span class=p>,</span> <span class=n>String</span><span class=p>));</span></span></span></code></pre></div><p>However if we run the program we will encounter a null exception. On our first GET request, the value of <code>SearchTerms</code> is null, which is <em>not</em> a legal argument for <code>String.Contains()</code>.</p><h2 id=making-search-conditional>Making Search Conditional</h2><p>If the <code>SearchTerms</code> is null, that indicates that the user did not enter a search term - accordingly, we probably don&rsquo;t want to search. We can wrap our filter in an <code>if</code> test to prevent applying the filter when there is no search term. Thus, we would refactor our filtering expression to:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-csharp data-lang=csharp><span class=line><span class=cl><span class=n>Movies</span> <span class=p>=</span> <span class=n>MovieDatabase</span><span class=p>.</span><span class=n>All</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=c1>// Search movie titles for the SearchTerms</span>
</span></span><span class=line><span class=cl><span class=k>if</span><span class=p>(</span><span class=n>SearchTerms</span> <span class=p>!=</span> <span class=kc>null</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=n>Movies</span> <span class=p>=</span> <span class=n>Movies</span><span class=p>.</span><span class=n>Where</span><span class=p>(</span><span class=n>movie</span> <span class=p>=&gt;</span> <span class=n>movie</span><span class=p>.</span><span class=n>Title</span> <span class=p>!=</span> <span class=kc>null</span> <span class=p>&amp;&amp;</span> <span class=n>movie</span><span class=p>.</span><span class=n>Title</span><span class=p>.</span><span class=n>Contains</span><span class=p>(</span><span class=n>SearchTerms</span><span class=p>,</span> <span class=n>StringComparison</span><span class=p>.</span><span class=n>InvariantCultureIgnoreCase</span><span class=p>));</span>
</span></span><span class=line><span class=cl><span class=p>}</span></span></span></code></pre></div><p>Now if we run the program, and search for a specific term, we&rsquo;ll see our results is modified to contain <em>only</em> those movies with the terms in their title!</p><p>We can also use the query syntax instead of the extension method syntax, which is similar to SQL:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-csharp data-lang=csharp><span class=line><span class=cl><span class=n>Movies</span> <span class=p>=</span> <span class=n>MovieDatabase</span><span class=p>.</span><span class=n>All</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=c1>// Search movie titles for the SearchTerms</span>
</span></span><span class=line><span class=cl><span class=k>if</span><span class=p>(</span><span class=n>SerchTerms</span> <span class=p>!=</span> <span class=kc>null</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=n>Movies</span> <span class=p>=</span> <span class=k>from</span> <span class=n>movie</span> <span class=k>in</span> <span class=n>Movies</span>
</span></span><span class=line><span class=cl>        <span class=k>where</span> <span class=n>movie</span><span class=p>.</span><span class=n>Title</span> <span class=p>!=</span> <span class=kc>null</span> <span class=p>&amp;&amp;</span> <span class=n>movie</span><span class=p>.</span><span class=n>Title</span><span class=p>.</span><span class=n>Contains</span><span class=p>(</span><span class=n>SearchTerms</span><span class=p>,</span> <span class=n>StringComparison</span><span class=p>.</span><span class=n>InvariantCultureIgnoreCase</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=k>select</span> <span class=n>movie</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span></span></span></code></pre></div><p>This syntax is converted by the C# compiler to use the extension methods as part of the compilation process.</p><div class="box notices cstyle info"><div class=box-label><i class="fa-fw fas fa-info-circle"></i> Info</div><div class=box-content><p>The search approach listed above will only find the <em>exact</em> search terms, i.e. searching for &ldquo;Clear Present Danger&rdquo; will <em>not</em> match the film &ldquo;Clear and Present Danger&rdquo;. How might you tweak the search approach so that terms would be found individually?</p></div></div><p>You can use either form for writing your queries, though it is best to stay consistent within a single program.</p><h2 id=filtering-with-linq>Filtering with LINQ</h2><p>Filtering is also accomplished through the <a href="https://docs.microsoft.com/en-us/dotnet/api/system.linq.enumerable.where?view=netcore-3.1" rel=external target=_blank>Where()</a>. We can add additional tests within our search <code>Where()</code>, but it is more legible to add <em>additional</em> <code>Where</code> calls:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-csharp data-lang=csharp><span class=line><span class=cl><span class=n>Movies</span> <span class=p>=</span> <span class=n>MovieDatabase</span><span class=p>.</span><span class=n>All</span>
</span></span><span class=line><span class=cl>    <span class=c1>// Search movie titles for the SearchTerms</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span><span class=p>(</span><span class=n>SearchTerms</span> <span class=p>!=</span> <span class=kc>null</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=n>Movies</span> <span class=p>=</span> <span class=n>Movies</span><span class=p>.</span><span class=n>Where</span><span class=p>(</span><span class=n>movie</span> <span class=p>=&gt;</span> <span class=n>movie</span><span class=p>.</span><span class=n>Title</span> <span class=p>!=</span> <span class=kc>null</span> <span class=p>&amp;&amp;</span> <span class=n>movie</span><span class=p>.</span><span class=n>Title</span><span class=p>.</span><span class=n>Contains</span><span class=p>(</span><span class=n>SearchTerms</span><span class=p>,</span> <span class=n>StringComparison</span><span class=p>.</span><span class=n>InvariantCultureIgnoreCase</span><span class=p>));</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=c1>// Filter by MPAA Rating</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span><span class=p>(</span><span class=n>MPAARatings</span> <span class=p>!=</span> <span class=kc>null</span> <span class=p>&amp;&amp;</span> <span class=n>MPAARatings</span><span class=p>.</span><span class=n>Length</span> <span class=p>!=</span> <span class=m>0</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=n>Movies</span> <span class=p>=</span> <span class=n>Movies</span><span class=p>.</span><span class=n>Where</span><span class=p>(</span><span class=n>movie</span> <span class=p>=&gt;</span>
</span></span><span class=line><span class=cl>            <span class=n>movie</span><span class=p>.</span><span class=n>MPAARating</span> <span class=p>!=</span> <span class=kc>null</span> <span class=p>&amp;&amp;</span>
</span></span><span class=line><span class=cl>            <span class=n>MPAARatings</span><span class=p>.</span><span class=n>Contains</span><span class=p>(</span><span class=n>movie</span><span class=p>.</span><span class=n>MPAARating</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            <span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span></span></span></code></pre></div><div class="box notices cstyle todo"><div class=box-label></div><div class=box-content><p>The numerical filters are handled the same way - with additional <code>Where</code> clauses. I leave this as an exercise for the reader to complete.</p></div></div><h2 id=benefits-of-linq>Benefits of LINQ</h2><p>While LINQ is a bit less code for us to write, there is another big benefit - the actual filtering is only applied <em>when we start iterating through the results</em>. This means that LINQ queries with multiple <code>Where()</code> invocations can combine them into a single iteration.</p><p>Consider our movie website example. We have four filters - the search, the MPAA Ratings, the IMDB Ratings, and the Rotten Tomato Rating. In the worst case, each movie in the database would pass each filter, so that our list never got smaller. With the filter functions we wrote in <code>MovieDatabase</code>, we would have to iterate over that full list <em>four times</em>. In terms of complexity, that&rsquo;s $O(4n)$.</p><p>In contrast, because LINQ doesn&rsquo;t actually run the filters until we start iterating, it can combine all the <code>While</code> tests into a single boolean expression. The result is it only has to iterate through the list <em>once</em>. Hence, its complexity becomes $O(n)$. There is a little additional overhead for holding onto the query information that way, but it&rsquo;s small compared to the benefit.</p><p>Also, we could have done the same kind of optimization ourselves, but it takes a lot of work to set up, and may not be worth it for a single web app. But LINQ provides us that benefit for free.</p><footer class=footline></footer></article></section><article class=default><header class=headline></header><h1 id=deployment>Deployment</h1><p>Now that we have a well-functioning web application, we are ready to publish it to a production environment, where eveyrone on the web will have access to it! This exercise walks you through deploying your new application using Microsoft&rsquo;s Azure Web Services, utilizing the built-in support for this deployment process in Visual Studio.</p><footer class=footline></footer></article><section><h1 class=a11y-only>Subsections of Deployment</h1><article class=default><header class=headline></header><h1 id=creating-an-azure-account>Creating an Azure Account</h1><iframe width=560 height=315 src=https://www.youtube.com/embed/8XikqJSXHDI frameborder=0 allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" allowfullscreen></iframe><footer class=footline></footer></article><article class=default><header class=headline></header><h1 id=deploying-our-movie-site-to-azure>Deploying our Movie Site to Azure</h1><p>Before you start this exercise, you should:</p><ol><li>Set up your Azure account (see the <a href=https://textbooks.cs.ksu.edu/cis400/c-exercises-s23/13-deployment/01-azure/ rel=external target=_blank>previous section</a>).</li><li><a href="https://docs.microsoft.com/en-us/visualstudio/ide/signing-in-to-visual-studio?view=vs-2019" rel=external target=_blank>Sign into Visual Studio</a> using the same account as you used for Azure</li></ol><iframe width=560 height=315 src=https://www.youtube.com/embed/rFgET9SLZTk frameborder=0 allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" allowfullscreen></iframe><p>Open your Movie Site project from your previous web data exercises. If you right-click on the project name in the Solution Explorer, you can choose <code>publish</code> from the context menu:</p><p><a href=#R-image-bbe70f7f10bedc49e391524bb898f60b class=lightbox-link><img alt="The Publish option in the Solution Explorer" class="border lazy lightbox noshadow figure-image" loading=lazy src=/cis400/images/c.13.2.1.png style=height:auto;width:auto></a>
<a href=javascript:history.back(); class=lightbox-back id=R-image-bbe70f7f10bedc49e391524bb898f60b><img alt="The Publish option in the Solution Explorer" class="border lazy lightbox noshadow lightbox-image" loading=lazy src=/cis400/images/c.13.2.1.png></a></p><p>The first time you choose this option in a project, it will launch a publish wizard. The first step is to choose your deployment target:</p><p><a href=#R-image-7373e7d37dfb5e01194fedd31dc168df class=lightbox-link><img alt="Deployment Targets in the Publish Wizard" class="border lazy lightbox noshadow figure-image" loading=lazy src=/cis400/images/c.13.2.2.png style=height:auto;width:auto></a>
<a href=javascript:history.back(); class=lightbox-back id=R-image-7373e7d37dfb5e01194fedd31dc168df><img alt="Deployment Targets in the Publish Wizard" class="border lazy lightbox noshadow lightbox-image" loading=lazy src=/cis400/images/c.13.2.2.png></a></p><p>For this exercise, we&rsquo;ll choose &ldquo;Azure&rdquo;, but feel free to explore the other options. Once you&rsquo;ve chosen Azure and clicked the <code>Next</code> button, you&rsquo;ll see the second step of the wizard, which seeks more detail on your deployment target:</p><p><a href=#R-image-d1a22a6b4c32bc736b4249e76515e49a class=lightbox-link><img alt="Azure Deployment Targets in the Publish Wizard" class="border lazy lightbox noshadow figure-image" loading=lazy src=/cis400/images/c.13.2.3.png style=height:auto;width:auto></a>
<a href=javascript:history.back(); class=lightbox-back id=R-image-d1a22a6b4c32bc736b4249e76515e49a><img alt="Azure Deployment Targets in the Publish Wizard" class="border lazy lightbox noshadow lightbox-image" loading=lazy src=/cis400/images/c.13.2.3.png></a></p><p>The options here include deploying to a Windows or Linux infrastructure, or as a Docker image, or as an Azure VM (in which case you would need to set up the OS and environment). Let&rsquo;s choose the &ldquo;Linux&rdquo; option and click <code>Next</code> to reach the next step in the wizard.</p><p><a href=#R-image-781ffad066dfd910a1b1310158b01b72 class=lightbox-link><img alt="Azure App Service in the Publish Wizard" class="border lazy lightbox noshadow figure-image" loading=lazy src=/cis400/images/c.13.2.4.png style=height:auto;width:auto></a>
<a href=javascript:history.back(); class=lightbox-back id=R-image-781ffad066dfd910a1b1310158b01b72><img alt="Azure App Service in the Publish Wizard" class="border lazy lightbox noshadow lightbox-image" loading=lazy src=/cis400/images/c.13.2.4.png></a></p><p>This step lists the subscription(s) available to your account, as well as any Resource Groups and App Services you have created. Most likely the latter two are empty, and your Subscription will be &ldquo;Azure for Students&rdquo; (this is the $100 of credit you receive as a K-State student). If you have used Azure previously, you may have additional options. For this project, choose the &ldquo;Create a new Azure App Service&mldr;&rdquo;</p><p>This launches another dialog, for creating a new App Service:</p><p><a href=#R-image-2e64e71a99382bba7b64a7b4a5f25a98 class=lightbox-link><img alt="App Service creation dialog" class="border lazy lightbox noshadow figure-image" loading=lazy src=/cis400/images/c.13.2.5.png style=height:auto;width:auto></a>
<a href=javascript:history.back(); class=lightbox-back id=R-image-2e64e71a99382bba7b64a7b4a5f25a98><img alt="App Service creation dialog" class="border lazy lightbox noshadow lightbox-image" loading=lazy src=/cis400/images/c.13.2.5.png></a></p><p>You may change the name to any available name (by default it will be your project name followed by a timestamp). When you&rsquo;re happy with your name, click the <code>Create</code> button. It will take a few minutes to create your App Service, so please be patient. Once it finishes, you&rsquo;ll be back in the Wizard with your new app service selected:</p><p><a href=#R-image-d1cb3d7b4cec1f4dce4ad6716f2b67c2 class=lightbox-link><img alt="Finishing the Publish Wizard" class="border lazy lightbox noshadow figure-image" loading=lazy src=/cis400/images/c.13.2.6.png style=height:auto;width:auto></a>
<a href=javascript:history.back(); class=lightbox-back id=R-image-d1cb3d7b4cec1f4dce4ad6716f2b67c2><img alt="Finishing the Publish Wizard" class="border lazy lightbox noshadow lightbox-image" loading=lazy src=/cis400/images/c.13.2.6.png></a></p><p>Go ahead and click the <code>Finish</code> button. This will close the wizard and return you to Visual Studio, where the Publish configuration screen is now visible:</p><p><a href=#R-image-10a02dc39fe5a283cf58107d8176d342 class=lightbox-link><img alt="The Publish Configuration" class="border lazy lightbox noshadow figure-image" loading=lazy src=/cis400/images/c.13.2.7.png style=height:auto;width:auto></a>
<a href=javascript:history.back(); class=lightbox-back id=R-image-10a02dc39fe5a283cf58107d8176d342><img alt="The Publish Configuration" class="border lazy lightbox noshadow lightbox-image" loading=lazy src=/cis400/images/c.13.2.7.png></a></p><p>Two elements are important here - the <em>Site URL</em> is the URL where you will be able to visit your published web application (after you publish it), and the <code>Publish</code> button launches the publishing process. Go ahead and click the <code>Publish</code> button. It will take a few minutes, but you&rsquo;ll see the project is built and deployed to the Azure service. When the process completes, it will open your site in the default web browser (or you can navigate there using the supplied URL).</p><p>Your published website will now look something like this:</p><p><a href=#R-image-2e79c8cdab17cc66027ea2dd76b4c99e class=lightbox-link><img alt="The published website" class="border lazy lightbox noshadow figure-image" loading=lazy src=/cis400/images/c.13.2.8.png style=height:auto;width:auto></a>
<a href=javascript:history.back(); class=lightbox-back id=R-image-2e79c8cdab17cc66027ea2dd76b4c99e><img alt="The published website" class="border lazy lightbox noshadow lightbox-image" loading=lazy src=/cis400/images/c.13.2.8.png></a></p><p>While the website is now loaded and functional, it does not look like our debug build - it seems to be missing all of our styles! If we inspect the CSS in the browser development tools, we&rsquo;ll see that it is loading <em>site.min.css</em>, and this file contains the minified boilerplate CSS from the original site template, but none of the changes we made! If we examine our <em>Layout.csthml</em> template file, we can find the lines where the <code>&lt;link></code> element for the CSS is defined:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-html data-lang=html><span class=line><span class=cl><span class=p>&lt;</span><span class=nt>environment</span> <span class=na>include</span><span class=o>=</span><span class=s>&#34;Development&#34;</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>    <span class=p>&lt;</span><span class=nt>link</span> <span class=na>rel</span><span class=o>=</span><span class=s>&#34;stylesheet&#34;</span> <span class=na>href</span><span class=o>=</span><span class=s>&#34;~/css/site.css&#34;</span> <span class=na>asp-append-version</span><span class=o>=</span><span class=s>&#34;true&#34;</span> <span class=p>/&gt;</span>
</span></span><span class=line><span class=cl><span class=p>&lt;/</span><span class=nt>environment</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl><span class=p>&lt;</span><span class=nt>environment</span> <span class=na>exclude</span><span class=o>=</span><span class=s>&#34;Development&#34;</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>    <span class=p>&lt;</span><span class=nt>link</span> <span class=na>rel</span><span class=o>=</span><span class=s>&#34;stylesheet&#34;</span> <span class=na>href</span><span class=o>=</span><span class=s>&#34;~/css/site.min.css&#34;</span> <span class=na>asp-append-version</span><span class=o>=</span><span class=s>&#34;true&#34;</span> <span class=p>/&gt;</span>
</span></span><span class=line><span class=cl><span class=p>&lt;/</span><span class=nt>environment</span><span class=p>&gt;</span></span></span></code></pre></div><p>Notice the use of the ASP.NET-specific <code>&lt;environment></code> element? This conditionally includes its children based on the environment the web server is running in. Debug mode corresponds to our &ldquo;Development&rdquo; environment, so in debug we are including <em>site.css</em>. However, when we run it in &ldquo;Production&rdquo; mode, i.e. in our Azure service, we&rsquo;re instead using <em>site.min.css</em>. This is intended to be a minified and bundled version of <em>site.css</em>. Minification is a transpiling process where we strip out unnecessary content, i.e. whitespace and comments. Bundling refers to gathering multiple files - i.e. multiple CSS files, and combining them into a single file (this is helpful if we like to keep our CSS rules separated according to what pages they correspond to).</p><p>The issue is that the <em>site.min.css</em> file is not currently being updated when we build our project - instead we&rsquo;re still using the example file that came with the project template. We&rsquo;ll need to install and configure a NuGet package within the Movie project to enable this extra building step. You can read more about bundling and minification within ASP.NET Core <a href=https://docs.microsoft.com/aspnet/core/client-side/bundling-and-minification rel=external target=_blank>here</a>.</p><p>Start by selecting <code>Tools > NuGet Package Manager > Manage Nuget Packages for Solution...</code> from the <code>Tools</code> menu:</p><p><a href=#R-image-ecc625f9edb54b98a94fff45a1b6a96f class=lightbox-link><img alt="Launching the NuGet Package Manager" class="border lazy lightbox noshadow figure-image" loading=lazy src=/cis400/images/c.13.2.9.png style=height:auto;width:auto></a>
<a href=javascript:history.back(); class=lightbox-back id=R-image-ecc625f9edb54b98a94fff45a1b6a96f><img alt="Launching the NuGet Package Manager" class="border lazy lightbox noshadow lightbox-image" loading=lazy src=/cis400/images/c.13.2.9.png></a></p><p>This loads the NuGet Package Manager, which allows us to install additional components into our project. By default it starts with the &ldquo;Installed&rdquo; tab, which shows which packages are currently installed. Not surprisingly, we have several Microsoft.NETCore packages - these contain the library code for .NETCore and for procesing Razor pages. We also have a third-party library, Newtonsoft.Json, which is used to parse the JSON database file. We&rsquo;ll want to install a new package, so select the &ldquo;Browse&rdquo; tab:</p><p><a href=#R-image-bada9a6d1bf7b2ac50cf5d9f12d41b6f class=lightbox-link><img alt="The NuGet Package Manager" class="border lazy lightbox noshadow figure-image" loading=lazy src=/cis400/images/c.13.2.10.png style=height:auto;width:auto></a>
<a href=javascript:history.back(); class=lightbox-back id=R-image-bada9a6d1bf7b2ac50cf5d9f12d41b6f><img alt="The NuGet Package Manager" class="border lazy lightbox noshadow lightbox-image" loading=lazy src=/cis400/images/c.13.2.10.png></a></p><p>Then type into the search box &ldquo;BuildBundlerMinifier&rdquo;. The corresponding package should show up in the results below. This tool will add the bundling and minification step to the build process of Visual Studio. Clicking on the project will open a checklist allowing you to choose which projects you want to install the package into. Check the box next to the <em>Movies</em> project, and then click the <code>Install</code> button.</p><p><a href=#R-image-80b55e9cc8f0b8a66f1fa3e2a8f9b408 class=lightbox-link><img alt="Installing the BuildBundlerMinifier Package" class="border lazy lightbox noshadow figure-image" loading=lazy src=/images/c.13.2.11.png style=height:auto;width:auto></a>
<a href=javascript:history.back(); class=lightbox-back id=R-image-80b55e9cc8f0b8a66f1fa3e2a8f9b408><img alt="Installing the BuildBundlerMinifier Package" class="border lazy lightbox noshadow lightbox-image" loading=lazy src=/images/c.13.2.11.png></a></p><p>YOu will need to click <code>Ok</code> in the confirmation dialog, and then the package will be installed. Visual Studio will report that the <em>bundleconfig.json</em> files does not exist. This file configures the new package to create the minified bundle file - we&rsquo;ll need to add it. It should be created at the root of the Move project, and it consists of a simple JSON structure:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-json data-lang=json><span class=line><span class=cl><span class=p>[</span>
</span></span><span class=line><span class=cl>  <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;outputFileName&#34;</span><span class=p>:</span> <span class=s2>&#34;wwwroot/css/site.min.css&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;inputFiles&#34;</span><span class=p>:</span> <span class=p>[</span>
</span></span><span class=line><span class=cl>      <span class=s2>&#34;wwwroot/css/site.css&#34;</span>
</span></span><span class=line><span class=cl>    <span class=p>]</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>]</span></span></span></code></pre></div><p>The <code>"outputFileName"</code> is the name of the file we want to write to (in this case, _site.min.css), and the <code>"inputFiles"</code> is an array containing file names of all the files we want to bundle (in this case, <em>site.css</em>). If we had additional CSS files in our project, we could also list those here as well, and all of the listed files would be combined into the single output file.</p><p>We can bundle and minify Javascript files the same way, by adding a second JSON object defining the <code>"outputFileName"</code> for the minified and bundled Javascript file (which we conventionally give the extension <em>.min.js</em>), and an <code>"inputFiles"</code> array consisting of all the JavaScript files we want to bundle.</p><p>With this change, now whenever we build our project, we will also rebuild the minified <em>site.min.css</em> file. Click the <code>Publish</code> button in the Publish screen again, and when the project finishes loading, you&rsquo;ll now see the CSS rules being applied to your site:</p><p><a href=#R-image-b5f3e32eea1f1f6f6f77a3ade90daecd class=lightbox-link><img alt="Final Deployed Site" class="border lazy lightbox noshadow figure-image" loading=lazy src=/cis400/images/c.13.2.12.png style=height:auto;width:auto></a>
<a href=javascript:history.back(); class=lightbox-back id=R-image-b5f3e32eea1f1f6f6f77a3ade90daecd><img alt="Final Deployed Site" class="border lazy lightbox noshadow lightbox-image" loading=lazy src=/cis400/images/c.13.2.12.png></a></p><p>That&rsquo;s all there is to it! You now have a published ASP.NET Core Web Application that can be accessed from any internet-connected browser!</p><p>Turn in the URL to your published site. After it is graded, feel free to take down your Azure service.</p><footer class=footline></footer></article></section></section></div></main><div class=git-footer><p class=theme-version-footer>6.0.0</p><p>Last modified by:
<i class='fas fa-user'></i> Julie Thornton
<i class='fas fa-calendar'></i> <a href=https://github.com/ksu-cs-textbooks/cis400/commit/1918e4b3753773e28f9dbf232246ba26fe9d64c7>Nov 6, 2023</a></p></div></div><script src=/cis400/js/clipboard.min.js?1719517098 defer></script><script src=/cis400/js/perfect-scrollbar.min.js?1719517098 defer></script><script>function useMathJax(e){window.MathJax=Object.assign(window.MathJax||{},{tex:{inlineMath:[["\\(","\\)"],["$","$"]],displayMath:[["\\[","\\]"],["$$","$$"]]},options:{enableMenu:!1}},e)}useMathJax(JSON.parse("{}"))</script><script id=MathJax-script async src=/cis400/js/mathjax/tex-mml-chtml.js?1719517098></script><script src=/cis400/js/theme.js?1719517098 defer></script></body></html>