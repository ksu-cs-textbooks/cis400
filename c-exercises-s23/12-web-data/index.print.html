<!doctype html><html lang=en-us dir=ltr itemscope itemtype=http://schema.org/Article><head><meta charset=utf-8><meta name=viewport content="height=device-height,width=device-width,initial-scale=1,minimum-scale=1"><meta name=generator content="Hugo 0.128.0"><meta name=generator content="Relearn 6.0.0"><meta name=description content="Now that we’ve seen how to dynamically create the content of a Razor Page on the server, we should turn our attention to how we can do so based on our user’s needs. Consider the example application we have been developing - it exposes a database of movie information to the user. How might a user want to use this database? They might want to find the details for a specific movie - who directed it, when was it released, etc."><meta name=author content="Nathan Bean"><meta name=twitter:card content="summary"><meta name=twitter:title content="Web Data :: K-State CIS 400 Textbook"><meta name=twitter:description content="Now that we’ve seen how to dynamically create the content of a Razor Page on the server, we should turn our attention to how we can do so based on our user’s needs. Consider the example application we have been developing - it exposes a database of movie information to the user. How might a user want to use this database? They might want to find the details for a specific movie - who directed it, when was it released, etc."><meta property="og:url" content="https://textbooks.cs.ksu.edu/cis400/c-exercises-s23/12-web-data/"><meta property="og:site_name" content="K-State CIS 400 Textbook"><meta property="og:title" content="Web Data :: K-State CIS 400 Textbook"><meta property="og:description" content="Now that we’ve seen how to dynamically create the content of a Razor Page on the server, we should turn our attention to how we can do so based on our user’s needs. Consider the example application we have been developing - it exposes a database of movie information to the user. How might a user want to use this database? They might want to find the details for a specific movie - who directed it, when was it released, etc."><meta property="og:locale" content="en-us"><meta property="og:type" content="website"><meta itemprop=name content="Web Data :: K-State CIS 400 Textbook"><meta itemprop=description content="Now that we’ve seen how to dynamically create the content of a Razor Page on the server, we should turn our attention to how we can do so based on our user’s needs. Consider the example application we have been developing - it exposes a database of movie information to the user. How might a user want to use this database? They might want to find the details for a specific movie - who directed it, when was it released, etc."><meta itemprop=datePublished content="2018-08-24T10:53:05-05:00"><meta itemprop=dateModified content="2023-08-03T13:20:03-05:00"><meta itemprop=wordCount content="431"><title>Web Data :: K-State CIS 400 Textbook</title>
<link href=https://textbooks.cs.ksu.edu/cis400/c-exercises-s23/12-web-data/ rel=canonical type=text/html title="Web Data :: K-State CIS 400 Textbook"><link href=/cis400/c-exercises-s23/12-web-data/index.xml rel=alternate type=application/rss+xml title="Web Data :: K-State CIS 400 Textbook"><link href=/cis400/c-exercises-s23/12-web-data/tele.html rel=alternate type=text/html title="Web Data :: K-State CIS 400 Textbook"><link href=/cis400/c-exercises-s23/12-web-data/embed.html rel=alternate type=text/html title="Web Data :: K-State CIS 400 Textbook"><link href=/cis400/css/fontawesome-all.min.css?1731949282 rel=stylesheet media=print onload='this.media="all",this.onload=null'><noscript><link href=/cis400/css/fontawesome-all.min.css?1731949282 rel=stylesheet></noscript><link href=/cis400/css/nucleus.css?1731949282 rel=stylesheet><link href=/cis400/css/auto-complete.css?1731949282 rel=stylesheet media=print onload='this.media="all",this.onload=null'><noscript><link href=/cis400/css/auto-complete.css?1731949282 rel=stylesheet></noscript><link href=/cis400/css/perfect-scrollbar.min.css?1731949282 rel=stylesheet><link href=/cis400/css/fonts.css?1731949282 rel=stylesheet media=print onload='this.media="all",this.onload=null'><noscript><link href=/cis400/css/fonts.css?1731949282 rel=stylesheet></noscript><link href=/cis400/css/theme.css?1731949282 rel=stylesheet><link href=/cis400/css/theme-auto.css?1731949282 rel=stylesheet id=R-variant-style><link href=/cis400/css/chroma-auto.css?1731949282 rel=stylesheet id=R-variant-chroma-style><link href=/cis400/css/variant.css?1731949282 rel=stylesheet><link href=/cis400/css/print.css?1731949282 rel=stylesheet media=print><link href=/cis400/css/format-print.css?1731949282 rel=stylesheet><script src=/cis400/js/variant.js?1731949282></script><script>window.relearn=window.relearn||{},window.relearn.relBasePath="../..",window.relearn.relBaseUri="../../..",window.relearn.absBaseUri="https://textbooks.cs.ksu.edu/cis400",window.index_js_url="/cis400/index.search.js",window.variants&&variants.init(["auto","light-theme","dark-theme"]),window.T_Copy_to_clipboard=`Copy to clipboard`,window.T_Copied_to_clipboard=`Copied to clipboard!`,window.T_Copy_link_to_clipboard=`Copy link to clipboard`,window.T_Link_copied_to_clipboard=`Copied link to clipboard!`,window.T_Reset_view=`Reset view`,window.T_View_reset=`View reset!`,window.T_No_results_found=`No results found for "{0}"`,window.T_N_results_found=`{1} results found for "{0}"`</script><link href=/cis400/css/custom.css?1731949282 rel=stylesheet></head><body class="mobile-support print disableInlineCopyToClipboard" data-url=/cis400/c-exercises-s23/12-web-data/><div id=R-body class=default-animation><div id=R-body-overlay></div><nav id=R-topbar><div class=topbar-wrapper><div class=topbar-sidebar-divider></div><div class="topbar-area topbar-area-start" data-area=start><div class="topbar-button topbar-button-sidebar" data-content-empty=disable data-width-s=show data-width-m=hide data-width-l=hide><button class=topbar-control onclick=toggleNav() type=button title="Menu (CTRL+ALT+n)"><i class="fa-fw fas fa-bars"></i></button></div></div><ol class="topbar-breadcrumbs breadcrumbs highlightable" itemscope itemtype=http://schema.org/BreadcrumbList><li itemscope itemtype=https://schema.org/ListItem itemprop=itemListElement><a itemprop=item href=/cis400/c-exercises-s23/><span itemprop=name>Exercises</span></a><meta itemprop=position content="1">&nbsp;>&nbsp;</li><li itemscope itemtype=https://schema.org/ListItem itemprop=itemListElement><span itemprop=name>Web Data</span><meta itemprop=position content="2"></li></ol><div class="topbar-area topbar-area-end" data-area=end><div class="topbar-button topbar-button-prev" data-content-empty=disable data-width-s=show data-width-m=show data-width-l=show><a class=topbar-control href=/cis400/c-exercises-s23/11-responsive-design/08-bootstrap/ title="Summary (🡐)"><i class="fa-fw fas fa-chevron-left"></i></a></div><div class="topbar-button topbar-button-next" data-content-empty=disable data-width-s=show data-width-m=show data-width-l=show><a class=topbar-control href=/cis400/c-exercises-s23/12-web-data/01-simple-search/ title="Adding Search to the Movie Site (🡒)"><i class="fa-fw fas fa-chevron-right"></i></a></div></div></div></nav><div id=R-main-overlay></div><main id=R-body-inner class="highlightable default" tabindex=-1><div class=flex-block-wrapper><article class=default><header class=headline></header><h1 id=web-data>Web Data</h1><p>Now that we&rsquo;ve seen how to dynamically create the content of a Razor Page on the server, we should turn our attention to how we can do so based on our user&rsquo;s needs. Consider the example application we have been developing - it exposes a database of movie information to the user. How might a user want to use this database? They might want to find the details for a specific movie - who directed it, when was it released, etc. They might be looking for a movie they want to watch in a favorite genre. They might be looking to find all the movies directed by a favorite director&mldr; there are a lot of possibilities.</p><p>As software developers, we need to anticipate how our users will likely want to use the software we are developing. And with that in mind, we need to develop user interfaces that allow the user to communicate those needs to the software we are writing as concisely as possible. Remember that in HTTP, all communication between the client (and its user) and the server (our web application), is mediated through the request-response mechanism:</p><p><a href=#R-image-56f057a52e2f463379ab2904b0fb7e39 class=lightbox-link><img alt="Request-Response Mechanism" class="border lazy lightbox noshadow figure-image" loading=lazy src=/cis400/images/request-response-pattern.png style=height:auto;width:auto></a>
<a href=javascript:history.back(); class=lightbox-back id=R-image-56f057a52e2f463379ab2904b0fb7e39><img alt="Request-Response Mechanism" class="border lazy lightbox noshadow lightbox-image" loading=lazy src=/cis400/images/request-response-pattern.png></a></p><p>Thus, any information the user wants to supply the server is typically communicated <em>through</em> a request. HTML provides a mechanism for enabling this communication in a structured way - forms. A <code>&lt;form></code> element, when submitted, serializes the values of all <code>&lt;input></code> elements contained within it and submits them to the server in the request.</p><p>The values in the form are serialized (converted into text) and submitted with the request. Exactly how this serialization happens depends on the kind of request. For GET requests the serialized data is added to the url as the query string. For POST requests, the serialized data is sent as the body of the request.</p><p>You can usually use either form (except when uploading files, which must be POSTed). However, you might think about the semantics of each action. A GET request is for retrieving something <em>from</em> the server, so any data your sending is about modifying that request. Thus, search and filter requests make sense as a GET request. A POST request is about sending something <em>to</em> the server, thus account creation, blog posts, and so on make sense as a POST request.</p><div class="box notices cstyle info"><div class=box-label><i class="fa-fw fas fa-info-circle"></i> Info</div><div class=box-content><p>When sent using secure HTTP (HTTPS), both the query string portion of the URL and the request body are encrypted, so there is no difference in the in-transit security. However, browsers typically store the full URL in the history, so if sensitive information is being sent, you might want to use POST requests.</p></div></div><footer class=footline></footer></article><section><h1 class=a11y-only>Subsections of Web Data</h1><article class=default><header class=headline></header><h1 id=adding-search-to-the-movie-site>Adding Search to the Movie Site</h1><p>Let&rsquo;s add a search form and functionality to our movie website. We&rsquo;ll add this to our <em>Index.cshtml</em> page, just above the <code>&lt;h1></code> element:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-html data-lang=html><span class=line><span class=cl>    <span class=p>&lt;</span><span class=nt>form</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>        <span class=p>&lt;</span><span class=nt>input</span> <span class=na>type</span><span class=o>=</span><span class=s>&#34;text&#34;</span> <span class=na>name</span><span class=o>=</span><span class=s>&#34;SearchTerms&#34;</span><span class=p>/&gt;</span>
</span></span><span class=line><span class=cl>        <span class=p>&lt;</span><span class=nt>input</span> <span class=na>type</span><span class=o>=</span><span class=s>&#34;submit&#34;</span> <span class=na>value</span><span class=o>=</span><span class=s>&#34;Search&#34;</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>    <span class=p>&lt;/</span><span class=nt>form</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>    <span class=p>&lt;</span><span class=nt>h1</span><span class=p>&gt;</span>Movie Results<span class=p>&lt;/</span><span class=nt>h1</span><span class=p>&gt;</span></span></span></code></pre></div><p>We&rsquo;ll also change the <code>&lt;h1></code> contents to &ldquo;Movie Results&rdquo;.</p><p>Try typing a search term into the search box, and click the <em>search</em> button. Has anything changed?</p><h3 id=the-request-object>The Request Object</h3><p>When you click the <em>search</em> button, the browser serializes your form, and makes a request against your server including the search terms. By default this request is a <strong>GET</strong> request, and the contents of the form are serialized using <a href=https://developer.mozilla.org/en-US/docs/Glossary/percent-encoding rel=external target=_blank>urlencoding (aka percent encoding)</a>, a special string format. This string is then appended to the requested url as the <a href=https://developer.mozilla.org/en-US/docs/Web/API/Location/search rel=external target=_blank>query string (aka search string)</a> - a series of key-value pairs proceeded by the question mark symbol(<code>?</code>) and separated by the ampersand (<code>&</code>).</p><p>This data is made available to us in our PageModel <em>Index.cshtml.cs</em> by ASP.NET. Let&rsquo;s take a look at it now. Notice the method <code>public void OnGet()</code>? This method is invoked <em>every time the page is requested using a GET request</em>. Thus, if we need to do some initialization and/or processing, this would be the place to do it.</p><p>Inside the PageModel, we can access the request data using the <code>Request</code> object. The exact string can be accessed with <code>Request.QueryString</code>, or the parsed and deserialized results can be accessed from <code>Request.Query</code>. Let&rsquo;s use the latter to pull out the search terms:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-csharp data-lang=csharp><span class=line><span class=cl>    <span class=kd>public</span> <span class=k>void</span> <span class=n>OnGet</span><span class=p>()</span> 
</span></span><span class=line><span class=cl>    <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=n>String</span> <span class=n>terms</span> <span class=p>=</span> <span class=n>Request</span><span class=p>.</span><span class=n>Query</span><span class=p>[</span><span class=s>&#34;SearchTerms&#34;</span><span class=p>];</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span></span></span></code></pre></div><p>We can store that value, and make it available to the page itself, by creating a public property. Let&rsquo;s create one named <code>SearchTerms</code>:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-csharp data-lang=csharp><span class=line><span class=cl>    <span class=kd>public</span> <span class=kt>string</span> <span class=n>SearchTerms</span> <span class=p>{</span> <span class=k>get</span><span class=p>;</span> <span class=k>set</span><span class=p>;</span> <span class=p>}</span></span></span></code></pre></div><p>And we&rsquo;ll refactor our <code>OnGet()</code> to store the search terms coming in from the request:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-csharp data-lang=csharp><span class=line><span class=cl>    <span class=kd>public</span> <span class=k>void</span> <span class=n>OnGet</span><span class=p>()</span> 
</span></span><span class=line><span class=cl>    <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=n>SearchTerms</span> <span class=p>=</span> <span class=n>Request</span><span class=p>.</span><span class=n>Query</span><span class=p>[</span><span class=s>&#34;SearchTerms&#34;</span><span class=p>];</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span></span></span></code></pre></div><p>Now we can refactor our input element to use that public property from our model as its default value:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-html data-lang=html><span class=line><span class=cl>    <span class=p>&lt;</span><span class=nt>input</span> <span class=na>type</span><span class=o>=</span><span class=s>&#34;text&#34;</span> <span class=na>name</span><span class=o>=</span><span class=s>&#34;SearchTerms&#34;</span> <span class=na>value</span><span class=o>=</span><span class=s>&#34;@Model.SearchTerms&#34;</span><span class=p>/&gt;</span></span></span></code></pre></div><p>The first time we visit the index page, the <code>SearchTerms</code> value will be null, so our input would have <code>value=""</code>. The browser interprets this as empty. If we add a search term and click the <em>search</em> button, we&rsquo;ll see the page reload. And since <code>@Model.SearchTerms</code> has a value this time, we&rsquo;ll see that string appear in search box!</p><p>Now we just need to search for those terms&mldr;</p><h3 id=adding-search-to-the-database>Adding Search to the Database</h3><p>We&rsquo;ll start by defining a new static method in our <em>MovieDatabase.cs</em> file to search for movies using the search terms:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-csharp data-lang=csharp><span class=line><span class=cl>    <span class=cs>/// &lt;summary&gt;</span>
</span></span><span class=line><span class=cl>    <span class=cs>/// Searches the database for matching movies</span>
</span></span><span class=line><span class=cl>    <span class=cs>/// &lt;/summary&gt;</span>
</span></span><span class=line><span class=cl>    <span class=cs>/// &lt;param name=&#34;terms&#34;&gt;The terms to search for&lt;/param&gt;</span>
</span></span><span class=line><span class=cl>    <span class=cs>/// &lt;returns&gt;A collection of movies&lt;/returns&gt;</span>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=kd>static</span> <span class=n>IEnumerable</span><span class=p>&lt;</span><span class=n>Movie</span><span class=p>&gt;</span> <span class=n>Search</span><span class=p>(</span><span class=kt>string</span> <span class=n>terms</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=c1>// TODO: Search database</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span></span></span></code></pre></div><p>We&rsquo;ll need a collection of results that implements the <code>IEnumerable&lt;T></code> interface. Let&rsquo;s use the familiar <code>List&lt;T></code>:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-csharp data-lang=csharp><span class=line><span class=cl>    <span class=n>List</span><span class=p>&lt;</span><span class=n>Movie</span><span class=p>&gt;</span> <span class=n>results</span> <span class=p>=</span> <span class=k>new</span> <span class=n>List</span><span class=p>&lt;</span><span class=n>Movie</span><span class=p>&gt;();</span></span></span></code></pre></div><p>Now, there is a chance that the search terms we receive are <code>null</code>. If that&rsquo;s the case, we would either 1) return <em>all</em> the movies, or 2) return <em>no</em> movies. You can choose either option, but for now, I&rsquo;ll return all movies</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-csharp data-lang=csharp><span class=line><span class=cl>    <span class=c1>// Return all movies if there are no search terms</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span><span class=p>(</span><span class=n>terms</span> <span class=p>==</span> <span class=kc>null</span><span class=p>)</span> <span class=k>return</span> <span class=n>All</span><span class=p>;</span></span></span></code></pre></div><p>If we <em>do</em> have search terms, we need to add any movies from our database that include those terms in the title. This requires us to check <em>each movie</em> in our database:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-csharp data-lang=csharp><span class=line><span class=cl>    <span class=c1>// return each movie in the database containing the terms substring</span>
</span></span><span class=line><span class=cl>    <span class=k>foreach</span><span class=p>(</span><span class=n>Movie</span> <span class=n>movie</span> <span class=k>in</span> <span class=n>All</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span><span class=p>(</span><span class=n>movie</span><span class=p>.</span><span class=n>Title</span><span class=p>.</span><span class=n>Contains</span><span class=p>(</span><span class=n>terms</span><span class=p>,</span> <span class=n>StringComparison</span><span class=p>.</span><span class=n>InvariantCultureIgnoreCase</span><span class=p>))</span> 
</span></span><span class=line><span class=cl>        <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=n>results</span><span class=p>.</span><span class=n>Add</span><span class=p>(</span><span class=n>movie</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>   </span></span></code></pre></div><p>We&rsquo;ll use <a href="https://docs.microsoft.com/en-us/dotnet/api/system.string.contains?view=netframework-4.8" rel=external target=_blank>String.Contains()</a> to determine if our terms are a <em>substring</em> within the title, ignoring case differences. If we find it, we&rsquo;ll add the movie to our <code>results</code> list.</p><p>Finally, we&rsquo;ll return that list:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-csharp data-lang=csharp><span class=line><span class=cl>    <span class=k>return</span> <span class=n>results</span><span class=p>;</span></span></span></code></pre></div><p>Now, we can refactor our <em>Index.cshtml.cs</em> to use this new search method:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-csharp data-lang=csharp><span class=line><span class=cl>    <span class=cs>/// &lt;summary&gt;</span>
</span></span><span class=line><span class=cl>    <span class=cs>/// The movies to display on the index page </span>
</span></span><span class=line><span class=cl>    <span class=cs>/// &lt;/summary&gt;</span>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=n>IEnumerable</span><span class=p>&lt;</span><span class=n>Movie</span><span class=p>&gt;</span> <span class=n>Movies</span> <span class=p>{</span> <span class=k>get</span><span class=p>;</span> <span class=kd>protected</span> <span class=k>set</span><span class=p>;</span> <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=cs>/// &lt;summary&gt;</span>
</span></span><span class=line><span class=cl>    <span class=cs>/// The current search terms </span>
</span></span><span class=line><span class=cl>    <span class=cs>/// &lt;/summary&gt;</span>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=kt>string</span> <span class=n>SearchTerms</span> <span class=p>{</span> <span class=k>get</span><span class=p>;</span> <span class=k>set</span><span class=p>;</span> <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=cs>/// &lt;summary&gt;</span>
</span></span><span class=line><span class=cl>    <span class=cs>/// Gets the search results for display on the page</span>
</span></span><span class=line><span class=cl>    <span class=cs>/// &lt;/summary&gt;</span>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=k>void</span> <span class=n>OnGet</span><span class=p>()</span> 
</span></span><span class=line><span class=cl>    <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=n>SearchTerms</span> <span class=p>=</span> <span class=n>Request</span><span class=p>.</span><span class=n>Query</span><span class=p>[</span><span class=s>&#34;SearchTerms&#34;</span><span class=p>];</span>
</span></span><span class=line><span class=cl>        <span class=n>Movies</span> <span class=p>=</span> <span class=n>MovieDatabase</span><span class=p>.</span><span class=n>Search</span><span class=p>(</span><span class=n>SearchTerms</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span></span></span></code></pre></div><p>We&rsquo;ll also need ot refactor our <em>Index.cshtml.cs</em> to use the search results, instead of the entire database:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-html data-lang=html><span class=line><span class=cl><span class=p>&lt;</span><span class=nt>ul</span> <span class=na>class</span><span class=o>=</span><span class=s>&#34;movie-list&#34;</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>    @foreach(Movie movie in @Model.Movies)
</span></span><span class=line><span class=cl>    {
</span></span><span class=line><span class=cl>        <span class=p>&lt;</span><span class=nt>li</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>            <span class=p>&lt;</span><span class=nt>div</span> <span class=na>class</span><span class=o>=</span><span class=s>&#34;details&#34;</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>                <span class=p>&lt;</span><span class=nt>h3</span> <span class=na>class</span><span class=o>=</span><span class=s>&#34;title&#34;</span><span class=p>&gt;</span>@movie.Title<span class=p>&lt;/</span><span class=nt>h3</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>                <span class=p>&lt;</span><span class=nt>div</span> <span class=na>class</span><span class=o>=</span><span class=s>&#34;mpaa&#34;</span><span class=p>&gt;</span>@movie.MPAARating<span class=p>&lt;/</span><span class=nt>div</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>                <span class=p>&lt;</span><span class=nt>div</span> <span class=na>class</span><span class=o>=</span><span class=s>&#34;genre&#34;</span><span class=p>&gt;</span>@movie.MajorGenre<span class=p>&lt;/</span><span class=nt>div</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>            <span class=p>&lt;/</span><span class=nt>div</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>            <span class=p>&lt;</span><span class=nt>div</span> <span class=na>class</span><span class=o>=</span><span class=s>&#34;ratings&#34;</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>                @if(movie.IMDBRating != null)
</span></span><span class=line><span class=cl>                {
</span></span><span class=line><span class=cl>                    <span class=p>&lt;</span><span class=nt>div</span> <span class=na>class</span><span class=o>=</span><span class=s>&#34;imdb&#34;</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>                        @movie.IMDBRating
</span></span><span class=line><span class=cl>                    <span class=p>&lt;/</span><span class=nt>div</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>                }
</span></span><span class=line><span class=cl>                @if(movie.RottenTomatoesRating != null)
</span></span><span class=line><span class=cl>                {
</span></span><span class=line><span class=cl>                    <span class=p>&lt;</span><span class=nt>div</span> <span class=na>class</span><span class=o>=</span><span class=s>&#34;rotten-tomatoes&#34;</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>                        @movie.RottenTomatoesRating
</span></span><span class=line><span class=cl>                    <span class=p>&lt;/</span><span class=nt>div</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>                }
</span></span><span class=line><span class=cl>            <span class=p>&lt;/</span><span class=nt>div</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>        <span class=p>&lt;/</span><span class=nt>li</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>    }
</span></span><span class=line><span class=cl><span class=p>&lt;/</span><span class=nt>ul</span><span class=p>&gt;</span></span></span></code></pre></div><p>If we try running the project again, and searching for the term &ldquo;Love&rdquo;&mldr; it crashes? What is going on?</p><p><a href=#R-image-307c9ea5a9b515b8822d835c34405bc8 class=lightbox-link><img alt="The Encountered Exception" class="border lazy lightbox noshadow figure-image" loading=lazy src=/cis400/images/6.8.2.png style=height:auto;width:auto></a>
<a href=javascript:history.back(); class=lightbox-back id=R-image-307c9ea5a9b515b8822d835c34405bc8><img alt="The Encountered Exception" class="border lazy lightbox noshadow lightbox-image" loading=lazy src=/cis400/images/6.8.2.png></a></p><p>Notice that the error is a <code>NullReferenceException</code>, and occurs in our <code>if</code> statement checking the title.</p><h3 id=bad-data>Bad Data</h3><p>If we think about what variables are involved in the line <code>if(movie.Title.Contains(terms, StringComparison.InvariantCultureIgnoreCase))</code>, we have:</p><ul><li><code>movie</code></li><li><code>movie.Title</code></li><li><code>terms</code></li></ul><p>Which of these three values can be null? We know for certain <code>terms</code> is not, as we test for the null value and return if it exists just before this portion of our code. Similarly, <code>movie</code> cannot be null, as it is an entry in the list provided by <code>All</code>, and if it were null, our page would have crashed before we added searching. That leaves <code>movie.Title</code> as a possibility.</p><p>If we comb through the data in <em>movies.json</em>, we find on line 54957 a movie with <code>null</code> for a title:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-json data-lang=json><span class=line><span class=cl>  <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;Title&#34;</span><span class=p>:</span> <span class=kc>null</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;USGross&#34;</span><span class=p>:</span> <span class=mi>26403</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;WorldwideGross&#34;</span><span class=p>:</span> <span class=mi>3080493</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;USDVDSales&#34;</span><span class=p>:</span> <span class=kc>null</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;ProductionBudget&#34;</span><span class=p>:</span> <span class=mi>3700000</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;ReleaseDate&#34;</span><span class=p>:</span> <span class=s2>&#34;Nov 03 2006&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;MPAARating&#34;</span><span class=p>:</span> <span class=s2>&#34;Not Rated&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;RunningTime&#34;</span><span class=p>:</span> <span class=mi>85</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;Distributor&#34;</span><span class=p>:</span> <span class=s2>&#34;IFC Films&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;Source&#34;</span><span class=p>:</span> <span class=s2>&#34;Original Screenplay&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;MajorGenre&#34;</span><span class=p>:</span> <span class=s2>&#34;Thriller/Suspense&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;CreativeType&#34;</span><span class=p>:</span> <span class=s2>&#34;Contemporary Fiction&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;Director&#34;</span><span class=p>:</span> <span class=kc>null</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;RottenTomatoesRating&#34;</span><span class=p>:</span> <span class=mi>39</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;IMDBRating&#34;</span><span class=p>:</span> <span class=mf>6.6</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;IMDBVotes&#34;</span><span class=p>:</span> <span class=mi>11986</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span><span class=err>,</span></span></span></code></pre></div><p>Working from the provided metadata, we can eventually identify the film as one titled <a href=https://en.wikipedia.org/wiki/Unknown_(2006_film) rel=external target=_blank>Unknown</a>. It would seem that whomever wrote the script to create this JSON file interpreted &ldquo;Unknown&rdquo; to mean the title was unknown (hence null), rather than the literal word &ldquo;Unknown&rdquo;.</p><p>If we dig deeper into the JSON file, we can find other issues. For example, the JSON identifies the controversial film <a href=https://en.wikipedia.org/wiki/The_Birth_of_a_Nation rel=external target=_blank>Birth of a Nation</a> as being released in 2015, when it was actually the first full-length theatrical film ever released, in <em>1915</em>! Most likely the original database from which these entries were derived only used two digits for the year, i.e. <code>15</code>, and the scripter who converted it to JSON chose a threshold date to determine if it was released in the 20 or 21st century, i.e.:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-csharp data-lang=csharp><span class=line><span class=cl><span class=k>if</span><span class=p>(</span><span class=n>date</span> <span class=p>&lt;</span> <span class=m>28</span><span class=p>)</span> 
</span></span><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=n>date</span> <span class=p>+=</span> <span class=m>2000</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl><span class=k>else</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=n>date</span> <span class=p>+=</span> <span class=m>1900</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span></span></span></code></pre></div><p>The earliest movie release date in the JSON is 1928, for &ldquo;The Broadway Melody&rdquo;, which suggests that <em>all</em> the movies released between 1915 and 1928 have been mislabeled as being released in the 21st century!</p><p>Unfortunately, these kinds of errors are rampant in databases, so as software developers we must be aware that our data may well be <em>dirty</em> - containing erroneous values, and anticipate these errors much like we do with user input. It is a good idea to clean up and fix these errors in our database so that it will be more reliable, but we also need to check for potential errors in our own code, as the database could be updated with more junk data in the future. Thus, we&rsquo;ll add a <code>null</code> check to our <code>if</code> statement in <em>MovieDatabase.cs</em>:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-csharp data-lang=csharp><span class=line><span class=cl><span class=k>if</span><span class=p>(</span><span class=n>movie</span><span class=p>.</span><span class=n>Title</span> <span class=p>!=</span> <span class=kc>null</span> <span class=p>&amp;&amp;</span> <span class=n>movie</span><span class=p>.</span><span class=n>Title</span><span class=p>.</span><span class=n>Contains</span><span class=p>(</span><span class=n>terms</span><span class=p>,</span> <span class=n>StringComparison</span><span class=p>.</span><span class=n>InvariantCultureIgnoreCase</span><span class=p>))</span> </span></span></code></pre></div><p>This will protect us against a <code>NullReferenceException</code> when our movie titles are null. Now if you try the search again, you should see the results:</p><p><a href=#R-image-dff72d6a791e38ef859dca58e1f7ae45 class=lightbox-link><img alt="The Search Results for &ldquo;Love&rdquo;" class="border lazy lightbox noshadow figure-image" loading=lazy src=/cis400/images/6.8.3.png style=height:auto;width:auto></a>
<a href=javascript:history.back(); class=lightbox-back id=R-image-dff72d6a791e38ef859dca58e1f7ae45><img alt="The Search Results for &ldquo;Love&rdquo;" class="border lazy lightbox noshadow lightbox-image" loading=lazy src=/cis400/images/6.8.3.png></a></p><footer class=footline></footer></article><article class=default><header class=headline></header><h1 id=adding-categorical-filters-to-the-movie-site>Adding Categorical Filters to the Movie Site</h1><p>Let&rsquo;s add some filters to the page as well. We&rsquo;ll start with <em>categorical</em> filters, i.e. filtering by category. Let&rsquo;s start by filtering for MPAA Rating. We know that there are only a handful of ratings issued by the Motion Picture Association of America - G, PG, PG-13, R, and NC-17. We might be tempted to use an enumeration to represent these values, but in C# an enumeration cannot have strings for values. Nor can we use the hyphen (<code>-</code>) in an enumeration name.</p><h2 id=defining-the-mpaa-ratings>Defining the MPAA Ratings</h2><p>So let&rsquo;s define a string array with our MPAA values, and make it accessible from our <code>MovieDatabase</code> class:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-csharp data-lang=csharp><span class=line><span class=cl>    <span class=cs>/// &lt;summary&gt;</span>
</span></span><span class=line><span class=cl>    <span class=cs>/// Gets the possible MPAARatings</span>
</span></span><span class=line><span class=cl>    <span class=cs>/// &lt;/summary&gt;</span>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=kd>static</span> <span class=kt>string</span><span class=p>[]</span> <span class=n>MPAARatings</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=k>get</span> <span class=p>=&gt;</span> <span class=k>new</span> <span class=kt>string</span><span class=p>[]</span>
</span></span><span class=line><span class=cl>        <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=s>&#34;G&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=s>&#34;PG&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=s>&#34;PG-13&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=s>&#34;R&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=s>&#34;NC-17&#34;</span>
</span></span><span class=line><span class=cl>        <span class=p>};</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span></span></span></code></pre></div><p>Now in our <code>&lt;form></code> in <em>Index.cshtml</em> we can add a checkbox for each of these possible values:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-html data-lang=html><span class=line><span class=cl><span class=p>&lt;</span><span class=nt>form</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>   <span class=p>&lt;</span><span class=nt>input</span> <span class=na>type</span><span class=o>=</span><span class=s>&#34;text&#34;</span> <span class=na>name</span><span class=o>=</span><span class=s>&#34;SearchTerms&#34;</span> <span class=na>value</span><span class=o>=</span><span class=s>&#34;@Model.SearchTerms&#34;</span><span class=p>/&gt;</span>
</span></span><span class=line><span class=cl>    <span class=p>&lt;</span><span class=nt>input</span> <span class=na>type</span><span class=o>=</span><span class=s>&#34;submit&#34;</span> <span class=na>value</span><span class=o>=</span><span class=s>&#34;Search&#34;</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>    @foreach  (string rating in MovieDatabase.MPAARating) 
</span></span><span class=line><span class=cl>    {
</span></span><span class=line><span class=cl>        <span class=p>&lt;</span><span class=nt>label</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>            <span class=p>&lt;</span><span class=nt>input</span> <span class=na>type</span><span class=o>=</span><span class=s>&#34;checkbox&#34;</span> <span class=na>name</span><span class=o>=</span><span class=s>&#34;MPAARatings&#34;</span> <span class=na>value</span><span class=o>=</span><span class=s>&#34;@rating&#34;</span><span class=p>/&gt;</span>
</span></span><span class=line><span class=cl>            @rating
</span></span><span class=line><span class=cl>        <span class=p>&lt;/</span><span class=nt>label</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>    }
</span></span><span class=line><span class=cl><span class=p>&lt;/</span><span class=nt>form</span><span class=p>&gt;</span></span></span></code></pre></div><p>If you try running the project now, and check a few boxes, you&rsquo;ll see the query string results look something like:</p><div class=highlight><pre tabindex=0><code>?SearchTerms=&amp;MPAARatings=G&amp;MPAARatings=PG-13</code></pre></div><p>Notice how the key <em>MPAARatings</em> is repeated twice? What would that look like in our PageModel? We can find out; declare a <code>var</code> to hold the value in the <code>OnGet()</code> method of <em>Index.cshtml.cs</em>:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-csharp data-lang=csharp><span class=line><span class=cl>    <span class=kt>var</span> <span class=n>MPAARatings</span> <span class=p>=</span> <span class=n>Request</span><span class=p>.</span><span class=n>Query</span><span class=p>[</span><span class=s>&#34;MPAARatings&#34;</span><span class=p>];</span></span></span></code></pre></div><p>If we add a breakpoint on this line, and run our code, then check several boxes (you&rsquo;ll have to <em>continue</em> the first time you hit the breakpoint), then step over the line, we&rsquo;ll see that the var <code>MPAA</code> rating is set to a <em>string collection</em>. We could therefore store it in an array property in <em>Index.cshtml.cs</em>, much like we did with our <code>SearchTerms</code>:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-csharp data-lang=csharp><span class=line><span class=cl>    <span class=cs>/// &lt;summary&gt;</span>
</span></span><span class=line><span class=cl>    <span class=cs>/// The filtered MPAA Ratings</span>
</span></span><span class=line><span class=cl>    <span class=cs>/// &lt;/summary&gt;</span>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=kt>string</span><span class=p>[]</span> <span class=n>MPAARatings</span> <span class=p>{</span> <span class=k>get</span><span class=p>;</span> <span class=k>set</span><span class=p>;</span> <span class=p>}</span></span></span></code></pre></div><p>And we can refactor the line we just added to <code>OnGet()</code> to use this new property:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-csharp data-lang=csharp><span class=line><span class=cl>    <span class=n>MPAARatings</span> <span class=p>=</span> <span class=n>Request</span><span class=p>.</span><span class=n>Query</span><span class=p>[</span><span class=s>&#34;MPAARatings&#34;</span><span class=p>];</span></span></span></code></pre></div><p>Then, in our <em>Index.cshtml</em> Razor Page, we can refactor the checkbox to be checked if we filtered against this rating in our last request:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-html data-lang=html><span class=line><span class=cl>    <span class=p>&lt;</span><span class=nt>input</span> <span class=na>type</span><span class=o>=</span><span class=s>&#34;checkbox&#34;</span> <span class=na>name</span><span class=o>=</span><span class=s>&#34;MPAARatings&#34;</span> <span class=na>value</span><span class=o>=</span><span class=s>&#34;@rating&#34;</span> <span class=na>checked</span><span class=o>=</span><span class=s>&#34;@Model.MPAARatings.Contains(rating)&#34;</span><span class=p>/&gt;</span></span></span></code></pre></div><p>Now our filters stick around when we submit the search request. That just leaves making the filters actually <em>work</em>.</p><h2 id=applying-mpaa-rating-filters>Applying MPAA Rating Filters</h2><p>Let&rsquo;s add another method to our <code>MovieDatabase</code> class, <code>FilterByMPAARating()</code>:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-csharp data-lang=csharp><span class=line><span class=cl>    <span class=cs>/// &lt;summary&gt;</span>
</span></span><span class=line><span class=cl>    <span class=cs>/// Filters the provided collection of movies</span>
</span></span><span class=line><span class=cl>    <span class=cs>/// &lt;/summary&gt;</span>
</span></span><span class=line><span class=cl>    <span class=cs>/// &lt;param name=&#34;movies&#34;&gt;The collection of movies to filter&lt;/param&gt;</span>
</span></span><span class=line><span class=cl>    <span class=cs>/// &lt;param name=&#34;ratings&#34;&gt;The ratings to include&lt;/param&gt;</span>
</span></span><span class=line><span class=cl>    <span class=cs>/// &lt;returns&gt;A collection containing only movies that match the filter&lt;/returns&gt;</span>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=kd>static</span> <span class=n>IEnumerable</span><span class=p>&lt;</span><span class=n>Movie</span><span class=p>&gt;</span> <span class=n>FilterByMPAARating</span><span class=p>(</span><span class=n>IEnumerable</span><span class=p>&lt;</span><span class=n>Movie</span><span class=p>&gt;</span> <span class=n>movies</span><span class=p>,</span> <span class=n>IEnumerable</span><span class=p>&lt;</span><span class=kt>string</span><span class=p>&gt;</span> <span class=n>ratings</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=c1>// TODO: Filter the list</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=p>}</span></span></span></code></pre></div><p>Notice that in <em>this</em> method, we accept an <code>IEnumerable&lt;Movie></code> parameter. This is the list of movies we want to filter. We use this, instead of the <code>All()</code> we did in the <code>Search()</code> method, as we would want to filter the <em>results</em> of a search.</p><p>Let&rsquo;s do a null/empty check, and just return this shortlist if no filters are specified:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-csharp data-lang=csharp><span class=line><span class=cl>    <span class=c1>// If no filter is specified, just return the provided collection</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=p>(</span><span class=n>ratings</span> <span class=p>==</span> <span class=kc>null</span> <span class=p>||</span> <span class=n>ratings</span><span class=p>.</span><span class=n>Count</span><span class=p>()</span> <span class=p>==</span> <span class=m>0</span><span class=p>)</span> <span class=k>return</span> <span class=n>movies</span><span class=p>;</span></span></span></code></pre></div><p>Otherwise, we&rsquo;ll use the same process we did before. Start with an empty list of movies, and iterate over the collection seeing if any match. However, as we have <em>two</em> collections (the movies <em>and</em> the ratings), we&rsquo;ll see if the ratings collection contains the supplied movie&rsquo;s rating.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-csharp data-lang=csharp><span class=line><span class=cl>    <span class=c1>// Filter the supplied collection of movies</span>
</span></span><span class=line><span class=cl>    <span class=n>List</span><span class=p>&lt;</span><span class=n>Movie</span><span class=p>&gt;</span> <span class=n>results</span> <span class=p>=</span> <span class=k>new</span> <span class=n>List</span><span class=p>&lt;</span><span class=n>Movie</span><span class=p>&gt;();</span>
</span></span><span class=line><span class=cl>    <span class=k>foreach</span><span class=p>(</span><span class=n>Movie</span> <span class=n>movie</span> <span class=k>in</span> <span class=n>movies</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span><span class=p>(</span><span class=n>movie</span><span class=p>.</span><span class=n>MPAARating</span> <span class=p>!=</span> <span class=kc>null</span> <span class=p>&amp;&amp;</span> <span class=n>ratings</span><span class=p>.</span><span class=n>Contains</span><span class=p>(</span><span class=n>movie</span><span class=p>.</span><span class=n>MPAARating</span><span class=p>))</span>
</span></span><span class=line><span class=cl>        <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=n>results</span><span class=p>.</span><span class=n>Add</span><span class=p>(</span><span class=n>movie</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span></span></span></code></pre></div><p>Finally, we&rsquo;ll return our results:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-csharp data-lang=csharp><span class=line><span class=cl>    <span class=k>return</span> <span class=n>results</span><span class=p>;</span></span></span></code></pre></div><p>Now, back in our PageModel <em>Index.cshtml.cs</em>, we&rsquo;ll apply our filter to the results of our search. The refactored <code>OnGet()</code> should then be:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-csharp data-lang=csharp><span class=line><span class=cl>    <span class=kd>public</span> <span class=k>void</span> <span class=n>OnGet</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=n>SearchTerms</span> <span class=p>=</span> <span class=n>Request</span><span class=p>.</span><span class=n>Query</span><span class=p>[</span><span class=s>&#34;SearchTerms&#34;</span><span class=p>];</span>
</span></span><span class=line><span class=cl>        <span class=n>MPAARatings</span> <span class=p>=</span> <span class=n>Request</span><span class=p>.</span><span class=n>Query</span><span class=p>[</span><span class=s>&#34;MPAARatings&#34;</span><span class=p>];</span>
</span></span><span class=line><span class=cl>        <span class=n>Movies</span> <span class=p>=</span> <span class=n>MovieDatabase</span><span class=p>.</span><span class=n>Search</span><span class=p>(</span><span class=n>SearchTerms</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=n>Movies</span> <span class=p>=</span> <span class=n>MovieDatabase</span><span class=p>.</span><span class=n>FilterByMPAARating</span><span class=p>(</span><span class=n>Movies</span><span class=p>,</span> <span class=n>MPAARatings</span><span class=p>);</span>        
</span></span><span class=line><span class=cl>    <span class=p>}</span></span></span></code></pre></div><p>Now we can run a search with filters applied. For example, searching for the word &ldquo;Love&rdquo; and movies that are PG or PG-13 yields:</p><p><a href=#R-image-b8f29e060085b5471273840107c80067 class=lightbox-link><img alt="Filtered Search Results" class="border lazy lightbox noshadow figure-image" loading=lazy src=/cis400/images/6.8.4.png style=height:auto;width:auto></a>
<a href=javascript:history.back(); class=lightbox-back id=R-image-b8f29e060085b5471273840107c80067><img alt="Filtered Search Results" class="border lazy lightbox noshadow lightbox-image" loading=lazy src=/cis400/images/6.8.4.png></a></p><p>You might be wondering why <em>Cloverfield</em> is listed. But remember, we&rsquo;re searching by substring, and C <strong>LOVE</strong> rfield contains love!</p><h2 id=filtering-by-genre>Filtering by Genre</h2><p>Let&rsquo;s add filters for genre next. But what genres should be included? This is not as clear-cut as our MPAA rating, as there is no standards organization that says &ldquo;these are the only offical genres that exist.&rdquo; In fact, new genres emerge from time to time. So a better source of this info might just be to see what Genres are defined in our data, i.e.:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-csharp data-lang=csharp><span class=line><span class=cl>    <span class=n>HashSet</span><span class=p>&lt;</span><span class=kt>string</span><span class=p>&gt;</span> <span class=n>genres</span> <span class=p>=</span> <span class=k>new</span> <span class=n>HashSet</span><span class=p>&lt;</span><span class=kt>string</span><span class=p>&gt;();</span>
</span></span><span class=line><span class=cl>    <span class=k>foreach</span><span class=p>(</span><span class=n>Movie</span> <span class=n>movie</span> <span class=k>in</span> <span class=n>All</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span><span class=p>(</span><span class=n>movie</span><span class=p>.</span><span class=n>MajorGenre</span> <span class=p>!=</span> <span class=kc>null</span><span class=p>)</span> 
</span></span><span class=line><span class=cl>        <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=n>genres</span><span class=p>.</span><span class=n>Add</span><span class=p>(</span><span class=n>movie</span><span class=p>.</span><span class=n>MajorGenre</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span></span></span></code></pre></div><p>Here we use a <a href="https://docs.microsoft.com/en-us/dotnet/api/system.collections.generic.hashset-1?view=netframework-4.8" rel=external target=_blank>HashSet</a> instead of a list, as it only adds each unique item once. Duplicates are ignored.</p><p>But where would this code go? We could place it in a getter for <code>MovieDatabase.Genres</code>:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-csharp data-lang=csharp><span class=line><span class=cl>    <span class=kd>public</span> <span class=n>IEnumerable</span><span class=p>&lt;</span><span class=kt>string</span><span class=p>&gt;</span> <span class=n>Genres</span> 
</span></span><span class=line><span class=cl>    <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=k>get</span> 
</span></span><span class=line><span class=cl>        <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=n>HashSet</span><span class=p>&lt;</span><span class=kt>string</span><span class=p>&gt;</span> <span class=n>genres</span> <span class=p>=</span> <span class=k>new</span> <span class=n>HashSet</span><span class=p>&lt;</span><span class=kt>string</span><span class=p>&gt;();</span>
</span></span><span class=line><span class=cl>            <span class=k>foreach</span><span class=p>(</span><span class=n>Movie</span> <span class=n>movie</span> <span class=k>in</span> <span class=n>All</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>                <span class=k>if</span><span class=p>(</span><span class=n>movie</span><span class=p>.</span><span class=n>MajorGenre</span> <span class=p>!=</span> <span class=kc>null</span><span class=p>)</span> 
</span></span><span class=line><span class=cl>                <span class=p>{</span>
</span></span><span class=line><span class=cl>                    <span class=n>genres</span><span class=p>.</span><span class=n>Add</span><span class=p>(</span><span class=n>movie</span><span class=p>.</span><span class=n>MajorGenre</span><span class=p>);</span>
</span></span><span class=line><span class=cl>                <span class=p>}</span>
</span></span><span class=line><span class=cl>            <span class=p>}</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span></span></span></code></pre></div><p>But this means that every time we want to access it, we&rsquo;ll search through all the movies&mldr; This is an O(n) operation, and will make our website slower.</p><p>Instead, let&rsquo;s create a private static variable in the <code>MovieDatabase</code> class to <em>cache</em> this collection as an array of strings:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-csharp data-lang=csharp><span class=line><span class=cl>    <span class=c1>// The genres represented in the database</span>
</span></span><span class=line><span class=cl>    <span class=kd>private</span> <span class=kd>static</span> <span class=kt>string</span><span class=p>[]</span> <span class=n>_genres</span><span class=p>;</span></span></span></code></pre></div><p>And expose it with a public static property:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-csharp data-lang=csharp><span class=line><span class=cl>    <span class=cs>/// &lt;summary&gt;</span>
</span></span><span class=line><span class=cl>    <span class=cs>/// Gets the movie genres represented in the database </span>
</span></span><span class=line><span class=cl>    <span class=cs>/// &lt;/summary&gt;</span>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=kd>static</span> <span class=kt>string</span><span class=p>[]</span> <span class=n>Genres</span> <span class=p>=&gt;</span> <span class=n>_genres</span><span class=p>;</span></span></span></code></pre></div><p>And finally, we&rsquo;ll populate this array in the static constructor of <code>MovieDatabase</code>, after the JSON file has been processed:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-csharp data-lang=csharp><span class=line><span class=cl>    <span class=n>HashSet</span><span class=p>&lt;</span><span class=kt>string</span><span class=p>&gt;</span> <span class=n>genreSet</span> <span class=p>=</span> <span class=k>new</span> <span class=n>HashSet</span><span class=p>&lt;</span><span class=kt>string</span><span class=p>&gt;();</span>
</span></span><span class=line><span class=cl>    <span class=k>foreach</span><span class=p>(</span><span class=n>Movie</span> <span class=n>movie</span> <span class=k>in</span> <span class=n>_movies</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span><span class=p>(</span><span class=n>movie</span><span class=p>.</span><span class=n>MajorGenre</span> <span class=p>!=</span> <span class=kc>null</span><span class=p>)</span> 
</span></span><span class=line><span class=cl>        <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=n>genreSet</span><span class=p>.</span><span class=n>Add</span><span class=p>(</span><span class=n>movie</span><span class=p>.</span><span class=n>MajorGenre</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=n>_genres</span> <span class=p>=</span> <span class=n>genreSet</span><span class=p>.</span><span class=n>ToArray</span><span class=p>();</span></span></span></code></pre></div><p>This approach means the finding of genres only happens once, and getting the <code>Genre</code> property is a constant-time O(1) operation.</p><p>We can implement the filters for the genres in the same way as we did for the MPAA filters; I&rsquo;ll leave that as an exercise for the reader.</p><footer class=footline></footer></article><article class=default><header class=headline></header><h1 id=adding-categorical-filters-to-the-movie-site>Adding Categorical Filters to the Movie Site</h1><p>Let&rsquo;s add some filters to the page as well. We&rsquo;ll start with <em>categorical</em> filters, i.e. filtering by category. Let&rsquo;s start by filtering for MPAA Rating. We know that there are only a handful of ratings issued by the Motion Picture Association of America - G, PG, PG-13, R, and NC-17. We might be tempted to use an enumeration to represent these values, but in C# an enumeration cannot have strings for values. Nor can we use the hyphen (<code>-</code>) in an enumeration name.</p><h2 id=defining-the-mpaa-ratings>Defining the MPAA Ratings</h2><p>So let&rsquo;s define a string array with our MPAA values, and make it accessible from our <code>MovieDatabase</code> class:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-csharp data-lang=csharp><span class=line><span class=cl>    <span class=cs>/// &lt;summary&gt;</span>
</span></span><span class=line><span class=cl>    <span class=cs>/// Gets the possible MPAARatings</span>
</span></span><span class=line><span class=cl>    <span class=cs>/// &lt;/summary&gt;</span>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=kd>static</span> <span class=kt>string</span><span class=p>[]</span> <span class=n>MPAARatings</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=k>get</span> <span class=p>=&gt;</span> <span class=k>new</span> <span class=kt>string</span><span class=p>[]</span>
</span></span><span class=line><span class=cl>        <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=s>&#34;G&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=s>&#34;PG&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=s>&#34;PG-13&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=s>&#34;R&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=s>&#34;NC-17&#34;</span>
</span></span><span class=line><span class=cl>        <span class=p>};</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span></span></span></code></pre></div><p>Now in our <code>&lt;form></code> in <em>Index.cshtml</em> we can add a checkbox for each of these possible values:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-html data-lang=html><span class=line><span class=cl><span class=p>&lt;</span><span class=nt>form</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>   <span class=p>&lt;</span><span class=nt>input</span> <span class=na>type</span><span class=o>=</span><span class=s>&#34;text&#34;</span> <span class=na>name</span><span class=o>=</span><span class=s>&#34;SearchTerms&#34;</span> <span class=na>value</span><span class=o>=</span><span class=s>&#34;@Model.SearchTerms&#34;</span><span class=p>/&gt;</span>
</span></span><span class=line><span class=cl>    <span class=p>&lt;</span><span class=nt>input</span> <span class=na>type</span><span class=o>=</span><span class=s>&#34;submit&#34;</span> <span class=na>value</span><span class=o>=</span><span class=s>&#34;Search&#34;</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>    @foreach  (string rating in MovieDatabase.MPAARating) 
</span></span><span class=line><span class=cl>    {
</span></span><span class=line><span class=cl>        <span class=p>&lt;</span><span class=nt>label</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>            <span class=p>&lt;</span><span class=nt>input</span> <span class=na>type</span><span class=o>=</span><span class=s>&#34;checkbox&#34;</span> <span class=na>name</span><span class=o>=</span><span class=s>&#34;MPAARatings&#34;</span> <span class=na>value</span><span class=o>=</span><span class=s>&#34;@rating&#34;</span><span class=p>/&gt;</span>
</span></span><span class=line><span class=cl>            @rating
</span></span><span class=line><span class=cl>        <span class=p>&lt;/</span><span class=nt>label</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>    }
</span></span><span class=line><span class=cl><span class=p>&lt;/</span><span class=nt>form</span><span class=p>&gt;</span></span></span></code></pre></div><p>If you try running the project now, and check a few boxes, you&rsquo;ll see the query string results look something like:</p><div class=highlight><pre tabindex=0><code>?SearchTerms=&amp;MPAARatings=G&amp;MPAARatings=PG-13</code></pre></div><p>Notice how the key <em>MPAARatings</em> is repeated twice? What would that look like in our PageModel? We can find out; declare a <code>var</code> to hold the value in the <code>OnGet()</code> method of <em>Index.cshtml.cs</em>:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-csharp data-lang=csharp><span class=line><span class=cl>    <span class=kt>var</span> <span class=n>MPAARatings</span> <span class=p>=</span> <span class=n>Request</span><span class=p>.</span><span class=n>Query</span><span class=p>[</span><span class=s>&#34;MPAARatings&#34;</span><span class=p>];</span></span></span></code></pre></div><p>If we add a breakpoint on this line, and run our code, then check several boxes (you&rsquo;ll have to <em>continue</em> the first time you hit the breakpoint), then step over the line, we&rsquo;ll see that the var <code>MPAA</code> rating is set to a <em>string collection</em>. We could therefore store it in an array property in <em>Index.cshtml.cs</em>, much like we did with our <code>SearchTerms</code>:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-csharp data-lang=csharp><span class=line><span class=cl>    <span class=cs>/// &lt;summary&gt;</span>
</span></span><span class=line><span class=cl>    <span class=cs>/// The filtered MPAA Ratings</span>
</span></span><span class=line><span class=cl>    <span class=cs>/// &lt;/summary&gt;</span>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=kt>string</span><span class=p>[]</span> <span class=n>MPAARatings</span> <span class=p>{</span> <span class=k>get</span><span class=p>;</span> <span class=k>set</span><span class=p>;</span> <span class=p>}</span></span></span></code></pre></div><p>And we can refactor the line we just added to <code>OnGet()</code> to use this new property:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-csharp data-lang=csharp><span class=line><span class=cl>    <span class=n>MPAARatings</span> <span class=p>=</span> <span class=n>Request</span><span class=p>.</span><span class=n>Query</span><span class=p>[</span><span class=s>&#34;MPAARatings&#34;</span><span class=p>];</span></span></span></code></pre></div><p>Then, in our <em>Index.cshtml</em> Razor Page, we can refactor the checkbox to be checked if we filtered against this rating in our last request:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-html data-lang=html><span class=line><span class=cl>    <span class=p>&lt;</span><span class=nt>input</span> <span class=na>type</span><span class=o>=</span><span class=s>&#34;checkbox&#34;</span> <span class=na>name</span><span class=o>=</span><span class=s>&#34;MPAARatings&#34;</span> <span class=na>value</span><span class=o>=</span><span class=s>&#34;@rating&#34;</span> <span class=na>checked</span><span class=o>=</span><span class=s>&#34;@Model.MPAARatings.Contains(rating)&#34;</span><span class=p>/&gt;</span></span></span></code></pre></div><p>Now our filters stick around when we submit the search request. That just leaves making the filters actually <em>work</em>.</p><h2 id=applying-mpaa-rating-filters>Applying MPAA Rating Filters</h2><p>Let&rsquo;s add another method to our <code>MovieDatabase</code> class, <code>FilterByMPAARating()</code>:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-csharp data-lang=csharp><span class=line><span class=cl>    <span class=cs>/// &lt;summary&gt;</span>
</span></span><span class=line><span class=cl>    <span class=cs>/// Filters the provided collection of movies</span>
</span></span><span class=line><span class=cl>    <span class=cs>/// &lt;/summary&gt;</span>
</span></span><span class=line><span class=cl>    <span class=cs>/// &lt;param name=&#34;movies&#34;&gt;The collection of movies to filter&lt;/param&gt;</span>
</span></span><span class=line><span class=cl>    <span class=cs>/// &lt;param name=&#34;ratings&#34;&gt;The ratings to include&lt;/param&gt;</span>
</span></span><span class=line><span class=cl>    <span class=cs>/// &lt;returns&gt;A collection containing only movies that match the filter&lt;/returns&gt;</span>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=kd>static</span> <span class=n>IEnumerable</span><span class=p>&lt;</span><span class=n>Movie</span><span class=p>&gt;</span> <span class=n>FilterByMPAARating</span><span class=p>(</span><span class=n>IEnumerable</span><span class=p>&lt;</span><span class=n>Movie</span><span class=p>&gt;</span> <span class=n>movies</span><span class=p>,</span> <span class=n>IEnumerable</span><span class=p>&lt;</span><span class=kt>string</span><span class=p>&gt;</span> <span class=n>ratings</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=c1>// TODO: Filter the list</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=p>}</span></span></span></code></pre></div><p>Notice that in <em>this</em> method, we accept an <code>IEnumerable&lt;Movie></code> parameter. This is the list of movies we want to filter. We use this, instead of the <code>All()</code> we did in the <code>Search()</code> method, as we would want to filter the <em>results</em> of a search.</p><p>Let&rsquo;s do a null/empty check, and just return this shortlist if no filters are specified:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-csharp data-lang=csharp><span class=line><span class=cl>    <span class=c1>// If no filter is specified, just return the provided collection</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=p>(</span><span class=n>ratings</span> <span class=p>==</span> <span class=kc>null</span> <span class=p>||</span> <span class=n>ratings</span><span class=p>.</span><span class=n>Count</span><span class=p>()</span> <span class=p>==</span> <span class=m>0</span><span class=p>)</span> <span class=k>return</span> <span class=n>movies</span><span class=p>;</span></span></span></code></pre></div><p>Otherwise, we&rsquo;ll use the same process we did before. Start with an empty list of movies, and iterate over the collection seeing if any match. However, as we have <em>two</em> collections (the movies <em>and</em> the ratings), we&rsquo;ll see if the ratings collection contains the supplied movie&rsquo;s rating.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-csharp data-lang=csharp><span class=line><span class=cl>    <span class=c1>// Filter the supplied collection of movies</span>
</span></span><span class=line><span class=cl>    <span class=n>List</span><span class=p>&lt;</span><span class=n>Movie</span><span class=p>&gt;</span> <span class=n>results</span> <span class=p>=</span> <span class=k>new</span> <span class=n>List</span><span class=p>&lt;</span><span class=n>Movie</span><span class=p>&gt;();</span>
</span></span><span class=line><span class=cl>    <span class=k>foreach</span><span class=p>(</span><span class=n>Movie</span> <span class=n>movie</span> <span class=k>in</span> <span class=n>movies</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span><span class=p>(</span><span class=n>movie</span><span class=p>.</span><span class=n>MPAARating</span> <span class=p>!=</span> <span class=kc>null</span> <span class=p>&amp;&amp;</span> <span class=n>ratings</span><span class=p>.</span><span class=n>Contains</span><span class=p>(</span><span class=n>movie</span><span class=p>.</span><span class=n>MPAARating</span><span class=p>))</span>
</span></span><span class=line><span class=cl>        <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=n>results</span><span class=p>.</span><span class=n>Add</span><span class=p>(</span><span class=n>movie</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span></span></span></code></pre></div><p>Finally, we&rsquo;ll return our results:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-csharp data-lang=csharp><span class=line><span class=cl>    <span class=k>return</span> <span class=n>results</span><span class=p>;</span></span></span></code></pre></div><p>Now, back in our PageModel <em>Index.cshtml.cs</em>, we&rsquo;ll apply our filter to the results of our search. The refactored <code>OnGet()</code> should then be:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-csharp data-lang=csharp><span class=line><span class=cl>    <span class=kd>public</span> <span class=k>void</span> <span class=n>OnGet</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=n>SearchTerms</span> <span class=p>=</span> <span class=n>Request</span><span class=p>.</span><span class=n>Query</span><span class=p>[</span><span class=s>&#34;SearchTerms&#34;</span><span class=p>];</span>
</span></span><span class=line><span class=cl>        <span class=n>MPAARatings</span> <span class=p>=</span> <span class=n>Request</span><span class=p>.</span><span class=n>Query</span><span class=p>[</span><span class=s>&#34;MPAARatings&#34;</span><span class=p>];</span>
</span></span><span class=line><span class=cl>        <span class=n>Movies</span> <span class=p>=</span> <span class=n>MovieDatabase</span><span class=p>.</span><span class=n>Search</span><span class=p>(</span><span class=n>SearchTerms</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=n>Movies</span> <span class=p>=</span> <span class=n>MovieDatabase</span><span class=p>.</span><span class=n>FilterByMPAARating</span><span class=p>(</span><span class=n>Movies</span><span class=p>,</span> <span class=n>MPAARatings</span><span class=p>);</span>        
</span></span><span class=line><span class=cl>    <span class=p>}</span></span></span></code></pre></div><p>Now we can run a search with filters applied. For example, searching for the word &ldquo;Love&rdquo; and movies that are PG or PG-13 yields:</p><p><a href=#R-image-e1f1ca6b2574703c567614f588126c3a class=lightbox-link><img alt="Filtered Search Results" class="border lazy lightbox noshadow figure-image" loading=lazy src=/cis400/images/6.8.4.png style=height:auto;width:auto></a>
<a href=javascript:history.back(); class=lightbox-back id=R-image-e1f1ca6b2574703c567614f588126c3a><img alt="Filtered Search Results" class="border lazy lightbox noshadow lightbox-image" loading=lazy src=/cis400/images/6.8.4.png></a></p><p>You might be wondering why <em>Cloverfield</em> is listed. But remember, we&rsquo;re searching by substring, and C <strong>LOVE</strong> rfield contains love!</p><h2 id=filtering-by-genre>Filtering by Genre</h2><p>Let&rsquo;s add filters for genre next. But what genres should be included? This is not as clear-cut as our MPAA rating, as there is no standards organization that says &ldquo;these are the only offical genres that exist.&rdquo; In fact, new genres emerge from time to time. So a better source of this info might just be to see what Genres are defined in our data, i.e.:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-csharp data-lang=csharp><span class=line><span class=cl>    <span class=n>HashSet</span><span class=p>&lt;</span><span class=kt>string</span><span class=p>&gt;</span> <span class=n>genres</span> <span class=p>=</span> <span class=k>new</span> <span class=n>HashSet</span><span class=p>&lt;</span><span class=kt>string</span><span class=p>&gt;();</span>
</span></span><span class=line><span class=cl>    <span class=k>foreach</span><span class=p>(</span><span class=n>Movie</span> <span class=n>movie</span> <span class=k>in</span> <span class=n>All</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span><span class=p>(</span><span class=n>movie</span><span class=p>.</span><span class=n>MajorGenre</span> <span class=p>!=</span> <span class=kc>null</span><span class=p>)</span> 
</span></span><span class=line><span class=cl>        <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=n>genres</span><span class=p>.</span><span class=n>Add</span><span class=p>(</span><span class=n>movie</span><span class=p>.</span><span class=n>MajorGenre</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span></span></span></code></pre></div><p>Here we use a <a href="https://docs.microsoft.com/en-us/dotnet/api/system.collections.generic.hashset-1?view=netframework-4.8" rel=external target=_blank>HashSet</a> instead of a list, as it only adds each unique item once. Duplicates are ignored.</p><p>But where would this code go? We could place it in a getter for <code>MovieDatabase.Genres</code>:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-csharp data-lang=csharp><span class=line><span class=cl>    <span class=kd>public</span> <span class=n>IEnumerable</span><span class=p>&lt;</span><span class=kt>string</span><span class=p>&gt;</span> <span class=n>Genres</span> 
</span></span><span class=line><span class=cl>    <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=k>get</span> 
</span></span><span class=line><span class=cl>        <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=n>HashSet</span><span class=p>&lt;</span><span class=kt>string</span><span class=p>&gt;</span> <span class=n>genres</span> <span class=p>=</span> <span class=k>new</span> <span class=n>HashSet</span><span class=p>&lt;</span><span class=kt>string</span><span class=p>&gt;();</span>
</span></span><span class=line><span class=cl>            <span class=k>foreach</span><span class=p>(</span><span class=n>Movie</span> <span class=n>movie</span> <span class=k>in</span> <span class=n>All</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>                <span class=k>if</span><span class=p>(</span><span class=n>movie</span><span class=p>.</span><span class=n>MajorGenre</span> <span class=p>!=</span> <span class=kc>null</span><span class=p>)</span> 
</span></span><span class=line><span class=cl>                <span class=p>{</span>
</span></span><span class=line><span class=cl>                    <span class=n>genres</span><span class=p>.</span><span class=n>Add</span><span class=p>(</span><span class=n>movie</span><span class=p>.</span><span class=n>MajorGenre</span><span class=p>);</span>
</span></span><span class=line><span class=cl>                <span class=p>}</span>
</span></span><span class=line><span class=cl>            <span class=p>}</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span></span></span></code></pre></div><p>But this means that every time we want to access it, we&rsquo;ll search through all the movies&mldr; This is an O(n) operation, and will make our website slower.</p><p>Instead, let&rsquo;s create a private static variable in the <code>MovieDatabase</code> class to <em>cache</em> this collection as an array of strings:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-csharp data-lang=csharp><span class=line><span class=cl>    <span class=c1>// The genres represented in the database</span>
</span></span><span class=line><span class=cl>    <span class=kd>private</span> <span class=kd>static</span> <span class=kt>string</span><span class=p>[]</span> <span class=n>_genres</span><span class=p>;</span></span></span></code></pre></div><p>And expose it with a public static property:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-csharp data-lang=csharp><span class=line><span class=cl>    <span class=cs>/// &lt;summary&gt;</span>
</span></span><span class=line><span class=cl>    <span class=cs>/// Gets the movie genres represented in the database </span>
</span></span><span class=line><span class=cl>    <span class=cs>/// &lt;/summary&gt;</span>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=kd>static</span> <span class=kt>string</span><span class=p>[]</span> <span class=n>Genres</span> <span class=p>=&gt;</span> <span class=n>_genres</span><span class=p>;</span></span></span></code></pre></div><p>And finally, we&rsquo;ll populate this array in the static constructor of <code>MovieDatabase</code>, after the JSON file has been processed:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-csharp data-lang=csharp><span class=line><span class=cl>    <span class=n>HashSet</span><span class=p>&lt;</span><span class=kt>string</span><span class=p>&gt;</span> <span class=n>genreSet</span> <span class=p>=</span> <span class=k>new</span> <span class=n>HashSet</span><span class=p>&lt;</span><span class=kt>string</span><span class=p>&gt;();</span>
</span></span><span class=line><span class=cl>    <span class=k>foreach</span><span class=p>(</span><span class=n>Movie</span> <span class=n>movie</span> <span class=k>in</span> <span class=n>_movies</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span><span class=p>(</span><span class=n>movie</span><span class=p>.</span><span class=n>MajorGenre</span> <span class=p>!=</span> <span class=kc>null</span><span class=p>)</span> 
</span></span><span class=line><span class=cl>        <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=n>genreSet</span><span class=p>.</span><span class=n>Add</span><span class=p>(</span><span class=n>movie</span><span class=p>.</span><span class=n>MajorGenre</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=n>_genres</span> <span class=p>=</span> <span class=n>genreSet</span><span class=p>.</span><span class=n>ToArray</span><span class=p>();</span></span></span></code></pre></div><p>This approach means the finding of genres only happens once, and getting the <code>Genre</code> property is a constant-time O(1) operation.</p><p>We can implement the filters for the genres in the same way as we did for the MPAA filters; I&rsquo;ll leave that as an exercise for the reader.</p><footer class=footline></footer></article><article class=default><header class=headline></header><h1 id=adding-categorical-filters-to-the-movie-site>Adding Categorical Filters to the Movie Site</h1><p>Let&rsquo;s add some filters to the page as well. We&rsquo;ll start with <em>categorical</em> filters, i.e. filtering by category. Let&rsquo;s start by filtering for MPAA Rating. We know that there are only a handful of ratings issued by the Motion Picture Association of America - G, PG, PG-13, R, and NC-17. We might be tempted to use an enumeration to represent these values, but in C# an enumeration cannot have strings for values. Nor can we use the hyphen (<code>-</code>) in an enumeration name.</p><h2 id=defining-the-mpaa-ratings>Defining the MPAA Ratings</h2><p>So let&rsquo;s define a string array with our MPAA values, and make it accessible from our <code>MovieDatabase</code> class:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-csharp data-lang=csharp><span class=line><span class=cl>    <span class=cs>/// &lt;summary&gt;</span>
</span></span><span class=line><span class=cl>    <span class=cs>/// Gets the possible MPAARatings</span>
</span></span><span class=line><span class=cl>    <span class=cs>/// &lt;/summary&gt;</span>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=kd>static</span> <span class=kt>string</span><span class=p>[]</span> <span class=n>MPAARatings</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=k>get</span> <span class=p>=&gt;</span> <span class=k>new</span> <span class=kt>string</span><span class=p>[]</span>
</span></span><span class=line><span class=cl>        <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=s>&#34;G&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=s>&#34;PG&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=s>&#34;PG-13&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=s>&#34;R&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=s>&#34;NC-17&#34;</span>
</span></span><span class=line><span class=cl>        <span class=p>};</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span></span></span></code></pre></div><p>Now in our <code>&lt;form></code> in <em>Index.cshtml</em> we can add a checkbox for each of these possible values:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-html data-lang=html><span class=line><span class=cl><span class=p>&lt;</span><span class=nt>form</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>   <span class=p>&lt;</span><span class=nt>input</span> <span class=na>type</span><span class=o>=</span><span class=s>&#34;text&#34;</span> <span class=na>name</span><span class=o>=</span><span class=s>&#34;SearchTerms&#34;</span> <span class=na>value</span><span class=o>=</span><span class=s>&#34;@Model.SearchTerms&#34;</span><span class=p>/&gt;</span>
</span></span><span class=line><span class=cl>    <span class=p>&lt;</span><span class=nt>input</span> <span class=na>type</span><span class=o>=</span><span class=s>&#34;submit&#34;</span> <span class=na>value</span><span class=o>=</span><span class=s>&#34;Search&#34;</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>    @foreach  (string rating in MovieDatabase.MPAARatings) 
</span></span><span class=line><span class=cl>    {
</span></span><span class=line><span class=cl>        <span class=p>&lt;</span><span class=nt>label</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>            <span class=p>&lt;</span><span class=nt>input</span> <span class=na>type</span><span class=o>=</span><span class=s>&#34;checkbox&#34;</span> <span class=na>name</span><span class=o>=</span><span class=s>&#34;MPAARatings&#34;</span> <span class=na>value</span><span class=o>=</span><span class=s>&#34;@rating&#34;</span><span class=p>/&gt;</span>
</span></span><span class=line><span class=cl>            @rating
</span></span><span class=line><span class=cl>        <span class=p>&lt;/</span><span class=nt>label</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>    }
</span></span><span class=line><span class=cl><span class=p>&lt;/</span><span class=nt>form</span><span class=p>&gt;</span></span></span></code></pre></div><p>If you try running the project now, and check a few boxes, you&rsquo;ll see the query string results look something like:</p><div class=highlight><pre tabindex=0><code>?SearchTerms=&amp;MPAARatings=G&amp;MPAARatings=PG-13</code></pre></div><p>Notice how the key <em>MPAARatings</em> is repeated twice? What would that look like in our PageModel? We can find out; declare a <code>var</code> to hold the value in the <code>OnGet()</code> method of <em>Index.cshtml.cs</em>:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-csharp data-lang=csharp><span class=line><span class=cl>    <span class=kt>var</span> <span class=n>MPAARatings</span> <span class=p>=</span> <span class=n>Request</span><span class=p>.</span><span class=n>Query</span><span class=p>[</span><span class=s>&#34;MPAARatings&#34;</span><span class=p>];</span></span></span></code></pre></div><p>If we add a breakpoint on this line, and run our code, then check several boxes (you&rsquo;ll have to <em>continue</em> the first time you hit the breakpoint), then step over the line, we&rsquo;ll see that the var <code>MPAA</code> rating is set to a <em>string collection</em>. We could therefore store it in an array property in <em>Index.cshtml.cs</em>, much like we did with our <code>SearchTerms</code>:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-csharp data-lang=csharp><span class=line><span class=cl>    <span class=cs>/// &lt;summary&gt;</span>
</span></span><span class=line><span class=cl>    <span class=cs>/// The filtered MPAA Ratings</span>
</span></span><span class=line><span class=cl>    <span class=cs>/// &lt;/summary&gt;</span>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=kt>string</span><span class=p>[]</span> <span class=n>MPAARatings</span> <span class=p>{</span> <span class=k>get</span><span class=p>;</span> <span class=k>set</span><span class=p>;</span> <span class=p>}</span></span></span></code></pre></div><p>And we can refactor the line we just added to <code>OnGet()</code> to use this new property:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-csharp data-lang=csharp><span class=line><span class=cl>    <span class=n>MPAARatings</span> <span class=p>=</span> <span class=n>Request</span><span class=p>.</span><span class=n>Query</span><span class=p>[</span><span class=s>&#34;MPAARatings&#34;</span><span class=p>];</span></span></span></code></pre></div><p>Then, in our <em>Index.cshtml</em> Razor Page, we can refactor the checkbox to be checked if we filtered against this rating in our last request:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-html data-lang=html><span class=line><span class=cl>    <span class=p>&lt;</span><span class=nt>input</span> <span class=na>type</span><span class=o>=</span><span class=s>&#34;checkbox&#34;</span> <span class=na>name</span><span class=o>=</span><span class=s>&#34;MPAARatings&#34;</span> <span class=na>value</span><span class=o>=</span><span class=s>&#34;@rating&#34;</span> <span class=na>checked</span><span class=o>=</span><span class=s>&#34;@Model.MPAARatings.Contains(rating)&#34;</span><span class=p>/&gt;</span></span></span></code></pre></div><p>Now our filters stick around when we submit the search request. That just leaves making the filters actually <em>work</em>.</p><h2 id=applying-mpaa-rating-filters>Applying MPAA Rating Filters</h2><p>Let&rsquo;s add another method to our <code>MovieDatabase</code> class, <code>FilterByMPAARating()</code>:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-csharp data-lang=csharp><span class=line><span class=cl>    <span class=cs>/// &lt;summary&gt;</span>
</span></span><span class=line><span class=cl>    <span class=cs>/// Filters the provided collection of movies</span>
</span></span><span class=line><span class=cl>    <span class=cs>/// &lt;/summary&gt;</span>
</span></span><span class=line><span class=cl>    <span class=cs>/// &lt;param name=&#34;movies&#34;&gt;The collection of movies to filter&lt;/param&gt;</span>
</span></span><span class=line><span class=cl>    <span class=cs>/// &lt;param name=&#34;ratings&#34;&gt;The ratings to include&lt;/param&gt;</span>
</span></span><span class=line><span class=cl>    <span class=cs>/// &lt;returns&gt;A collection containing only movies that match the filter&lt;/returns&gt;</span>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=kd>static</span> <span class=n>IEnumerable</span><span class=p>&lt;</span><span class=n>Movie</span><span class=p>&gt;</span> <span class=n>FilterByMPAARating</span><span class=p>(</span><span class=n>IEnumerable</span><span class=p>&lt;</span><span class=n>Movie</span><span class=p>&gt;</span> <span class=n>movies</span><span class=p>,</span> <span class=n>IEnumerable</span><span class=p>&lt;</span><span class=kt>string</span><span class=p>&gt;</span> <span class=n>ratings</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=c1>// TODO: Filter the list</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=p>}</span></span></span></code></pre></div><p>Notice that in <em>this</em> method, we accept an <code>IEnumerable&lt;Movie></code> parameter. This is the list of movies we want to filter. We use this, instead of the <code>All()</code> we did in the <code>Search()</code> method, as we would want to filter the <em>results</em> of a search.</p><p>Let&rsquo;s do a null/empty check, and just return this shortlist if no filters are specified:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-csharp data-lang=csharp><span class=line><span class=cl>    <span class=c1>// If no filter is specified, just return the provided collection</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=p>(</span><span class=n>ratings</span> <span class=p>==</span> <span class=kc>null</span> <span class=p>||</span> <span class=n>ratings</span><span class=p>.</span><span class=n>Count</span><span class=p>()</span> <span class=p>==</span> <span class=m>0</span><span class=p>)</span> <span class=k>return</span> <span class=n>movies</span><span class=p>;</span></span></span></code></pre></div><p>Otherwise, we&rsquo;ll use the same process we did before. Start with an empty list of movies, and iterate over the collection seeing if any match. However, as we have <em>two</em> collections (the movies <em>and</em> the ratings), we&rsquo;ll see if the ratings collection contains the supplied movie&rsquo;s rating.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-csharp data-lang=csharp><span class=line><span class=cl>    <span class=c1>// Filter the supplied collection of movies</span>
</span></span><span class=line><span class=cl>    <span class=n>List</span><span class=p>&lt;</span><span class=n>Movie</span><span class=p>&gt;</span> <span class=n>results</span> <span class=p>=</span> <span class=k>new</span> <span class=n>List</span><span class=p>&lt;</span><span class=n>Movie</span><span class=p>&gt;();</span>
</span></span><span class=line><span class=cl>    <span class=k>foreach</span><span class=p>(</span><span class=n>Movie</span> <span class=n>movie</span> <span class=k>in</span> <span class=n>movies</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span><span class=p>(</span><span class=n>movie</span><span class=p>.</span><span class=n>MPAARating</span> <span class=p>!=</span> <span class=kc>null</span> <span class=p>&amp;&amp;</span> <span class=n>ratings</span><span class=p>.</span><span class=n>Contains</span><span class=p>(</span><span class=n>movie</span><span class=p>.</span><span class=n>MPAARating</span><span class=p>))</span>
</span></span><span class=line><span class=cl>        <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=n>results</span><span class=p>.</span><span class=n>Add</span><span class=p>(</span><span class=n>movie</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span></span></span></code></pre></div><p>Finally, we&rsquo;ll return our results:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-csharp data-lang=csharp><span class=line><span class=cl>    <span class=k>return</span> <span class=n>results</span><span class=p>;</span></span></span></code></pre></div><p>Now, back in our PageModel <em>Index.cshtml.cs</em>, we&rsquo;ll apply our filter to the results of our search. The refactored <code>OnGet()</code> should then be:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-csharp data-lang=csharp><span class=line><span class=cl>    <span class=kd>public</span> <span class=k>void</span> <span class=n>OnGet</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=n>SearchTerms</span> <span class=p>=</span> <span class=n>Request</span><span class=p>.</span><span class=n>Query</span><span class=p>[</span><span class=s>&#34;SearchTerms&#34;</span><span class=p>];</span>
</span></span><span class=line><span class=cl>        <span class=n>MPAARatings</span> <span class=p>=</span> <span class=n>Request</span><span class=p>.</span><span class=n>Query</span><span class=p>[</span><span class=s>&#34;MPAARatings&#34;</span><span class=p>];</span>
</span></span><span class=line><span class=cl>        <span class=n>Movies</span> <span class=p>=</span> <span class=n>MovieDatabase</span><span class=p>.</span><span class=n>Search</span><span class=p>(</span><span class=n>SearchTerms</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=n>Movies</span> <span class=p>=</span> <span class=n>MovieDatabase</span><span class=p>.</span><span class=n>FilterByMPAARating</span><span class=p>(</span><span class=n>Movies</span><span class=p>,</span> <span class=n>MPAARatings</span><span class=p>);</span>        
</span></span><span class=line><span class=cl>    <span class=p>}</span></span></span></code></pre></div><p>Now we can run a search with filters applied. For example, searching for the word &ldquo;Love&rdquo; and movies that are PG or PG-13 yields:</p><p><a href=#R-image-f44e972b221d0dcde453ee8662373b74 class=lightbox-link><img alt="Filtered Search Results" class="border lazy lightbox noshadow figure-image" loading=lazy src=/cis400/images/6.8.4.png style=height:auto;width:auto></a>
<a href=javascript:history.back(); class=lightbox-back id=R-image-f44e972b221d0dcde453ee8662373b74><img alt="Filtered Search Results" class="border lazy lightbox noshadow lightbox-image" loading=lazy src=/cis400/images/6.8.4.png></a></p><p>You might be wondering why <em>Cloverfield</em> is listed. But remember, we&rsquo;re searching by substring, and C <strong>LOVE</strong> rfield contains love!</p><h2 id=filtering-by-genre>Filtering by Genre</h2><p>Let&rsquo;s add filters for genre next. But what genres should be included? This is not as clear-cut as our MPAA rating, as there is no standards organization that says &ldquo;these are the only offical genres that exist.&rdquo; In fact, new genres emerge from time to time. So a better source of this info might just be to see what Genres are defined in our data, i.e.:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-csharp data-lang=csharp><span class=line><span class=cl>    <span class=n>HashSet</span><span class=p>&lt;</span><span class=kt>string</span><span class=p>&gt;</span> <span class=n>genres</span> <span class=p>=</span> <span class=k>new</span> <span class=n>HashSet</span><span class=p>&lt;</span><span class=kt>string</span><span class=p>&gt;();</span>
</span></span><span class=line><span class=cl>    <span class=k>foreach</span><span class=p>(</span><span class=n>Movie</span> <span class=n>movie</span> <span class=k>in</span> <span class=n>All</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span><span class=p>(</span><span class=n>movie</span><span class=p>.</span><span class=n>MajorGenre</span> <span class=p>!=</span> <span class=kc>null</span><span class=p>)</span> 
</span></span><span class=line><span class=cl>        <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=n>genres</span><span class=p>.</span><span class=n>Add</span><span class=p>(</span><span class=n>movie</span><span class=p>.</span><span class=n>MajorGenre</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span></span></span></code></pre></div><p>Here we use a <a href="https://docs.microsoft.com/en-us/dotnet/api/system.collections.generic.hashset-1?view=netframework-4.8" rel=external target=_blank>HashSet</a> instead of a list, as it only adds each unique item once. Duplicates are ignored.</p><p>But where would this code go? We could place it in a getter for <code>MovieDatabase.Genres</code>:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-csharp data-lang=csharp><span class=line><span class=cl>    <span class=kd>public</span> <span class=n>IEnumerable</span><span class=p>&lt;</span><span class=kt>string</span><span class=p>&gt;</span> <span class=n>Genres</span> 
</span></span><span class=line><span class=cl>    <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=k>get</span> 
</span></span><span class=line><span class=cl>        <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=n>HashSet</span><span class=p>&lt;</span><span class=kt>string</span><span class=p>&gt;</span> <span class=n>genres</span> <span class=p>=</span> <span class=k>new</span> <span class=n>HashSet</span><span class=p>&lt;</span><span class=kt>string</span><span class=p>&gt;();</span>
</span></span><span class=line><span class=cl>            <span class=k>foreach</span><span class=p>(</span><span class=n>Movie</span> <span class=n>movie</span> <span class=k>in</span> <span class=n>All</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>                <span class=k>if</span><span class=p>(</span><span class=n>movie</span><span class=p>.</span><span class=n>MajorGenre</span> <span class=p>!=</span> <span class=kc>null</span><span class=p>)</span> 
</span></span><span class=line><span class=cl>                <span class=p>{</span>
</span></span><span class=line><span class=cl>                    <span class=n>genres</span><span class=p>.</span><span class=n>Add</span><span class=p>(</span><span class=n>movie</span><span class=p>.</span><span class=n>MajorGenre</span><span class=p>);</span>
</span></span><span class=line><span class=cl>                <span class=p>}</span>
</span></span><span class=line><span class=cl>            <span class=p>}</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span></span></span></code></pre></div><p>But this means that every time we want to access it, we&rsquo;ll search through all the movies&mldr; This is an O(n) operation, and will make our website slower.</p><p>Instead, let&rsquo;s create a private static variable in the <code>MovieDatabase</code> class to <em>cache</em> this collection as an array of strings:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-csharp data-lang=csharp><span class=line><span class=cl>    <span class=c1>// The genres represented in the database</span>
</span></span><span class=line><span class=cl>    <span class=kd>private</span> <span class=kd>static</span> <span class=kt>string</span><span class=p>[]</span> <span class=n>_genres</span><span class=p>;</span></span></span></code></pre></div><p>And expose it with a public static property:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-csharp data-lang=csharp><span class=line><span class=cl>    <span class=cs>/// &lt;summary&gt;</span>
</span></span><span class=line><span class=cl>    <span class=cs>/// Gets the movie genres represented in the database </span>
</span></span><span class=line><span class=cl>    <span class=cs>/// &lt;/summary&gt;</span>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=kd>static</span> <span class=kt>string</span><span class=p>[]</span> <span class=n>Genres</span> <span class=p>=&gt;</span> <span class=n>_genres</span><span class=p>;</span></span></span></code></pre></div><p>And finally, we&rsquo;ll populate this array in the static constructor of <code>MovieDatabase</code>, after the JSON file has been processed:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-csharp data-lang=csharp><span class=line><span class=cl>    <span class=n>HashSet</span><span class=p>&lt;</span><span class=kt>string</span><span class=p>&gt;</span> <span class=n>genreSet</span> <span class=p>=</span> <span class=k>new</span> <span class=n>HashSet</span><span class=p>&lt;</span><span class=kt>string</span><span class=p>&gt;();</span>
</span></span><span class=line><span class=cl>    <span class=k>foreach</span><span class=p>(</span><span class=n>Movie</span> <span class=n>movie</span> <span class=k>in</span> <span class=n>_movies</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span><span class=p>(</span><span class=n>movie</span><span class=p>.</span><span class=n>MajorGenre</span> <span class=p>!=</span> <span class=kc>null</span><span class=p>)</span> 
</span></span><span class=line><span class=cl>        <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=n>genreSet</span><span class=p>.</span><span class=n>Add</span><span class=p>(</span><span class=n>movie</span><span class=p>.</span><span class=n>MajorGenre</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=n>_genres</span> <span class=p>=</span> <span class=n>genreSet</span><span class=p>.</span><span class=n>ToArray</span><span class=p>();</span></span></span></code></pre></div><p>This approach means the finding of genres only happens once, and getting the <code>Genre</code> property is a constant-time O(1) operation.</p><p>We can implement the filters for the genres in the same way as we did for the MPAA filters; I&rsquo;ll leave that as an exercise for the reader.</p><footer class=footline></footer></article><article class=default><header class=headline></header><h1 id=adding-categorical-filters-to-the-movie-site>Adding Categorical Filters to the Movie Site</h1><p>Let&rsquo;s add some filters to the page as well. We&rsquo;ll start with <em>categorical</em> filters, i.e. filtering by category. Let&rsquo;s start by filtering for MPAA Rating. We know that there are only a handful of ratings issued by the Motion Picture Association of America - G, PG, PG-13, R, and NC-17. We might be tempted to use an enumeration to represent these values, but in C# an enumeration cannot have strings for values. Nor can we use the hyphen (<code>-</code>) in an enumeration name.</p><h2 id=defining-the-mpaa-ratings>Defining the MPAA Ratings</h2><p>So let&rsquo;s define a string array with our MPAA values, and make it accessible from our <code>MovieDatabase</code> class:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-csharp data-lang=csharp><span class=line><span class=cl>    <span class=cs>/// &lt;summary&gt;</span>
</span></span><span class=line><span class=cl>    <span class=cs>/// Gets the possible MPAARatings</span>
</span></span><span class=line><span class=cl>    <span class=cs>/// &lt;/summary&gt;</span>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=kd>static</span> <span class=kt>string</span><span class=p>[]</span> <span class=n>MPAARatings</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=k>get</span> <span class=p>=&gt;</span> <span class=k>new</span> <span class=kt>string</span><span class=p>[]</span>
</span></span><span class=line><span class=cl>        <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=s>&#34;G&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=s>&#34;PG&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=s>&#34;PG-13&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=s>&#34;R&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=s>&#34;NC-17&#34;</span>
</span></span><span class=line><span class=cl>        <span class=p>};</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span></span></span></code></pre></div><p>Now in our <code>&lt;form></code> in <em>Index.cshtml</em> we can add a checkbox for each of these possible values:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-html data-lang=html><span class=line><span class=cl><span class=p>&lt;</span><span class=nt>form</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>   <span class=p>&lt;</span><span class=nt>input</span> <span class=na>type</span><span class=o>=</span><span class=s>&#34;text&#34;</span> <span class=na>name</span><span class=o>=</span><span class=s>&#34;SearchTerms&#34;</span> <span class=na>value</span><span class=o>=</span><span class=s>&#34;@Model.SearchTerms&#34;</span><span class=p>/&gt;</span>
</span></span><span class=line><span class=cl>    <span class=p>&lt;</span><span class=nt>input</span> <span class=na>type</span><span class=o>=</span><span class=s>&#34;submit&#34;</span> <span class=na>value</span><span class=o>=</span><span class=s>&#34;Search&#34;</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>    @foreach  (string rating in MovieDatabase.MPAARatings) 
</span></span><span class=line><span class=cl>    {
</span></span><span class=line><span class=cl>        <span class=p>&lt;</span><span class=nt>label</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>            <span class=p>&lt;</span><span class=nt>input</span> <span class=na>type</span><span class=o>=</span><span class=s>&#34;checkbox&#34;</span> <span class=na>name</span><span class=o>=</span><span class=s>&#34;MPAARatings&#34;</span> <span class=na>value</span><span class=o>=</span><span class=s>&#34;@rating&#34;</span><span class=p>/&gt;</span>
</span></span><span class=line><span class=cl>            @rating
</span></span><span class=line><span class=cl>        <span class=p>&lt;/</span><span class=nt>label</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>    }
</span></span><span class=line><span class=cl><span class=p>&lt;/</span><span class=nt>form</span><span class=p>&gt;</span></span></span></code></pre></div><p>If you try running the project now, and check a few boxes, you&rsquo;ll see the query string results look something like:</p><div class=highlight><pre tabindex=0><code>?SearchTerms=&amp;MPAARatings=G&amp;MPAARatings=PG-13</code></pre></div><p>Notice how the key <em>MPAARatings</em> is repeated twice? What would that look like in our PageModel? We can find out; declare a <code>var</code> to hold the value in the <code>OnGet()</code> method of <em>Index.cshtml.cs</em>:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-csharp data-lang=csharp><span class=line><span class=cl>    <span class=kt>var</span> <span class=n>MPAARatings</span> <span class=p>=</span> <span class=n>Request</span><span class=p>.</span><span class=n>Query</span><span class=p>[</span><span class=s>&#34;MPAARatings&#34;</span><span class=p>];</span></span></span></code></pre></div><p>If we add a breakpoint on this line, and run our code, then check several boxes (you&rsquo;ll have to <em>continue</em> the first time you hit the breakpoint), then step over the line, we&rsquo;ll see that the var <code>MPAA</code> rating is set to a <em>string collection</em>. We could therefore store it in an array property in <em>Index.cshtml.cs</em>, much like we did with our <code>SearchTerms</code>:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-csharp data-lang=csharp><span class=line><span class=cl>    <span class=cs>/// &lt;summary&gt;</span>
</span></span><span class=line><span class=cl>    <span class=cs>/// The filtered MPAA Ratings</span>
</span></span><span class=line><span class=cl>    <span class=cs>/// &lt;/summary&gt;</span>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=kt>string</span><span class=p>[]</span> <span class=n>MPAARatings</span> <span class=p>{</span> <span class=k>get</span><span class=p>;</span> <span class=k>set</span><span class=p>;</span> <span class=p>}</span></span></span></code></pre></div><p>And we can refactor the line we just added to <code>OnGet()</code> to use this new property:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-csharp data-lang=csharp><span class=line><span class=cl>    <span class=n>MPAARatings</span> <span class=p>=</span> <span class=n>Request</span><span class=p>.</span><span class=n>Query</span><span class=p>[</span><span class=s>&#34;MPAARatings&#34;</span><span class=p>];</span></span></span></code></pre></div><p>Then, in our <em>Index.cshtml</em> Razor Page, we can refactor the checkbox to be checked if we filtered against this rating in our last request:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-html data-lang=html><span class=line><span class=cl>    <span class=p>&lt;</span><span class=nt>input</span> <span class=na>type</span><span class=o>=</span><span class=s>&#34;checkbox&#34;</span> <span class=na>name</span><span class=o>=</span><span class=s>&#34;MPAARatings&#34;</span> <span class=na>value</span><span class=o>=</span><span class=s>&#34;@rating&#34;</span> <span class=na>checked</span><span class=o>=</span><span class=s>&#34;@Model.MPAARatings.Contains(rating)&#34;</span><span class=p>/&gt;</span></span></span></code></pre></div><p>Now our filters stick around when we submit the search request. That just leaves making the filters actually <em>work</em>.</p><h2 id=applying-mpaa-rating-filters>Applying MPAA Rating Filters</h2><p>Let&rsquo;s add another method to our <code>MovieDatabase</code> class, <code>FilterByMPAARating()</code>:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-csharp data-lang=csharp><span class=line><span class=cl>    <span class=cs>/// &lt;summary&gt;</span>
</span></span><span class=line><span class=cl>    <span class=cs>/// Filters the provided collection of movies</span>
</span></span><span class=line><span class=cl>    <span class=cs>/// &lt;/summary&gt;</span>
</span></span><span class=line><span class=cl>    <span class=cs>/// &lt;param name=&#34;movies&#34;&gt;The collection of movies to filter&lt;/param&gt;</span>
</span></span><span class=line><span class=cl>    <span class=cs>/// &lt;param name=&#34;ratings&#34;&gt;The ratings to include&lt;/param&gt;</span>
</span></span><span class=line><span class=cl>    <span class=cs>/// &lt;returns&gt;A collection containing only movies that match the filter&lt;/returns&gt;</span>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=kd>static</span> <span class=n>IEnumerable</span><span class=p>&lt;</span><span class=n>Movie</span><span class=p>&gt;</span> <span class=n>FilterByMPAARating</span><span class=p>(</span><span class=n>IEnumerable</span><span class=p>&lt;</span><span class=n>Movie</span><span class=p>&gt;</span> <span class=n>movies</span><span class=p>,</span> <span class=n>IEnumerable</span><span class=p>&lt;</span><span class=kt>string</span><span class=p>&gt;</span> <span class=n>ratings</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=c1>// TODO: Filter the list</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=p>}</span></span></span></code></pre></div><p>Notice that in <em>this</em> method, we accept an <code>IEnumerable&lt;Movie></code> parameter. This is the list of movies we want to filter. We use this, instead of the <code>All()</code> we did in the <code>Search()</code> method, as we would want to filter the <em>results</em> of a search.</p><p>Let&rsquo;s do a null/empty check, and just return this shortlist if no filters are specified:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-csharp data-lang=csharp><span class=line><span class=cl>    <span class=c1>// If no filter is specified, just return the provided collection</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=p>(</span><span class=n>ratings</span> <span class=p>==</span> <span class=kc>null</span> <span class=p>||</span> <span class=n>ratings</span><span class=p>.</span><span class=n>Count</span><span class=p>()</span> <span class=p>==</span> <span class=m>0</span><span class=p>)</span> <span class=k>return</span> <span class=n>movies</span><span class=p>;</span></span></span></code></pre></div><p>Otherwise, we&rsquo;ll use the same process we did before. Start with an empty list of movies, and iterate over the collection seeing if any match. However, as we have <em>two</em> collections (the movies <em>and</em> the ratings), we&rsquo;ll see if the ratings collection contains the supplied movie&rsquo;s rating.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-csharp data-lang=csharp><span class=line><span class=cl>    <span class=c1>// Filter the supplied collection of movies</span>
</span></span><span class=line><span class=cl>    <span class=n>List</span><span class=p>&lt;</span><span class=n>Movie</span><span class=p>&gt;</span> <span class=n>results</span> <span class=p>=</span> <span class=k>new</span> <span class=n>List</span><span class=p>&lt;</span><span class=n>Movie</span><span class=p>&gt;();</span>
</span></span><span class=line><span class=cl>    <span class=k>foreach</span><span class=p>(</span><span class=n>Movie</span> <span class=n>movie</span> <span class=k>in</span> <span class=n>movies</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span><span class=p>(</span><span class=n>movie</span><span class=p>.</span><span class=n>MPAARating</span> <span class=p>!=</span> <span class=kc>null</span> <span class=p>&amp;&amp;</span> <span class=n>ratings</span><span class=p>.</span><span class=n>Contains</span><span class=p>(</span><span class=n>movie</span><span class=p>.</span><span class=n>MPAARating</span><span class=p>))</span>
</span></span><span class=line><span class=cl>        <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=n>results</span><span class=p>.</span><span class=n>Add</span><span class=p>(</span><span class=n>movie</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span></span></span></code></pre></div><p>Finally, we&rsquo;ll return our results:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-csharp data-lang=csharp><span class=line><span class=cl>    <span class=k>return</span> <span class=n>results</span><span class=p>;</span></span></span></code></pre></div><p>Now, back in our PageModel <em>Index.cshtml.cs</em>, we&rsquo;ll apply our filter to the results of our search. The refactored <code>OnGet()</code> should then be:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-csharp data-lang=csharp><span class=line><span class=cl>    <span class=kd>public</span> <span class=k>void</span> <span class=n>OnGet</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=n>SearchTerms</span> <span class=p>=</span> <span class=n>Request</span><span class=p>.</span><span class=n>Query</span><span class=p>[</span><span class=s>&#34;SearchTerms&#34;</span><span class=p>];</span>
</span></span><span class=line><span class=cl>        <span class=n>MPAARatings</span> <span class=p>=</span> <span class=n>Request</span><span class=p>.</span><span class=n>Query</span><span class=p>[</span><span class=s>&#34;MPAARatings&#34;</span><span class=p>];</span>
</span></span><span class=line><span class=cl>        <span class=n>Movies</span> <span class=p>=</span> <span class=n>MovieDatabase</span><span class=p>.</span><span class=n>Search</span><span class=p>(</span><span class=n>SearchTerms</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=n>Movies</span> <span class=p>=</span> <span class=n>MovieDatabase</span><span class=p>.</span><span class=n>FilterByMPAARating</span><span class=p>(</span><span class=n>Movies</span><span class=p>,</span> <span class=n>MPAARatings</span><span class=p>);</span>        
</span></span><span class=line><span class=cl>    <span class=p>}</span></span></span></code></pre></div><p>Now we can run a search with filters applied. For example, searching for the word &ldquo;Love&rdquo; and movies that are PG or PG-13 yields:</p><p><a href=#R-image-8b828e08e6de3c1ec79db2b272ce0e1f class=lightbox-link><img alt="Filtered Search Results" class="border lazy lightbox noshadow figure-image" loading=lazy src=/cis400/images/6.8.4.png style=height:auto;width:auto></a>
<a href=javascript:history.back(); class=lightbox-back id=R-image-8b828e08e6de3c1ec79db2b272ce0e1f><img alt="Filtered Search Results" class="border lazy lightbox noshadow lightbox-image" loading=lazy src=/cis400/images/6.8.4.png></a></p><p>You might be wondering why <em>Cloverfield</em> is listed. But remember, we&rsquo;re searching by substring, and C <strong>LOVE</strong> rfield contains love!</p><h2 id=filtering-by-genre>Filtering by Genre</h2><p>Let&rsquo;s add filters for genre next. But what genres should be included? This is not as clear-cut as our MPAA rating, as there is no standards organization that says &ldquo;these are the only offical genres that exist.&rdquo; In fact, new genres emerge from time to time. So a better source of this info might just be to see what Genres are defined in our data, i.e.:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-csharp data-lang=csharp><span class=line><span class=cl>    <span class=n>HashSet</span><span class=p>&lt;</span><span class=kt>string</span><span class=p>&gt;</span> <span class=n>genres</span> <span class=p>=</span> <span class=k>new</span> <span class=n>HashSet</span><span class=p>&lt;</span><span class=kt>string</span><span class=p>&gt;();</span>
</span></span><span class=line><span class=cl>    <span class=k>foreach</span><span class=p>(</span><span class=n>Movie</span> <span class=n>movie</span> <span class=k>in</span> <span class=n>All</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span><span class=p>(</span><span class=n>movie</span><span class=p>.</span><span class=n>MajorGenre</span> <span class=p>!=</span> <span class=kc>null</span><span class=p>)</span> 
</span></span><span class=line><span class=cl>        <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=n>genres</span><span class=p>.</span><span class=n>Add</span><span class=p>(</span><span class=n>movie</span><span class=p>.</span><span class=n>MajorGenre</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span></span></span></code></pre></div><p>Here we use a <a href="https://docs.microsoft.com/en-us/dotnet/api/system.collections.generic.hashset-1?view=netframework-4.8" rel=external target=_blank>HashSet</a> instead of a list, as it only adds each unique item once. Duplicates are ignored.</p><p>But where would this code go? We could place it in a getter for <code>MovieDatabase.Genres</code>:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-csharp data-lang=csharp><span class=line><span class=cl>    <span class=kd>public</span> <span class=n>IEnumerable</span><span class=p>&lt;</span><span class=kt>string</span><span class=p>&gt;</span> <span class=n>Genres</span> 
</span></span><span class=line><span class=cl>    <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=k>get</span> 
</span></span><span class=line><span class=cl>        <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=n>HashSet</span><span class=p>&lt;</span><span class=kt>string</span><span class=p>&gt;</span> <span class=n>genres</span> <span class=p>=</span> <span class=k>new</span> <span class=n>HashSet</span><span class=p>&lt;</span><span class=kt>string</span><span class=p>&gt;();</span>
</span></span><span class=line><span class=cl>            <span class=k>foreach</span><span class=p>(</span><span class=n>Movie</span> <span class=n>movie</span> <span class=k>in</span> <span class=n>All</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>                <span class=k>if</span><span class=p>(</span><span class=n>movie</span><span class=p>.</span><span class=n>MajorGenre</span> <span class=p>!=</span> <span class=kc>null</span><span class=p>)</span> 
</span></span><span class=line><span class=cl>                <span class=p>{</span>
</span></span><span class=line><span class=cl>                    <span class=n>genres</span><span class=p>.</span><span class=n>Add</span><span class=p>(</span><span class=n>movie</span><span class=p>.</span><span class=n>MajorGenre</span><span class=p>);</span>
</span></span><span class=line><span class=cl>                <span class=p>}</span>
</span></span><span class=line><span class=cl>            <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>            <span class=k>return</span> <span class=n>genres</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span></span></span></code></pre></div><p>But this means that every time we want to access it, we&rsquo;ll search through all the movies&mldr; This is an O(n) operation, and will make our website slower.</p><p>Instead, let&rsquo;s create a private static variable in the <code>MovieDatabase</code> class to <em>cache</em> this collection as an array of strings:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-csharp data-lang=csharp><span class=line><span class=cl>    <span class=c1>// The genres represented in the database</span>
</span></span><span class=line><span class=cl>    <span class=kd>private</span> <span class=kd>static</span> <span class=kt>string</span><span class=p>[]</span> <span class=n>_genres</span><span class=p>;</span></span></span></code></pre></div><p>And expose it with a public static property:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-csharp data-lang=csharp><span class=line><span class=cl>    <span class=cs>/// &lt;summary&gt;</span>
</span></span><span class=line><span class=cl>    <span class=cs>/// Gets the movie genres represented in the database </span>
</span></span><span class=line><span class=cl>    <span class=cs>/// &lt;/summary&gt;</span>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=kd>static</span> <span class=kt>string</span><span class=p>[]</span> <span class=n>Genres</span> <span class=p>=&gt;</span> <span class=n>_genres</span><span class=p>;</span></span></span></code></pre></div><p>And finally, we&rsquo;ll populate this array in the static constructor of <code>MovieDatabase</code>, after the JSON file has been processed:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-csharp data-lang=csharp><span class=line><span class=cl>    <span class=n>HashSet</span><span class=p>&lt;</span><span class=kt>string</span><span class=p>&gt;</span> <span class=n>genreSet</span> <span class=p>=</span> <span class=k>new</span> <span class=n>HashSet</span><span class=p>&lt;</span><span class=kt>string</span><span class=p>&gt;();</span>
</span></span><span class=line><span class=cl>    <span class=k>foreach</span><span class=p>(</span><span class=n>Movie</span> <span class=n>movie</span> <span class=k>in</span> <span class=n>_movies</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span><span class=p>(</span><span class=n>movie</span><span class=p>.</span><span class=n>MajorGenre</span> <span class=p>!=</span> <span class=kc>null</span><span class=p>)</span> 
</span></span><span class=line><span class=cl>        <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=n>genreSet</span><span class=p>.</span><span class=n>Add</span><span class=p>(</span><span class=n>movie</span><span class=p>.</span><span class=n>MajorGenre</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=n>_genres</span> <span class=p>=</span> <span class=n>genreSet</span><span class=p>.</span><span class=n>ToArray</span><span class=p>();</span></span></span></code></pre></div><p>This approach means the finding of genres only happens once, and getting the <code>Genre</code> property is a constant-time O(1) operation.</p><p>We can implement the filters for the genres in the same way as we did for the MPAA filters; I&rsquo;ll leave that as an exercise for the reader.</p><footer class=footline></footer></article><article class=default><header class=headline></header><h1 id=adding-categorical-filters-to-the-movie-site>Adding Categorical Filters to the Movie Site</h1><p>Let&rsquo;s add some filters to the page as well. We&rsquo;ll start with <em>categorical</em> filters, i.e. filtering by category. Let&rsquo;s start by filtering for MPAA Rating. We know that there are only a handful of ratings issued by the Motion Picture Association of America - G, PG, PG-13, R, and NC-17. We might be tempted to use an enumeration to represent these values, but in C# an enumeration cannot have strings for values. Nor can we use the hyphen (<code>-</code>) in an enumeration name.</p><h2 id=defining-the-mpaa-ratings>Defining the MPAA Ratings</h2><p>So let&rsquo;s define a string array with our MPAA values, and make it accessible from our <code>MovieDatabase</code> class:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-csharp data-lang=csharp><span class=line><span class=cl>    <span class=cs>/// &lt;summary&gt;</span>
</span></span><span class=line><span class=cl>    <span class=cs>/// Gets the possible MPAARatings</span>
</span></span><span class=line><span class=cl>    <span class=cs>/// &lt;/summary&gt;</span>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=kd>static</span> <span class=kt>string</span><span class=p>[]</span> <span class=n>MPAARatings</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=k>get</span> <span class=p>=&gt;</span> <span class=k>new</span> <span class=kt>string</span><span class=p>[]</span>
</span></span><span class=line><span class=cl>        <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=s>&#34;G&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=s>&#34;PG&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=s>&#34;PG-13&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=s>&#34;R&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=s>&#34;NC-17&#34;</span>
</span></span><span class=line><span class=cl>        <span class=p>};</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span></span></span></code></pre></div><p>Now in our <code>&lt;form></code> in <em>Index.cshtml</em> we can add a checkbox for each of these possible values:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-html data-lang=html><span class=line><span class=cl><span class=p>&lt;</span><span class=nt>form</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>   <span class=p>&lt;</span><span class=nt>input</span> <span class=na>type</span><span class=o>=</span><span class=s>&#34;text&#34;</span> <span class=na>name</span><span class=o>=</span><span class=s>&#34;SearchTerms&#34;</span> <span class=na>value</span><span class=o>=</span><span class=s>&#34;@Model.SearchTerms&#34;</span><span class=p>/&gt;</span>
</span></span><span class=line><span class=cl>    <span class=p>&lt;</span><span class=nt>input</span> <span class=na>type</span><span class=o>=</span><span class=s>&#34;submit&#34;</span> <span class=na>value</span><span class=o>=</span><span class=s>&#34;Search&#34;</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>    @foreach  (string rating in MovieDatabase.MPAARatings) 
</span></span><span class=line><span class=cl>    {
</span></span><span class=line><span class=cl>        <span class=p>&lt;</span><span class=nt>label</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>            <span class=p>&lt;</span><span class=nt>input</span> <span class=na>type</span><span class=o>=</span><span class=s>&#34;checkbox&#34;</span> <span class=na>name</span><span class=o>=</span><span class=s>&#34;MPAARatings&#34;</span> <span class=na>value</span><span class=o>=</span><span class=s>&#34;@rating&#34;</span><span class=p>/&gt;</span>
</span></span><span class=line><span class=cl>            @rating
</span></span><span class=line><span class=cl>        <span class=p>&lt;/</span><span class=nt>label</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>    }
</span></span><span class=line><span class=cl><span class=p>&lt;/</span><span class=nt>form</span><span class=p>&gt;</span></span></span></code></pre></div><p>If you try running the project now, and check a few boxes, you&rsquo;ll see the query string results look something like:</p><div class=highlight><pre tabindex=0><code>?SearchTerms=&amp;MPAARatings=G&amp;MPAARatings=PG-13</code></pre></div><p>Notice how the key <em>MPAARatings</em> is repeated twice? What would that look like in our PageModel? We can find out; declare a <code>var</code> to hold the value in the <code>OnGet()</code> method of <em>Index.cshtml.cs</em>:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-csharp data-lang=csharp><span class=line><span class=cl>    <span class=kt>var</span> <span class=n>MPAARatings</span> <span class=p>=</span> <span class=n>Request</span><span class=p>.</span><span class=n>Query</span><span class=p>[</span><span class=s>&#34;MPAARatings&#34;</span><span class=p>];</span></span></span></code></pre></div><p>If we add a breakpoint on this line, and run our code, then check several boxes (you&rsquo;ll have to <em>continue</em> the first time you hit the breakpoint), then step over the line, we&rsquo;ll see that the var <code>MPAA</code> rating is set to a <em>string collection</em>. We could therefore store it in an array property in <em>Index.cshtml.cs</em>, much like we did with our <code>SearchTerms</code>:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-csharp data-lang=csharp><span class=line><span class=cl>    <span class=cs>/// &lt;summary&gt;</span>
</span></span><span class=line><span class=cl>    <span class=cs>/// The filtered MPAA Ratings</span>
</span></span><span class=line><span class=cl>    <span class=cs>/// &lt;/summary&gt;</span>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=kt>string</span><span class=p>[]</span> <span class=n>MPAARatings</span> <span class=p>{</span> <span class=k>get</span><span class=p>;</span> <span class=k>set</span><span class=p>;</span> <span class=p>}</span></span></span></code></pre></div><p>And we can refactor the line we just added to <code>OnGet()</code> to use this new property:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-csharp data-lang=csharp><span class=line><span class=cl>    <span class=n>MPAARatings</span> <span class=p>=</span> <span class=n>Request</span><span class=p>.</span><span class=n>Query</span><span class=p>[</span><span class=s>&#34;MPAARatings&#34;</span><span class=p>];</span></span></span></code></pre></div><p>Then, in our <em>Index.cshtml</em> Razor Page, we can refactor the checkbox to be checked if we filtered against this rating in our last request:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-html data-lang=html><span class=line><span class=cl>    <span class=p>&lt;</span><span class=nt>input</span> <span class=na>type</span><span class=o>=</span><span class=s>&#34;checkbox&#34;</span> <span class=na>name</span><span class=o>=</span><span class=s>&#34;MPAARatings&#34;</span> <span class=na>value</span><span class=o>=</span><span class=s>&#34;@rating&#34;</span> <span class=na>checked</span><span class=o>=</span><span class=s>&#34;@Model.MPAARatings.Contains(rating)&#34;</span><span class=p>/&gt;</span></span></span></code></pre></div><p>Now our filters stick around when we submit the search request. That just leaves making the filters actually <em>work</em>.</p><h2 id=applying-mpaa-rating-filters>Applying MPAA Rating Filters</h2><p>Let&rsquo;s add another method to our <code>MovieDatabase</code> class, <code>FilterByMPAARating()</code>:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-csharp data-lang=csharp><span class=line><span class=cl>    <span class=cs>/// &lt;summary&gt;</span>
</span></span><span class=line><span class=cl>    <span class=cs>/// Filters the provided collection of movies</span>
</span></span><span class=line><span class=cl>    <span class=cs>/// &lt;/summary&gt;</span>
</span></span><span class=line><span class=cl>    <span class=cs>/// &lt;param name=&#34;movies&#34;&gt;The collection of movies to filter&lt;/param&gt;</span>
</span></span><span class=line><span class=cl>    <span class=cs>/// &lt;param name=&#34;ratings&#34;&gt;The ratings to include&lt;/param&gt;</span>
</span></span><span class=line><span class=cl>    <span class=cs>/// &lt;returns&gt;A collection containing only movies that match the filter&lt;/returns&gt;</span>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=kd>static</span> <span class=n>IEnumerable</span><span class=p>&lt;</span><span class=n>Movie</span><span class=p>&gt;</span> <span class=n>FilterByMPAARating</span><span class=p>(</span><span class=n>IEnumerable</span><span class=p>&lt;</span><span class=n>Movie</span><span class=p>&gt;</span> <span class=n>movies</span><span class=p>,</span> <span class=n>IEnumerable</span><span class=p>&lt;</span><span class=kt>string</span><span class=p>&gt;</span> <span class=n>ratings</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=c1>// TODO: Filter the list</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=p>}</span></span></span></code></pre></div><p>Notice that in <em>this</em> method, we accept an <code>IEnumerable&lt;Movie></code> parameter. This is the list of movies we want to filter. We use this, instead of the <code>All()</code> we did in the <code>Search()</code> method, as we would want to filter the <em>results</em> of a search.</p><p>Let&rsquo;s do a null/empty check, and just return this shortlist if no filters are specified:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-csharp data-lang=csharp><span class=line><span class=cl>    <span class=c1>// If no filter is specified, just return the provided collection</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=p>(</span><span class=n>ratings</span> <span class=p>==</span> <span class=kc>null</span> <span class=p>||</span> <span class=n>ratings</span><span class=p>.</span><span class=n>Count</span><span class=p>()</span> <span class=p>==</span> <span class=m>0</span><span class=p>)</span> <span class=k>return</span> <span class=n>movies</span><span class=p>;</span></span></span></code></pre></div><p>Otherwise, we&rsquo;ll use the same process we did before. Start with an empty list of movies, and iterate over the collection seeing if any match. However, as we have <em>two</em> collections (the movies <em>and</em> the ratings), we&rsquo;ll see if the ratings collection contains the supplied movie&rsquo;s rating.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-csharp data-lang=csharp><span class=line><span class=cl>    <span class=c1>// Filter the supplied collection of movies</span>
</span></span><span class=line><span class=cl>    <span class=n>List</span><span class=p>&lt;</span><span class=n>Movie</span><span class=p>&gt;</span> <span class=n>results</span> <span class=p>=</span> <span class=k>new</span> <span class=n>List</span><span class=p>&lt;</span><span class=n>Movie</span><span class=p>&gt;();</span>
</span></span><span class=line><span class=cl>    <span class=k>foreach</span><span class=p>(</span><span class=n>Movie</span> <span class=n>movie</span> <span class=k>in</span> <span class=n>movies</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span><span class=p>(</span><span class=n>movie</span><span class=p>.</span><span class=n>MPAARating</span> <span class=p>!=</span> <span class=kc>null</span> <span class=p>&amp;&amp;</span> <span class=n>ratings</span><span class=p>.</span><span class=n>Contains</span><span class=p>(</span><span class=n>movie</span><span class=p>.</span><span class=n>MPAARating</span><span class=p>))</span>
</span></span><span class=line><span class=cl>        <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=n>results</span><span class=p>.</span><span class=n>Add</span><span class=p>(</span><span class=n>movie</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span></span></span></code></pre></div><p>Finally, we&rsquo;ll return our results:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-csharp data-lang=csharp><span class=line><span class=cl>    <span class=k>return</span> <span class=n>results</span><span class=p>;</span></span></span></code></pre></div><p>Now, back in our PageModel <em>Index.cshtml.cs</em>, we&rsquo;ll apply our filter to the results of our search. The refactored <code>OnGet()</code> should then be:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-csharp data-lang=csharp><span class=line><span class=cl>    <span class=kd>public</span> <span class=k>void</span> <span class=n>OnGet</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=n>SearchTerms</span> <span class=p>=</span> <span class=n>Request</span><span class=p>.</span><span class=n>Query</span><span class=p>[</span><span class=s>&#34;SearchTerms&#34;</span><span class=p>];</span>
</span></span><span class=line><span class=cl>        <span class=n>MPAARatings</span> <span class=p>=</span> <span class=n>Request</span><span class=p>.</span><span class=n>Query</span><span class=p>[</span><span class=s>&#34;MPAARatings&#34;</span><span class=p>];</span>
</span></span><span class=line><span class=cl>        <span class=n>Movies</span> <span class=p>=</span> <span class=n>MovieDatabase</span><span class=p>.</span><span class=n>Search</span><span class=p>(</span><span class=n>SearchTerms</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=n>Movies</span> <span class=p>=</span> <span class=n>MovieDatabase</span><span class=p>.</span><span class=n>FilterByMPAARating</span><span class=p>(</span><span class=n>Movies</span><span class=p>,</span> <span class=n>MPAARatings</span><span class=p>);</span>        
</span></span><span class=line><span class=cl>    <span class=p>}</span></span></span></code></pre></div><p>Now we can run a search with filters applied. For example, searching for the word &ldquo;Love&rdquo; and movies that are PG or PG-13 yields:</p><p><a href=#R-image-d73f007888e30f911788056de78449c8 class=lightbox-link><img alt="Filtered Search Results" class="border lazy lightbox noshadow figure-image" loading=lazy src=/cis400/images/6.8.4.png style=height:auto;width:auto></a>
<a href=javascript:history.back(); class=lightbox-back id=R-image-d73f007888e30f911788056de78449c8><img alt="Filtered Search Results" class="border lazy lightbox noshadow lightbox-image" loading=lazy src=/cis400/images/6.8.4.png></a></p><p>You might be wondering why <em>Cloverfield</em> is listed. But remember, we&rsquo;re searching by substring, and C <strong>LOVE</strong> rfield contains love!</p><h2 id=filtering-by-genre>Filtering by Genre</h2><p>Let&rsquo;s add filters for genre next. But what genres should be included? This is not as clear-cut as our MPAA rating, as there is no standards organization that says &ldquo;these are the only offical genres that exist.&rdquo; In fact, new genres emerge from time to time. So a better source of this info might just be to see what Genres are defined in our data, i.e.:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-csharp data-lang=csharp><span class=line><span class=cl>    <span class=n>HashSet</span><span class=p>&lt;</span><span class=kt>string</span><span class=p>&gt;</span> <span class=n>genres</span> <span class=p>=</span> <span class=k>new</span> <span class=n>HashSet</span><span class=p>&lt;</span><span class=kt>string</span><span class=p>&gt;();</span>
</span></span><span class=line><span class=cl>    <span class=k>foreach</span><span class=p>(</span><span class=n>Movie</span> <span class=n>movie</span> <span class=k>in</span> <span class=n>All</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span><span class=p>(</span><span class=n>movie</span><span class=p>.</span><span class=n>MajorGenre</span> <span class=p>!=</span> <span class=kc>null</span><span class=p>)</span> 
</span></span><span class=line><span class=cl>        <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=n>genres</span><span class=p>.</span><span class=n>Add</span><span class=p>(</span><span class=n>movie</span><span class=p>.</span><span class=n>MajorGenre</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span></span></span></code></pre></div><p>Here we use a <a href="https://docs.microsoft.com/en-us/dotnet/api/system.collections.generic.hashset-1?view=netframework-4.8" rel=external target=_blank>HashSet</a> instead of a list, as it only adds each unique item once. Duplicates are ignored.</p><p>But where would this code go? We could place it in a getter for <code>MovieDatabase.Genres</code>:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-csharp data-lang=csharp><span class=line><span class=cl>    <span class=kd>public</span> <span class=kd>static</span> <span class=n>IEnumerable</span><span class=p>&lt;</span><span class=kt>string</span><span class=p>&gt;</span> <span class=n>Genres</span> 
</span></span><span class=line><span class=cl>    <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=k>get</span> 
</span></span><span class=line><span class=cl>        <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=n>HashSet</span><span class=p>&lt;</span><span class=kt>string</span><span class=p>&gt;</span> <span class=n>genres</span> <span class=p>=</span> <span class=k>new</span> <span class=n>HashSet</span><span class=p>&lt;</span><span class=kt>string</span><span class=p>&gt;();</span>
</span></span><span class=line><span class=cl>            <span class=k>foreach</span><span class=p>(</span><span class=n>Movie</span> <span class=n>movie</span> <span class=k>in</span> <span class=n>All</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>                <span class=k>if</span><span class=p>(</span><span class=n>movie</span><span class=p>.</span><span class=n>MajorGenre</span> <span class=p>!=</span> <span class=kc>null</span><span class=p>)</span> 
</span></span><span class=line><span class=cl>                <span class=p>{</span>
</span></span><span class=line><span class=cl>                    <span class=n>genres</span><span class=p>.</span><span class=n>Add</span><span class=p>(</span><span class=n>movie</span><span class=p>.</span><span class=n>MajorGenre</span><span class=p>);</span>
</span></span><span class=line><span class=cl>                <span class=p>}</span>
</span></span><span class=line><span class=cl>            <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>            <span class=k>return</span> <span class=n>genres</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span></span></span></code></pre></div><p>But this means that every time we want to access it, we&rsquo;ll search through all the movies&mldr; This is an O(n) operation, and will make our website slower.</p><p>Instead, let&rsquo;s create a private static variable in the <code>MovieDatabase</code> class to <em>cache</em> this collection as an array of strings:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-csharp data-lang=csharp><span class=line><span class=cl>    <span class=c1>// The genres represented in the database</span>
</span></span><span class=line><span class=cl>    <span class=kd>private</span> <span class=kd>static</span> <span class=kt>string</span><span class=p>[]</span> <span class=n>_genres</span><span class=p>;</span></span></span></code></pre></div><p>And expose it with a public static property:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-csharp data-lang=csharp><span class=line><span class=cl>    <span class=cs>/// &lt;summary&gt;</span>
</span></span><span class=line><span class=cl>    <span class=cs>/// Gets the movie genres represented in the database </span>
</span></span><span class=line><span class=cl>    <span class=cs>/// &lt;/summary&gt;</span>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=kd>static</span> <span class=kt>string</span><span class=p>[]</span> <span class=n>Genres</span> <span class=p>=&gt;</span> <span class=n>_genres</span><span class=p>;</span></span></span></code></pre></div><p>And finally, we&rsquo;ll populate this array in the static constructor of <code>MovieDatabase</code>, after the JSON file has been processed:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-csharp data-lang=csharp><span class=line><span class=cl>    <span class=n>HashSet</span><span class=p>&lt;</span><span class=kt>string</span><span class=p>&gt;</span> <span class=n>genreSet</span> <span class=p>=</span> <span class=k>new</span> <span class=n>HashSet</span><span class=p>&lt;</span><span class=kt>string</span><span class=p>&gt;();</span>
</span></span><span class=line><span class=cl>    <span class=k>foreach</span><span class=p>(</span><span class=n>Movie</span> <span class=n>movie</span> <span class=k>in</span> <span class=n>_movies</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span><span class=p>(</span><span class=n>movie</span><span class=p>.</span><span class=n>MajorGenre</span> <span class=p>!=</span> <span class=kc>null</span><span class=p>)</span> 
</span></span><span class=line><span class=cl>        <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=n>genreSet</span><span class=p>.</span><span class=n>Add</span><span class=p>(</span><span class=n>movie</span><span class=p>.</span><span class=n>MajorGenre</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=n>_genres</span> <span class=p>=</span> <span class=n>genreSet</span><span class=p>.</span><span class=n>ToArray</span><span class=p>();</span></span></span></code></pre></div><p>This approach means the finding of genres only happens once, and getting the <code>Genre</code> property is a constant-time O(1) operation.</p><p>We can implement the filters for the genres in the same way as we did for the MPAA filters; I&rsquo;ll leave that as an exercise for the reader.</p><footer class=footline></footer></article><article class=default><header class=headline></header><h1 id=adding-categorical-filters-to-the-movie-site>Adding Categorical Filters to the Movie Site</h1><p>Let&rsquo;s add some filters to the page as well. We&rsquo;ll start with <em>categorical</em> filters, i.e. filtering by category. Let&rsquo;s start by filtering for MPAA Rating. We know that there are only a handful of ratings issued by the Motion Picture Association of America - G, PG, PG-13, R, and NC-17. We might be tempted to use an enumeration to represent these values, but in C# an enumeration cannot have strings for values. Nor can we use the hyphen (<code>-</code>) in an enumeration name.</p><h2 id=defining-the-mpaa-ratings>Defining the MPAA Ratings</h2><p>So let&rsquo;s define a string array with our MPAA values, and make it accessible from our <code>MovieDatabase</code> class:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-csharp data-lang=csharp><span class=line><span class=cl>    <span class=cs>/// &lt;summary&gt;</span>
</span></span><span class=line><span class=cl>    <span class=cs>/// Gets the possible MPAARatings</span>
</span></span><span class=line><span class=cl>    <span class=cs>/// &lt;/summary&gt;</span>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=kd>static</span> <span class=kt>string</span><span class=p>[]</span> <span class=n>MPAARatings</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=k>get</span> <span class=p>=&gt;</span> <span class=k>new</span> <span class=kt>string</span><span class=p>[]</span>
</span></span><span class=line><span class=cl>        <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=s>&#34;G&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=s>&#34;PG&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=s>&#34;PG-13&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=s>&#34;R&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=s>&#34;NC-17&#34;</span>
</span></span><span class=line><span class=cl>        <span class=p>};</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span></span></span></code></pre></div><p>Now in our <code>&lt;form></code> in <em>Index.cshtml</em> we can add a checkbox for each of these possible values:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-html data-lang=html><span class=line><span class=cl><span class=p>&lt;</span><span class=nt>form</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>    @foreach  (string rating in MovieDatabase.MPAARatings) 
</span></span><span class=line><span class=cl>    {
</span></span><span class=line><span class=cl>        <span class=p>&lt;</span><span class=nt>label</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>            <span class=p>&lt;</span><span class=nt>input</span> <span class=na>type</span><span class=o>=</span><span class=s>&#34;checkbox&#34;</span> <span class=na>name</span><span class=o>=</span><span class=s>&#34;MPAARatings&#34;</span> <span class=na>value</span><span class=o>=</span><span class=s>&#34;@rating&#34;</span><span class=p>/&gt;</span>
</span></span><span class=line><span class=cl>            @rating
</span></span><span class=line><span class=cl>        <span class=p>&lt;/</span><span class=nt>label</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>    }
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=p>&lt;</span><span class=nt>input</span> <span class=na>type</span><span class=o>=</span><span class=s>&#34;text&#34;</span> <span class=na>name</span><span class=o>=</span><span class=s>&#34;SearchTerms&#34;</span> <span class=na>value</span><span class=o>=</span><span class=s>&#34;@Model.SearchTerms&#34;</span><span class=p>/&gt;</span>
</span></span><span class=line><span class=cl>    <span class=p>&lt;</span><span class=nt>input</span> <span class=na>type</span><span class=o>=</span><span class=s>&#34;submit&#34;</span> <span class=na>value</span><span class=o>=</span><span class=s>&#34;Search&#34;</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl><span class=p>&lt;/</span><span class=nt>form</span><span class=p>&gt;</span></span></span></code></pre></div><p>If you try running the project now, and check a few boxes, you&rsquo;ll see the query string results look something like:</p><div class=highlight><pre tabindex=0><code>?SearchTerms=&amp;MPAARatings=G&amp;MPAARatings=PG-13</code></pre></div><p>Notice how the key <em>MPAARatings</em> is repeated twice? What would that look like in our PageModel? We can find out; declare a <code>var</code> to hold the value in the <code>OnGet()</code> method of <em>Index.cshtml.cs</em>:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-csharp data-lang=csharp><span class=line><span class=cl>    <span class=kt>var</span> <span class=n>MPAARatings</span> <span class=p>=</span> <span class=n>Request</span><span class=p>.</span><span class=n>Query</span><span class=p>[</span><span class=s>&#34;MPAARatings&#34;</span><span class=p>];</span></span></span></code></pre></div><p>If we add a breakpoint on this line, and run our code, then check several boxes (you&rsquo;ll have to <em>continue</em> the first time you hit the breakpoint), then step over the line, we&rsquo;ll see that the var <code>MPAA</code> rating is set to a <em>string collection</em>. We could therefore store it in an array property in <em>Index.cshtml.cs</em>, much like we did with our <code>SearchTerms</code>:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-csharp data-lang=csharp><span class=line><span class=cl>    <span class=cs>/// &lt;summary&gt;</span>
</span></span><span class=line><span class=cl>    <span class=cs>/// The filtered MPAA Ratings</span>
</span></span><span class=line><span class=cl>    <span class=cs>/// &lt;/summary&gt;</span>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=kt>string</span><span class=p>[]</span> <span class=n>MPAARatings</span> <span class=p>{</span> <span class=k>get</span><span class=p>;</span> <span class=k>set</span><span class=p>;</span> <span class=p>}</span></span></span></code></pre></div><p>And we can refactor the line we just added to <code>OnGet()</code> to use this new property:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-csharp data-lang=csharp><span class=line><span class=cl>    <span class=n>MPAARatings</span> <span class=p>=</span> <span class=n>Request</span><span class=p>.</span><span class=n>Query</span><span class=p>[</span><span class=s>&#34;MPAARatings&#34;</span><span class=p>];</span></span></span></code></pre></div><p>Then, in our <em>Index.cshtml</em> Razor Page, we can refactor the checkbox to be checked if we filtered against this rating in our last request:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-html data-lang=html><span class=line><span class=cl>    <span class=p>&lt;</span><span class=nt>input</span> <span class=na>type</span><span class=o>=</span><span class=s>&#34;checkbox&#34;</span> <span class=na>name</span><span class=o>=</span><span class=s>&#34;MPAARatings&#34;</span> <span class=na>value</span><span class=o>=</span><span class=s>&#34;@rating&#34;</span> <span class=na>checked</span><span class=o>=</span><span class=s>&#34;@Model.MPAARatings.Contains(rating)&#34;</span><span class=p>/&gt;</span></span></span></code></pre></div><p>Now our filters stick around when we submit the search request. That just leaves making the filters actually <em>work</em>.</p><h2 id=applying-mpaa-rating-filters>Applying MPAA Rating Filters</h2><p>Let&rsquo;s add another method to our <code>MovieDatabase</code> class, <code>FilterByMPAARating()</code>:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-csharp data-lang=csharp><span class=line><span class=cl>    <span class=cs>/// &lt;summary&gt;</span>
</span></span><span class=line><span class=cl>    <span class=cs>/// Filters the provided collection of movies</span>
</span></span><span class=line><span class=cl>    <span class=cs>/// &lt;/summary&gt;</span>
</span></span><span class=line><span class=cl>    <span class=cs>/// &lt;param name=&#34;movies&#34;&gt;The collection of movies to filter&lt;/param&gt;</span>
</span></span><span class=line><span class=cl>    <span class=cs>/// &lt;param name=&#34;ratings&#34;&gt;The ratings to include&lt;/param&gt;</span>
</span></span><span class=line><span class=cl>    <span class=cs>/// &lt;returns&gt;A collection containing only movies that match the filter&lt;/returns&gt;</span>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=kd>static</span> <span class=n>IEnumerable</span><span class=p>&lt;</span><span class=n>Movie</span><span class=p>&gt;</span> <span class=n>FilterByMPAARating</span><span class=p>(</span><span class=n>IEnumerable</span><span class=p>&lt;</span><span class=n>Movie</span><span class=p>&gt;</span> <span class=n>movies</span><span class=p>,</span> <span class=n>IEnumerable</span><span class=p>&lt;</span><span class=kt>string</span><span class=p>&gt;</span> <span class=n>ratings</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=c1>// TODO: Filter the list</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=p>}</span></span></span></code></pre></div><p>Notice that in <em>this</em> method, we accept an <code>IEnumerable&lt;Movie></code> parameter. This is the list of movies we want to filter. We use this, instead of the <code>All()</code> we did in the <code>Search()</code> method, as we would want to filter the <em>results</em> of a search.</p><p>Let&rsquo;s do a null/empty check, and just return this shortlist if no filters are specified:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-csharp data-lang=csharp><span class=line><span class=cl>    <span class=c1>// If no filter is specified, just return the provided collection</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=p>(</span><span class=n>ratings</span> <span class=p>==</span> <span class=kc>null</span> <span class=p>||</span> <span class=n>ratings</span><span class=p>.</span><span class=n>Count</span><span class=p>()</span> <span class=p>==</span> <span class=m>0</span><span class=p>)</span> <span class=k>return</span> <span class=n>movies</span><span class=p>;</span></span></span></code></pre></div><p>Otherwise, we&rsquo;ll use the same process we did before. Start with an empty list of movies, and iterate over the collection seeing if any match. However, as we have <em>two</em> collections (the movies <em>and</em> the ratings), we&rsquo;ll see if the ratings collection contains the supplied movie&rsquo;s rating.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-csharp data-lang=csharp><span class=line><span class=cl>    <span class=c1>// Filter the supplied collection of movies</span>
</span></span><span class=line><span class=cl>    <span class=n>List</span><span class=p>&lt;</span><span class=n>Movie</span><span class=p>&gt;</span> <span class=n>results</span> <span class=p>=</span> <span class=k>new</span> <span class=n>List</span><span class=p>&lt;</span><span class=n>Movie</span><span class=p>&gt;();</span>
</span></span><span class=line><span class=cl>    <span class=k>foreach</span><span class=p>(</span><span class=n>Movie</span> <span class=n>movie</span> <span class=k>in</span> <span class=n>movies</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span><span class=p>(</span><span class=n>movie</span><span class=p>.</span><span class=n>MPAARatings</span> <span class=p>!=</span> <span class=kc>null</span> <span class=p>&amp;&amp;</span> <span class=n>ratings</span><span class=p>.</span><span class=n>Contains</span><span class=p>(</span><span class=n>movie</span><span class=p>.</span><span class=n>MPAARatings</span><span class=p>))</span>
</span></span><span class=line><span class=cl>        <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=n>results</span><span class=p>.</span><span class=n>Add</span><span class=p>(</span><span class=n>movie</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span></span></span></code></pre></div><p>Finally, we&rsquo;ll return our results:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-csharp data-lang=csharp><span class=line><span class=cl>    <span class=k>return</span> <span class=n>results</span><span class=p>;</span></span></span></code></pre></div><p>Now, back in our PageModel <em>Index.cshtml.cs</em>, we&rsquo;ll apply our filter to the results of our search. The refactored <code>OnGet()</code> should then be:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-csharp data-lang=csharp><span class=line><span class=cl>    <span class=kd>public</span> <span class=k>void</span> <span class=n>OnGet</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=n>SearchTerms</span> <span class=p>=</span> <span class=n>Request</span><span class=p>.</span><span class=n>Query</span><span class=p>[</span><span class=s>&#34;SearchTerms&#34;</span><span class=p>];</span>
</span></span><span class=line><span class=cl>        <span class=n>MPAARatings</span> <span class=p>=</span> <span class=n>Request</span><span class=p>.</span><span class=n>Query</span><span class=p>[</span><span class=s>&#34;MPAARatings&#34;</span><span class=p>];</span>
</span></span><span class=line><span class=cl>        <span class=n>Movies</span> <span class=p>=</span> <span class=n>MovieDatabase</span><span class=p>.</span><span class=n>Search</span><span class=p>(</span><span class=n>SearchTerms</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=n>Movies</span> <span class=p>=</span> <span class=n>MovieDatabase</span><span class=p>.</span><span class=n>FilterByMPAARating</span><span class=p>(</span><span class=n>Movies</span><span class=p>,</span> <span class=n>MPAARatings</span><span class=p>);</span>        
</span></span><span class=line><span class=cl>    <span class=p>}</span></span></span></code></pre></div><p>Now we can run a search with filters applied. For example, searching for the word &ldquo;Love&rdquo; and movies that are PG or PG-13 yields:</p><p><a href=#R-image-485dcc5f0c0be412e16106162df27c73 class=lightbox-link><img alt="Filtered Search Results" class="border lazy lightbox noshadow figure-image" loading=lazy src=/cis400/images/6.8.4.png style=height:auto;width:auto></a>
<a href=javascript:history.back(); class=lightbox-back id=R-image-485dcc5f0c0be412e16106162df27c73><img alt="Filtered Search Results" class="border lazy lightbox noshadow lightbox-image" loading=lazy src=/cis400/images/6.8.4.png></a></p><p>You might be wondering why <em>Cloverfield</em> is listed. But remember, we&rsquo;re searching by substring, and C <strong>LOVE</strong> rfield contains love!</p><h2 id=filtering-by-genre>Filtering by Genre</h2><p>Let&rsquo;s add filters for genre next. But what genres should be included? This is not as clear-cut as our MPAA rating, as there is no standards organization that says &ldquo;these are the only offical genres that exist.&rdquo; In fact, new genres emerge from time to time. So a better source of this info might just be to see what Genres are defined in our data, i.e.:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-csharp data-lang=csharp><span class=line><span class=cl>    <span class=n>HashSet</span><span class=p>&lt;</span><span class=kt>string</span><span class=p>&gt;</span> <span class=n>genres</span> <span class=p>=</span> <span class=k>new</span> <span class=n>HashSet</span><span class=p>&lt;</span><span class=kt>string</span><span class=p>&gt;();</span>
</span></span><span class=line><span class=cl>    <span class=k>foreach</span><span class=p>(</span><span class=n>Movie</span> <span class=n>movie</span> <span class=k>in</span> <span class=n>All</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span><span class=p>(</span><span class=n>movie</span><span class=p>.</span><span class=n>MajorGenre</span> <span class=p>!=</span> <span class=kc>null</span><span class=p>)</span> 
</span></span><span class=line><span class=cl>        <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=n>genres</span><span class=p>.</span><span class=n>Add</span><span class=p>(</span><span class=n>movie</span><span class=p>.</span><span class=n>MajorGenre</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span></span></span></code></pre></div><p>Here we use a <a href="https://docs.microsoft.com/en-us/dotnet/api/system.collections.generic.hashset-1?view=netframework-4.8" rel=external target=_blank>HashSet</a> instead of a list, as it only adds each unique item once. Duplicates are ignored.</p><p>But where would this code go? We could place it in a getter for <code>MovieDatabase.Genres</code>:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-csharp data-lang=csharp><span class=line><span class=cl>    <span class=kd>public</span> <span class=n>IEnumerable</span><span class=p>&lt;</span><span class=kt>string</span><span class=p>&gt;</span> <span class=n>Genres</span> 
</span></span><span class=line><span class=cl>    <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=k>get</span> 
</span></span><span class=line><span class=cl>        <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=n>HashSet</span><span class=p>&lt;</span><span class=kt>string</span><span class=p>&gt;</span> <span class=n>genres</span> <span class=p>=</span> <span class=k>new</span> <span class=n>HashSet</span><span class=p>&lt;</span><span class=kt>string</span><span class=p>&gt;();</span>
</span></span><span class=line><span class=cl>            <span class=k>foreach</span><span class=p>(</span><span class=n>Movie</span> <span class=n>movie</span> <span class=k>in</span> <span class=n>All</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>                <span class=k>if</span><span class=p>(</span><span class=n>movie</span><span class=p>.</span><span class=n>MajorGenre</span> <span class=p>!=</span> <span class=kc>null</span><span class=p>)</span> 
</span></span><span class=line><span class=cl>                <span class=p>{</span>
</span></span><span class=line><span class=cl>                    <span class=n>genres</span><span class=p>.</span><span class=n>Add</span><span class=p>(</span><span class=n>movie</span><span class=p>.</span><span class=n>MajorGenre</span><span class=p>);</span>
</span></span><span class=line><span class=cl>                <span class=p>}</span>
</span></span><span class=line><span class=cl>            <span class=p>}</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span></span></span></code></pre></div><p>But this means that every time we want to access it, we&rsquo;ll search through all the movies&mldr; This is an O(n) operation, and will make our website slower.</p><p>Instead, let&rsquo;s create a private static variable in the <code>MovieDatabase</code> class to <em>cache</em> this collection as an array of strings:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-csharp data-lang=csharp><span class=line><span class=cl>    <span class=c1>// The genres represented in the database</span>
</span></span><span class=line><span class=cl>    <span class=kd>private</span> <span class=kd>static</span> <span class=kt>string</span><span class=p>[]</span> <span class=n>_genres</span><span class=p>;</span></span></span></code></pre></div><p>And expose it with a public static property:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-csharp data-lang=csharp><span class=line><span class=cl>    <span class=cs>/// &lt;summary&gt;</span>
</span></span><span class=line><span class=cl>    <span class=cs>/// Gets the movie genres represented in the database </span>
</span></span><span class=line><span class=cl>    <span class=cs>/// &lt;/summary&gt;</span>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=kd>static</span> <span class=kt>string</span><span class=p>[]</span> <span class=n>Genres</span> <span class=p>=&gt;</span> <span class=n>_genres</span><span class=p>;</span></span></span></code></pre></div><p>And finally, we&rsquo;ll populate this array in the static constructor of <code>MovieDatabase</code>, after the JSON file has been processed:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-csharp data-lang=csharp><span class=line><span class=cl>    <span class=n>HashSet</span><span class=p>&lt;</span><span class=kt>string</span><span class=p>&gt;</span> <span class=n>genreSet</span> <span class=p>=</span> <span class=k>new</span> <span class=n>HashSet</span><span class=p>&lt;</span><span class=kt>string</span><span class=p>&gt;();</span>
</span></span><span class=line><span class=cl>    <span class=k>foreach</span><span class=p>(</span><span class=n>Movie</span> <span class=n>movie</span> <span class=k>in</span> <span class=n>_movies</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span><span class=p>(</span><span class=n>movie</span><span class=p>.</span><span class=n>MajorGenre</span> <span class=p>!=</span> <span class=kc>null</span><span class=p>)</span> 
</span></span><span class=line><span class=cl>        <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=n>genreSet</span><span class=p>.</span><span class=n>Add</span><span class=p>(</span><span class=n>movie</span><span class=p>.</span><span class=n>MajorGenre</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=n>_genres</span> <span class=p>=</span> <span class=n>genreSet</span><span class=p>.</span><span class=n>ToArray</span><span class=p>();</span></span></span></code></pre></div><p>This approach means the finding of genres only happens once, and getting the <code>Genre</code> property is a constant-time O(1) operation.</p><p>We can implement the filters for the genres in the same way as we did for the MPAA filters; I&rsquo;ll leave that as an exercise for the reader.</p><footer class=footline></footer></article><article class=default><header class=headline></header><h1 id=numerical-filters>Numerical Filters</h1><p>Let&rsquo;s tackle one of the critics ratings next. While we could create categories and use checkboxes, this doesn&rsquo;t capture the incremental values (i.e. 4.3), and it would be a <em>lot</em> of checkboxes for Rotten Tomatoes ratings! Instead, we&rsquo;ll use a <em>numerical filter</em>, which limits our possible results to a range - between a minimum and maximum value.</p><p>Moreover, let&rsquo;s clean up our Index page, as it is getting difficult to determine what filter(s) go together, and and are adding more.</p><h2 id=refactoring-the-index-page>Refactoring the Index Page</h2><p>Let&rsquo;s move the filters to a column on the left, leave the search bar above, and show our results on the right. This will require refactoring our <em>Index.cshtml</em> file:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-csharp data-lang=csharp><span class=line><span class=cl>    <span class=p>&lt;</span><span class=n>form</span> <span class=n>id</span><span class=p>=</span><span class=s>&#34;movie-database&#34;</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=p>&lt;</span><span class=n>div</span> <span class=n>id</span><span class=p>=</span><span class=s>&#34;search&#34;</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>            <span class=p>&lt;</span><span class=n>input</span> <span class=n>type</span><span class=p>=</span><span class=s>&#34;text&#34;</span> <span class=n>name</span><span class=p>=</span><span class=s>&#34;SearchTerms&#34;</span> <span class=k>value</span><span class=p>=</span><span class=s>&#34;@Model.SearchTerms&#34;</span> <span class=p>/&gt;</span>
</span></span><span class=line><span class=cl>            <span class=p>&lt;</span><span class=n>input</span> <span class=n>type</span><span class=p>=</span><span class=s>&#34;submit&#34;</span> <span class=k>value</span><span class=p>=</span><span class=s>&#34;Search&#34;</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>        <span class=p>&lt;/</span><span class=n>div</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=p>&lt;</span><span class=n>div</span> <span class=n>id</span><span class=p>=</span><span class=s>&#34;filters&#34;</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>            <span class=p>&lt;</span><span class=n>h4</span><span class=p>&gt;</span><span class=n>MPAA</span> <span class=n>Rating</span><span class=p>&lt;/</span><span class=n>h4</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>            <span class=n>@foreach</span> <span class=p>(</span><span class=kt>string</span> <span class=n>rating</span> <span class=k>in</span> <span class=n>MovieDatabase</span><span class=p>.</span><span class=n>MPAARating</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            <span class=p>{</span>
</span></span><span class=line><span class=cl>                <span class=p>&lt;</span><span class=n>label</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>                    <span class=p>&lt;</span><span class=n>input</span> <span class=n>type</span><span class=p>=</span><span class=s>&#34;checkbox&#34;</span> <span class=n>name</span><span class=p>=</span><span class=s>&#34;MPAARatings&#34;</span> <span class=k>value</span><span class=p>=</span><span class=s>&#34;@rating&#34;</span> <span class=k>checked</span><span class=p>=</span><span class=s>&#34;@Model.MPAARatings.Contains(rating)&#34;</span> <span class=p>/&gt;</span>
</span></span><span class=line><span class=cl>                    <span class=n>@rating</span>
</span></span><span class=line><span class=cl>                <span class=p>&lt;/</span><span class=n>label</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>            <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>            <span class=p>&lt;</span><span class=n>h4</span><span class=p>&gt;</span><span class=n>Genre</span><span class=p>&lt;/</span><span class=n>h4</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>            <span class=n>@foreach</span> <span class=p>(</span><span class=kt>string</span> <span class=n>genre</span> <span class=k>in</span> <span class=n>MovieDatabase</span><span class=p>.</span><span class=n>Genres</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            <span class=p>{</span>
</span></span><span class=line><span class=cl>                <span class=p>&lt;</span><span class=n>label</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>                    <span class=p>&lt;</span><span class=n>input</span> <span class=n>type</span><span class=p>=</span><span class=s>&#34;checkbox&#34;</span> <span class=n>name</span><span class=p>=</span><span class=s>&#34;Genres&#34;</span> <span class=k>value</span><span class=p>=</span><span class=s>&#34;@genre&#34;</span> <span class=p>/&gt;</span>
</span></span><span class=line><span class=cl>                    <span class=n>@genre</span>
</span></span><span class=line><span class=cl>                <span class=p>&lt;/</span><span class=n>label</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>            <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>            <span class=p>&lt;</span><span class=n>h4</span><span class=p>&gt;</span><span class=n>IMDB</span> <span class=n>Rating</span><span class=p>&lt;/</span><span class=n>h4</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>            <span class=p>&lt;</span><span class=n>div</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>                <span class=n>Between</span>
</span></span><span class=line><span class=cl>                <span class=p>&lt;</span><span class=n>input</span> <span class=n>name</span><span class=p>=</span><span class=s>&#34;IMDBMin&#34;</span> <span class=n>type</span><span class=p>=</span><span class=s>&#34;number&#34;</span> <span class=n>min</span><span class=p>=</span><span class=s>&#34;0&#34;</span> <span class=n>max</span><span class=p>=</span><span class=s>&#34;10&#34;</span> <span class=n>step</span><span class=p>=</span><span class=s>&#34;0.1&#34;</span> <span class=n>placeholder</span><span class=p>=</span><span class=s>&#34;min&#34;</span><span class=p>/&gt;</span>
</span></span><span class=line><span class=cl>                <span class=n>and</span>
</span></span><span class=line><span class=cl>                <span class=p>&lt;</span><span class=n>input</span> <span class=n>name</span><span class=p>=</span><span class=s>&#34;IMDBMax&#34;</span> <span class=n>type</span><span class=p>=</span><span class=s>&#34;number&#34;</span> <span class=n>min</span><span class=p>=</span><span class=s>&#34;0&#34;</span> <span class=n>max</span><span class=p>=</span><span class=s>&#34;10&#34;</span> <span class=n>step</span><span class=p>=</span><span class=s>&#34;0.1&#34;</span> <span class=n>placeholder</span><span class=p>=</span><span class=s>&#34;max&#34;</span><span class=p>/&gt;</span>
</span></span><span class=line><span class=cl>            <span class=p>&lt;/</span><span class=n>div</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=p>&lt;/</span><span class=n>div</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=p>&lt;</span><span class=n>div</span> <span class=n>id</span><span class=p>=</span><span class=s>&#34;results&#34;</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>            <span class=p>&lt;</span><span class=n>h1</span><span class=p>&gt;</span><span class=n>Movie</span> <span class=n>Results</span><span class=p>&lt;/</span><span class=n>h1</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>            <span class=p>&lt;</span><span class=n>ul</span> <span class=n>class</span><span class=p>=</span><span class=s>&#34;movie-list&#34;</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>                <span class=n>@foreach</span> <span class=p>(</span><span class=n>Movie</span> <span class=n>movie</span> <span class=k>in</span> <span class=n>@Model</span><span class=p>.</span><span class=n>Movies</span><span class=p>)</span>
</span></span><span class=line><span class=cl>                <span class=p>{</span>
</span></span><span class=line><span class=cl>                    <span class=p>&lt;</span><span class=n>li</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>                        <span class=p>&lt;</span><span class=n>div</span> <span class=n>class</span><span class=p>=</span><span class=s>&#34;details&#34;</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>                            <span class=p>&lt;</span><span class=n>h3</span> <span class=n>class</span><span class=p>=</span><span class=s>&#34;title&#34;</span><span class=p>&gt;</span><span class=n>@movie</span><span class=p>.</span><span class=n>Title</span><span class=p>&lt;/</span><span class=n>h3</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>                            <span class=p>&lt;</span><span class=n>div</span> <span class=n>class</span><span class=p>=</span><span class=s>&#34;mpaa&#34;</span><span class=p>&gt;</span><span class=n>@movie</span><span class=p>.</span><span class=n>MPAARating</span><span class=p>&lt;/</span><span class=n>div</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>                            <span class=p>&lt;</span><span class=n>div</span> <span class=n>class</span><span class=p>=</span><span class=s>&#34;genre&#34;</span><span class=p>&gt;</span><span class=n>@movie</span><span class=p>.</span><span class=n>MajorGenre</span><span class=p>&lt;/</span><span class=n>div</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>                        <span class=p>&lt;/</span><span class=n>div</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>                        <span class=p>&lt;</span><span class=n>div</span> <span class=n>class</span><span class=p>=</span><span class=s>&#34;ratings&#34;</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>                            <span class=n>@if</span> <span class=p>(</span><span class=n>movie</span><span class=p>.</span><span class=n>IMDBRating</span> <span class=p>!=</span> <span class=kc>null</span><span class=p>)</span>
</span></span><span class=line><span class=cl>                            <span class=p>{</span>
</span></span><span class=line><span class=cl>                                <span class=p>&lt;</span><span class=n>div</span> <span class=n>class</span><span class=p>=</span><span class=s>&#34;imdb&#34;</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>                                    <span class=n>@movie</span><span class=p>.</span><span class=n>IMDBRating</span>
</span></span><span class=line><span class=cl>                                <span class=p>&lt;/</span><span class=n>div</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>                            <span class=p>}</span>
</span></span><span class=line><span class=cl>                            <span class=n>@if</span> <span class=p>(</span><span class=n>movie</span><span class=p>.</span><span class=n>RottenTomatoesRating</span> <span class=p>!=</span> <span class=kc>null</span><span class=p>)</span>
</span></span><span class=line><span class=cl>                            <span class=p>{</span>
</span></span><span class=line><span class=cl>                                <span class=p>&lt;</span><span class=n>div</span> <span class=n>class</span><span class=p>=</span><span class=s>&#34;rotten-tomatoes&#34;</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>                                    <span class=n>@movie</span><span class=p>.</span><span class=n>RottenTomatoesRating</span>
</span></span><span class=line><span class=cl>                                <span class=p>&lt;/</span><span class=n>div</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>                            <span class=p>}</span>
</span></span><span class=line><span class=cl>                        <span class=p>&lt;/</span><span class=n>div</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>                    <span class=p>&lt;/</span><span class=n>li</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>                <span class=p>}</span>
</span></span><span class=line><span class=cl>            <span class=p>&lt;/</span><span class=n>ul</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>        <span class=p>&lt;/</span><span class=n>div</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=p>&lt;/</span><span class=n>form</span><span class=p>&gt;</span></span></span></code></pre></div><p>Most of this is simply moving elements around the page, but note that we are using inputs of <code>type=number</code> to represent our range of IMDB values. We can specify a minimum and maximum for this range, as well as an allowable increment. Also, we use the <code>placeholder</code> attribute to put text into the <code>input</code> until a value is added.</p><h2 id=adding-more-styles>Adding More Styles</h2><p>Now we&rsquo;ll need to add some rules to our <em>wwwroot/css/styles.css</em>. First, we&rsquo;ll use a <code>grid</code> for the layout of the form:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-css data-lang=css><span class=line><span class=cl><span class=nt>form</span><span class=p>#</span><span class=nn>movie-database</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>display</span><span class=p>:</span> <span class=k>grid</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=k>grid-template-columns</span><span class=p>:</span> <span class=mi>1</span><span class=n>fr</span> <span class=mi>3</span><span class=n>fr</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=k>grid-template-rows</span><span class=p>:</span> <span class=kc>auto</span> <span class=kc>auto</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span></span></span></code></pre></div><p>The right column will be three times as big as the right.</p><p>We can make our search bar span both columns with <code>grid-column-start</code> and <code>grid-column-end</code>:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-css data-lang=css><span class=line><span class=cl><span class=p>#</span><span class=nn>search</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>grid-column-start</span><span class=p>:</span> <span class=mi>1</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=k>grid-column-end</span><span class=p>:</span> <span class=mi>3</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=k>text-align</span><span class=p>:</span> <span class=kc>center</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span></span></span></code></pre></div><p>Notice too that for CSS, we start counting at 1, not 0. The filters and the results will fall in the next row automatically, each taking up their own respective grid cell. You can read more about the grid layout in <a href=https://css-tricks.com/snippets/css/complete-guide-grid/ rel=external target=_blank>A Complete Guide to Grid</a>.</p><p>Let&rsquo;s go ahead and use flexbox to lay out our filters in a column:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-css data-lang=css><span class=line><span class=cl><span class=p>#</span><span class=nn>filters</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>display</span><span class=p>:</span> <span class=kc>flex</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=k>flex-direction</span><span class=p>:</span> <span class=kc>column</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span></span></span></code></pre></div><p>And make our number inputs bigger:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-css data-lang=css><span class=line><span class=cl><span class=p>#</span><span class=nn>filters</span> <span class=nt>input</span><span class=o>[</span><span class=nt>type</span><span class=o>=</span><span class=nt>number</span><span class=o>]</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>width</span><span class=p>:</span> <span class=mi>4</span><span class=kt>rem</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span></span></span></code></pre></div><p>Notice the use of square brackets in our CSS Selector to only apply to inputs with type number.</p><p>Also, let&rsquo;s add a margin above and remove most of the margin below our <code>&lt;h4></code> elements:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-css data-lang=css><span class=line><span class=cl><span class=p>#</span><span class=nn>filters</span> <span class=nt>h4</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>margin-bottom</span><span class=p>:</span> <span class=mf>0.2</span><span class=kt>rem</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=k>margin-top</span><span class=p>:</span> <span class=mi>2</span><span class=kt>rem</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span></span></span></code></pre></div><p>The resulting page looks much cleaner:</p><p><a href=#R-image-b7013a2f648209fa5cf89959fc66399e class=lightbox-link><img alt="The Styled Page" class="border lazy lightbox noshadow figure-image" loading=lazy src=/cis400/images/6.8.5.png style=height:auto;width:auto></a>
<a href=javascript:history.back(); class=lightbox-back id=R-image-b7013a2f648209fa5cf89959fc66399e><img alt="The Styled Page" class="border lazy lightbox noshadow lightbox-image" loading=lazy src=/cis400/images/6.8.5.png></a></p><h2 id=capturing-the-filter-values>Capturing the Filter Values</h2><p>Now we need to get the filter values from our GET request query string. We could do this like we&rsquo;ve been doing before, with:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-csharp data-lang=csharp><span class=line><span class=cl>    <span class=n>Request</span><span class=p>.</span><span class=n>Query</span><span class=p>[</span><span class=s>&#34;IMDBMin&#34;</span><span class=p>];</span></span></span></code></pre></div><p>But the returned value would be a string, so we&rsquo;d need to parse it:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-csharp data-lang=csharp><span class=line><span class=cl>    <span class=n>IMDBMin</span> <span class=p>=</span> <span class=kt>double</span><span class=p>.</span><span class=n>Parse</span><span class=p>(</span><span class=n>Request</span><span class=p>.</span><span class=n>Query</span><span class=p>[</span><span class=s>&#34;IMDBMin&#34;</span><span class=p>]);</span></span></span></code></pre></div><p>If the query was <code>null</code>, then this would evaluate to <code>NaN</code>, which we wouldn&rsquo;t want to set our <code>&lt;input></code> to&mldr;</p><p>Instead, we&rsquo;ll look at some options built into the PageModel.</p><h2 id=parameter-binding>Parameter Binding</h2><p>The first of these options is <a href=https://docs.microsoft.com/en-us/aspnet/web-api/overview/formats-and-model-binding/parameter-binding-in-aspnet-web-api rel=external target=_blank><em>Parameter Binding</em></a>. In this approach, we define parameters to our <code>OnGet()</code> method to be parsed out of the request automatically, i.e.:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-csharp data-lang=csharp><span class=line><span class=cl>    <span class=cs>/// &lt;summary&gt;</span>
</span></span><span class=line><span class=cl>    <span class=cs>/// Gets the search results for display on the page</span>
</span></span><span class=line><span class=cl>    <span class=cs>/// &lt;/summary&gt;</span>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=k>void</span> <span class=n>OnGet</span><span class=p>(</span><span class=kt>string</span> <span class=n>SearchTerms</span><span class=p>,</span> <span class=kt>string</span><span class=p>[]</span> <span class=n>MPAARatings</span><span class=p>,</span> <span class=kt>string</span><span class=p>[]</span> <span class=n>Genres</span><span class=p>,</span> <span class=kt>double?</span> <span class=n>IMDBMin</span><span class=p>,</span> <span class=kt>double?</span> <span class=n>IMDBMax</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=k>this</span><span class=p>.</span><span class=n>SearchTerms</span> <span class=p>=</span> <span class=n>SearchTerms</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=k>this</span><span class=p>.</span><span class=n>MPAARatings</span> <span class=p>=</span> <span class=n>MPAARatings</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=k>this</span><span class=p>.</span><span class=n>Genres</span> <span class=p>=</span> <span class=n>Genres</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=k>this</span><span class=p>.</span><span class=n>IMDBMin</span> <span class=p>=</span> <span class=n>IMDBMin</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=k>this</span><span class=p>.</span><span class=n>IMDBMax</span> <span class=p>=</span> <span class=n>IMDBMax</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=n>Movies</span> <span class=p>=</span> <span class=n>MovieDatabase</span><span class=p>.</span><span class=n>Search</span><span class=p>(</span><span class=n>SearchTerms</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=n>Movies</span> <span class=p>=</span> <span class=n>MovieDatabase</span><span class=p>.</span><span class=n>FilterByMPAARating</span><span class=p>(</span><span class=n>Movies</span><span class=p>,</span> <span class=n>MPAARatings</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=n>Movies</span> <span class=p>=</span> <span class=n>MovieDatabase</span><span class=p>.</span><span class=n>FilterByGenre</span><span class=p>(</span><span class=n>Movies</span><span class=p>,</span> <span class=n>Genres</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=n>Movies</span> <span class=p>=</span> <span class=n>MovieDatabase</span><span class=p>.</span><span class=n>FilterByIMDBRating</span><span class=p>(</span><span class=n>Movies</span><span class=p>,</span> <span class=n>IMDBMin</span><span class=p>,</span> <span class=n>IMDBMax</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span></span></span></code></pre></div><p>The benefit of this approach is that as long as C# knows a conversion into the type we specify, the conversion is done automatically. Note that the parameter name matches the <code>name</code> property of the corresponding <code>&lt;input></code> - this must be the case for the Razor Page to bind the parameter to the corresponding input value.</p><p>Note that we still need to assign these parameter values to the corresponding properties of our PageModel. If we don&rsquo;t, then those properties will all be <code>null</code>, and the <code>&lt;inputs></code> rendered on our page will always be blank.</p><h2 id=model-binding>Model Binding</h2><p>A second option is to use <a href="https://docs.microsoft.com/en-us/aspnet/core/mvc/models/model-binding?view=aspnetcore-3.1" rel=external target=_blank><em>Model Binding</em></a>. Model binding also automatically converts incoming form data, but in this case it binds directly to the properties of our PageModel. We indicate this form of binding with a <code>[BindProperty]</code> attribute, i.e.:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-csharp data-lang=csharp><span class=line><span class=cl><span class=kd>public</span> <span class=k>class</span> <span class=nc>IndexModel</span> <span class=p>:</span> <span class=n>PageModel</span> <span class=p>{</span>
</span></span><span class=line><span class=cl><span class=na>
</span></span></span><span class=line><span class=cl><span class=na>    [BindProperty(SupportsGet=true)]</span>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=kt>string</span> <span class=n>SearchTerms</span> <span class=p>{</span><span class=k>get</span><span class=p>;</span> <span class=k>set</span><span class=p>;}</span>
</span></span><span class=line><span class=cl><span class=na>
</span></span></span><span class=line><span class=cl><span class=na>    [BindProperty(SupportsGet=true)]</span>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=kt>string</span><span class=p>[]</span> <span class=n>MPAARatings</span> <span class=p>{</span><span class=k>get</span><span class=p>;</span> <span class=k>set</span><span class=p>;}</span>
</span></span><span class=line><span class=cl><span class=na>
</span></span></span><span class=line><span class=cl><span class=na>    [BindProperty(SupportsGet=true)]</span>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=kt>string</span><span class=p>[]</span> <span class=n>Genres</span> <span class=p>{</span><span class=k>get</span><span class=p>;</span> <span class=k>set</span><span class=p>;}</span>
</span></span><span class=line><span class=cl><span class=na>
</span></span></span><span class=line><span class=cl><span class=na>    [BindProperty(SupportsGet=true)]</span>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=kt>double?</span> <span class=n>IMDBMin</span> <span class=p>{</span><span class=k>get</span><span class=p>;</span> <span class=k>set</span><span class=p>;}</span>
</span></span><span class=line><span class=cl><span class=na>
</span></span></span><span class=line><span class=cl><span class=na>    [BindProperty(SupportsGet=true)]</span>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=kt>double?</span> <span class=n>IMDBMax</span> <span class=p>{</span><span class=k>get</span><span class=p>;</span> <span class=k>set</span><span class=p>;}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=cs>/// &lt;summary&gt;</span>
</span></span><span class=line><span class=cl>    <span class=cs>/// Gets the search results for display on the page</span>
</span></span><span class=line><span class=cl>    <span class=cs>/// &lt;/summary&gt;</span>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=k>void</span> <span class=n>OnGet</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=n>Movies</span> <span class=p>=</span> <span class=n>MovieDatabase</span><span class=p>.</span><span class=n>Search</span><span class=p>(</span><span class=n>SearchTerms</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=n>Movies</span> <span class=p>=</span> <span class=n>MovieDatabase</span><span class=p>.</span><span class=n>FilterByMPAARating</span><span class=p>(</span><span class=n>Movies</span><span class=p>,</span> <span class=n>MPAARatings</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=n>Movies</span> <span class=p>=</span> <span class=n>MovieDatabase</span><span class=p>.</span><span class=n>FilterByGenre</span><span class=p>(</span><span class=n>Movies</span><span class=p>,</span> <span class=n>Genres</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=n>Movies</span> <span class=p>=</span> <span class=n>MovieDatabase</span><span class=p>.</span><span class=n>FilterByIMDBRating</span><span class=p>(</span><span class=n>Movies</span><span class=p>,</span> <span class=n>IMDBMin</span><span class=p>,</span> <span class=n>IMDBMax</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span></span></span></code></pre></div><p>Note that with this approach, the incoming data is directly bound to the properties, so we don&rsquo;t need to do any special assignments within our <code>OnGet()</code> method. Also, note that we have to use <code>SupportsGet=true</code> in order for this binding to occur on GET requests (by default, model binding only happens with POST requests).</p><div class="box notices cstyle note"><div class=box-label><i class="fa-fw fas fa-exclamation-circle"></i> Note</div><div class=box-content><p>You only need to do <em>one</em> binding approach per property in a PageModel. I.e. you can just use the property decorator:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-csharp data-lang=csharp><span class=line><span class=cl><span class=kd>public</span> <span class=k>class</span> <span class=nc>SomePageModel</span> <span class=p>:</span> <span class=n>PageModel</span>
</span></span><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl><span class=na>    [BindProperty(SupportsGet=true)]</span>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=kt>float</span> <span class=n>SomeProperty</span> <span class=p>{</span> <span class=k>get</span><span class=p>;</span> <span class=k>set</span><span class=p>;</span> <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=k>void</span> <span class=n>OnGet</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=n>DoSomething</span><span class=p>(</span><span class=n>SomeProperty</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span></span></span></code></pre></div><p><em>or</em> you might use parameter binding:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-csharp data-lang=csharp><span class=line><span class=cl><span class=kd>public</span> <span class=k>class</span> <span class=nc>SomePageModel</span> <span class=p>:</span> <span class=n>PageModel</span>
</span></span><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=k>void</span> <span class=n>OnGet</span><span class=p>(</span><span class=kt>float</span> <span class=n>SomeProperty</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=n>DoSomething</span><span class=p>(</span><span class=n>SomeProperty</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span></span></span></code></pre></div><p><em>or</em> you can parse it from the request:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-csharp data-lang=csharp><span class=line><span class=cl><span class=kd>public</span> <span class=k>class</span> <span class=nc>SomePageModel</span> <span class=p>:</span> <span class=n>PageModel</span>
</span></span><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=k>void</span> <span class=n>OnGet</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=kt>var</span> <span class=n>someProperty</span> <span class=p>=</span> <span class=kt>float</span><span class=p>.</span><span class=n>Parse</span><span class=p>(</span><span class=n>Request</span><span class=p>.</span><span class=n>Query</span><span class=p>[</span><span class=s>&#34;SomeProperty&#34;</span><span class=p>]);</span>
</span></span><span class=line><span class=cl>        <span class=n>DoSomething</span><span class=p>(</span><span class=n>someProperty</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span></span></span></code></pre></div><p>These are all <em>different means</em> of accessing the <em>same data</em> from the incoming request.</p></div></div><p>Now all we need to do is implement the actual filter.</p><h3 id=implementing-the-imdb-rating-filter>Implementing the IMDB Rating Filter</h3><p>We&rsquo;ll define the new filter in our <code>MovieDatabase</code> class as another static method:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-csharp data-lang=csharp><span class=line><span class=cl>    <span class=cs>/// &lt;summary&gt;</span>
</span></span><span class=line><span class=cl>    <span class=cs>/// Filters the provided collection of movies</span>
</span></span><span class=line><span class=cl>    <span class=cs>/// to those with IMDB ratings falling within</span>
</span></span><span class=line><span class=cl>    <span class=cs>/// the specified range</span>
</span></span><span class=line><span class=cl>    <span class=cs>/// &lt;/summary&gt;</span>
</span></span><span class=line><span class=cl>    <span class=cs>/// &lt;param name=&#34;movies&#34;&gt;The collection of movies to filter&lt;/param&gt;</span>
</span></span><span class=line><span class=cl>    <span class=cs>/// &lt;param name=&#34;min&#34;&gt;The minimum range value&lt;/param&gt;</span>
</span></span><span class=line><span class=cl>    <span class=cs>/// &lt;param name=&#34;max&#34;&gt;The maximum range value&lt;/param&gt;</span>
</span></span><span class=line><span class=cl>    <span class=cs>/// &lt;returns&gt;The filtered movie collection&lt;/returns&gt;</span>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=kd>static</span> <span class=n>IEnumerable</span><span class=p>&lt;</span><span class=n>Movie</span><span class=p>&gt;</span> <span class=n>FilterByIMDBRating</span><span class=p>(</span><span class=n>IEnumerable</span><span class=p>&lt;</span><span class=n>Movie</span><span class=p>&gt;</span> <span class=n>movies</span><span class=p>,</span> <span class=kt>double?</span> <span class=n>min</span><span class=p>,</span> <span class=kt>double?</span> <span class=n>max</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=c1>// TODO: Filter movies</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span></span></span></code></pre></div><p>Notice that here too we use the nullable double value. So our first step is probably to do a <code>null</code> check:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-csharp data-lang=csharp><span class=line><span class=cl>    <span class=k>if</span> <span class=p>(</span><span class=n>min</span> <span class=p>==</span> <span class=kc>null</span> <span class=p>&amp;&amp;</span> <span class=n>max</span> <span class=p>==</span> <span class=kc>null</span><span class=p>)</span> <span class=k>return</span> <span class=n>movies</span><span class=p>;</span></span></span></code></pre></div><p>But what if only one is null? Should we filter for that part of the range? It wouldn&rsquo;t be hard to do:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-csharp data-lang=csharp><span class=line><span class=cl>    <span class=kt>var</span> <span class=n>results</span> <span class=p>=</span> <span class=k>new</span> <span class=n>List</span><span class=p>&lt;</span><span class=n>Movie</span><span class=p>&gt;();</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c1>// only a maximum specified</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span><span class=p>(</span><span class=n>min</span> <span class=p>==</span> <span class=kc>null</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=k>foreach</span><span class=p>(</span><span class=n>Movie</span> <span class=n>movie</span> <span class=k>in</span> <span class=n>movies</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=k>if</span> <span class=p>(</span><span class=n>movie</span><span class=p>.</span><span class=n>IMDBRating</span> <span class=p>&lt;=</span> <span class=n>max</span><span class=p>)</span> <span class=n>results</span><span class=p>.</span><span class=n>Add</span><span class=p>(</span><span class=n>movie</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=n>results</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span></span></span></code></pre></div><p>And the minimum would mirror that:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-csharp data-lang=csharp><span class=line><span class=cl>    <span class=c1>// only a minimum specified</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span><span class=p>(</span><span class=n>max</span> <span class=p>==</span> <span class=kc>null</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=k>foreach</span><span class=p>(</span><span class=n>Movie</span> <span class=n>movie</span> <span class=k>in</span> <span class=n>movies</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=k>if</span> <span class=p>(</span><span class=n>movie</span><span class=p>.</span><span class=n>IMDBRating</span> <span class=p>&gt;=</span> <span class=n>min</span><span class=p>)</span> <span class=n>results</span><span class=p>.</span><span class=n>Add</span><span class=p>(</span><span class=n>movie</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=n>results</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span></span></span></code></pre></div><p>Finally, we could handle the case where we have both a min and max value to our range:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-csharp data-lang=csharp><span class=line><span class=cl>    <span class=c1>// Both minimum and maximum specified</span>
</span></span><span class=line><span class=cl>    <span class=k>foreach</span><span class=p>(</span><span class=n>Movie</span> <span class=n>movie</span> <span class=k>in</span> <span class=n>movies</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span><span class=p>(</span><span class=n>movie</span><span class=p>.</span><span class=n>IMDBRating</span> <span class=p>&gt;=</span> <span class=n>min</span> <span class=p>&amp;&amp;</span> <span class=n>movie</span><span class=p>.</span><span class=n>IMDBRating</span> <span class=p>&lt;=</span> <span class=n>max</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=n>results</span><span class=p>.</span><span class=n>Add</span><span class=p>(</span><span class=n>movie</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=n>results</span><span class=p>;</span></span></span></code></pre></div><p>Notice too, that in each of these cases we&rsquo;re treating the range as <em>inclusive</em> (including the specified minimum and maximum). This is the behavior most casual internet users will expect. If the database and user expectations are different for your audience, you&rsquo;d want your code to match that expectation.</p><p>Now we can filter by IMDB rating:</p><p><a href=#R-image-d5eadae6f1c9e36732fc4bc4bae1a261 class=lightbox-link><img alt="Filtering By IMDB" class="border lazy lightbox noshadow figure-image" loading=lazy src=/cis400/images/6.8.6.png style=height:auto;width:auto></a>
<a href=javascript:history.back(); class=lightbox-back id=R-image-d5eadae6f1c9e36732fc4bc4bae1a261><img alt="Filtering By IMDB" class="border lazy lightbox noshadow lightbox-image" loading=lazy src=/cis400/images/6.8.6.png></a></p><h2 id=finishing-up>Finishing Up</h2><p>Since we&rsquo;re displaying the Rotten Tomatoes rating, we should probably also have a filter for it. This will work almost exactly like the IMDB rating - but with the range from 0 to 100. I&rsquo;ll leave this as an exercise for the reader.</p><footer class=footline></footer></article><article class=default><header class=headline></header><h1 id=numerical-filters>Numerical Filters</h1><p>Let&rsquo;s tackle one of the critics ratings next. While we could create categories and use checkboxes, this doesn&rsquo;t capture the incremental values (i.e. 4.3), and it would be a <em>lot</em> of checkboxes for Rotten Tomatoes ratings! Instead, we&rsquo;ll use a <em>numerical filter</em>, which limits our possible results to a range - between a minimum and maximum value.</p><p>Moreover, let&rsquo;s clean up our Index page, as it is getting difficult to determine what filter(s) go together, and and are adding more.</p><h2 id=refactoring-the-index-page>Refactoring the Index Page</h2><p>Let&rsquo;s move the filters to a column on the left, leave the search bar above, and show our results on the right. This will require refactoring our <em>Index.cshtml</em> file:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-csharp data-lang=csharp><span class=line><span class=cl>    <span class=p>&lt;</span><span class=n>form</span> <span class=n>id</span><span class=p>=</span><span class=s>&#34;movie-database&#34;</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=p>&lt;</span><span class=n>div</span> <span class=n>id</span><span class=p>=</span><span class=s>&#34;search&#34;</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>            <span class=p>&lt;</span><span class=n>input</span> <span class=n>type</span><span class=p>=</span><span class=s>&#34;text&#34;</span> <span class=n>name</span><span class=p>=</span><span class=s>&#34;SearchTerms&#34;</span> <span class=k>value</span><span class=p>=</span><span class=s>&#34;@Model.SearchTerms&#34;</span> <span class=p>/&gt;</span>
</span></span><span class=line><span class=cl>            <span class=p>&lt;</span><span class=n>input</span> <span class=n>type</span><span class=p>=</span><span class=s>&#34;submit&#34;</span> <span class=k>value</span><span class=p>=</span><span class=s>&#34;Search&#34;</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>        <span class=p>&lt;/</span><span class=n>div</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=p>&lt;</span><span class=n>div</span> <span class=n>id</span><span class=p>=</span><span class=s>&#34;filters&#34;</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>            <span class=p>&lt;</span><span class=n>h4</span><span class=p>&gt;</span><span class=n>MPAA</span> <span class=n>Rating</span><span class=p>&lt;/</span><span class=n>h4</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>            <span class=n>@foreach</span> <span class=p>(</span><span class=kt>string</span> <span class=n>rating</span> <span class=k>in</span> <span class=n>MovieDatabase</span><span class=p>.</span><span class=n>MPAARating</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            <span class=p>{</span>
</span></span><span class=line><span class=cl>                <span class=p>&lt;</span><span class=n>label</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>                    <span class=p>&lt;</span><span class=n>input</span> <span class=n>type</span><span class=p>=</span><span class=s>&#34;checkbox&#34;</span> <span class=n>name</span><span class=p>=</span><span class=s>&#34;MPAARatings&#34;</span> <span class=k>value</span><span class=p>=</span><span class=s>&#34;@rating&#34;</span> <span class=k>checked</span><span class=p>=</span><span class=s>&#34;@Model.MPAARatings.Contains(rating)&#34;</span> <span class=p>/&gt;</span>
</span></span><span class=line><span class=cl>                    <span class=n>@rating</span>
</span></span><span class=line><span class=cl>                <span class=p>&lt;/</span><span class=n>label</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>            <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>            <span class=p>&lt;</span><span class=n>h4</span><span class=p>&gt;</span><span class=n>Genre</span><span class=p>&lt;/</span><span class=n>h4</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>            <span class=n>@foreach</span> <span class=p>(</span><span class=kt>string</span> <span class=n>genre</span> <span class=k>in</span> <span class=n>MovieDatabase</span><span class=p>.</span><span class=n>Genres</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            <span class=p>{</span>
</span></span><span class=line><span class=cl>                <span class=p>&lt;</span><span class=n>label</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>                    <span class=p>&lt;</span><span class=n>input</span> <span class=n>type</span><span class=p>=</span><span class=s>&#34;checkbox&#34;</span> <span class=n>name</span><span class=p>=</span><span class=s>&#34;Genres&#34;</span> <span class=k>value</span><span class=p>=</span><span class=s>&#34;@genre&#34;</span> <span class=p>/&gt;</span>
</span></span><span class=line><span class=cl>                    <span class=n>@genre</span>
</span></span><span class=line><span class=cl>                <span class=p>&lt;/</span><span class=n>label</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>            <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>            <span class=p>&lt;</span><span class=n>h4</span><span class=p>&gt;</span><span class=n>IMDB</span> <span class=n>Rating</span><span class=p>&lt;/</span><span class=n>h4</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>            <span class=p>&lt;</span><span class=n>div</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>                <span class=n>Between</span>
</span></span><span class=line><span class=cl>                <span class=p>&lt;</span><span class=n>input</span> <span class=n>name</span><span class=p>=</span><span class=s>&#34;IMDBMin&#34;</span> <span class=n>type</span><span class=p>=</span><span class=s>&#34;number&#34;</span> <span class=n>min</span><span class=p>=</span><span class=s>&#34;0&#34;</span> <span class=n>max</span><span class=p>=</span><span class=s>&#34;10&#34;</span> <span class=n>step</span><span class=p>=</span><span class=s>&#34;0.1&#34;</span> <span class=n>placeholder</span><span class=p>=</span><span class=s>&#34;min&#34;</span><span class=p>/&gt;</span>
</span></span><span class=line><span class=cl>                <span class=n>and</span>
</span></span><span class=line><span class=cl>                <span class=p>&lt;</span><span class=n>input</span> <span class=n>name</span><span class=p>=</span><span class=s>&#34;IMDBMax&#34;</span> <span class=n>type</span><span class=p>=</span><span class=s>&#34;number&#34;</span> <span class=n>min</span><span class=p>=</span><span class=s>&#34;0&#34;</span> <span class=n>max</span><span class=p>=</span><span class=s>&#34;10&#34;</span> <span class=n>step</span><span class=p>=</span><span class=s>&#34;0.1&#34;</span> <span class=n>placeholder</span><span class=p>=</span><span class=s>&#34;max&#34;</span><span class=p>/&gt;</span>
</span></span><span class=line><span class=cl>            <span class=p>&lt;/</span><span class=n>div</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=p>&lt;/</span><span class=n>div</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=p>&lt;</span><span class=n>div</span> <span class=n>id</span><span class=p>=</span><span class=s>&#34;results&#34;</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>            <span class=p>&lt;</span><span class=n>h1</span><span class=p>&gt;</span><span class=n>Movie</span> <span class=n>Results</span><span class=p>&lt;/</span><span class=n>h1</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>            <span class=p>&lt;</span><span class=n>ul</span> <span class=n>class</span><span class=p>=</span><span class=s>&#34;movie-list&#34;</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>                <span class=n>@foreach</span> <span class=p>(</span><span class=n>Movie</span> <span class=n>movie</span> <span class=k>in</span> <span class=n>@Model</span><span class=p>.</span><span class=n>Movies</span><span class=p>)</span>
</span></span><span class=line><span class=cl>                <span class=p>{</span>
</span></span><span class=line><span class=cl>                    <span class=p>&lt;</span><span class=n>li</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>                        <span class=p>&lt;</span><span class=n>div</span> <span class=n>class</span><span class=p>=</span><span class=s>&#34;details&#34;</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>                            <span class=p>&lt;</span><span class=n>h3</span> <span class=n>class</span><span class=p>=</span><span class=s>&#34;title&#34;</span><span class=p>&gt;</span><span class=n>@movie</span><span class=p>.</span><span class=n>Title</span><span class=p>&lt;/</span><span class=n>h3</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>                            <span class=p>&lt;</span><span class=n>div</span> <span class=n>class</span><span class=p>=</span><span class=s>&#34;mpaa&#34;</span><span class=p>&gt;</span><span class=n>@movie</span><span class=p>.</span><span class=n>MPAARating</span><span class=p>&lt;/</span><span class=n>div</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>                            <span class=p>&lt;</span><span class=n>div</span> <span class=n>class</span><span class=p>=</span><span class=s>&#34;genre&#34;</span><span class=p>&gt;</span><span class=n>@movie</span><span class=p>.</span><span class=n>MajorGenre</span><span class=p>&lt;/</span><span class=n>div</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>                        <span class=p>&lt;/</span><span class=n>div</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>                        <span class=p>&lt;</span><span class=n>div</span> <span class=n>class</span><span class=p>=</span><span class=s>&#34;ratings&#34;</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>                            <span class=n>@if</span> <span class=p>(</span><span class=n>movie</span><span class=p>.</span><span class=n>IMDBRating</span> <span class=p>!=</span> <span class=kc>null</span><span class=p>)</span>
</span></span><span class=line><span class=cl>                            <span class=p>{</span>
</span></span><span class=line><span class=cl>                                <span class=p>&lt;</span><span class=n>div</span> <span class=n>class</span><span class=p>=</span><span class=s>&#34;imdb&#34;</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>                                    <span class=n>@movie</span><span class=p>.</span><span class=n>IMDBRating</span>
</span></span><span class=line><span class=cl>                                <span class=p>&lt;/</span><span class=n>div</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>                            <span class=p>}</span>
</span></span><span class=line><span class=cl>                            <span class=n>@if</span> <span class=p>(</span><span class=n>movie</span><span class=p>.</span><span class=n>RottenTomatoesRating</span> <span class=p>!=</span> <span class=kc>null</span><span class=p>)</span>
</span></span><span class=line><span class=cl>                            <span class=p>{</span>
</span></span><span class=line><span class=cl>                                <span class=p>&lt;</span><span class=n>div</span> <span class=n>class</span><span class=p>=</span><span class=s>&#34;rotten-tomatoes&#34;</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>                                    <span class=n>@movie</span><span class=p>.</span><span class=n>RottenTomatoesRating</span>
</span></span><span class=line><span class=cl>                                <span class=p>&lt;/</span><span class=n>div</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>                            <span class=p>}</span>
</span></span><span class=line><span class=cl>                        <span class=p>&lt;/</span><span class=n>div</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>                    <span class=p>&lt;/</span><span class=n>li</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>                <span class=p>}</span>
</span></span><span class=line><span class=cl>            <span class=p>&lt;/</span><span class=n>ul</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>        <span class=p>&lt;/</span><span class=n>div</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=p>&lt;/</span><span class=n>form</span><span class=p>&gt;</span></span></span></code></pre></div><p>Most of this is simply moving elements around the page, but note that we are using inputs of <code>type=number</code> to represent our range of IMDB values. We can specify a minimum and maximum for this range, as well as an allowable increment. Also, we use the <code>placeholder</code> attribute to put text into the <code>input</code> until a value is added.</p><h2 id=adding-more-styles>Adding More Styles</h2><p>Now we&rsquo;ll need to add some rules to our <em>wwwroot/css/styles.css</em>. First, we&rsquo;ll use a <code>grid</code> for the layout of the form:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-css data-lang=css><span class=line><span class=cl><span class=nt>form</span><span class=p>#</span><span class=nn>movie-database</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>display</span><span class=p>:</span> <span class=k>grid</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=k>grid-template-columns</span><span class=p>:</span> <span class=mi>1</span><span class=n>fr</span> <span class=mi>3</span><span class=n>fr</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=k>grid-template-rows</span><span class=p>:</span> <span class=kc>auto</span> <span class=kc>auto</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span></span></span></code></pre></div><p>The right column will be three times as big as the left.</p><p>We can make our search bar span both columns with <code>grid-column-start</code> and <code>grid-column-end</code>:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-css data-lang=css><span class=line><span class=cl><span class=p>#</span><span class=nn>search</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>grid-column-start</span><span class=p>:</span> <span class=mi>1</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=k>grid-column-end</span><span class=p>:</span> <span class=mi>3</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=k>text-align</span><span class=p>:</span> <span class=kc>center</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span></span></span></code></pre></div><p>Notice too that for CSS, we start counting at 1, not 0. The filters and the results will fall in the next row automatically, each taking up their own respective grid cell. You can read more about the grid layout in <a href=https://css-tricks.com/snippets/css/complete-guide-grid/ rel=external target=_blank>A Complete Guide to Grid</a>.</p><p>Let&rsquo;s go ahead and use flexbox to lay out our filters in a column:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-css data-lang=css><span class=line><span class=cl><span class=p>#</span><span class=nn>filters</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>display</span><span class=p>:</span> <span class=kc>flex</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=k>flex-direction</span><span class=p>:</span> <span class=kc>column</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span></span></span></code></pre></div><p>And make our number inputs bigger:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-css data-lang=css><span class=line><span class=cl><span class=p>#</span><span class=nn>filters</span> <span class=nt>input</span><span class=o>[</span><span class=nt>type</span><span class=o>=</span><span class=nt>number</span><span class=o>]</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>width</span><span class=p>:</span> <span class=mi>4</span><span class=kt>rem</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span></span></span></code></pre></div><p>Notice the use of square brackets in our CSS Selector to only apply to inputs with type number.</p><p>Also, let&rsquo;s add a margin above and remove most of the margin below our <code>&lt;h4></code> elements:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-css data-lang=css><span class=line><span class=cl><span class=p>#</span><span class=nn>filters</span> <span class=nt>h4</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>margin-bottom</span><span class=p>:</span> <span class=mf>0.2</span><span class=kt>rem</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=k>margin-top</span><span class=p>:</span> <span class=mi>2</span><span class=kt>rem</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span></span></span></code></pre></div><p>The resulting page looks much cleaner:</p><p><a href=#R-image-7b59fdb68c3d367597319f755ab93a5e class=lightbox-link><img alt="The Styled Page" class="border lazy lightbox noshadow figure-image" loading=lazy src=/cis400/images/6.8.5.png style=height:auto;width:auto></a>
<a href=javascript:history.back(); class=lightbox-back id=R-image-7b59fdb68c3d367597319f755ab93a5e><img alt="The Styled Page" class="border lazy lightbox noshadow lightbox-image" loading=lazy src=/cis400/images/6.8.5.png></a></p><h2 id=capturing-the-filter-values>Capturing the Filter Values</h2><p>Now we need to get the filter values from our GET request query string. We could do this like we&rsquo;ve been doing before, with:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-csharp data-lang=csharp><span class=line><span class=cl>    <span class=n>Request</span><span class=p>.</span><span class=n>Query</span><span class=p>[</span><span class=s>&#34;IMDBMin&#34;</span><span class=p>];</span></span></span></code></pre></div><p>But the returned value would be a string, so we&rsquo;d need to parse it:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-csharp data-lang=csharp><span class=line><span class=cl>    <span class=n>IMDBMin</span> <span class=p>=</span> <span class=kt>double</span><span class=p>.</span><span class=n>Parse</span><span class=p>(</span><span class=n>Request</span><span class=p>.</span><span class=n>Query</span><span class=p>[</span><span class=s>&#34;IMDBMin&#34;</span><span class=p>]);</span></span></span></code></pre></div><p>If the query was <code>null</code>, then this would evaluate to <code>NaN</code>, which we wouldn&rsquo;t want to set our <code>&lt;input></code> to&mldr;</p><p>Instead, we&rsquo;ll look at some options built into the PageModel.</p><h2 id=parameter-binding>Parameter Binding</h2><p>The first of these options is <a href=https://docs.microsoft.com/en-us/aspnet/web-api/overview/formats-and-model-binding/parameter-binding-in-aspnet-web-api rel=external target=_blank><em>Parameter Binding</em></a>. In this approach, we define parameters to our <code>OnGet()</code> method to be parsed out of the request automatically, i.e.:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-csharp data-lang=csharp><span class=line><span class=cl>    <span class=cs>/// &lt;summary&gt;</span>
</span></span><span class=line><span class=cl>    <span class=cs>/// Gets the search results for display on the page</span>
</span></span><span class=line><span class=cl>    <span class=cs>/// &lt;/summary&gt;</span>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=k>void</span> <span class=n>OnGet</span><span class=p>(</span><span class=kt>string</span> <span class=n>SearchTerms</span><span class=p>,</span> <span class=kt>string</span><span class=p>[]</span> <span class=n>MPAARatings</span><span class=p>,</span> <span class=kt>string</span><span class=p>[]</span> <span class=n>Genres</span><span class=p>,</span> <span class=kt>double?</span> <span class=n>IMDBMin</span><span class=p>,</span> <span class=kt>double?</span> <span class=n>IMDBMax</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=k>this</span><span class=p>.</span><span class=n>SearchTerms</span> <span class=p>=</span> <span class=n>SearchTerms</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=k>this</span><span class=p>.</span><span class=n>MPAARatings</span> <span class=p>=</span> <span class=n>MPAARatings</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=k>this</span><span class=p>.</span><span class=n>Genres</span> <span class=p>=</span> <span class=n>Genres</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=k>this</span><span class=p>.</span><span class=n>IMDBMin</span> <span class=p>=</span> <span class=n>IMDBMin</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=k>this</span><span class=p>.</span><span class=n>IMDBMax</span> <span class=p>=</span> <span class=n>IMDBMax</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=n>Movies</span> <span class=p>=</span> <span class=n>MovieDatabase</span><span class=p>.</span><span class=n>Search</span><span class=p>(</span><span class=n>SearchTerms</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=n>Movies</span> <span class=p>=</span> <span class=n>MovieDatabase</span><span class=p>.</span><span class=n>FilterByMPAARating</span><span class=p>(</span><span class=n>Movies</span><span class=p>,</span> <span class=n>MPAARatings</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=n>Movies</span> <span class=p>=</span> <span class=n>MovieDatabase</span><span class=p>.</span><span class=n>FilterByGenre</span><span class=p>(</span><span class=n>Movies</span><span class=p>,</span> <span class=n>Genres</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=n>Movies</span> <span class=p>=</span> <span class=n>MovieDatabase</span><span class=p>.</span><span class=n>FilterByIMDBRating</span><span class=p>(</span><span class=n>Movies</span><span class=p>,</span> <span class=n>IMDBMin</span><span class=p>,</span> <span class=n>IMDBMax</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span></span></span></code></pre></div><p>The benefit of this approach is that as long as C# knows a conversion into the type we specify, the conversion is done automatically. Note that the parameter name matches the <code>name</code> property of the corresponding <code>&lt;input></code> - this must be the case for the Razor Page to bind the parameter to the corresponding input value.</p><p>Note that we still need to assign these parameter values to the corresponding properties of our PageModel. If we don&rsquo;t, then those properties will all be <code>null</code>, and the <code>&lt;inputs></code> rendered on our page will always be blank.</p><h2 id=model-binding>Model Binding</h2><p>A second option is to use <a href="https://docs.microsoft.com/en-us/aspnet/core/mvc/models/model-binding?view=aspnetcore-3.1" rel=external target=_blank><em>Model Binding</em></a>. Model binding also automatically converts incoming form data, but in this case it binds directly to the properties of our PageModel. We indicate this form of binding with a <code>[BindProperty]</code> attribute, i.e.:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-csharp data-lang=csharp><span class=line><span class=cl><span class=kd>public</span> <span class=k>class</span> <span class=nc>IndexModel</span> <span class=p>:</span> <span class=n>PageModel</span> <span class=p>{</span>
</span></span><span class=line><span class=cl><span class=na>
</span></span></span><span class=line><span class=cl><span class=na>    [BindProperty(SupportsGet=true)]</span>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=kt>string</span> <span class=n>SearchTerms</span> <span class=p>{</span><span class=k>get</span><span class=p>;</span> <span class=k>set</span><span class=p>;}</span>
</span></span><span class=line><span class=cl><span class=na>
</span></span></span><span class=line><span class=cl><span class=na>    [BindProperty(SupportsGet=true)]</span>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=kt>string</span><span class=p>[]</span> <span class=n>MPAARatings</span> <span class=p>{</span><span class=k>get</span><span class=p>;</span> <span class=k>set</span><span class=p>;}</span>
</span></span><span class=line><span class=cl><span class=na>
</span></span></span><span class=line><span class=cl><span class=na>    [BindProperty(SupportsGet=true)]</span>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=kt>string</span><span class=p>[]</span> <span class=n>Genres</span> <span class=p>{</span><span class=k>get</span><span class=p>;</span> <span class=k>set</span><span class=p>;}</span>
</span></span><span class=line><span class=cl><span class=na>
</span></span></span><span class=line><span class=cl><span class=na>    [BindProperty(SupportsGet=true)]</span>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=kt>double?</span> <span class=n>IMDBMin</span> <span class=p>{</span><span class=k>get</span><span class=p>;</span> <span class=k>set</span><span class=p>;}</span>
</span></span><span class=line><span class=cl><span class=na>
</span></span></span><span class=line><span class=cl><span class=na>    [BindProperty(SupportsGet=true)]</span>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=kt>double?</span> <span class=n>IMDBMax</span> <span class=p>{</span><span class=k>get</span><span class=p>;</span> <span class=k>set</span><span class=p>;}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=cs>/// &lt;summary&gt;</span>
</span></span><span class=line><span class=cl>    <span class=cs>/// Gets the search results for display on the page</span>
</span></span><span class=line><span class=cl>    <span class=cs>/// &lt;/summary&gt;</span>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=k>void</span> <span class=n>OnGet</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=n>Movies</span> <span class=p>=</span> <span class=n>MovieDatabase</span><span class=p>.</span><span class=n>Search</span><span class=p>(</span><span class=n>SearchTerms</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=n>Movies</span> <span class=p>=</span> <span class=n>MovieDatabase</span><span class=p>.</span><span class=n>FilterByMPAARating</span><span class=p>(</span><span class=n>Movies</span><span class=p>,</span> <span class=n>MPAARatings</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=n>Movies</span> <span class=p>=</span> <span class=n>MovieDatabase</span><span class=p>.</span><span class=n>FilterByGenre</span><span class=p>(</span><span class=n>Movies</span><span class=p>,</span> <span class=n>Genres</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=n>Movies</span> <span class=p>=</span> <span class=n>MovieDatabase</span><span class=p>.</span><span class=n>FilterByIMDBRating</span><span class=p>(</span><span class=n>Movies</span><span class=p>,</span> <span class=n>IMDBMin</span><span class=p>,</span> <span class=n>IMDBMax</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span></span></span></code></pre></div><p>Note that with this approach, the incoming data is directly bound to the properties, so we don&rsquo;t need to do any special assignments within our <code>OnGet()</code> method. Also, note that we have to use <code>SupportsGet=true</code> in order for this binding to occur on GET requests (by default, model binding only happens with POST requests).</p><div class="box notices cstyle note"><div class=box-label><i class="fa-fw fas fa-exclamation-circle"></i> Note</div><div class=box-content><p>You only need to do <em>one</em> binding approach per property in a PageModel. I.e. you can just use the property decorator:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-csharp data-lang=csharp><span class=line><span class=cl><span class=kd>public</span> <span class=k>class</span> <span class=nc>SomePageModel</span> <span class=p>:</span> <span class=n>PageModel</span>
</span></span><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl><span class=na>    [BindProperty(SupportsGet=true)]</span>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=kt>float</span> <span class=n>SomeProperty</span> <span class=p>{</span> <span class=k>get</span><span class=p>;</span> <span class=k>set</span><span class=p>;</span> <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=k>void</span> <span class=n>OnGet</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=n>DoSomething</span><span class=p>(</span><span class=n>SomeProperty</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span></span></span></code></pre></div><p><em>or</em> you might use parameter binding:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-csharp data-lang=csharp><span class=line><span class=cl><span class=kd>public</span> <span class=k>class</span> <span class=nc>SomePageModel</span> <span class=p>:</span> <span class=n>PageModel</span>
</span></span><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=k>void</span> <span class=n>OnGet</span><span class=p>(</span><span class=kt>float</span> <span class=n>SomeProperty</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=n>DoSomething</span><span class=p>(</span><span class=n>SomeProperty</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span></span></span></code></pre></div><p><em>or</em> you can parse it from the request:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-csharp data-lang=csharp><span class=line><span class=cl><span class=kd>public</span> <span class=k>class</span> <span class=nc>SomePageModel</span> <span class=p>:</span> <span class=n>PageModel</span>
</span></span><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=k>void</span> <span class=n>OnGet</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=kt>var</span> <span class=n>someProperty</span> <span class=p>=</span> <span class=kt>float</span><span class=p>.</span><span class=n>Parse</span><span class=p>(</span><span class=n>Request</span><span class=p>.</span><span class=n>Query</span><span class=p>[</span><span class=s>&#34;SomeProperty&#34;</span><span class=p>]);</span>
</span></span><span class=line><span class=cl>        <span class=n>DoSomething</span><span class=p>(</span><span class=n>someProperty</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span></span></span></code></pre></div><p>These are all <em>different means</em> of accessing the <em>same data</em> from the incoming request.</p></div></div><p>Now all we need to do is implement the actual filter.</p><h3 id=implementing-the-imdb-rating-filter>Implementing the IMDB Rating Filter</h3><p>We&rsquo;ll define the new filter in our <code>MovieDatabase</code> class as another static method:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-csharp data-lang=csharp><span class=line><span class=cl>    <span class=cs>/// &lt;summary&gt;</span>
</span></span><span class=line><span class=cl>    <span class=cs>/// Filters the provided collection of movies</span>
</span></span><span class=line><span class=cl>    <span class=cs>/// to those with IMDB ratings falling within</span>
</span></span><span class=line><span class=cl>    <span class=cs>/// the specified range</span>
</span></span><span class=line><span class=cl>    <span class=cs>/// &lt;/summary&gt;</span>
</span></span><span class=line><span class=cl>    <span class=cs>/// &lt;param name=&#34;movies&#34;&gt;The collection of movies to filter&lt;/param&gt;</span>
</span></span><span class=line><span class=cl>    <span class=cs>/// &lt;param name=&#34;min&#34;&gt;The minimum range value&lt;/param&gt;</span>
</span></span><span class=line><span class=cl>    <span class=cs>/// &lt;param name=&#34;max&#34;&gt;The maximum range value&lt;/param&gt;</span>
</span></span><span class=line><span class=cl>    <span class=cs>/// &lt;returns&gt;The filtered movie collection&lt;/returns&gt;</span>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=kd>static</span> <span class=n>IEnumerable</span><span class=p>&lt;</span><span class=n>Movie</span><span class=p>&gt;</span> <span class=n>FilterByIMDBRating</span><span class=p>(</span><span class=n>IEnumerable</span><span class=p>&lt;</span><span class=n>Movie</span><span class=p>&gt;</span> <span class=n>movies</span><span class=p>,</span> <span class=kt>double?</span> <span class=n>min</span><span class=p>,</span> <span class=kt>double?</span> <span class=n>max</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=c1>// TODO: Filter movies</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span></span></span></code></pre></div><p>Notice that here too we use the nullable double value. So our first step is probably to do a <code>null</code> check:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-csharp data-lang=csharp><span class=line><span class=cl>    <span class=k>if</span> <span class=p>(</span><span class=n>min</span> <span class=p>==</span> <span class=kc>null</span> <span class=p>&amp;&amp;</span> <span class=n>max</span> <span class=p>==</span> <span class=kc>null</span><span class=p>)</span> <span class=k>return</span> <span class=n>movies</span><span class=p>;</span></span></span></code></pre></div><p>But what if only one is null? Should we filter for that part of the range? It wouldn&rsquo;t be hard to do:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-csharp data-lang=csharp><span class=line><span class=cl>    <span class=kt>var</span> <span class=n>results</span> <span class=p>=</span> <span class=k>new</span> <span class=n>List</span><span class=p>&lt;</span><span class=n>Movie</span><span class=p>&gt;();</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c1>// only a maximum specified</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span><span class=p>(</span><span class=n>min</span> <span class=p>==</span> <span class=kc>null</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=k>foreach</span><span class=p>(</span><span class=n>Movie</span> <span class=n>movie</span> <span class=k>in</span> <span class=n>movies</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=k>if</span> <span class=p>(</span><span class=n>movie</span><span class=p>.</span><span class=n>IMDBRating</span> <span class=p>&lt;=</span> <span class=n>max</span><span class=p>)</span> <span class=n>results</span><span class=p>.</span><span class=n>Add</span><span class=p>(</span><span class=n>movie</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=n>results</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span></span></span></code></pre></div><p>And the minimum would mirror that:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-csharp data-lang=csharp><span class=line><span class=cl>    <span class=c1>// only a minimum specified</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span><span class=p>(</span><span class=n>max</span> <span class=p>==</span> <span class=kc>null</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=k>foreach</span><span class=p>(</span><span class=n>Movie</span> <span class=n>movie</span> <span class=k>in</span> <span class=n>movies</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=k>if</span> <span class=p>(</span><span class=n>movie</span><span class=p>.</span><span class=n>IMDBRating</span> <span class=p>&gt;=</span> <span class=n>min</span><span class=p>)</span> <span class=n>results</span><span class=p>.</span><span class=n>Add</span><span class=p>(</span><span class=n>movie</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=n>results</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span></span></span></code></pre></div><p>Finally, we could handle the case where we have both a min and max value to our range:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-csharp data-lang=csharp><span class=line><span class=cl>    <span class=c1>// Both minimum and maximum specified</span>
</span></span><span class=line><span class=cl>    <span class=k>foreach</span><span class=p>(</span><span class=n>Movie</span> <span class=n>movie</span> <span class=k>in</span> <span class=n>movies</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span><span class=p>(</span><span class=n>movie</span><span class=p>.</span><span class=n>IMDBRating</span> <span class=p>&gt;=</span> <span class=n>min</span> <span class=p>&amp;&amp;</span> <span class=n>movie</span><span class=p>.</span><span class=n>IMDBRating</span> <span class=p>&lt;=</span> <span class=n>max</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=n>results</span><span class=p>.</span><span class=n>Add</span><span class=p>(</span><span class=n>movie</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=n>results</span><span class=p>;</span></span></span></code></pre></div><p>Notice too, that in each of these cases we&rsquo;re treating the range as <em>inclusive</em> (including the specified minimum and maximum). This is the behavior most casual internet users will expect. If the database and user expectations are different for your audience, you&rsquo;d want your code to match that expectation.</p><p>Now we can filter by IMDB rating:</p><p><a href=#R-image-153d3fa03000da8ac8983818d7364503 class=lightbox-link><img alt="Filtering By IMDB" class="border lazy lightbox noshadow figure-image" loading=lazy src=/cis400/images/6.8.6.png style=height:auto;width:auto></a>
<a href=javascript:history.back(); class=lightbox-back id=R-image-153d3fa03000da8ac8983818d7364503><img alt="Filtering By IMDB" class="border lazy lightbox noshadow lightbox-image" loading=lazy src=/cis400/images/6.8.6.png></a></p><h2 id=finishing-up>Finishing Up</h2><p>Since we&rsquo;re displaying the Rotten Tomatoes rating, we should probably also have a filter for it. This will work almost exactly like the IMDB rating - but with the range from 0 to 100. I&rsquo;ll leave this as an exercise for the reader.</p><footer class=footline></footer></article><article class=default><header class=headline></header><h1 id=numerical-filters>Numerical Filters</h1><p>Let&rsquo;s tackle one of the critics ratings next. While we could create categories and use checkboxes, this doesn&rsquo;t capture the incremental values (i.e. 4.3), and it would be a <em>lot</em> of checkboxes for Rotten Tomatoes ratings! Instead, we&rsquo;ll use a <em>numerical filter</em>, which limits our possible results to a range - between a minimum and maximum value.</p><p>Moreover, let&rsquo;s clean up our Index page, as it is getting difficult to determine what filter(s) go together, and and are adding more.</p><h2 id=refactoring-the-index-page>Refactoring the Index Page</h2><p>Let&rsquo;s move the filters to a column on the left, leave the search bar above, and show our results on the right. This will require refactoring our <em>Index.cshtml</em> file:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-csharp data-lang=csharp><span class=line><span class=cl>    <span class=p>&lt;</span><span class=n>form</span> <span class=n>id</span><span class=p>=</span><span class=s>&#34;movie-database&#34;</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=p>&lt;</span><span class=n>div</span> <span class=n>id</span><span class=p>=</span><span class=s>&#34;search&#34;</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>            <span class=p>&lt;</span><span class=n>input</span> <span class=n>type</span><span class=p>=</span><span class=s>&#34;text&#34;</span> <span class=n>name</span><span class=p>=</span><span class=s>&#34;SearchTerms&#34;</span> <span class=k>value</span><span class=p>=</span><span class=s>&#34;@Model.SearchTerms&#34;</span> <span class=p>/&gt;</span>
</span></span><span class=line><span class=cl>            <span class=p>&lt;</span><span class=n>input</span> <span class=n>type</span><span class=p>=</span><span class=s>&#34;submit&#34;</span> <span class=k>value</span><span class=p>=</span><span class=s>&#34;Search&#34;</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>        <span class=p>&lt;/</span><span class=n>div</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=p>&lt;</span><span class=n>div</span> <span class=n>id</span><span class=p>=</span><span class=s>&#34;filters&#34;</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>            <span class=p>&lt;</span><span class=n>h4</span><span class=p>&gt;</span><span class=n>MPAA</span> <span class=n>Rating</span><span class=p>&lt;/</span><span class=n>h4</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>            <span class=n>@foreach</span> <span class=p>(</span><span class=kt>string</span> <span class=n>rating</span> <span class=k>in</span> <span class=n>MovieDatabase</span><span class=p>.</span><span class=n>MPAARatings</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            <span class=p>{</span>
</span></span><span class=line><span class=cl>                <span class=p>&lt;</span><span class=n>label</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>                    <span class=p>&lt;</span><span class=n>input</span> <span class=n>type</span><span class=p>=</span><span class=s>&#34;checkbox&#34;</span> <span class=n>name</span><span class=p>=</span><span class=s>&#34;MPAARatings&#34;</span> <span class=k>value</span><span class=p>=</span><span class=s>&#34;@rating&#34;</span> <span class=k>checked</span><span class=p>=</span><span class=s>&#34;@Model.MPAARatings.Contains(rating)&#34;</span> <span class=p>/&gt;</span>
</span></span><span class=line><span class=cl>                    <span class=n>@rating</span>
</span></span><span class=line><span class=cl>                <span class=p>&lt;/</span><span class=n>label</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>            <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>            <span class=p>&lt;</span><span class=n>h4</span><span class=p>&gt;</span><span class=n>Genre</span><span class=p>&lt;/</span><span class=n>h4</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>            <span class=n>@foreach</span> <span class=p>(</span><span class=kt>string</span> <span class=n>genre</span> <span class=k>in</span> <span class=n>MovieDatabase</span><span class=p>.</span><span class=n>Genres</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            <span class=p>{</span>
</span></span><span class=line><span class=cl>                <span class=p>&lt;</span><span class=n>label</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>                    <span class=p>&lt;</span><span class=n>input</span> <span class=n>type</span><span class=p>=</span><span class=s>&#34;checkbox&#34;</span> <span class=n>name</span><span class=p>=</span><span class=s>&#34;Genres&#34;</span> <span class=k>value</span><span class=p>=</span><span class=s>&#34;@genre&#34;</span> <span class=p>/&gt;</span>
</span></span><span class=line><span class=cl>                    <span class=n>@genre</span>
</span></span><span class=line><span class=cl>                <span class=p>&lt;/</span><span class=n>label</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>            <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>            <span class=p>&lt;</span><span class=n>h4</span><span class=p>&gt;</span><span class=n>IMDB</span> <span class=n>Rating</span><span class=p>&lt;/</span><span class=n>h4</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>            <span class=p>&lt;</span><span class=n>div</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>                <span class=n>Between</span>
</span></span><span class=line><span class=cl>                <span class=p>&lt;</span><span class=n>input</span> <span class=n>name</span><span class=p>=</span><span class=s>&#34;IMDBMin&#34;</span> <span class=n>type</span><span class=p>=</span><span class=s>&#34;number&#34;</span> <span class=n>min</span><span class=p>=</span><span class=s>&#34;0&#34;</span> <span class=n>max</span><span class=p>=</span><span class=s>&#34;10&#34;</span> <span class=n>step</span><span class=p>=</span><span class=s>&#34;0.1&#34;</span> <span class=n>placeholder</span><span class=p>=</span><span class=s>&#34;min&#34;</span><span class=p>/&gt;</span>
</span></span><span class=line><span class=cl>                <span class=n>and</span>
</span></span><span class=line><span class=cl>                <span class=p>&lt;</span><span class=n>input</span> <span class=n>name</span><span class=p>=</span><span class=s>&#34;IMDBMax&#34;</span> <span class=n>type</span><span class=p>=</span><span class=s>&#34;number&#34;</span> <span class=n>min</span><span class=p>=</span><span class=s>&#34;0&#34;</span> <span class=n>max</span><span class=p>=</span><span class=s>&#34;10&#34;</span> <span class=n>step</span><span class=p>=</span><span class=s>&#34;0.1&#34;</span> <span class=n>placeholder</span><span class=p>=</span><span class=s>&#34;max&#34;</span><span class=p>/&gt;</span>
</span></span><span class=line><span class=cl>            <span class=p>&lt;/</span><span class=n>div</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=p>&lt;/</span><span class=n>div</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=p>&lt;</span><span class=n>div</span> <span class=n>id</span><span class=p>=</span><span class=s>&#34;results&#34;</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>            <span class=p>&lt;</span><span class=n>h1</span><span class=p>&gt;</span><span class=n>Movie</span> <span class=n>Results</span><span class=p>&lt;/</span><span class=n>h1</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>            <span class=p>&lt;</span><span class=n>ul</span> <span class=n>class</span><span class=p>=</span><span class=s>&#34;movie-list&#34;</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>                <span class=n>@foreach</span> <span class=p>(</span><span class=n>Movie</span> <span class=n>movie</span> <span class=k>in</span> <span class=n>@Model</span><span class=p>.</span><span class=n>Movies</span><span class=p>)</span>
</span></span><span class=line><span class=cl>                <span class=p>{</span>
</span></span><span class=line><span class=cl>                    <span class=p>&lt;</span><span class=n>li</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>                        <span class=p>&lt;</span><span class=n>div</span> <span class=n>class</span><span class=p>=</span><span class=s>&#34;details&#34;</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>                            <span class=p>&lt;</span><span class=n>h3</span> <span class=n>class</span><span class=p>=</span><span class=s>&#34;title&#34;</span><span class=p>&gt;</span><span class=n>@movie</span><span class=p>.</span><span class=n>Title</span><span class=p>&lt;/</span><span class=n>h3</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>                            <span class=p>&lt;</span><span class=n>div</span> <span class=n>class</span><span class=p>=</span><span class=s>&#34;mpaa&#34;</span><span class=p>&gt;</span><span class=n>@movie</span><span class=p>.</span><span class=n>MPAARating</span><span class=p>&lt;/</span><span class=n>div</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>                            <span class=p>&lt;</span><span class=n>div</span> <span class=n>class</span><span class=p>=</span><span class=s>&#34;genre&#34;</span><span class=p>&gt;</span><span class=n>@movie</span><span class=p>.</span><span class=n>MajorGenre</span><span class=p>&lt;/</span><span class=n>div</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>                        <span class=p>&lt;/</span><span class=n>div</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>                        <span class=p>&lt;</span><span class=n>div</span> <span class=n>class</span><span class=p>=</span><span class=s>&#34;ratings&#34;</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>                            <span class=n>@if</span> <span class=p>(</span><span class=n>movie</span><span class=p>.</span><span class=n>IMDBRating</span> <span class=p>!=</span> <span class=kc>null</span><span class=p>)</span>
</span></span><span class=line><span class=cl>                            <span class=p>{</span>
</span></span><span class=line><span class=cl>                                <span class=p>&lt;</span><span class=n>div</span> <span class=n>class</span><span class=p>=</span><span class=s>&#34;imdb&#34;</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>                                    <span class=n>@movie</span><span class=p>.</span><span class=n>IMDBRating</span>
</span></span><span class=line><span class=cl>                                <span class=p>&lt;/</span><span class=n>div</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>                            <span class=p>}</span>
</span></span><span class=line><span class=cl>                            <span class=n>@if</span> <span class=p>(</span><span class=n>movie</span><span class=p>.</span><span class=n>RottenTomatoesRating</span> <span class=p>!=</span> <span class=kc>null</span><span class=p>)</span>
</span></span><span class=line><span class=cl>                            <span class=p>{</span>
</span></span><span class=line><span class=cl>                                <span class=p>&lt;</span><span class=n>div</span> <span class=n>class</span><span class=p>=</span><span class=s>&#34;rotten-tomatoes&#34;</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>                                    <span class=n>@movie</span><span class=p>.</span><span class=n>RottenTomatoesRating</span>
</span></span><span class=line><span class=cl>                                <span class=p>&lt;/</span><span class=n>div</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>                            <span class=p>}</span>
</span></span><span class=line><span class=cl>                        <span class=p>&lt;/</span><span class=n>div</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>                    <span class=p>&lt;/</span><span class=n>li</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>                <span class=p>}</span>
</span></span><span class=line><span class=cl>            <span class=p>&lt;/</span><span class=n>ul</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>        <span class=p>&lt;/</span><span class=n>div</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=p>&lt;/</span><span class=n>form</span><span class=p>&gt;</span></span></span></code></pre></div><p>Most of this is simply moving elements around the page, but note that we are using inputs of <code>type=number</code> to represent our range of IMDB values. We can specify a minimum and maximum for this range, as well as an allowable increment. Also, we use the <code>placeholder</code> attribute to put text into the <code>input</code> until a value is added.</p><h2 id=adding-more-styles>Adding More Styles</h2><p>Now we&rsquo;ll need to add some rules to our <em>wwwroot/css/styles.css</em>. First, we&rsquo;ll use a <code>grid</code> for the layout of the form:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-css data-lang=css><span class=line><span class=cl><span class=nt>form</span><span class=p>#</span><span class=nn>movie-database</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>display</span><span class=p>:</span> <span class=k>grid</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=k>grid-template-columns</span><span class=p>:</span> <span class=mi>1</span><span class=n>fr</span> <span class=mi>3</span><span class=n>fr</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=k>grid-template-rows</span><span class=p>:</span> <span class=kc>auto</span> <span class=kc>auto</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span></span></span></code></pre></div><p>The right column will be three times as big as the left.</p><p>We can make our search bar span both columns with <code>grid-column-start</code> and <code>grid-column-end</code>:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-css data-lang=css><span class=line><span class=cl><span class=p>#</span><span class=nn>search</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>grid-column-start</span><span class=p>:</span> <span class=mi>1</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=k>grid-column-end</span><span class=p>:</span> <span class=mi>3</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=k>text-align</span><span class=p>:</span> <span class=kc>center</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span></span></span></code></pre></div><p>Notice too that for CSS, we start counting at 1, not 0. The filters and the results will fall in the next row automatically, each taking up their own respective grid cell. You can read more about the grid layout in <a href=https://css-tricks.com/snippets/css/complete-guide-grid/ rel=external target=_blank>A Complete Guide to Grid</a>.</p><p>Let&rsquo;s go ahead and use flexbox to lay out our filters in a column:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-css data-lang=css><span class=line><span class=cl><span class=p>#</span><span class=nn>filters</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>display</span><span class=p>:</span> <span class=kc>flex</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=k>flex-direction</span><span class=p>:</span> <span class=kc>column</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span></span></span></code></pre></div><p>And make our number inputs bigger:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-css data-lang=css><span class=line><span class=cl><span class=p>#</span><span class=nn>filters</span> <span class=nt>input</span><span class=o>[</span><span class=nt>type</span><span class=o>=</span><span class=nt>number</span><span class=o>]</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>width</span><span class=p>:</span> <span class=mi>4</span><span class=kt>rem</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span></span></span></code></pre></div><p>Notice the use of square brackets in our CSS Selector to only apply to inputs with type number.</p><p>Also, let&rsquo;s add a margin above and remove most of the margin below our <code>&lt;h4></code> elements:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-css data-lang=css><span class=line><span class=cl><span class=p>#</span><span class=nn>filters</span> <span class=nt>h4</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>margin-bottom</span><span class=p>:</span> <span class=mf>0.2</span><span class=kt>rem</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=k>margin-top</span><span class=p>:</span> <span class=mi>2</span><span class=kt>rem</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span></span></span></code></pre></div><p>The resulting page looks much cleaner:</p><p><a href=#R-image-330e84526d056576333e33c5582388f4 class=lightbox-link><img alt="The Styled Page" class="border lazy lightbox noshadow figure-image" loading=lazy src=/cis400/images/6.8.5.png style=height:auto;width:auto></a>
<a href=javascript:history.back(); class=lightbox-back id=R-image-330e84526d056576333e33c5582388f4><img alt="The Styled Page" class="border lazy lightbox noshadow lightbox-image" loading=lazy src=/cis400/images/6.8.5.png></a></p><h2 id=capturing-the-filter-values>Capturing the Filter Values</h2><p>Now we need to get the filter values from our GET request query string. We could do this like we&rsquo;ve been doing before, with:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-csharp data-lang=csharp><span class=line><span class=cl>    <span class=n>Request</span><span class=p>.</span><span class=n>Query</span><span class=p>[</span><span class=s>&#34;IMDBMin&#34;</span><span class=p>];</span></span></span></code></pre></div><p>But the returned value would be a string, so we&rsquo;d need to parse it:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-csharp data-lang=csharp><span class=line><span class=cl>    <span class=n>IMDBMin</span> <span class=p>=</span> <span class=kt>double</span><span class=p>.</span><span class=n>Parse</span><span class=p>(</span><span class=n>Request</span><span class=p>.</span><span class=n>Query</span><span class=p>[</span><span class=s>&#34;IMDBMin&#34;</span><span class=p>]);</span></span></span></code></pre></div><p>If the query was <code>null</code>, then this would evaluate to <code>NaN</code>, which we wouldn&rsquo;t want to set our <code>&lt;input></code> to&mldr;</p><p>Instead, we&rsquo;ll look at some options built into the PageModel.</p><h2 id=parameter-binding>Parameter Binding</h2><p>The first of these options is <a href=https://docs.microsoft.com/en-us/aspnet/web-api/overview/formats-and-model-binding/parameter-binding-in-aspnet-web-api rel=external target=_blank><em>Parameter Binding</em></a>. In this approach, we define parameters to our <code>OnGet()</code> method to be parsed out of the request automatically, i.e.:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-csharp data-lang=csharp><span class=line><span class=cl>    <span class=cs>/// &lt;summary&gt;</span>
</span></span><span class=line><span class=cl>    <span class=cs>/// Gets the search results for display on the page</span>
</span></span><span class=line><span class=cl>    <span class=cs>/// &lt;/summary&gt;</span>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=k>void</span> <span class=n>OnGet</span><span class=p>(</span><span class=kt>string</span> <span class=n>SearchTerms</span><span class=p>,</span> <span class=kt>string</span><span class=p>[]</span> <span class=n>MPAARatings</span><span class=p>,</span> <span class=kt>string</span><span class=p>[]</span> <span class=n>Genres</span><span class=p>,</span> <span class=kt>double?</span> <span class=n>IMDBMin</span><span class=p>,</span> <span class=kt>double?</span> <span class=n>IMDBMax</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=k>this</span><span class=p>.</span><span class=n>SearchTerms</span> <span class=p>=</span> <span class=n>SearchTerms</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=k>this</span><span class=p>.</span><span class=n>MPAARatings</span> <span class=p>=</span> <span class=n>MPAARatings</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=k>this</span><span class=p>.</span><span class=n>Genres</span> <span class=p>=</span> <span class=n>Genres</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=k>this</span><span class=p>.</span><span class=n>IMDBMin</span> <span class=p>=</span> <span class=n>IMDBMin</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=k>this</span><span class=p>.</span><span class=n>IMDBMax</span> <span class=p>=</span> <span class=n>IMDBMax</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=n>Movies</span> <span class=p>=</span> <span class=n>MovieDatabase</span><span class=p>.</span><span class=n>Search</span><span class=p>(</span><span class=n>SearchTerms</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=n>Movies</span> <span class=p>=</span> <span class=n>MovieDatabase</span><span class=p>.</span><span class=n>FilterByMPAARating</span><span class=p>(</span><span class=n>Movies</span><span class=p>,</span> <span class=n>MPAARatings</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=n>Movies</span> <span class=p>=</span> <span class=n>MovieDatabase</span><span class=p>.</span><span class=n>FilterByGenre</span><span class=p>(</span><span class=n>Movies</span><span class=p>,</span> <span class=n>Genres</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=n>Movies</span> <span class=p>=</span> <span class=n>MovieDatabase</span><span class=p>.</span><span class=n>FilterByIMDBRating</span><span class=p>(</span><span class=n>Movies</span><span class=p>,</span> <span class=n>IMDBMin</span><span class=p>,</span> <span class=n>IMDBMax</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span></span></span></code></pre></div><p>The benefit of this approach is that as long as C# knows a conversion into the type we specify, the conversion is done automatically. Note that the parameter name matches the <code>name</code> property of the corresponding <code>&lt;input></code> - this must be the case for the Razor Page to bind the parameter to the corresponding input value.</p><p>Note that we still need to assign these parameter values to the corresponding properties of our PageModel. If we don&rsquo;t, then those properties will all be <code>null</code>, and the <code>&lt;inputs></code> rendered on our page will always be blank.</p><h2 id=model-binding>Model Binding</h2><p>A second option is to use <a href="https://docs.microsoft.com/en-us/aspnet/core/mvc/models/model-binding?view=aspnetcore-3.1" rel=external target=_blank><em>Model Binding</em></a>. Model binding also automatically converts incoming form data, but in this case it binds directly to the properties of our PageModel. We indicate this form of binding with a <code>[BindProperty]</code> attribute, i.e.:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-csharp data-lang=csharp><span class=line><span class=cl><span class=kd>public</span> <span class=k>class</span> <span class=nc>IndexModel</span> <span class=p>:</span> <span class=n>PageModel</span> <span class=p>{</span>
</span></span><span class=line><span class=cl><span class=na>
</span></span></span><span class=line><span class=cl><span class=na>    [BindProperty(SupportsGet=true)]</span>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=kt>string</span> <span class=n>SearchTerms</span> <span class=p>{</span><span class=k>get</span><span class=p>;</span> <span class=k>set</span><span class=p>;}</span>
</span></span><span class=line><span class=cl><span class=na>
</span></span></span><span class=line><span class=cl><span class=na>    [BindProperty(SupportsGet=true)]</span>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=kt>string</span><span class=p>[]</span> <span class=n>MPAARatings</span> <span class=p>{</span><span class=k>get</span><span class=p>;</span> <span class=k>set</span><span class=p>;}</span>
</span></span><span class=line><span class=cl><span class=na>
</span></span></span><span class=line><span class=cl><span class=na>    [BindProperty(SupportsGet=true)]</span>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=kt>string</span><span class=p>[]</span> <span class=n>Genres</span> <span class=p>{</span><span class=k>get</span><span class=p>;</span> <span class=k>set</span><span class=p>;}</span>
</span></span><span class=line><span class=cl><span class=na>
</span></span></span><span class=line><span class=cl><span class=na>    [BindProperty(SupportsGet=true)]</span>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=kt>double?</span> <span class=n>IMDBMin</span> <span class=p>{</span><span class=k>get</span><span class=p>;</span> <span class=k>set</span><span class=p>;}</span>
</span></span><span class=line><span class=cl><span class=na>
</span></span></span><span class=line><span class=cl><span class=na>    [BindProperty(SupportsGet=true)]</span>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=kt>double?</span> <span class=n>IMDBMax</span> <span class=p>{</span><span class=k>get</span><span class=p>;</span> <span class=k>set</span><span class=p>;}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=cs>/// &lt;summary&gt;</span>
</span></span><span class=line><span class=cl>    <span class=cs>/// Gets the search results for display on the page</span>
</span></span><span class=line><span class=cl>    <span class=cs>/// &lt;/summary&gt;</span>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=k>void</span> <span class=n>OnGet</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=n>Movies</span> <span class=p>=</span> <span class=n>MovieDatabase</span><span class=p>.</span><span class=n>Search</span><span class=p>(</span><span class=n>SearchTerms</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=n>Movies</span> <span class=p>=</span> <span class=n>MovieDatabase</span><span class=p>.</span><span class=n>FilterByMPAARating</span><span class=p>(</span><span class=n>Movies</span><span class=p>,</span> <span class=n>MPAARatings</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=n>Movies</span> <span class=p>=</span> <span class=n>MovieDatabase</span><span class=p>.</span><span class=n>FilterByGenre</span><span class=p>(</span><span class=n>Movies</span><span class=p>,</span> <span class=n>Genres</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=n>Movies</span> <span class=p>=</span> <span class=n>MovieDatabase</span><span class=p>.</span><span class=n>FilterByIMDBRating</span><span class=p>(</span><span class=n>Movies</span><span class=p>,</span> <span class=n>IMDBMin</span><span class=p>,</span> <span class=n>IMDBMax</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span></span></span></code></pre></div><p>Note that with this approach, the incoming data is directly bound to the properties, so we don&rsquo;t need to do any special assignments within our <code>OnGet()</code> method. Also, note that we have to use <code>SupportsGet=true</code> in order for this binding to occur on GET requests (by default, model binding only happens with POST requests).</p><div class="box notices cstyle note"><div class=box-label><i class="fa-fw fas fa-exclamation-circle"></i> Note</div><div class=box-content><p>You only need to do <em>one</em> binding approach per property in a PageModel. I.e. you can just use the property decorator:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-csharp data-lang=csharp><span class=line><span class=cl><span class=kd>public</span> <span class=k>class</span> <span class=nc>SomePageModel</span> <span class=p>:</span> <span class=n>PageModel</span>
</span></span><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl><span class=na>    [BindProperty(SupportsGet=true)]</span>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=kt>float</span> <span class=n>SomeProperty</span> <span class=p>{</span> <span class=k>get</span><span class=p>;</span> <span class=k>set</span><span class=p>;</span> <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=k>void</span> <span class=n>OnGet</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=n>DoSomething</span><span class=p>(</span><span class=n>SomeProperty</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span></span></span></code></pre></div><p><em>or</em> you might use parameter binding:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-csharp data-lang=csharp><span class=line><span class=cl><span class=kd>public</span> <span class=k>class</span> <span class=nc>SomePageModel</span> <span class=p>:</span> <span class=n>PageModel</span>
</span></span><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=k>void</span> <span class=n>OnGet</span><span class=p>(</span><span class=kt>float</span> <span class=n>SomeProperty</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=n>DoSomething</span><span class=p>(</span><span class=n>SomeProperty</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span></span></span></code></pre></div><p><em>or</em> you can parse it from the request:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-csharp data-lang=csharp><span class=line><span class=cl><span class=kd>public</span> <span class=k>class</span> <span class=nc>SomePageModel</span> <span class=p>:</span> <span class=n>PageModel</span>
</span></span><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=k>void</span> <span class=n>OnGet</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=kt>var</span> <span class=n>someProperty</span> <span class=p>=</span> <span class=kt>float</span><span class=p>.</span><span class=n>Parse</span><span class=p>(</span><span class=n>Request</span><span class=p>.</span><span class=n>Query</span><span class=p>[</span><span class=s>&#34;SomeProperty&#34;</span><span class=p>]);</span>
</span></span><span class=line><span class=cl>        <span class=n>DoSomething</span><span class=p>(</span><span class=n>someProperty</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span></span></span></code></pre></div><p>These are all <em>different means</em> of accessing the <em>same data</em> from the incoming request.</p></div></div><p>Now all we need to do is implement the actual filter.</p><h3 id=implementing-the-imdb-rating-filter>Implementing the IMDB Rating Filter</h3><p>We&rsquo;ll define the new filter in our <code>MovieDatabase</code> class as another static method:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-csharp data-lang=csharp><span class=line><span class=cl>    <span class=cs>/// &lt;summary&gt;</span>
</span></span><span class=line><span class=cl>    <span class=cs>/// Filters the provided collection of movies</span>
</span></span><span class=line><span class=cl>    <span class=cs>/// to those with IMDB ratings falling within</span>
</span></span><span class=line><span class=cl>    <span class=cs>/// the specified range</span>
</span></span><span class=line><span class=cl>    <span class=cs>/// &lt;/summary&gt;</span>
</span></span><span class=line><span class=cl>    <span class=cs>/// &lt;param name=&#34;movies&#34;&gt;The collection of movies to filter&lt;/param&gt;</span>
</span></span><span class=line><span class=cl>    <span class=cs>/// &lt;param name=&#34;min&#34;&gt;The minimum range value&lt;/param&gt;</span>
</span></span><span class=line><span class=cl>    <span class=cs>/// &lt;param name=&#34;max&#34;&gt;The maximum range value&lt;/param&gt;</span>
</span></span><span class=line><span class=cl>    <span class=cs>/// &lt;returns&gt;The filtered movie collection&lt;/returns&gt;</span>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=kd>static</span> <span class=n>IEnumerable</span><span class=p>&lt;</span><span class=n>Movie</span><span class=p>&gt;</span> <span class=n>FilterByIMDBRating</span><span class=p>(</span><span class=n>IEnumerable</span><span class=p>&lt;</span><span class=n>Movie</span><span class=p>&gt;</span> <span class=n>movies</span><span class=p>,</span> <span class=kt>double?</span> <span class=n>min</span><span class=p>,</span> <span class=kt>double?</span> <span class=n>max</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=c1>// TODO: Filter movies</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span></span></span></code></pre></div><p>Notice that here too we use the nullable double value. So our first step is probably to do a <code>null</code> check:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-csharp data-lang=csharp><span class=line><span class=cl>    <span class=k>if</span> <span class=p>(</span><span class=n>min</span> <span class=p>==</span> <span class=kc>null</span> <span class=p>&amp;&amp;</span> <span class=n>max</span> <span class=p>==</span> <span class=kc>null</span><span class=p>)</span> <span class=k>return</span> <span class=n>movies</span><span class=p>;</span></span></span></code></pre></div><p>But what if only one is null? Should we filter for that part of the range? It wouldn&rsquo;t be hard to do:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-csharp data-lang=csharp><span class=line><span class=cl>    <span class=kt>var</span> <span class=n>results</span> <span class=p>=</span> <span class=k>new</span> <span class=n>List</span><span class=p>&lt;</span><span class=n>Movie</span><span class=p>&gt;();</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c1>// only a maximum specified</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span><span class=p>(</span><span class=n>min</span> <span class=p>==</span> <span class=kc>null</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=k>foreach</span><span class=p>(</span><span class=n>Movie</span> <span class=n>movie</span> <span class=k>in</span> <span class=n>movies</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=k>if</span> <span class=p>(</span><span class=n>movie</span><span class=p>.</span><span class=n>IMDBRating</span> <span class=p>&lt;=</span> <span class=n>max</span><span class=p>)</span> <span class=n>results</span><span class=p>.</span><span class=n>Add</span><span class=p>(</span><span class=n>movie</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=n>results</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span></span></span></code></pre></div><p>And the minimum would mirror that:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-csharp data-lang=csharp><span class=line><span class=cl>    <span class=c1>// only a minimum specified</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span><span class=p>(</span><span class=n>max</span> <span class=p>==</span> <span class=kc>null</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=k>foreach</span><span class=p>(</span><span class=n>Movie</span> <span class=n>movie</span> <span class=k>in</span> <span class=n>movies</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=k>if</span> <span class=p>(</span><span class=n>movie</span><span class=p>.</span><span class=n>IMDBRating</span> <span class=p>&gt;=</span> <span class=n>min</span><span class=p>)</span> <span class=n>results</span><span class=p>.</span><span class=n>Add</span><span class=p>(</span><span class=n>movie</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=n>results</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span></span></span></code></pre></div><p>Finally, we could handle the case where we have both a min and max value to our range:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-csharp data-lang=csharp><span class=line><span class=cl>    <span class=c1>// Both minimum and maximum specified</span>
</span></span><span class=line><span class=cl>    <span class=k>foreach</span><span class=p>(</span><span class=n>Movie</span> <span class=n>movie</span> <span class=k>in</span> <span class=n>movies</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span><span class=p>(</span><span class=n>movie</span><span class=p>.</span><span class=n>IMDBRating</span> <span class=p>&gt;=</span> <span class=n>min</span> <span class=p>&amp;&amp;</span> <span class=n>movie</span><span class=p>.</span><span class=n>IMDBRating</span> <span class=p>&lt;=</span> <span class=n>max</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=n>results</span><span class=p>.</span><span class=n>Add</span><span class=p>(</span><span class=n>movie</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=n>results</span><span class=p>;</span></span></span></code></pre></div><p>Notice too, that in each of these cases we&rsquo;re treating the range as <em>inclusive</em> (including the specified minimum and maximum). This is the behavior most casual internet users will expect. If the database and user expectations are different for your audience, you&rsquo;d want your code to match that expectation.</p><p>Now we can filter by IMDB rating:</p><p><a href=#R-image-ae8c51eef3070b44cd78a9806fe75b19 class=lightbox-link><img alt="Filtering By IMDB" class="border lazy lightbox noshadow figure-image" loading=lazy src=/cis400/images/6.8.6.png style=height:auto;width:auto></a>
<a href=javascript:history.back(); class=lightbox-back id=R-image-ae8c51eef3070b44cd78a9806fe75b19><img alt="Filtering By IMDB" class="border lazy lightbox noshadow lightbox-image" loading=lazy src=/cis400/images/6.8.6.png></a></p><h2 id=finishing-up>Finishing Up</h2><p>Since we&rsquo;re displaying the Rotten Tomatoes rating, we should probably also have a filter for it. This will work almost exactly like the IMDB rating - but with the range from 0 to 100. I&rsquo;ll leave this as an exercise for the reader.</p><footer class=footline></footer></article><article class=default><header class=headline></header><h1 id=numerical-filters>Numerical Filters</h1><p>Let&rsquo;s tackle one of the critics ratings next. While we could create categories and use checkboxes, this doesn&rsquo;t capture the incremental values (i.e. 4.3), and it would be a <em>lot</em> of checkboxes for Rotten Tomatoes ratings! Instead, we&rsquo;ll use a <em>numerical filter</em>, which limits our possible results to a range - between a minimum and maximum value.</p><p>Moreover, let&rsquo;s clean up our Index page, as it is getting difficult to determine what filter(s) go together, and and are adding more.</p><h2 id=refactoring-the-index-page>Refactoring the Index Page</h2><p>Let&rsquo;s move the filters to a column on the left, leave the search bar above, and show our results on the right. This will require refactoring our <em>Index.cshtml</em> file:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-csharp data-lang=csharp><span class=line><span class=cl>    <span class=p>&lt;</span><span class=n>form</span> <span class=n>id</span><span class=p>=</span><span class=s>&#34;movie-database&#34;</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=p>&lt;</span><span class=n>div</span> <span class=n>id</span><span class=p>=</span><span class=s>&#34;search&#34;</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>            <span class=p>&lt;</span><span class=n>input</span> <span class=n>type</span><span class=p>=</span><span class=s>&#34;text&#34;</span> <span class=n>name</span><span class=p>=</span><span class=s>&#34;SearchTerms&#34;</span> <span class=k>value</span><span class=p>=</span><span class=s>&#34;@Model.SearchTerms&#34;</span> <span class=p>/&gt;</span>
</span></span><span class=line><span class=cl>            <span class=p>&lt;</span><span class=n>input</span> <span class=n>type</span><span class=p>=</span><span class=s>&#34;submit&#34;</span> <span class=k>value</span><span class=p>=</span><span class=s>&#34;Search&#34;</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>        <span class=p>&lt;/</span><span class=n>div</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=p>&lt;</span><span class=n>div</span> <span class=n>id</span><span class=p>=</span><span class=s>&#34;filters&#34;</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>            <span class=p>&lt;</span><span class=n>h4</span><span class=p>&gt;</span><span class=n>MPAA</span> <span class=n>Rating</span><span class=p>&lt;/</span><span class=n>h4</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>            <span class=n>@foreach</span> <span class=p>(</span><span class=kt>string</span> <span class=n>rating</span> <span class=k>in</span> <span class=n>MovieDatabase</span><span class=p>.</span><span class=n>MPAARatings</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            <span class=p>{</span>
</span></span><span class=line><span class=cl>                <span class=p>&lt;</span><span class=n>label</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>                    <span class=p>&lt;</span><span class=n>input</span> <span class=n>type</span><span class=p>=</span><span class=s>&#34;checkbox&#34;</span> <span class=n>name</span><span class=p>=</span><span class=s>&#34;MPAARatings&#34;</span> <span class=k>value</span><span class=p>=</span><span class=s>&#34;@rating&#34;</span> <span class=k>checked</span><span class=p>=</span><span class=s>&#34;@Model.MPAARatings.Contains(rating)&#34;</span> <span class=p>/&gt;</span>
</span></span><span class=line><span class=cl>                    <span class=n>@rating</span>
</span></span><span class=line><span class=cl>                <span class=p>&lt;/</span><span class=n>label</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>            <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>            <span class=p>&lt;</span><span class=n>h4</span><span class=p>&gt;</span><span class=n>Genre</span><span class=p>&lt;/</span><span class=n>h4</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>            <span class=n>@foreach</span> <span class=p>(</span><span class=kt>string</span> <span class=n>genre</span> <span class=k>in</span> <span class=n>MovieDatabase</span><span class=p>.</span><span class=n>Genres</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            <span class=p>{</span>
</span></span><span class=line><span class=cl>                <span class=p>&lt;</span><span class=n>label</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>                    <span class=p>&lt;</span><span class=n>input</span> <span class=n>type</span><span class=p>=</span><span class=s>&#34;checkbox&#34;</span> <span class=n>name</span><span class=p>=</span><span class=s>&#34;Genres&#34;</span> <span class=k>value</span><span class=p>=</span><span class=s>&#34;@genre&#34;</span> <span class=p>/&gt;</span>
</span></span><span class=line><span class=cl>                    <span class=n>@genre</span>
</span></span><span class=line><span class=cl>                <span class=p>&lt;/</span><span class=n>label</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>            <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>            <span class=p>&lt;</span><span class=n>h4</span><span class=p>&gt;</span><span class=n>IMDB</span> <span class=n>Rating</span><span class=p>&lt;/</span><span class=n>h4</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>            <span class=p>&lt;</span><span class=n>div</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>                <span class=n>Between</span>
</span></span><span class=line><span class=cl>                <span class=p>&lt;</span><span class=n>input</span> <span class=n>name</span><span class=p>=</span><span class=s>&#34;IMDBMin&#34;</span> <span class=n>type</span><span class=p>=</span><span class=s>&#34;number&#34;</span> <span class=n>min</span><span class=p>=</span><span class=s>&#34;0&#34;</span> <span class=n>max</span><span class=p>=</span><span class=s>&#34;10&#34;</span> <span class=n>step</span><span class=p>=</span><span class=s>&#34;0.1&#34;</span> <span class=n>placeholder</span><span class=p>=</span><span class=s>&#34;min&#34;</span><span class=p>/&gt;</span>
</span></span><span class=line><span class=cl>                <span class=n>and</span>
</span></span><span class=line><span class=cl>                <span class=p>&lt;</span><span class=n>input</span> <span class=n>name</span><span class=p>=</span><span class=s>&#34;IMDBMax&#34;</span> <span class=n>type</span><span class=p>=</span><span class=s>&#34;number&#34;</span> <span class=n>min</span><span class=p>=</span><span class=s>&#34;0&#34;</span> <span class=n>max</span><span class=p>=</span><span class=s>&#34;10&#34;</span> <span class=n>step</span><span class=p>=</span><span class=s>&#34;0.1&#34;</span> <span class=n>placeholder</span><span class=p>=</span><span class=s>&#34;max&#34;</span><span class=p>/&gt;</span>
</span></span><span class=line><span class=cl>            <span class=p>&lt;/</span><span class=n>div</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=p>&lt;/</span><span class=n>div</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=p>&lt;</span><span class=n>div</span> <span class=n>id</span><span class=p>=</span><span class=s>&#34;results&#34;</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>            <span class=p>&lt;</span><span class=n>h1</span><span class=p>&gt;</span><span class=n>Movie</span> <span class=n>Results</span><span class=p>&lt;/</span><span class=n>h1</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>            <span class=p>&lt;</span><span class=n>ul</span> <span class=n>class</span><span class=p>=</span><span class=s>&#34;movie-list&#34;</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>                <span class=n>@foreach</span> <span class=p>(</span><span class=n>Movie</span> <span class=n>movie</span> <span class=k>in</span> <span class=n>@Model</span><span class=p>.</span><span class=n>Movies</span><span class=p>)</span>
</span></span><span class=line><span class=cl>                <span class=p>{</span>
</span></span><span class=line><span class=cl>                    <span class=p>&lt;</span><span class=n>li</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>                        <span class=p>&lt;</span><span class=n>div</span> <span class=n>class</span><span class=p>=</span><span class=s>&#34;details&#34;</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>                            <span class=p>&lt;</span><span class=n>h3</span> <span class=n>class</span><span class=p>=</span><span class=s>&#34;title&#34;</span><span class=p>&gt;</span><span class=n>@movie</span><span class=p>.</span><span class=n>Title</span><span class=p>&lt;/</span><span class=n>h3</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>                            <span class=p>&lt;</span><span class=n>div</span> <span class=n>class</span><span class=p>=</span><span class=s>&#34;mpaa&#34;</span><span class=p>&gt;</span><span class=n>@movie</span><span class=p>.</span><span class=n>MPAARating</span><span class=p>&lt;/</span><span class=n>div</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>                            <span class=p>&lt;</span><span class=n>div</span> <span class=n>class</span><span class=p>=</span><span class=s>&#34;genre&#34;</span><span class=p>&gt;</span><span class=n>@movie</span><span class=p>.</span><span class=n>MajorGenre</span><span class=p>&lt;/</span><span class=n>div</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>                        <span class=p>&lt;/</span><span class=n>div</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>                        <span class=p>&lt;</span><span class=n>div</span> <span class=n>class</span><span class=p>=</span><span class=s>&#34;ratings&#34;</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>                            <span class=n>@if</span> <span class=p>(</span><span class=n>movie</span><span class=p>.</span><span class=n>IMDBRating</span> <span class=p>!=</span> <span class=kc>null</span><span class=p>)</span>
</span></span><span class=line><span class=cl>                            <span class=p>{</span>
</span></span><span class=line><span class=cl>                                <span class=p>&lt;</span><span class=n>div</span> <span class=n>class</span><span class=p>=</span><span class=s>&#34;imdb&#34;</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>                                    <span class=n>@movie</span><span class=p>.</span><span class=n>IMDBRating</span>
</span></span><span class=line><span class=cl>                                <span class=p>&lt;/</span><span class=n>div</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>                            <span class=p>}</span>
</span></span><span class=line><span class=cl>                            <span class=n>@if</span> <span class=p>(</span><span class=n>movie</span><span class=p>.</span><span class=n>RottenTomatoesRating</span> <span class=p>!=</span> <span class=kc>null</span><span class=p>)</span>
</span></span><span class=line><span class=cl>                            <span class=p>{</span>
</span></span><span class=line><span class=cl>                                <span class=p>&lt;</span><span class=n>div</span> <span class=n>class</span><span class=p>=</span><span class=s>&#34;rotten-tomatoes&#34;</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>                                    <span class=n>@movie</span><span class=p>.</span><span class=n>RottenTomatoesRating</span>
</span></span><span class=line><span class=cl>                                <span class=p>&lt;/</span><span class=n>div</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>                            <span class=p>}</span>
</span></span><span class=line><span class=cl>                        <span class=p>&lt;/</span><span class=n>div</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>                    <span class=p>&lt;/</span><span class=n>li</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>                <span class=p>}</span>
</span></span><span class=line><span class=cl>            <span class=p>&lt;/</span><span class=n>ul</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>        <span class=p>&lt;/</span><span class=n>div</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=p>&lt;/</span><span class=n>form</span><span class=p>&gt;</span></span></span></code></pre></div><p>Most of this is simply moving elements around the page, but note that we are using inputs of <code>type=number</code> to represent our range of IMDB values. We can specify a minimum and maximum for this range, as well as an allowable increment. Also, we use the <code>placeholder</code> attribute to put text into the <code>input</code> until a value is added.</p><h2 id=adding-more-styles>Adding More Styles</h2><p>Now we&rsquo;ll need to add some rules to our <em>wwwroot/css/styles.css</em>. First, we&rsquo;ll use a <code>grid</code> for the layout of the form:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-css data-lang=css><span class=line><span class=cl><span class=nt>form</span><span class=p>#</span><span class=nn>movie-database</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>display</span><span class=p>:</span> <span class=k>grid</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=k>grid-template-columns</span><span class=p>:</span> <span class=mi>1</span><span class=n>fr</span> <span class=mi>3</span><span class=n>fr</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=k>grid-template-rows</span><span class=p>:</span> <span class=kc>auto</span> <span class=kc>auto</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span></span></span></code></pre></div><p>The right column will be three times as big as the left.</p><p>We can make our search bar span both columns with <code>grid-column-start</code> and <code>grid-column-end</code>:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-css data-lang=css><span class=line><span class=cl><span class=p>#</span><span class=nn>search</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>grid-column-start</span><span class=p>:</span> <span class=mi>1</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=k>grid-column-end</span><span class=p>:</span> <span class=mi>3</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=k>text-align</span><span class=p>:</span> <span class=kc>center</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span></span></span></code></pre></div><p>Notice too that for CSS, we start counting at 1, not 0. The filters and the results will fall in the next row automatically, each taking up their own respective grid cell. You can read more about the grid layout in <a href=https://css-tricks.com/snippets/css/complete-guide-grid/ rel=external target=_blank>A Complete Guide to Grid</a>.</p><p>Let&rsquo;s go ahead and use flexbox to lay out our filters in a column:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-css data-lang=css><span class=line><span class=cl><span class=p>#</span><span class=nn>filters</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>display</span><span class=p>:</span> <span class=kc>flex</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=k>flex-direction</span><span class=p>:</span> <span class=kc>column</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span></span></span></code></pre></div><p>And make our number inputs bigger:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-css data-lang=css><span class=line><span class=cl><span class=p>#</span><span class=nn>filters</span> <span class=nt>input</span><span class=o>[</span><span class=nt>type</span><span class=o>=</span><span class=nt>number</span><span class=o>]</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>width</span><span class=p>:</span> <span class=mi>4</span><span class=kt>rem</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span></span></span></code></pre></div><p>Notice the use of square brackets in our CSS Selector to only apply to inputs with type number.</p><p>Also, let&rsquo;s add a margin above and remove most of the margin below our <code>&lt;h4></code> elements:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-css data-lang=css><span class=line><span class=cl><span class=p>#</span><span class=nn>filters</span> <span class=nt>h4</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>margin-bottom</span><span class=p>:</span> <span class=mf>0.2</span><span class=kt>rem</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=k>margin-top</span><span class=p>:</span> <span class=mi>2</span><span class=kt>rem</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span></span></span></code></pre></div><p>The resulting page looks much cleaner:</p><p><a href=#R-image-95c10df170c6f35e6a77c7091e7d5341 class=lightbox-link><img alt="The Styled Page" class="border lazy lightbox noshadow figure-image" loading=lazy src=/cis400/images/6.8.5.png style=height:auto;width:auto></a>
<a href=javascript:history.back(); class=lightbox-back id=R-image-95c10df170c6f35e6a77c7091e7d5341><img alt="The Styled Page" class="border lazy lightbox noshadow lightbox-image" loading=lazy src=/cis400/images/6.8.5.png></a></p><h2 id=capturing-the-filter-values>Capturing the Filter Values</h2><p>Now we need to get the filter values from our GET request query string. We could do this like we&rsquo;ve been doing before, with:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-csharp data-lang=csharp><span class=line><span class=cl>    <span class=n>Request</span><span class=p>.</span><span class=n>Query</span><span class=p>[</span><span class=s>&#34;IMDBMin&#34;</span><span class=p>];</span></span></span></code></pre></div><p>But the returned value would be a string, so we&rsquo;d need to parse it:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-csharp data-lang=csharp><span class=line><span class=cl>    <span class=n>IMDBMin</span> <span class=p>=</span> <span class=kt>double</span><span class=p>.</span><span class=n>Parse</span><span class=p>(</span><span class=n>Request</span><span class=p>.</span><span class=n>Query</span><span class=p>[</span><span class=s>&#34;IMDBMin&#34;</span><span class=p>]);</span></span></span></code></pre></div><p>If the query was <code>null</code>, then this would evaluate to <code>NaN</code>, which we wouldn&rsquo;t want to set our <code>&lt;input></code> to&mldr;</p><p>Instead, we&rsquo;ll look at some options built into the PageModel.</p><h2 id=parameter-binding>Parameter Binding</h2><p>The first of these options is <a href=https://docs.microsoft.com/en-us/aspnet/web-api/overview/formats-and-model-binding/parameter-binding-in-aspnet-web-api rel=external target=_blank><em>Parameter Binding</em></a>. In this approach, we define parameters to our <code>OnGet()</code> method to be parsed out of the request automatically, i.e.:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-csharp data-lang=csharp><span class=line><span class=cl>    <span class=cs>/// &lt;summary&gt;</span>
</span></span><span class=line><span class=cl>    <span class=cs>/// Gets the search results for display on the page</span>
</span></span><span class=line><span class=cl>    <span class=cs>/// &lt;/summary&gt;</span>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=k>void</span> <span class=n>OnGet</span><span class=p>(</span><span class=kt>string</span> <span class=n>SearchTerms</span><span class=p>,</span> <span class=kt>string</span><span class=p>[]</span> <span class=n>MPAARatings</span><span class=p>,</span> <span class=kt>string</span><span class=p>[]</span> <span class=n>Genres</span><span class=p>,</span> <span class=kt>double?</span> <span class=n>IMDBMin</span><span class=p>,</span> <span class=kt>double?</span> <span class=n>IMDBMax</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=k>this</span><span class=p>.</span><span class=n>SearchTerms</span> <span class=p>=</span> <span class=n>SearchTerms</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=k>this</span><span class=p>.</span><span class=n>MPAARatings</span> <span class=p>=</span> <span class=n>MPAARatings</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=k>this</span><span class=p>.</span><span class=n>Genres</span> <span class=p>=</span> <span class=n>Genres</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=k>this</span><span class=p>.</span><span class=n>IMDBMin</span> <span class=p>=</span> <span class=n>IMDBMin</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=k>this</span><span class=p>.</span><span class=n>IMDBMax</span> <span class=p>=</span> <span class=n>IMDBMax</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=n>Movies</span> <span class=p>=</span> <span class=n>MovieDatabase</span><span class=p>.</span><span class=n>Search</span><span class=p>(</span><span class=n>SearchTerms</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=n>Movies</span> <span class=p>=</span> <span class=n>MovieDatabase</span><span class=p>.</span><span class=n>FilterByMPAARating</span><span class=p>(</span><span class=n>Movies</span><span class=p>,</span> <span class=n>MPAARatings</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=n>Movies</span> <span class=p>=</span> <span class=n>MovieDatabase</span><span class=p>.</span><span class=n>FilterByGenre</span><span class=p>(</span><span class=n>Movies</span><span class=p>,</span> <span class=n>Genres</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=n>Movies</span> <span class=p>=</span> <span class=n>MovieDatabase</span><span class=p>.</span><span class=n>FilterByIMDBRating</span><span class=p>(</span><span class=n>Movies</span><span class=p>,</span> <span class=n>IMDBMin</span><span class=p>,</span> <span class=n>IMDBMax</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span></span></span></code></pre></div><p>The benefit of this approach is that as long as C# knows a conversion into the type we specify, the conversion is done automatically. Note that the parameter name matches the <code>name</code> property of the corresponding <code>&lt;input></code> - this must be the case for the Razor Page to bind the parameter to the corresponding input value.</p><p>Note that we still need to assign these parameter values to the corresponding properties of our PageModel. If we don&rsquo;t, then those properties will all be <code>null</code>, and the <code>&lt;inputs></code> rendered on our page will always be blank.</p><h2 id=model-binding>Model Binding</h2><p>A second option is to use <a href="https://docs.microsoft.com/en-us/aspnet/core/mvc/models/model-binding?view=aspnetcore-3.1" rel=external target=_blank><em>Model Binding</em></a>. Model binding also automatically converts incoming form data, but in this case it binds directly to the properties of our PageModel. We indicate this form of binding with a <code>[BindProperty]</code> attribute, i.e.:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-csharp data-lang=csharp><span class=line><span class=cl><span class=kd>public</span> <span class=k>class</span> <span class=nc>IndexModel</span> <span class=p>:</span> <span class=n>PageModel</span> <span class=p>{</span>
</span></span><span class=line><span class=cl><span class=na>
</span></span></span><span class=line><span class=cl><span class=na>    [BindProperty(SupportsGet=true)]</span>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=kt>string</span> <span class=n>SearchTerms</span> <span class=p>{</span><span class=k>get</span><span class=p>;</span> <span class=k>set</span><span class=p>;}</span>
</span></span><span class=line><span class=cl><span class=na>
</span></span></span><span class=line><span class=cl><span class=na>    [BindProperty(SupportsGet=true)]</span>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=kt>string</span><span class=p>[]</span> <span class=n>MPAARatings</span> <span class=p>{</span><span class=k>get</span><span class=p>;</span> <span class=k>set</span><span class=p>;}</span>
</span></span><span class=line><span class=cl><span class=na>
</span></span></span><span class=line><span class=cl><span class=na>    [BindProperty(SupportsGet=true)]</span>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=kt>string</span><span class=p>[]</span> <span class=n>Genres</span> <span class=p>{</span><span class=k>get</span><span class=p>;</span> <span class=k>set</span><span class=p>;}</span>
</span></span><span class=line><span class=cl><span class=na>
</span></span></span><span class=line><span class=cl><span class=na>    [BindProperty(SupportsGet=true)]</span>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=kt>double?</span> <span class=n>IMDBMin</span> <span class=p>{</span><span class=k>get</span><span class=p>;</span> <span class=k>set</span><span class=p>;}</span>
</span></span><span class=line><span class=cl><span class=na>
</span></span></span><span class=line><span class=cl><span class=na>    [BindProperty(SupportsGet=true)]</span>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=kt>double?</span> <span class=n>IMDBMax</span> <span class=p>{</span><span class=k>get</span><span class=p>;</span> <span class=k>set</span><span class=p>;}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=cs>/// &lt;summary&gt;</span>
</span></span><span class=line><span class=cl>    <span class=cs>/// Gets the search results for display on the page</span>
</span></span><span class=line><span class=cl>    <span class=cs>/// &lt;/summary&gt;</span>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=k>void</span> <span class=n>OnGet</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=n>Movies</span> <span class=p>=</span> <span class=n>MovieDatabase</span><span class=p>.</span><span class=n>Search</span><span class=p>(</span><span class=n>SearchTerms</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=n>Movies</span> <span class=p>=</span> <span class=n>MovieDatabase</span><span class=p>.</span><span class=n>FilterByMPAARating</span><span class=p>(</span><span class=n>Movies</span><span class=p>,</span> <span class=n>MPAARatings</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=n>Movies</span> <span class=p>=</span> <span class=n>MovieDatabase</span><span class=p>.</span><span class=n>FilterByGenre</span><span class=p>(</span><span class=n>Movies</span><span class=p>,</span> <span class=n>Genres</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=n>Movies</span> <span class=p>=</span> <span class=n>MovieDatabase</span><span class=p>.</span><span class=n>FilterByIMDBRating</span><span class=p>(</span><span class=n>Movies</span><span class=p>,</span> <span class=n>IMDBMin</span><span class=p>,</span> <span class=n>IMDBMax</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span></span></span></code></pre></div><p>Note that with this approach, the incoming data is directly bound to the properties, so we don&rsquo;t need to do any special assignments within our <code>OnGet()</code> method. Also, note that we have to use <code>SupportsGet=true</code> in order for this binding to occur on GET requests (by default, model binding only happens with POST requests).</p><div class="box notices cstyle note"><div class=box-label><i class="fa-fw fas fa-exclamation-circle"></i> Note</div><div class=box-content><p>You only need to do <em>one</em> binding approach per property in a PageModel. I.e. you can just use the property decorator:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-csharp data-lang=csharp><span class=line><span class=cl><span class=kd>public</span> <span class=k>class</span> <span class=nc>SomePageModel</span> <span class=p>:</span> <span class=n>PageModel</span>
</span></span><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl><span class=na>    [BindProperty(SupportsGet=true)]</span>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=kt>float</span> <span class=n>SomeProperty</span> <span class=p>{</span> <span class=k>get</span><span class=p>;</span> <span class=k>set</span><span class=p>;</span> <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=k>void</span> <span class=n>OnGet</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=n>DoSomething</span><span class=p>(</span><span class=n>SomeProperty</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span></span></span></code></pre></div><p><em>or</em> you might use parameter binding:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-csharp data-lang=csharp><span class=line><span class=cl><span class=kd>public</span> <span class=k>class</span> <span class=nc>SomePageModel</span> <span class=p>:</span> <span class=n>PageModel</span>
</span></span><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=k>void</span> <span class=n>OnGet</span><span class=p>(</span><span class=kt>float</span> <span class=n>SomeProperty</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=n>DoSomething</span><span class=p>(</span><span class=n>SomeProperty</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span></span></span></code></pre></div><p><em>or</em> you can parse it from the request:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-csharp data-lang=csharp><span class=line><span class=cl><span class=kd>public</span> <span class=k>class</span> <span class=nc>SomePageModel</span> <span class=p>:</span> <span class=n>PageModel</span>
</span></span><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=k>void</span> <span class=n>OnGet</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=kt>var</span> <span class=n>someProperty</span> <span class=p>=</span> <span class=kt>float</span><span class=p>.</span><span class=n>Parse</span><span class=p>(</span><span class=n>Request</span><span class=p>.</span><span class=n>Query</span><span class=p>[</span><span class=s>&#34;SomeProperty&#34;</span><span class=p>]);</span>
</span></span><span class=line><span class=cl>        <span class=n>DoSomething</span><span class=p>(</span><span class=n>someProperty</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span></span></span></code></pre></div><p>These are all <em>different means</em> of accessing the <em>same data</em> from the incoming request.</p></div></div><p>Now all we need to do is implement the actual filter.</p><h3 id=implementing-the-imdb-rating-filter>Implementing the IMDB Rating Filter</h3><p>We&rsquo;ll define the new filter in our <code>MovieDatabase</code> class as another static method:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-csharp data-lang=csharp><span class=line><span class=cl>    <span class=cs>/// &lt;summary&gt;</span>
</span></span><span class=line><span class=cl>    <span class=cs>/// Filters the provided collection of movies</span>
</span></span><span class=line><span class=cl>    <span class=cs>/// to those with IMDB ratings falling within</span>
</span></span><span class=line><span class=cl>    <span class=cs>/// the specified range</span>
</span></span><span class=line><span class=cl>    <span class=cs>/// &lt;/summary&gt;</span>
</span></span><span class=line><span class=cl>    <span class=cs>/// &lt;param name=&#34;movies&#34;&gt;The collection of movies to filter&lt;/param&gt;</span>
</span></span><span class=line><span class=cl>    <span class=cs>/// &lt;param name=&#34;min&#34;&gt;The minimum range value&lt;/param&gt;</span>
</span></span><span class=line><span class=cl>    <span class=cs>/// &lt;param name=&#34;max&#34;&gt;The maximum range value&lt;/param&gt;</span>
</span></span><span class=line><span class=cl>    <span class=cs>/// &lt;returns&gt;The filtered movie collection&lt;/returns&gt;</span>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=kd>static</span> <span class=n>IEnumerable</span><span class=p>&lt;</span><span class=n>Movie</span><span class=p>&gt;</span> <span class=n>FilterByIMDBRating</span><span class=p>(</span><span class=n>IEnumerable</span><span class=p>&lt;</span><span class=n>Movie</span><span class=p>&gt;</span> <span class=n>movies</span><span class=p>,</span> <span class=kt>double?</span> <span class=n>min</span><span class=p>,</span> <span class=kt>double?</span> <span class=n>max</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=c1>// TODO: Filter movies</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span></span></span></code></pre></div><p>Notice that here too we use the nullable double value. So our first step is probably to do a <code>null</code> check:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-csharp data-lang=csharp><span class=line><span class=cl>    <span class=k>if</span> <span class=p>(</span><span class=n>min</span> <span class=p>==</span> <span class=kc>null</span> <span class=p>&amp;&amp;</span> <span class=n>max</span> <span class=p>==</span> <span class=kc>null</span><span class=p>)</span> <span class=k>return</span> <span class=n>movies</span><span class=p>;</span></span></span></code></pre></div><p>But what if only one is null? Should we filter for that part of the range? It wouldn&rsquo;t be hard to do:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-csharp data-lang=csharp><span class=line><span class=cl>    <span class=kt>var</span> <span class=n>results</span> <span class=p>=</span> <span class=k>new</span> <span class=n>List</span><span class=p>&lt;</span><span class=n>Movie</span><span class=p>&gt;();</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c1>// only a maximum specified</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span><span class=p>(</span><span class=n>min</span> <span class=p>==</span> <span class=kc>null</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=k>foreach</span><span class=p>(</span><span class=n>Movie</span> <span class=n>movie</span> <span class=k>in</span> <span class=n>movies</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=k>if</span> <span class=p>(</span><span class=n>movie</span><span class=p>.</span><span class=n>IMDBRating</span> <span class=p>&lt;=</span> <span class=n>max</span><span class=p>)</span> <span class=n>results</span><span class=p>.</span><span class=n>Add</span><span class=p>(</span><span class=n>movie</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=n>results</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span></span></span></code></pre></div><p>And the minimum would mirror that:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-csharp data-lang=csharp><span class=line><span class=cl>    <span class=c1>// only a minimum specified</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span><span class=p>(</span><span class=n>max</span> <span class=p>==</span> <span class=kc>null</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=k>foreach</span><span class=p>(</span><span class=n>Movie</span> <span class=n>movie</span> <span class=k>in</span> <span class=n>movies</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=k>if</span> <span class=p>(</span><span class=n>movie</span><span class=p>.</span><span class=n>IMDBRating</span> <span class=p>&gt;=</span> <span class=n>min</span><span class=p>)</span> <span class=n>results</span><span class=p>.</span><span class=n>Add</span><span class=p>(</span><span class=n>movie</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=n>results</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span></span></span></code></pre></div><p>Finally, we could handle the case where we have both a min and max value to our range:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-csharp data-lang=csharp><span class=line><span class=cl>    <span class=c1>// Both minimum and maximum specified</span>
</span></span><span class=line><span class=cl>    <span class=k>foreach</span><span class=p>(</span><span class=n>Movie</span> <span class=n>movie</span> <span class=k>in</span> <span class=n>movies</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span><span class=p>(</span><span class=n>movie</span><span class=p>.</span><span class=n>IMDBRating</span> <span class=p>&gt;=</span> <span class=n>min</span> <span class=p>&amp;&amp;</span> <span class=n>movie</span><span class=p>.</span><span class=n>IMDBRating</span> <span class=p>&lt;=</span> <span class=n>max</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=n>results</span><span class=p>.</span><span class=n>Add</span><span class=p>(</span><span class=n>movie</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=n>results</span><span class=p>;</span></span></span></code></pre></div><p>Notice too, that in each of these cases we&rsquo;re treating the range as <em>inclusive</em> (including the specified minimum and maximum). This is the behavior most casual internet users will expect. If the database and user expectations are different for your audience, you&rsquo;d want your code to match that expectation.</p><p>Now we can filter by IMDB rating:</p><p><a href=#R-image-98e2dcac2c180c77fa8016b93f85e87c class=lightbox-link><img alt="Filtering By IMDB" class="border lazy lightbox noshadow figure-image" loading=lazy src=/cis400/images/6.8.6.png style=height:auto;width:auto></a>
<a href=javascript:history.back(); class=lightbox-back id=R-image-98e2dcac2c180c77fa8016b93f85e87c><img alt="Filtering By IMDB" class="border lazy lightbox noshadow lightbox-image" loading=lazy src=/cis400/images/6.8.6.png></a></p><h2 id=finishing-up>Finishing Up</h2><p>Since we&rsquo;re displaying the Rotten Tomatoes rating, we should probably also have a filter for it. This will work almost exactly like the IMDB rating - but with the range from 0 to 100. I&rsquo;ll leave this as an exercise for the reader.</p><footer class=footline></footer></article><article class=default><header class=headline></header><h1 id=numerical-filters>Numerical Filters</h1><p>Let&rsquo;s tackle one of the critics ratings next. While we could create categories and use checkboxes, this doesn&rsquo;t capture the incremental values (i.e. 4.3), and it would be a <em>lot</em> of checkboxes for Rotten Tomatoes ratings! Instead, we&rsquo;ll use a <em>numerical filter</em>, which limits our possible results to a range - between a minimum and maximum value.</p><p>Moreover, let&rsquo;s clean up our Index page, as it is getting difficult to determine what filter(s) go together, and and are adding more.</p><h2 id=refactoring-the-index-page>Refactoring the Index Page</h2><p>Let&rsquo;s move the filters to a column on the left, leave the search bar above, and show our results on the right. This will require refactoring our <em>Index.cshtml</em> file:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-csharp data-lang=csharp><span class=line><span class=cl>    <span class=p>&lt;</span><span class=n>form</span> <span class=n>id</span><span class=p>=</span><span class=s>&#34;movie-database&#34;</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=p>&lt;</span><span class=n>div</span> <span class=n>id</span><span class=p>=</span><span class=s>&#34;search&#34;</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>            <span class=p>&lt;</span><span class=n>input</span> <span class=n>type</span><span class=p>=</span><span class=s>&#34;text&#34;</span> <span class=n>name</span><span class=p>=</span><span class=s>&#34;SearchTerms&#34;</span> <span class=k>value</span><span class=p>=</span><span class=s>&#34;@Model.SearchTerms&#34;</span> <span class=p>/&gt;</span>
</span></span><span class=line><span class=cl>            <span class=p>&lt;</span><span class=n>input</span> <span class=n>type</span><span class=p>=</span><span class=s>&#34;submit&#34;</span> <span class=k>value</span><span class=p>=</span><span class=s>&#34;Search&#34;</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>        <span class=p>&lt;/</span><span class=n>div</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=p>&lt;</span><span class=n>div</span> <span class=n>id</span><span class=p>=</span><span class=s>&#34;filters&#34;</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>            <span class=p>&lt;</span><span class=n>h4</span><span class=p>&gt;</span><span class=n>MPAA</span> <span class=n>Rating</span><span class=p>&lt;/</span><span class=n>h4</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>            <span class=n>@foreach</span> <span class=p>(</span><span class=kt>string</span> <span class=n>rating</span> <span class=k>in</span> <span class=n>MovieDatabase</span><span class=p>.</span><span class=n>MPAARatings</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            <span class=p>{</span>
</span></span><span class=line><span class=cl>                <span class=p>&lt;</span><span class=n>label</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>                    <span class=p>&lt;</span><span class=n>input</span> <span class=n>type</span><span class=p>=</span><span class=s>&#34;checkbox&#34;</span> <span class=n>name</span><span class=p>=</span><span class=s>&#34;MPAARatings&#34;</span> <span class=k>value</span><span class=p>=</span><span class=s>&#34;@rating&#34;</span> <span class=k>checked</span><span class=p>=</span><span class=s>&#34;@Model.MPAARatings.Contains(rating)&#34;</span> <span class=p>/&gt;</span>
</span></span><span class=line><span class=cl>                    <span class=n>@rating</span>
</span></span><span class=line><span class=cl>                <span class=p>&lt;/</span><span class=n>label</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>            <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>            <span class=p>&lt;</span><span class=n>h4</span><span class=p>&gt;</span><span class=n>Genre</span><span class=p>&lt;/</span><span class=n>h4</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>            <span class=n>@foreach</span> <span class=p>(</span><span class=kt>string</span> <span class=n>genre</span> <span class=k>in</span> <span class=n>MovieDatabase</span><span class=p>.</span><span class=n>Genres</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            <span class=p>{</span>
</span></span><span class=line><span class=cl>                <span class=p>&lt;</span><span class=n>label</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>                    <span class=p>&lt;</span><span class=n>input</span> <span class=n>type</span><span class=p>=</span><span class=s>&#34;checkbox&#34;</span> <span class=n>name</span><span class=p>=</span><span class=s>&#34;Genres&#34;</span> <span class=k>value</span><span class=p>=</span><span class=s>&#34;@genre&#34;</span> <span class=k>checked</span><span class=p>=</span><span class=s>&#34;@Model.Genres.Contains(genre)&#34;</span> <span class=p>/&gt;</span>
</span></span><span class=line><span class=cl>                    <span class=n>@genre</span>
</span></span><span class=line><span class=cl>                <span class=p>&lt;/</span><span class=n>label</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>            <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>            <span class=p>&lt;</span><span class=n>h4</span><span class=p>&gt;</span><span class=n>IMDB</span> <span class=n>Rating</span><span class=p>&lt;/</span><span class=n>h4</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>            <span class=p>&lt;</span><span class=n>div</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>                <span class=p>&lt;</span><span class=n>input</span> <span class=n>name</span><span class=p>=</span><span class=s>&#34;IMDBMin&#34;</span> <span class=n>type</span><span class=p>=</span><span class=s>&#34;number&#34;</span> <span class=n>min</span><span class=p>=</span><span class=s>&#34;0&#34;</span> <span class=n>max</span><span class=p>=</span><span class=s>&#34;10&#34;</span> <span class=n>step</span><span class=p>=</span><span class=s>&#34;0.1&#34;</span> <span class=n>placeholder</span><span class=p>=</span><span class=s>&#34;min&#34;</span><span class=p>/&gt;</span>
</span></span><span class=line><span class=cl>                <span class=n>to</span>
</span></span><span class=line><span class=cl>                <span class=p>&lt;</span><span class=n>input</span> <span class=n>name</span><span class=p>=</span><span class=s>&#34;IMDBMax&#34;</span> <span class=n>type</span><span class=p>=</span><span class=s>&#34;number&#34;</span> <span class=n>min</span><span class=p>=</span><span class=s>&#34;0&#34;</span> <span class=n>max</span><span class=p>=</span><span class=s>&#34;10&#34;</span> <span class=n>step</span><span class=p>=</span><span class=s>&#34;0.1&#34;</span> <span class=n>placeholder</span><span class=p>=</span><span class=s>&#34;max&#34;</span><span class=p>/&gt;</span>
</span></span><span class=line><span class=cl>            <span class=p>&lt;/</span><span class=n>div</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=p>&lt;/</span><span class=n>div</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=p>&lt;</span><span class=n>div</span> <span class=n>id</span><span class=p>=</span><span class=s>&#34;results&#34;</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>            <span class=p>&lt;</span><span class=n>h1</span><span class=p>&gt;</span><span class=n>Movie</span> <span class=n>Results</span><span class=p>&lt;/</span><span class=n>h1</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>            <span class=p>&lt;</span><span class=n>ul</span> <span class=n>class</span><span class=p>=</span><span class=s>&#34;movie-list&#34;</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>                <span class=n>@foreach</span> <span class=p>(</span><span class=n>Movie</span> <span class=n>movie</span> <span class=k>in</span> <span class=n>@Model</span><span class=p>.</span><span class=n>Movies</span><span class=p>)</span>
</span></span><span class=line><span class=cl>                <span class=p>{</span>
</span></span><span class=line><span class=cl>                    <span class=p>&lt;</span><span class=n>li</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>                        <span class=p>&lt;</span><span class=n>div</span> <span class=n>class</span><span class=p>=</span><span class=s>&#34;details&#34;</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>                            <span class=p>&lt;</span><span class=n>h3</span> <span class=n>class</span><span class=p>=</span><span class=s>&#34;title&#34;</span><span class=p>&gt;</span><span class=n>@movie</span><span class=p>.</span><span class=n>Title</span><span class=p>&lt;/</span><span class=n>h3</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>                            <span class=p>&lt;</span><span class=n>div</span> <span class=n>class</span><span class=p>=</span><span class=s>&#34;mpaa&#34;</span><span class=p>&gt;</span><span class=n>@movie</span><span class=p>.</span><span class=n>MPAARating</span><span class=p>&lt;/</span><span class=n>div</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>                            <span class=p>&lt;</span><span class=n>div</span> <span class=n>class</span><span class=p>=</span><span class=s>&#34;genre&#34;</span><span class=p>&gt;</span><span class=n>@movie</span><span class=p>.</span><span class=n>MajorGenre</span><span class=p>&lt;/</span><span class=n>div</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>                        <span class=p>&lt;/</span><span class=n>div</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>                        <span class=p>&lt;</span><span class=n>div</span> <span class=n>class</span><span class=p>=</span><span class=s>&#34;ratings&#34;</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>                            <span class=n>@if</span> <span class=p>(</span><span class=n>movie</span><span class=p>.</span><span class=n>IMDBRating</span> <span class=p>!=</span> <span class=kc>null</span><span class=p>)</span>
</span></span><span class=line><span class=cl>                            <span class=p>{</span>
</span></span><span class=line><span class=cl>                                <span class=p>&lt;</span><span class=n>div</span> <span class=n>class</span><span class=p>=</span><span class=s>&#34;imdb&#34;</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>                                    <span class=n>@movie</span><span class=p>.</span><span class=n>IMDBRating</span>
</span></span><span class=line><span class=cl>                                <span class=p>&lt;/</span><span class=n>div</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>                            <span class=p>}</span>
</span></span><span class=line><span class=cl>                            <span class=n>@if</span> <span class=p>(</span><span class=n>movie</span><span class=p>.</span><span class=n>RottenTomatoesRating</span> <span class=p>!=</span> <span class=kc>null</span><span class=p>)</span>
</span></span><span class=line><span class=cl>                            <span class=p>{</span>
</span></span><span class=line><span class=cl>                                <span class=p>&lt;</span><span class=n>div</span> <span class=n>class</span><span class=p>=</span><span class=s>&#34;rotten-tomatoes&#34;</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>                                    <span class=n>@movie</span><span class=p>.</span><span class=n>RottenTomatoesRating</span>
</span></span><span class=line><span class=cl>                                <span class=p>&lt;/</span><span class=n>div</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>                            <span class=p>}</span>
</span></span><span class=line><span class=cl>                        <span class=p>&lt;/</span><span class=n>div</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>                    <span class=p>&lt;/</span><span class=n>li</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>                <span class=p>}</span>
</span></span><span class=line><span class=cl>            <span class=p>&lt;/</span><span class=n>ul</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>        <span class=p>&lt;/</span><span class=n>div</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=p>&lt;/</span><span class=n>form</span><span class=p>&gt;</span></span></span></code></pre></div><p>Most of this is simply moving elements around the page, but note that we are using inputs of <code>type=number</code> to represent our range of IMDB values. We can specify a minimum and maximum for this range, as well as an allowable increment. Also, we use the <code>placeholder</code> attribute to put text into the <code>input</code> until a value is added.</p><h2 id=adding-more-styles>Adding More Styles</h2><p>Now we&rsquo;ll need to add some rules to our <em>wwwroot/css/styles.css</em>. First, we&rsquo;ll use a <code>grid</code> for the layout of the form:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-css data-lang=css><span class=line><span class=cl><span class=nt>form</span><span class=p>#</span><span class=nn>movie-database</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>display</span><span class=p>:</span> <span class=k>grid</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=k>grid-template-columns</span><span class=p>:</span> <span class=mi>1</span><span class=n>fr</span> <span class=mi>3</span><span class=n>fr</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=k>grid-template-rows</span><span class=p>:</span> <span class=kc>auto</span> <span class=kc>auto</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span></span></span></code></pre></div><p>The right column will be three times as big as the left.</p><p>We can make our search bar span both columns with <code>grid-column-start</code> and <code>grid-column-end</code>:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-css data-lang=css><span class=line><span class=cl><span class=p>#</span><span class=nn>search</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>grid-column-start</span><span class=p>:</span> <span class=mi>1</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=k>grid-column-end</span><span class=p>:</span> <span class=mi>3</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=k>text-align</span><span class=p>:</span> <span class=kc>center</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span></span></span></code></pre></div><p>Notice too that for CSS, we start counting at 1, not 0. The filters and the results will fall in the next row automatically, each taking up their own respective grid cell. You can read more about the grid layout in <a href=https://css-tricks.com/snippets/css/complete-guide-grid/ rel=external target=_blank>A Complete Guide to Grid</a>.</p><p>Let&rsquo;s go ahead and use flexbox to lay out our filters in a column:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-css data-lang=css><span class=line><span class=cl><span class=p>#</span><span class=nn>filters</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>display</span><span class=p>:</span> <span class=kc>flex</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=k>flex-direction</span><span class=p>:</span> <span class=kc>column</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span></span></span></code></pre></div><p>And make our number inputs bigger:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-css data-lang=css><span class=line><span class=cl><span class=p>#</span><span class=nn>filters</span> <span class=nt>input</span><span class=o>[</span><span class=nt>type</span><span class=o>=</span><span class=nt>number</span><span class=o>]</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>width</span><span class=p>:</span> <span class=mi>4</span><span class=kt>rem</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span></span></span></code></pre></div><p>Notice the use of square brackets in our CSS Selector to only apply to inputs with type number.</p><p>Also, let&rsquo;s add a margin above and remove most of the margin below our <code>&lt;h4></code> elements:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-css data-lang=css><span class=line><span class=cl><span class=p>#</span><span class=nn>filters</span> <span class=nt>h4</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>margin-bottom</span><span class=p>:</span> <span class=mf>0.2</span><span class=kt>rem</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=k>margin-top</span><span class=p>:</span> <span class=mi>2</span><span class=kt>rem</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span></span></span></code></pre></div><p>The resulting page looks much cleaner:</p><p><a href=#R-image-d1c5e0c3392df46a77ae202b507e90dd class=lightbox-link><img alt="The Styled Page" class="border lazy lightbox noshadow figure-image" loading=lazy src=/cis400/images/6.8.5.png style=height:auto;width:auto></a>
<a href=javascript:history.back(); class=lightbox-back id=R-image-d1c5e0c3392df46a77ae202b507e90dd><img alt="The Styled Page" class="border lazy lightbox noshadow lightbox-image" loading=lazy src=/cis400/images/6.8.5.png></a></p><h2 id=capturing-the-filter-values>Capturing the Filter Values</h2><p>Now we need to get the filter values from our GET request query string. We could do this like we&rsquo;ve been doing before, with:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-csharp data-lang=csharp><span class=line><span class=cl>    <span class=n>Request</span><span class=p>.</span><span class=n>Query</span><span class=p>[</span><span class=s>&#34;IMDBMin&#34;</span><span class=p>];</span></span></span></code></pre></div><p>But the returned value would be a string, so we&rsquo;d need to parse it:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-csharp data-lang=csharp><span class=line><span class=cl>    <span class=n>IMDBMin</span> <span class=p>=</span> <span class=kt>double</span><span class=p>.</span><span class=n>Parse</span><span class=p>(</span><span class=n>Request</span><span class=p>.</span><span class=n>Query</span><span class=p>[</span><span class=s>&#34;IMDBMin&#34;</span><span class=p>]);</span></span></span></code></pre></div><p>If the query was <code>null</code>, then this would evaluate to <code>NaN</code>, which we wouldn&rsquo;t want to set our <code>&lt;input></code> to&mldr;</p><p>Instead, we&rsquo;ll look at some options built into the PageModel.</p><h2 id=parameter-binding>Parameter Binding</h2><p>The first of these options is <a href=https://docs.microsoft.com/en-us/aspnet/web-api/overview/formats-and-model-binding/parameter-binding-in-aspnet-web-api rel=external target=_blank><em>Parameter Binding</em></a>. In this approach, we define parameters to our <code>OnGet()</code> method to be parsed out of the request automatically, i.e.:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-csharp data-lang=csharp><span class=line><span class=cl>    <span class=cs>/// &lt;summary&gt;</span>
</span></span><span class=line><span class=cl>    <span class=cs>/// Gets the search results for display on the page</span>
</span></span><span class=line><span class=cl>    <span class=cs>/// &lt;/summary&gt;</span>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=k>void</span> <span class=n>OnGet</span><span class=p>(</span><span class=kt>string</span> <span class=n>SearchTerms</span><span class=p>,</span> <span class=kt>string</span><span class=p>[]</span> <span class=n>MPAARatings</span><span class=p>,</span> <span class=kt>string</span><span class=p>[]</span> <span class=n>Genres</span><span class=p>,</span> <span class=kt>double?</span> <span class=n>IMDBMin</span><span class=p>,</span> <span class=kt>double?</span> <span class=n>IMDBMax</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=k>this</span><span class=p>.</span><span class=n>SearchTerms</span> <span class=p>=</span> <span class=n>SearchTerms</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=k>this</span><span class=p>.</span><span class=n>MPAARatings</span> <span class=p>=</span> <span class=n>MPAARatings</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=k>this</span><span class=p>.</span><span class=n>Genres</span> <span class=p>=</span> <span class=n>Genres</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=k>this</span><span class=p>.</span><span class=n>IMDBMin</span> <span class=p>=</span> <span class=n>IMDBMin</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=k>this</span><span class=p>.</span><span class=n>IMDBMax</span> <span class=p>=</span> <span class=n>IMDBMax</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=n>Movies</span> <span class=p>=</span> <span class=n>MovieDatabase</span><span class=p>.</span><span class=n>Search</span><span class=p>(</span><span class=n>SearchTerms</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=n>Movies</span> <span class=p>=</span> <span class=n>MovieDatabase</span><span class=p>.</span><span class=n>FilterByMPAARating</span><span class=p>(</span><span class=n>Movies</span><span class=p>,</span> <span class=n>MPAARatings</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=n>Movies</span> <span class=p>=</span> <span class=n>MovieDatabase</span><span class=p>.</span><span class=n>FilterByGenre</span><span class=p>(</span><span class=n>Movies</span><span class=p>,</span> <span class=n>Genres</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=n>Movies</span> <span class=p>=</span> <span class=n>MovieDatabase</span><span class=p>.</span><span class=n>FilterByIMDBRating</span><span class=p>(</span><span class=n>Movies</span><span class=p>,</span> <span class=n>IMDBMin</span><span class=p>,</span> <span class=n>IMDBMax</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span></span></span></code></pre></div><p>The benefit of this approach is that as long as C# knows a conversion into the type we specify, the conversion is done automatically. Note that the parameter name matches the <code>name</code> property of the corresponding <code>&lt;input></code> - this must be the case for the Razor Page to bind the parameter to the corresponding input value.</p><p>Note that we still need to assign these parameter values to the corresponding properties of our PageModel. If we don&rsquo;t, then those properties will all be <code>null</code>, and the <code>&lt;inputs></code> rendered on our page will always be blank.</p><h2 id=model-binding>Model Binding</h2><p>A second option is to use <a href="https://docs.microsoft.com/en-us/aspnet/core/mvc/models/model-binding?view=aspnetcore-3.1" rel=external target=_blank><em>Model Binding</em></a>. Model binding also automatically converts incoming form data, but in this case it binds directly to the properties of our PageModel. We indicate this form of binding with a <code>[BindProperty]</code> attribute, i.e.:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-csharp data-lang=csharp><span class=line><span class=cl><span class=kd>public</span> <span class=k>class</span> <span class=nc>IndexModel</span> <span class=p>:</span> <span class=n>PageModel</span> <span class=p>{</span>
</span></span><span class=line><span class=cl><span class=na>
</span></span></span><span class=line><span class=cl><span class=na>    [BindProperty(SupportsGet=true)]</span>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=kt>string</span> <span class=n>SearchTerms</span> <span class=p>{</span><span class=k>get</span><span class=p>;</span> <span class=k>set</span><span class=p>;}</span>
</span></span><span class=line><span class=cl><span class=na>
</span></span></span><span class=line><span class=cl><span class=na>    [BindProperty(SupportsGet=true)]</span>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=kt>string</span><span class=p>[]</span> <span class=n>MPAARatings</span> <span class=p>{</span><span class=k>get</span><span class=p>;</span> <span class=k>set</span><span class=p>;}</span>
</span></span><span class=line><span class=cl><span class=na>
</span></span></span><span class=line><span class=cl><span class=na>    [BindProperty(SupportsGet=true)]</span>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=kt>string</span><span class=p>[]</span> <span class=n>Genres</span> <span class=p>{</span><span class=k>get</span><span class=p>;</span> <span class=k>set</span><span class=p>;}</span>
</span></span><span class=line><span class=cl><span class=na>
</span></span></span><span class=line><span class=cl><span class=na>    [BindProperty(SupportsGet=true)]</span>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=kt>double?</span> <span class=n>IMDBMin</span> <span class=p>{</span><span class=k>get</span><span class=p>;</span> <span class=k>set</span><span class=p>;}</span>
</span></span><span class=line><span class=cl><span class=na>
</span></span></span><span class=line><span class=cl><span class=na>    [BindProperty(SupportsGet=true)]</span>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=kt>double?</span> <span class=n>IMDBMax</span> <span class=p>{</span><span class=k>get</span><span class=p>;</span> <span class=k>set</span><span class=p>;}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=cs>/// &lt;summary&gt;</span>
</span></span><span class=line><span class=cl>    <span class=cs>/// Gets the search results for display on the page</span>
</span></span><span class=line><span class=cl>    <span class=cs>/// &lt;/summary&gt;</span>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=k>void</span> <span class=n>OnGet</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=n>Movies</span> <span class=p>=</span> <span class=n>MovieDatabase</span><span class=p>.</span><span class=n>Search</span><span class=p>(</span><span class=n>SearchTerms</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=n>Movies</span> <span class=p>=</span> <span class=n>MovieDatabase</span><span class=p>.</span><span class=n>FilterByMPAARating</span><span class=p>(</span><span class=n>Movies</span><span class=p>,</span> <span class=n>MPAARatings</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=n>Movies</span> <span class=p>=</span> <span class=n>MovieDatabase</span><span class=p>.</span><span class=n>FilterByGenre</span><span class=p>(</span><span class=n>Movies</span><span class=p>,</span> <span class=n>Genres</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=n>Movies</span> <span class=p>=</span> <span class=n>MovieDatabase</span><span class=p>.</span><span class=n>FilterByIMDBRating</span><span class=p>(</span><span class=n>Movies</span><span class=p>,</span> <span class=n>IMDBMin</span><span class=p>,</span> <span class=n>IMDBMax</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span></span></span></code></pre></div><p>Note that with this approach, the incoming data is directly bound to the properties, so we don&rsquo;t need to do any special assignments within our <code>OnGet()</code> method. Also, note that we have to use <code>SupportsGet=true</code> in order for this binding to occur on GET requests (by default, model binding only happens with POST requests).</p><div class="box notices cstyle note"><div class=box-label><i class="fa-fw fas fa-exclamation-circle"></i> Note</div><div class=box-content><p>You only need to do <em>one</em> binding approach per property in a PageModel. I.e. you can just use the property decorator:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-csharp data-lang=csharp><span class=line><span class=cl><span class=kd>public</span> <span class=k>class</span> <span class=nc>SomePageModel</span> <span class=p>:</span> <span class=n>PageModel</span>
</span></span><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl><span class=na>    [BindProperty(SupportsGet=true)]</span>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=kt>float</span> <span class=n>SomeProperty</span> <span class=p>{</span> <span class=k>get</span><span class=p>;</span> <span class=k>set</span><span class=p>;</span> <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=k>void</span> <span class=n>OnGet</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=n>DoSomething</span><span class=p>(</span><span class=n>SomeProperty</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span></span></span></code></pre></div><p><em>or</em> you might use parameter binding:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-csharp data-lang=csharp><span class=line><span class=cl><span class=kd>public</span> <span class=k>class</span> <span class=nc>SomePageModel</span> <span class=p>:</span> <span class=n>PageModel</span>
</span></span><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=k>void</span> <span class=n>OnGet</span><span class=p>(</span><span class=kt>float</span> <span class=n>SomeProperty</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=n>DoSomething</span><span class=p>(</span><span class=n>SomeProperty</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span></span></span></code></pre></div><p><em>or</em> you can parse it from the request:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-csharp data-lang=csharp><span class=line><span class=cl><span class=kd>public</span> <span class=k>class</span> <span class=nc>SomePageModel</span> <span class=p>:</span> <span class=n>PageModel</span>
</span></span><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=k>void</span> <span class=n>OnGet</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=kt>var</span> <span class=n>someProperty</span> <span class=p>=</span> <span class=kt>float</span><span class=p>.</span><span class=n>Parse</span><span class=p>(</span><span class=n>Request</span><span class=p>.</span><span class=n>Query</span><span class=p>[</span><span class=s>&#34;SomeProperty&#34;</span><span class=p>]);</span>
</span></span><span class=line><span class=cl>        <span class=n>DoSomething</span><span class=p>(</span><span class=n>someProperty</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span></span></span></code></pre></div><p>These are all <em>different means</em> of accessing the <em>same data</em> from the incoming request.</p></div></div><p>Now all we need to do is implement the actual filter.</p><h3 id=implementing-the-imdb-rating-filter>Implementing the IMDB Rating Filter</h3><p>We&rsquo;ll define the new filter in our <code>MovieDatabase</code> class as another static method:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-csharp data-lang=csharp><span class=line><span class=cl>    <span class=cs>/// &lt;summary&gt;</span>
</span></span><span class=line><span class=cl>    <span class=cs>/// Filters the provided collection of movies</span>
</span></span><span class=line><span class=cl>    <span class=cs>/// to those with IMDB ratings falling within</span>
</span></span><span class=line><span class=cl>    <span class=cs>/// the specified range</span>
</span></span><span class=line><span class=cl>    <span class=cs>/// &lt;/summary&gt;</span>
</span></span><span class=line><span class=cl>    <span class=cs>/// &lt;param name=&#34;movies&#34;&gt;The collection of movies to filter&lt;/param&gt;</span>
</span></span><span class=line><span class=cl>    <span class=cs>/// &lt;param name=&#34;min&#34;&gt;The minimum range value&lt;/param&gt;</span>
</span></span><span class=line><span class=cl>    <span class=cs>/// &lt;param name=&#34;max&#34;&gt;The maximum range value&lt;/param&gt;</span>
</span></span><span class=line><span class=cl>    <span class=cs>/// &lt;returns&gt;The filtered movie collection&lt;/returns&gt;</span>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=kd>static</span> <span class=n>IEnumerable</span><span class=p>&lt;</span><span class=n>Movie</span><span class=p>&gt;</span> <span class=n>FilterByIMDBRating</span><span class=p>(</span><span class=n>IEnumerable</span><span class=p>&lt;</span><span class=n>Movie</span><span class=p>&gt;</span> <span class=n>movies</span><span class=p>,</span> <span class=kt>double?</span> <span class=n>min</span><span class=p>,</span> <span class=kt>double?</span> <span class=n>max</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=c1>// TODO: Filter movies</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span></span></span></code></pre></div><p>Notice that here too we use the nullable double value. So our first step is probably to do a <code>null</code> check:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-csharp data-lang=csharp><span class=line><span class=cl>    <span class=k>if</span> <span class=p>(</span><span class=n>min</span> <span class=p>==</span> <span class=kc>null</span> <span class=p>&amp;&amp;</span> <span class=n>max</span> <span class=p>==</span> <span class=kc>null</span><span class=p>)</span> <span class=k>return</span> <span class=n>movies</span><span class=p>;</span></span></span></code></pre></div><p>But what if only one is null? Should we filter for that part of the range? It wouldn&rsquo;t be hard to do:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-csharp data-lang=csharp><span class=line><span class=cl>    <span class=kt>var</span> <span class=n>results</span> <span class=p>=</span> <span class=k>new</span> <span class=n>List</span><span class=p>&lt;</span><span class=n>Movie</span><span class=p>&gt;();</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c1>// only a maximum specified</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span><span class=p>(</span><span class=n>min</span> <span class=p>==</span> <span class=kc>null</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=k>foreach</span><span class=p>(</span><span class=n>Movie</span> <span class=n>movie</span> <span class=k>in</span> <span class=n>movies</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=k>if</span> <span class=p>(</span><span class=n>movie</span><span class=p>.</span><span class=n>IMDBRating</span> <span class=p>&lt;=</span> <span class=n>max</span><span class=p>)</span> <span class=n>results</span><span class=p>.</span><span class=n>Add</span><span class=p>(</span><span class=n>movie</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=n>results</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span></span></span></code></pre></div><p>And the minimum would mirror that:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-csharp data-lang=csharp><span class=line><span class=cl>    <span class=c1>// only a minimum specified</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span><span class=p>(</span><span class=n>max</span> <span class=p>==</span> <span class=kc>null</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=k>foreach</span><span class=p>(</span><span class=n>Movie</span> <span class=n>movie</span> <span class=k>in</span> <span class=n>movies</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=k>if</span> <span class=p>(</span><span class=n>movie</span><span class=p>.</span><span class=n>IMDBRating</span> <span class=p>&gt;=</span> <span class=n>min</span><span class=p>)</span> <span class=n>results</span><span class=p>.</span><span class=n>Add</span><span class=p>(</span><span class=n>movie</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=n>results</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span></span></span></code></pre></div><p>Finally, we could handle the case where we have both a min and max value to our range:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-csharp data-lang=csharp><span class=line><span class=cl>    <span class=c1>// Both minimum and maximum specified</span>
</span></span><span class=line><span class=cl>    <span class=k>foreach</span><span class=p>(</span><span class=n>Movie</span> <span class=n>movie</span> <span class=k>in</span> <span class=n>movies</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span><span class=p>(</span><span class=n>movie</span><span class=p>.</span><span class=n>IMDBRating</span> <span class=p>&gt;=</span> <span class=n>min</span> <span class=p>&amp;&amp;</span> <span class=n>movie</span><span class=p>.</span><span class=n>IMDBRating</span> <span class=p>&lt;=</span> <span class=n>max</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=n>results</span><span class=p>.</span><span class=n>Add</span><span class=p>(</span><span class=n>movie</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=n>results</span><span class=p>;</span></span></span></code></pre></div><p>Notice too, that in each of these cases we&rsquo;re treating the range as <em>inclusive</em> (including the specified minimum and maximum). This is the behavior most casual internet users will expect. If the database and user expectations are different for your audience, you&rsquo;d want your code to match that expectation.</p><p>Now we can filter by IMDB rating:</p><p><a href=#R-image-0af3154f690bfb288e7644ee94f0e908 class=lightbox-link><img alt="Filtering By IMDB" class="border lazy lightbox noshadow figure-image" loading=lazy src=/cis400/images/6.8.6.png style=height:auto;width:auto></a>
<a href=javascript:history.back(); class=lightbox-back id=R-image-0af3154f690bfb288e7644ee94f0e908><img alt="Filtering By IMDB" class="border lazy lightbox noshadow lightbox-image" loading=lazy src=/cis400/images/6.8.6.png></a></p><h2 id=finishing-up>Finishing Up</h2><p>Since we&rsquo;re displaying the Rotten Tomatoes rating, we should probably also have a filter for it. This will work almost exactly like the IMDB rating - but with the range from 0 to 100. I&rsquo;ll leave this as an exercise for the reader.</p><footer class=footline></footer></article><article class=default><header class=headline></header><h1 id=numerical-filters>Numerical Filters</h1><p>Let&rsquo;s tackle one of the critics ratings next. While we could create categories and use checkboxes, this doesn&rsquo;t capture the incremental values (i.e. 4.3), and it would be a <em>lot</em> of checkboxes for Rotten Tomatoes ratings! Instead, we&rsquo;ll use a <em>numerical filter</em>, which limits our possible results to a range - between a minimum and maximum value.</p><p>Moreover, let&rsquo;s clean up our Index page, as it is getting difficult to determine what filter(s) go together, and are adding more.</p><h2 id=refactoring-the-index-page>Refactoring the Index Page</h2><p>Let&rsquo;s move the filters to a column on the left, leave the search bar above, and show our results on the right. This will require refactoring our <em>Index.cshtml</em> file:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-csharp data-lang=csharp><span class=line><span class=cl>    <span class=p>&lt;</span><span class=n>form</span> <span class=n>id</span><span class=p>=</span><span class=s>&#34;movie-database&#34;</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=p>&lt;</span><span class=n>div</span> <span class=n>id</span><span class=p>=</span><span class=s>&#34;search&#34;</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>            <span class=p>&lt;</span><span class=n>input</span> <span class=n>type</span><span class=p>=</span><span class=s>&#34;text&#34;</span> <span class=n>name</span><span class=p>=</span><span class=s>&#34;SearchTerms&#34;</span> <span class=k>value</span><span class=p>=</span><span class=s>&#34;@Model.SearchTerms&#34;</span> <span class=p>/&gt;</span>
</span></span><span class=line><span class=cl>            <span class=p>&lt;</span><span class=n>input</span> <span class=n>type</span><span class=p>=</span><span class=s>&#34;submit&#34;</span> <span class=k>value</span><span class=p>=</span><span class=s>&#34;Search&#34;</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>        <span class=p>&lt;/</span><span class=n>div</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=p>&lt;</span><span class=n>div</span> <span class=n>id</span><span class=p>=</span><span class=s>&#34;filters&#34;</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>            <span class=p>&lt;</span><span class=n>h4</span><span class=p>&gt;</span><span class=n>MPAA</span> <span class=n>Rating</span><span class=p>&lt;/</span><span class=n>h4</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>            <span class=n>@foreach</span> <span class=p>(</span><span class=kt>string</span> <span class=n>rating</span> <span class=k>in</span> <span class=n>MovieDatabase</span><span class=p>.</span><span class=n>MPAARatings</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            <span class=p>{</span>
</span></span><span class=line><span class=cl>                <span class=p>&lt;</span><span class=n>label</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>                    <span class=p>&lt;</span><span class=n>input</span> <span class=n>type</span><span class=p>=</span><span class=s>&#34;checkbox&#34;</span> <span class=n>name</span><span class=p>=</span><span class=s>&#34;MPAARatings&#34;</span> <span class=k>value</span><span class=p>=</span><span class=s>&#34;@rating&#34;</span> <span class=k>checked</span><span class=p>=</span><span class=s>&#34;@Model.MPAARatings.Contains(rating)&#34;</span> <span class=p>/&gt;</span>
</span></span><span class=line><span class=cl>                    <span class=n>@rating</span>
</span></span><span class=line><span class=cl>                <span class=p>&lt;/</span><span class=n>label</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>            <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>            <span class=p>&lt;</span><span class=n>h4</span><span class=p>&gt;</span><span class=n>Genre</span><span class=p>&lt;/</span><span class=n>h4</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>            <span class=n>@foreach</span> <span class=p>(</span><span class=kt>string</span> <span class=n>genre</span> <span class=k>in</span> <span class=n>MovieDatabase</span><span class=p>.</span><span class=n>Genres</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            <span class=p>{</span>
</span></span><span class=line><span class=cl>                <span class=p>&lt;</span><span class=n>label</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>                    <span class=p>&lt;</span><span class=n>input</span> <span class=n>type</span><span class=p>=</span><span class=s>&#34;checkbox&#34;</span> <span class=n>name</span><span class=p>=</span><span class=s>&#34;Genres&#34;</span> <span class=k>value</span><span class=p>=</span><span class=s>&#34;@genre&#34;</span> <span class=k>checked</span><span class=p>=</span><span class=s>&#34;@Model.Genres.Contains(genre)&#34;</span> <span class=p>/&gt;</span>
</span></span><span class=line><span class=cl>                    <span class=n>@genre</span>
</span></span><span class=line><span class=cl>                <span class=p>&lt;/</span><span class=n>label</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>            <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>            <span class=p>&lt;</span><span class=n>h4</span><span class=p>&gt;</span><span class=n>IMDB</span> <span class=n>Rating</span><span class=p>&lt;/</span><span class=n>h4</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>            <span class=p>&lt;</span><span class=n>div</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>                <span class=p>&lt;</span><span class=n>input</span> <span class=n>name</span><span class=p>=</span><span class=s>&#34;IMDBMin&#34;</span> <span class=n>type</span><span class=p>=</span><span class=s>&#34;number&#34;</span> <span class=n>min</span><span class=p>=</span><span class=s>&#34;0&#34;</span> <span class=n>max</span><span class=p>=</span><span class=s>&#34;10&#34;</span> <span class=n>step</span><span class=p>=</span><span class=s>&#34;0.1&#34;</span> <span class=n>placeholder</span><span class=p>=</span><span class=s>&#34;min&#34;</span><span class=p>/&gt;</span>
</span></span><span class=line><span class=cl>                <span class=n>to</span>
</span></span><span class=line><span class=cl>                <span class=p>&lt;</span><span class=n>input</span> <span class=n>name</span><span class=p>=</span><span class=s>&#34;IMDBMax&#34;</span> <span class=n>type</span><span class=p>=</span><span class=s>&#34;number&#34;</span> <span class=n>min</span><span class=p>=</span><span class=s>&#34;0&#34;</span> <span class=n>max</span><span class=p>=</span><span class=s>&#34;10&#34;</span> <span class=n>step</span><span class=p>=</span><span class=s>&#34;0.1&#34;</span> <span class=n>placeholder</span><span class=p>=</span><span class=s>&#34;max&#34;</span><span class=p>/&gt;</span>
</span></span><span class=line><span class=cl>            <span class=p>&lt;/</span><span class=n>div</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=p>&lt;/</span><span class=n>div</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=p>&lt;</span><span class=n>div</span> <span class=n>id</span><span class=p>=</span><span class=s>&#34;results&#34;</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>            <span class=p>&lt;</span><span class=n>h1</span><span class=p>&gt;</span><span class=n>Movie</span> <span class=n>Results</span><span class=p>&lt;/</span><span class=n>h1</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>            <span class=p>&lt;</span><span class=n>ul</span> <span class=n>class</span><span class=p>=</span><span class=s>&#34;movie-list&#34;</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>                <span class=n>@foreach</span> <span class=p>(</span><span class=n>Movie</span> <span class=n>movie</span> <span class=k>in</span> <span class=n>@Model</span><span class=p>.</span><span class=n>Movies</span><span class=p>)</span>
</span></span><span class=line><span class=cl>                <span class=p>{</span>
</span></span><span class=line><span class=cl>                    <span class=p>&lt;</span><span class=n>li</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>                        <span class=p>&lt;</span><span class=n>div</span> <span class=n>class</span><span class=p>=</span><span class=s>&#34;details&#34;</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>                            <span class=p>&lt;</span><span class=n>h3</span> <span class=n>class</span><span class=p>=</span><span class=s>&#34;title&#34;</span><span class=p>&gt;</span><span class=n>@movie</span><span class=p>.</span><span class=n>Title</span><span class=p>&lt;/</span><span class=n>h3</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>                            <span class=p>&lt;</span><span class=n>div</span> <span class=n>class</span><span class=p>=</span><span class=s>&#34;mpaa&#34;</span><span class=p>&gt;</span><span class=n>@movie</span><span class=p>.</span><span class=n>MPAARating</span><span class=p>&lt;/</span><span class=n>div</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>                            <span class=p>&lt;</span><span class=n>div</span> <span class=n>class</span><span class=p>=</span><span class=s>&#34;genre&#34;</span><span class=p>&gt;</span><span class=n>@movie</span><span class=p>.</span><span class=n>MajorGenre</span><span class=p>&lt;/</span><span class=n>div</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>                        <span class=p>&lt;/</span><span class=n>div</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>                        <span class=p>&lt;</span><span class=n>div</span> <span class=n>class</span><span class=p>=</span><span class=s>&#34;ratings&#34;</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>                            <span class=n>@if</span> <span class=p>(</span><span class=n>movie</span><span class=p>.</span><span class=n>IMDBRating</span> <span class=p>!=</span> <span class=kc>null</span><span class=p>)</span>
</span></span><span class=line><span class=cl>                            <span class=p>{</span>
</span></span><span class=line><span class=cl>                                <span class=p>&lt;</span><span class=n>div</span> <span class=n>class</span><span class=p>=</span><span class=s>&#34;imdb&#34;</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>                                    <span class=n>@movie</span><span class=p>.</span><span class=n>IMDBRating</span>
</span></span><span class=line><span class=cl>                                <span class=p>&lt;/</span><span class=n>div</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>                            <span class=p>}</span>
</span></span><span class=line><span class=cl>                            <span class=n>@if</span> <span class=p>(</span><span class=n>movie</span><span class=p>.</span><span class=n>RottenTomatoesRating</span> <span class=p>!=</span> <span class=kc>null</span><span class=p>)</span>
</span></span><span class=line><span class=cl>                            <span class=p>{</span>
</span></span><span class=line><span class=cl>                                <span class=p>&lt;</span><span class=n>div</span> <span class=n>class</span><span class=p>=</span><span class=s>&#34;rotten-tomatoes&#34;</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>                                    <span class=n>@movie</span><span class=p>.</span><span class=n>RottenTomatoesRating</span>
</span></span><span class=line><span class=cl>                                <span class=p>&lt;/</span><span class=n>div</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>                            <span class=p>}</span>
</span></span><span class=line><span class=cl>                        <span class=p>&lt;/</span><span class=n>div</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>                    <span class=p>&lt;/</span><span class=n>li</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>                <span class=p>}</span>
</span></span><span class=line><span class=cl>            <span class=p>&lt;/</span><span class=n>ul</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>        <span class=p>&lt;/</span><span class=n>div</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=p>&lt;/</span><span class=n>form</span><span class=p>&gt;</span></span></span></code></pre></div><p>Most of this is simply moving elements around the page, but note that we are using inputs of <code>type=number</code> to represent our range of IMDB values. We can specify a minimum and maximum for this range, as well as an allowable increment. Also, we use the <code>placeholder</code> attribute to put text into the <code>input</code> until a value is added.</p><h2 id=adding-more-styles>Adding More Styles</h2><p>Now we&rsquo;ll need to add some rules to our <em>wwwroot/css/site.css</em>. First, we&rsquo;ll use a <code>grid</code> for the layout of the form:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-css data-lang=css><span class=line><span class=cl><span class=nt>form</span><span class=p>#</span><span class=nn>movie-database</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>display</span><span class=p>:</span> <span class=k>grid</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=k>grid-template-columns</span><span class=p>:</span> <span class=mi>1</span><span class=n>fr</span> <span class=mi>3</span><span class=n>fr</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=k>grid-template-rows</span><span class=p>:</span> <span class=kc>auto</span> <span class=kc>auto</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span></span></span></code></pre></div><p>The right column will be three times as big as the left.</p><p>We can make our search bar span both columns with <code>grid-column-start</code> and <code>grid-column-end</code>:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-css data-lang=css><span class=line><span class=cl><span class=p>#</span><span class=nn>search</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>grid-column-start</span><span class=p>:</span> <span class=mi>1</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=k>grid-column-end</span><span class=p>:</span> <span class=mi>3</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=k>text-align</span><span class=p>:</span> <span class=kc>center</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span></span></span></code></pre></div><p>Notice too that for CSS, we start counting at 1, not 0. The filters and the results will fall in the next row automatically, each taking up their own respective grid cell. You can read more about the grid layout in <a href=https://css-tricks.com/snippets/css/complete-guide-grid/ rel=external target=_blank>A Complete Guide to Grid</a>.</p><p>Let&rsquo;s go ahead and use flexbox to lay out our filters in a column:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-css data-lang=css><span class=line><span class=cl><span class=p>#</span><span class=nn>filters</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>display</span><span class=p>:</span> <span class=kc>flex</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=k>flex-direction</span><span class=p>:</span> <span class=kc>column</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span></span></span></code></pre></div><p>And make our number inputs bigger:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-css data-lang=css><span class=line><span class=cl><span class=p>#</span><span class=nn>filters</span> <span class=nt>input</span><span class=o>[</span><span class=nt>type</span><span class=o>=</span><span class=nt>number</span><span class=o>]</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>width</span><span class=p>:</span> <span class=mi>4</span><span class=kt>rem</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span></span></span></code></pre></div><p>Notice the use of square brackets in our CSS Selector to only apply to inputs with type number.</p><p>Also, let&rsquo;s add a margin above and remove most of the margin below our <code>&lt;h4></code> elements:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-css data-lang=css><span class=line><span class=cl><span class=p>#</span><span class=nn>filters</span> <span class=nt>h4</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>margin-bottom</span><span class=p>:</span> <span class=mf>0.2</span><span class=kt>rem</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=k>margin-top</span><span class=p>:</span> <span class=mi>2</span><span class=kt>rem</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span></span></span></code></pre></div><p>The resulting page looks much cleaner:</p><p><a href=#R-image-7860a98eaad5aea392dfc332b3338ad3 class=lightbox-link><img alt="The Styled Page" class="border lazy lightbox noshadow figure-image" loading=lazy src=/cis400/images/6.8.5.png style=height:auto;width:auto></a>
<a href=javascript:history.back(); class=lightbox-back id=R-image-7860a98eaad5aea392dfc332b3338ad3><img alt="The Styled Page" class="border lazy lightbox noshadow lightbox-image" loading=lazy src=/cis400/images/6.8.5.png></a></p><h2 id=capturing-the-filter-values>Capturing the Filter Values</h2><p>Now we need to get the filter values from our GET request query string. We could do this like we&rsquo;ve been doing before, with:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-csharp data-lang=csharp><span class=line><span class=cl>    <span class=n>Request</span><span class=p>.</span><span class=n>Query</span><span class=p>[</span><span class=s>&#34;IMDBMin&#34;</span><span class=p>];</span></span></span></code></pre></div><p>But the returned value would be a string, so we&rsquo;d need to parse it:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-csharp data-lang=csharp><span class=line><span class=cl>    <span class=n>IMDBMin</span> <span class=p>=</span> <span class=kt>double</span><span class=p>.</span><span class=n>Parse</span><span class=p>(</span><span class=n>Request</span><span class=p>.</span><span class=n>Query</span><span class=p>[</span><span class=s>&#34;IMDBMin&#34;</span><span class=p>]);</span></span></span></code></pre></div><p>If the query was <code>null</code>, then this would evaluate to <code>NaN</code>, which we wouldn&rsquo;t want to set our <code>&lt;input></code> to&mldr;</p><p>Instead, we&rsquo;ll look at some options built into the PageModel.</p><h2 id=parameter-binding>Parameter Binding</h2><p>The first of these options is <a href=https://docs.microsoft.com/en-us/aspnet/web-api/overview/formats-and-model-binding/parameter-binding-in-aspnet-web-api rel=external target=_blank><em>Parameter Binding</em></a>. In this approach, we define parameters to our <code>OnGet()</code> method to be parsed out of the request automatically, i.e.:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-csharp data-lang=csharp><span class=line><span class=cl>    <span class=cs>/// &lt;summary&gt;</span>
</span></span><span class=line><span class=cl>    <span class=cs>/// Gets the search results for display on the page</span>
</span></span><span class=line><span class=cl>    <span class=cs>/// &lt;/summary&gt;</span>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=k>void</span> <span class=n>OnGet</span><span class=p>(</span><span class=kt>string</span> <span class=n>SearchTerms</span><span class=p>,</span> <span class=kt>string</span><span class=p>[]</span> <span class=n>MPAARatings</span><span class=p>,</span> <span class=kt>string</span><span class=p>[]</span> <span class=n>Genres</span><span class=p>,</span> <span class=kt>double?</span> <span class=n>IMDBMin</span><span class=p>,</span> <span class=kt>double?</span> <span class=n>IMDBMax</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=k>this</span><span class=p>.</span><span class=n>SearchTerms</span> <span class=p>=</span> <span class=n>SearchTerms</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=k>this</span><span class=p>.</span><span class=n>MPAARatings</span> <span class=p>=</span> <span class=n>MPAARatings</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=k>this</span><span class=p>.</span><span class=n>Genres</span> <span class=p>=</span> <span class=n>Genres</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=k>this</span><span class=p>.</span><span class=n>IMDBMin</span> <span class=p>=</span> <span class=n>IMDBMin</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=k>this</span><span class=p>.</span><span class=n>IMDBMax</span> <span class=p>=</span> <span class=n>IMDBMax</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=n>Movies</span> <span class=p>=</span> <span class=n>MovieDatabase</span><span class=p>.</span><span class=n>Search</span><span class=p>(</span><span class=n>SearchTerms</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=n>Movies</span> <span class=p>=</span> <span class=n>MovieDatabase</span><span class=p>.</span><span class=n>FilterByMPAARating</span><span class=p>(</span><span class=n>Movies</span><span class=p>,</span> <span class=n>MPAARatings</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=n>Movies</span> <span class=p>=</span> <span class=n>MovieDatabase</span><span class=p>.</span><span class=n>FilterByGenre</span><span class=p>(</span><span class=n>Movies</span><span class=p>,</span> <span class=n>Genres</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=n>Movies</span> <span class=p>=</span> <span class=n>MovieDatabase</span><span class=p>.</span><span class=n>FilterByIMDBRating</span><span class=p>(</span><span class=n>Movies</span><span class=p>,</span> <span class=n>IMDBMin</span><span class=p>,</span> <span class=n>IMDBMax</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span></span></span></code></pre></div><p>The benefit of this approach is that as long as C# knows a conversion into the type we specify, the conversion is done automatically. Note that the parameter name matches the <code>name</code> property of the corresponding <code>&lt;input></code> - this must be the case for the Razor Page to bind the parameter to the corresponding input value.</p><p>Note that we still need to assign these parameter values to the corresponding properties of our PageModel. If we don&rsquo;t, then those properties will all be <code>null</code>, and the <code>&lt;inputs></code> rendered on our page will always be blank.</p><h2 id=model-binding>Model Binding</h2><p>A second option is to use <a href="https://docs.microsoft.com/en-us/aspnet/core/mvc/models/model-binding?view=aspnetcore-3.1" rel=external target=_blank><em>Model Binding</em></a>. Model binding also automatically converts incoming form data, but in this case it binds directly to the properties of our PageModel. We indicate this form of binding with a <code>[BindProperty]</code> attribute, i.e.:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-csharp data-lang=csharp><span class=line><span class=cl><span class=kd>public</span> <span class=k>class</span> <span class=nc>IndexModel</span> <span class=p>:</span> <span class=n>PageModel</span> <span class=p>{</span>
</span></span><span class=line><span class=cl><span class=na>
</span></span></span><span class=line><span class=cl><span class=na>    [BindProperty(SupportsGet=true)]</span>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=kt>string</span> <span class=n>SearchTerms</span> <span class=p>{</span><span class=k>get</span><span class=p>;</span> <span class=k>set</span><span class=p>;}</span>
</span></span><span class=line><span class=cl><span class=na>
</span></span></span><span class=line><span class=cl><span class=na>    [BindProperty(SupportsGet=true)]</span>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=kt>string</span><span class=p>[]</span> <span class=n>MPAARatings</span> <span class=p>{</span><span class=k>get</span><span class=p>;</span> <span class=k>set</span><span class=p>;}</span>
</span></span><span class=line><span class=cl><span class=na>
</span></span></span><span class=line><span class=cl><span class=na>    [BindProperty(SupportsGet=true)]</span>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=kt>string</span><span class=p>[]</span> <span class=n>Genres</span> <span class=p>{</span><span class=k>get</span><span class=p>;</span> <span class=k>set</span><span class=p>;}</span>
</span></span><span class=line><span class=cl><span class=na>
</span></span></span><span class=line><span class=cl><span class=na>    [BindProperty(SupportsGet=true)]</span>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=kt>double?</span> <span class=n>IMDBMin</span> <span class=p>{</span><span class=k>get</span><span class=p>;</span> <span class=k>set</span><span class=p>;}</span>
</span></span><span class=line><span class=cl><span class=na>
</span></span></span><span class=line><span class=cl><span class=na>    [BindProperty(SupportsGet=true)]</span>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=kt>double?</span> <span class=n>IMDBMax</span> <span class=p>{</span><span class=k>get</span><span class=p>;</span> <span class=k>set</span><span class=p>;}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=cs>/// &lt;summary&gt;</span>
</span></span><span class=line><span class=cl>    <span class=cs>/// Gets the search results for display on the page</span>
</span></span><span class=line><span class=cl>    <span class=cs>/// &lt;/summary&gt;</span>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=k>void</span> <span class=n>OnGet</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=n>Movies</span> <span class=p>=</span> <span class=n>MovieDatabase</span><span class=p>.</span><span class=n>Search</span><span class=p>(</span><span class=n>SearchTerms</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=n>Movies</span> <span class=p>=</span> <span class=n>MovieDatabase</span><span class=p>.</span><span class=n>FilterByMPAARating</span><span class=p>(</span><span class=n>Movies</span><span class=p>,</span> <span class=n>MPAARatings</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=n>Movies</span> <span class=p>=</span> <span class=n>MovieDatabase</span><span class=p>.</span><span class=n>FilterByGenre</span><span class=p>(</span><span class=n>Movies</span><span class=p>,</span> <span class=n>Genres</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=n>Movies</span> <span class=p>=</span> <span class=n>MovieDatabase</span><span class=p>.</span><span class=n>FilterByIMDBRating</span><span class=p>(</span><span class=n>Movies</span><span class=p>,</span> <span class=n>IMDBMin</span><span class=p>,</span> <span class=n>IMDBMax</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span></span></span></code></pre></div><p>Note that with this approach, the incoming data is directly bound to the properties, so we don&rsquo;t need to do any special assignments within our <code>OnGet()</code> method. Also, note that we have to use <code>SupportsGet=true</code> in order for this binding to occur on GET requests (by default, model binding only happens with POST requests).</p><div class="box notices cstyle note"><div class=box-label><i class="fa-fw fas fa-exclamation-circle"></i> Note</div><div class=box-content><p>You only need to do <em>one</em> binding approach per property in a PageModel. I.e. you can just use the property decorator:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-csharp data-lang=csharp><span class=line><span class=cl><span class=kd>public</span> <span class=k>class</span> <span class=nc>SomePageModel</span> <span class=p>:</span> <span class=n>PageModel</span>
</span></span><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl><span class=na>    [BindProperty(SupportsGet=true)]</span>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=kt>float</span> <span class=n>SomeProperty</span> <span class=p>{</span> <span class=k>get</span><span class=p>;</span> <span class=k>set</span><span class=p>;</span> <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=k>void</span> <span class=n>OnGet</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=n>DoSomething</span><span class=p>(</span><span class=n>SomeProperty</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span></span></span></code></pre></div><p><em>or</em> you might use parameter binding:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-csharp data-lang=csharp><span class=line><span class=cl><span class=kd>public</span> <span class=k>class</span> <span class=nc>SomePageModel</span> <span class=p>:</span> <span class=n>PageModel</span>
</span></span><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=k>void</span> <span class=n>OnGet</span><span class=p>(</span><span class=kt>float</span> <span class=n>SomeProperty</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=n>DoSomething</span><span class=p>(</span><span class=n>SomeProperty</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span></span></span></code></pre></div><p><em>or</em> you can parse it from the request:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-csharp data-lang=csharp><span class=line><span class=cl><span class=kd>public</span> <span class=k>class</span> <span class=nc>SomePageModel</span> <span class=p>:</span> <span class=n>PageModel</span>
</span></span><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=k>void</span> <span class=n>OnGet</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=kt>var</span> <span class=n>someProperty</span> <span class=p>=</span> <span class=kt>float</span><span class=p>.</span><span class=n>Parse</span><span class=p>(</span><span class=n>Request</span><span class=p>.</span><span class=n>Query</span><span class=p>[</span><span class=s>&#34;SomeProperty&#34;</span><span class=p>]);</span>
</span></span><span class=line><span class=cl>        <span class=n>DoSomething</span><span class=p>(</span><span class=n>someProperty</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span></span></span></code></pre></div><p>These are all <em>different means</em> of accessing the <em>same data</em> from the incoming request.</p></div></div><p>Now all we need to do is implement the actual filter.</p><h3 id=implementing-the-imdb-rating-filter>Implementing the IMDB Rating Filter</h3><p>We&rsquo;ll define the new filter in our <code>MovieDatabase</code> class as another static method:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-csharp data-lang=csharp><span class=line><span class=cl>    <span class=cs>/// &lt;summary&gt;</span>
</span></span><span class=line><span class=cl>    <span class=cs>/// Filters the provided collection of movies</span>
</span></span><span class=line><span class=cl>    <span class=cs>/// to those with IMDB ratings falling within</span>
</span></span><span class=line><span class=cl>    <span class=cs>/// the specified range</span>
</span></span><span class=line><span class=cl>    <span class=cs>/// &lt;/summary&gt;</span>
</span></span><span class=line><span class=cl>    <span class=cs>/// &lt;param name=&#34;movies&#34;&gt;The collection of movies to filter&lt;/param&gt;</span>
</span></span><span class=line><span class=cl>    <span class=cs>/// &lt;param name=&#34;min&#34;&gt;The minimum range value&lt;/param&gt;</span>
</span></span><span class=line><span class=cl>    <span class=cs>/// &lt;param name=&#34;max&#34;&gt;The maximum range value&lt;/param&gt;</span>
</span></span><span class=line><span class=cl>    <span class=cs>/// &lt;returns&gt;The filtered movie collection&lt;/returns&gt;</span>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=kd>static</span> <span class=n>IEnumerable</span><span class=p>&lt;</span><span class=n>Movie</span><span class=p>&gt;</span> <span class=n>FilterByIMDBRating</span><span class=p>(</span><span class=n>IEnumerable</span><span class=p>&lt;</span><span class=n>Movie</span><span class=p>&gt;</span> <span class=n>movies</span><span class=p>,</span> <span class=kt>double?</span> <span class=n>min</span><span class=p>,</span> <span class=kt>double?</span> <span class=n>max</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=c1>// TODO: Filter movies</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span></span></span></code></pre></div><p>Notice that here too we use the nullable double value. So our first step is probably to do a <code>null</code> check:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-csharp data-lang=csharp><span class=line><span class=cl>    <span class=k>if</span> <span class=p>(</span><span class=n>min</span> <span class=p>==</span> <span class=kc>null</span> <span class=p>&amp;&amp;</span> <span class=n>max</span> <span class=p>==</span> <span class=kc>null</span><span class=p>)</span> <span class=k>return</span> <span class=n>movies</span><span class=p>;</span></span></span></code></pre></div><p>But what if only one is null? Should we filter for that part of the range? It wouldn&rsquo;t be hard to do:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-csharp data-lang=csharp><span class=line><span class=cl>    <span class=kt>var</span> <span class=n>results</span> <span class=p>=</span> <span class=k>new</span> <span class=n>List</span><span class=p>&lt;</span><span class=n>Movie</span><span class=p>&gt;();</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c1>// only a maximum specified</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span><span class=p>(</span><span class=n>min</span> <span class=p>==</span> <span class=kc>null</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=k>foreach</span><span class=p>(</span><span class=n>Movie</span> <span class=n>movie</span> <span class=k>in</span> <span class=n>movies</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=k>if</span> <span class=p>(</span><span class=n>movie</span><span class=p>.</span><span class=n>IMDBRating</span> <span class=p>&lt;=</span> <span class=n>max</span><span class=p>)</span> <span class=n>results</span><span class=p>.</span><span class=n>Add</span><span class=p>(</span><span class=n>movie</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=n>results</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span></span></span></code></pre></div><p>And the minimum would mirror that:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-csharp data-lang=csharp><span class=line><span class=cl>    <span class=c1>// only a minimum specified</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span><span class=p>(</span><span class=n>max</span> <span class=p>==</span> <span class=kc>null</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=k>foreach</span><span class=p>(</span><span class=n>Movie</span> <span class=n>movie</span> <span class=k>in</span> <span class=n>movies</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=k>if</span> <span class=p>(</span><span class=n>movie</span><span class=p>.</span><span class=n>IMDBRating</span> <span class=p>&gt;=</span> <span class=n>min</span><span class=p>)</span> <span class=n>results</span><span class=p>.</span><span class=n>Add</span><span class=p>(</span><span class=n>movie</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=n>results</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span></span></span></code></pre></div><p>Finally, we could handle the case where we have both a min and max value to our range:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-csharp data-lang=csharp><span class=line><span class=cl>    <span class=c1>// Both minimum and maximum specified</span>
</span></span><span class=line><span class=cl>    <span class=k>foreach</span><span class=p>(</span><span class=n>Movie</span> <span class=n>movie</span> <span class=k>in</span> <span class=n>movies</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span><span class=p>(</span><span class=n>movie</span><span class=p>.</span><span class=n>IMDBRating</span> <span class=p>&gt;=</span> <span class=n>min</span> <span class=p>&amp;&amp;</span> <span class=n>movie</span><span class=p>.</span><span class=n>IMDBRating</span> <span class=p>&lt;=</span> <span class=n>max</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=n>results</span><span class=p>.</span><span class=n>Add</span><span class=p>(</span><span class=n>movie</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=n>results</span><span class=p>;</span></span></span></code></pre></div><p>Notice too, that in each of these cases we&rsquo;re treating the range as <em>inclusive</em> (including the specified minimum and maximum). This is the behavior most casual internet users will expect. If the database and user expectations are different for your audience, you&rsquo;d want your code to match that expectation.</p><p>Now we can filter by IMDB rating:</p><p><a href=#R-image-3d26eb27003e01a2cb439073ef4bb56a class=lightbox-link><img alt="Filtering By IMDB" class="border lazy lightbox noshadow figure-image" loading=lazy src=/cis400/images/6.8.6.png style=height:auto;width:auto></a>
<a href=javascript:history.back(); class=lightbox-back id=R-image-3d26eb27003e01a2cb439073ef4bb56a><img alt="Filtering By IMDB" class="border lazy lightbox noshadow lightbox-image" loading=lazy src=/cis400/images/6.8.6.png></a></p><h2 id=finishing-up>Finishing Up</h2><p>Since we&rsquo;re displaying the Rotten Tomatoes rating, we should probably also have a filter for it. This will work almost exactly like the IMDB rating - but with the range from 0 to 100. I&rsquo;ll leave this as an exercise for the reader.</p><footer class=footline></footer></article><article class=default><header class=headline></header><h1 id=using-linq>Using LINQ</h1><p>In our movie website, we&rsquo;ve been using a custom &ldquo;database&rdquo; object, <code>MovieDatabase</code> to provide the movie data and search and filter functionality. In professional practice, we would probably replace this with an external database program. These programs have been developed specifically for persisting and accessing data, and leverage specialized data structures like B+ trees that allow them to do searches and filters much more efficiently.</p><p>Some of the most widely adopted database programs are <em>relational databases</em> like MySQL, MsSQL, Postgres, and SQLLite. These predate object-orientation, and accept requests for data in the form of SQL (Structured Query Language). You will learn more about these databases and how to use them in CIS560.</p><h2 id=linq>LINQ</h2><p>Microsoft, inspired by SQL, introduced Language Integrated Query (LINQ) in 2007 to bring the concept of a query language into .NET. LINQ allows you to construct queries in either chained method calls or in a syntax similar to SQL that can operate on collections or relational databases.</p><p>For relational databases, LINQ queries are converted internally to SQL queries, and dispatched to the database. But their real power is that they can also be used with any collection that supports either the <code>IEnumerable</code> or <code>IEnumerable&lt;T></code> interfaces. LINQ can be used to replace the kinds of filter and search functions we wrote for our <code>MovieDatabase</code>. Let&rsquo;s try it out with our movie website.</p><p>LINQ operates through extension methods, so we need to be sure to add the LINQ namespace to our CS files where we are going to employ them. We&rsquo;ll be adding our LINQ commands to our page model, so sure that is the case with your <em>Pages/Index.cshtml.cs</em>:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-csharp data-lang=csharp><span class=line><span class=cl><span class=k>using</span> <span class=nn>System.Linq</span><span class=p>;</span></span></span></code></pre></div><p>Adding this using statement will bring in all the extension methods for LINQ, and will also prompt Visual Studio to recognize the query-style syntax.</p><h2 id=searching-with-linq>Searching with LINQ</h2><p>One of the most useful extension methods in LINQ is <a href="https://docs.microsoft.com/en-us/dotnet/api/system.linq.enumerable.where?view=netcore-3.1" rel=external target=_blank>Where()</a>. It can be invoked on any <code>IEnumerable</code> and accepts a <code>Func</code> (a delegate type). This delegate takes a single argument - the current item being enumerated over, and its body should return a boolean value - <code>true</code> if the item should be included in the results, and <code>false</code> if it should not.</p><p>We can thus use our existing <code>SearchTerms</code> property as the basis for our test: <code>movie => movie.Title != null && movie.Title.Contains(SearchTerms)</code> (note that with lambda expressions, if the result is single expression we can omit the <code>{}</code> and the <code>return</code> is implied). Also note that we incorporate the null check directly into the expression using the boolean and <code>&&</code> operator.</p><p>We can replace our current search with a <code>Where()</code> call invoking this method:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-csharp data-lang=csharp><span class=line><span class=cl><span class=n>Movies</span> <span class=p>=</span> <span class=n>MovieDatabase</span><span class=p>.</span><span class=n>All</span><span class=p>.</span><span class=n>Where</span><span class=p>(</span><span class=n>movie</span> <span class=p>=&gt;</span> <span class=n>movie</span><span class=p>.</span><span class=n>Title</span> <span class=p>!=</span> <span class=kc>null</span> <span class=p>&amp;&amp;</span> <span class=n>movie</span><span class=p>.</span><span class=n>Title</span><span class=p>.</span><span class=n>Contains</span><span class=p>(</span><span class=n>SearchTerms</span><span class=p>,</span> <span class=n>String</span><span class=p>));</span></span></span></code></pre></div><p>However if we run the program we will encounter a null exception. On our first GET request, the value of <code>SearchTerms</code> is null, which is <em>not</em> a legal argument for <code>String.Contains()</code>.</p><h2 id=making-search-conditional>Making Search Conditional</h2><p>If the <code>SearchTerms</code> is null, that indicates that the user did not enter a search term - accordingly, we probably don&rsquo;t want to search. We can wrap our filter in an <code>if</code> test to prevent applying the filter when there is no search term. Thus, we would refactor our filtering expression to:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-csharp data-lang=csharp><span class=line><span class=cl><span class=n>Movies</span> <span class=p>=</span> <span class=n>MovieDatabase</span><span class=p>.</span><span class=n>All</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=c1>// Search movie titles for the SearchTerms</span>
</span></span><span class=line><span class=cl><span class=k>if</span><span class=p>(</span><span class=n>SearchTerms</span> <span class=p>!=</span> <span class=kc>null</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=n>Movies</span> <span class=p>=</span> <span class=n>Movies</span><span class=p>.</span><span class=n>Where</span><span class=p>(</span><span class=n>movie</span> <span class=p>=&gt;</span> <span class=n>movie</span><span class=p>.</span><span class=n>Title</span> <span class=p>!=</span> <span class=kc>null</span> <span class=p>&amp;&amp;</span> <span class=n>movie</span><span class=p>.</span><span class=n>Title</span><span class=p>.</span><span class=n>Contains</span><span class=p>(</span><span class=n>SearchTerms</span><span class=p>,</span> <span class=n>StringComparison</span><span class=p>.</span><span class=n>InvariantCultureIgnoreCase</span><span class=p>));</span>
</span></span><span class=line><span class=cl><span class=p>}</span></span></span></code></pre></div><p>Now if we run the program, and search for a specific term, we&rsquo;ll see our results is modified to contain <em>only</em> those movies with the terms in their title!</p><p>We can also use the query syntax instead of the extension method syntax, which is similar to SQL:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-csharp data-lang=csharp><span class=line><span class=cl><span class=n>Movies</span> <span class=p>=</span> <span class=n>MovieDatabase</span><span class=p>.</span><span class=n>All</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=c1>// Search movie titles for the SearchTerms</span>
</span></span><span class=line><span class=cl><span class=k>if</span><span class=p>(</span><span class=n>SerchTerms</span> <span class=p>!=</span> <span class=kc>null</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=n>Movies</span> <span class=p>=</span> <span class=k>from</span> <span class=n>movie</span> <span class=k>in</span> <span class=n>Movies</span>
</span></span><span class=line><span class=cl>        <span class=k>where</span> <span class=n>movie</span><span class=p>.</span><span class=n>Title</span> <span class=p>!=</span> <span class=kc>null</span> <span class=p>&amp;&amp;</span> <span class=n>movie</span><span class=p>.</span><span class=n>Title</span><span class=p>.</span><span class=n>Contains</span><span class=p>(</span><span class=n>SearchTerms</span><span class=p>,</span> <span class=n>StringComparison</span><span class=p>.</span><span class=n>InvariantCultureIgnoreCase</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=k>select</span> <span class=n>movie</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span></span></span></code></pre></div><p>This syntax is converted by the C# compiler to use the extension methods as part of the compilation process.</p><div class="box notices cstyle info"><div class=box-label><i class="fa-fw fas fa-info-circle"></i> Info</div><div class=box-content><p>The search approach listed above will only find the <em>exact</em> search terms, i.e. searching for &ldquo;Clear Present Danger&rdquo; will <em>not</em> match the film &ldquo;Clear and Present Danger&rdquo;. How might you tweak the search approach so that terms would be found individually?</p></div></div><p>You can use either form for writing your queries, though it is best to stay consistent within a single program.</p><h2 id=filtering-with-linq>Filtering with LINQ</h2><p>Filtering is also accomplished through the <a href="https://docs.microsoft.com/en-us/dotnet/api/system.linq.enumerable.where?view=netcore-3.1" rel=external target=_blank>Where()</a>. We can add additional tests within our search <code>Where()</code>, but it is more legible to add <em>additional</em> <code>Where</code> calls:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-csharp data-lang=csharp><span class=line><span class=cl><span class=n>Movies</span> <span class=p>=</span> <span class=n>MovieDatabase</span><span class=p>.</span><span class=n>All</span>
</span></span><span class=line><span class=cl>    <span class=c1>// Search movie titles for the SearchTerms</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span><span class=p>(</span><span class=n>SearchTerms</span> <span class=p>!=</span> <span class=kc>null</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=n>Movies</span> <span class=p>=</span> <span class=n>Movies</span><span class=p>.</span><span class=n>Where</span><span class=p>(</span><span class=n>movie</span> <span class=p>=&gt;</span> <span class=n>movie</span><span class=p>.</span><span class=n>Title</span> <span class=p>!=</span> <span class=kc>null</span> <span class=p>&amp;&amp;</span> <span class=n>movie</span><span class=p>.</span><span class=n>Title</span><span class=p>.</span><span class=n>Contains</span><span class=p>(</span><span class=n>SearchTerms</span><span class=p>,</span> <span class=n>StringComparison</span><span class=p>.</span><span class=n>InvariantCultureIgnoreCase</span><span class=p>));</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=c1>// Filter by MPAA Rating</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span><span class=p>(</span><span class=n>MPAARatings</span> <span class=p>!=</span> <span class=kc>null</span> <span class=p>&amp;&amp;</span> <span class=n>MPAARatings</span><span class=p>.</span><span class=n>Length</span> <span class=p>!=</span> <span class=m>0</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=n>Movies</span> <span class=p>=</span> <span class=n>Movies</span><span class=p>.</span><span class=n>Where</span><span class=p>(</span><span class=n>movie</span> <span class=p>=&gt;</span>
</span></span><span class=line><span class=cl>            <span class=n>movie</span><span class=p>.</span><span class=n>MPAARating</span> <span class=p>!=</span> <span class=kc>null</span> <span class=p>&amp;&amp;</span>
</span></span><span class=line><span class=cl>            <span class=n>MPAARatings</span><span class=p>.</span><span class=n>Contains</span><span class=p>(</span><span class=n>movie</span><span class=p>.</span><span class=n>MPAARating</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            <span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span></span></span></code></pre></div><div class="box notices cstyle todo"><div class=box-label></div><div class=box-content><p>The numerical filters are handled the same way - with additional <code>Where</code> clauses. I leave this as an exercise for the reader to complete.</p></div></div><h2 id=benefits-of-linq>Benefits of LINQ</h2><p>While LINQ is a bit less code for us to write, there is another big benefit - the actual filtering is only applied <em>when we start iterating through the results</em>. This means that LINQ queries with multiple <code>Where()</code> invocations can combine them into a single iteration.</p><p>Consider our movie website example. We have four filters - the search, the MPAA Ratings, the IMDB Ratings, and the Rotten Tomato Rating. In the worst case, each movie in the database would pass each filter, so that our list never got smaller. With the filter functions we wrote in <code>MovieDatabase</code>, we would have to iterate over that full list <em>four times</em>. In terms of complexity, that&rsquo;s $O(4n)$.</p><p>In contrast, because LINQ doesn&rsquo;t actually run the filters until we start iterating, it can combine all the <code>While</code> tests into a single boolean expression. The result is it only has to iterate through the list <em>once</em>. Hence, its complexity becomes $O(n)$. There is a little additional overhead for holding onto the query information that way, but it&rsquo;s small compared to the benefit.</p><p>Also, we could have done the same kind of optimization ourselves, but it takes a lot of work to set up, and may not be worth it for a single web app. But LINQ provides us that benefit for free.</p><footer class=footline></footer></article></section></div></main><div class=git-footer><p class=theme-version-footer>6.0.0</p><p>Last modified by:
<i class='fas fa-user'></i> Julie Thornton
<i class='fas fa-calendar'></i> <a href=https://github.com/ksu-cs-textbooks/cis400/commit/49e1b7656e0b4e6d675d8aa55bc1e73c58f44a99>Aug 3, 2023</a></p></div></div><script src=/cis400/js/clipboard.min.js?1731949282 defer></script><script src=/cis400/js/perfect-scrollbar.min.js?1731949282 defer></script><script src=/cis400/js/theme.js?1731949282 defer></script></body></html>