




	
	
		

	
	
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		
		

	
	
		

	
	
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		
		

	
	
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		
		

	
	
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		
		

	
	
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		
		

	
	
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		
		

	
	
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		
		

	
	
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		
		
		

	
	
		

	
	
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		
		

	
	
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		
		

	
	
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		
		

	
	
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		
		

	
	
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		
		

	
	
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		
		
		

	
	
		

	
	
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		
		

	
	
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		
		

	
	
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		
		

	
	
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		
		

	
	
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		
		

	
	
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		
		
		

	
	
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		
		

	
	
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		
		

	
	
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		
		

	
	
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		
		

	
	
		

	
	
		
		

	
	
		
		
		
<!DOCTYPE html>
<html lang="en" dir="ltr">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="height=device-height, width=device-width, initial-scale=1.0, minimum-scale=1.0">
    <meta name="generator" content="Hugo 0.117.0">
    <meta name="generator" content="Relearn 5.18.0">
    <meta name="description" content="K-State CIS 400 Textbook">
    <meta name="author" content="Nathan Bean">
    <title>Web Data :: K-State CIS 400 Textbook</title>
    <link href="https://ksu-cs-textbooks.github.io/cis400/c-exercises-s23/12-web-data/index.html" rel="canonical" type="text/html" title="Web Data :: K-State CIS 400 Textbook">
    <link href="https://ksu-cs-textbooks.github.io/cis400/c-exercises-s23/12-web-data/index.xml" rel="alternate" type="application/rss+xml" title="Web Data :: K-State CIS 400 Textbook">
    <link href="https://ksu-cs-textbooks.github.io/cis400/c-exercises-s23/12-web-data/tele.html" rel="alternate" type="text/html" title="Web Data :: K-State CIS 400 Textbook">
    <link href="https://ksu-cs-textbooks.github.io/cis400/c-exercises-s23/12-web-data/embed.html" rel="alternate" type="text/html" title="Web Data :: K-State CIS 400 Textbook">
    <!-- https://github.com/filamentgroup/loadCSS/blob/master/README.md#how-to-use -->
    <link href="https://ksu-cs-textbooks.github.io/cis400/css/fontawesome-all.min.css?1714501677" rel="stylesheet" media="print" onload="this.media='all';this.onload=null;"><noscript><link href="https://ksu-cs-textbooks.github.io/cis400/css/fontawesome-all.min.css?1714501677" rel="stylesheet"></noscript>
    <link href="https://ksu-cs-textbooks.github.io/cis400/css/nucleus.css?1714501677" rel="stylesheet">
    <link href="https://ksu-cs-textbooks.github.io/cis400/css/auto-complete.css?1714501677" rel="stylesheet" media="print" onload="this.media='all';this.onload=null;"><noscript><link href="https://ksu-cs-textbooks.github.io/cis400/css/auto-complete.css?1714501677" rel="stylesheet"></noscript>
    <link href="https://ksu-cs-textbooks.github.io/cis400/css/perfect-scrollbar.min.css?1714501677" rel="stylesheet">
    <link href="https://ksu-cs-textbooks.github.io/cis400/css/fonts.css?1714501677" rel="stylesheet" media="print" onload="this.media='all';this.onload=null;"><noscript><link href="https://ksu-cs-textbooks.github.io/cis400/css/fonts.css?1714501677" rel="stylesheet"></noscript>
    <link href="https://ksu-cs-textbooks.github.io/cis400/css/theme.css?1714501677" rel="stylesheet">
    <link href="https://ksu-cs-textbooks.github.io/cis400/css/theme-auto.css?1714501677" rel="stylesheet" id="variant-style">
    <link href="https://ksu-cs-textbooks.github.io/cis400/css/variant.css?1714501677" rel="stylesheet">
    <link href="https://ksu-cs-textbooks.github.io/cis400/css/print.css?1714501677" rel="stylesheet" media="print">
    <link href="https://ksu-cs-textbooks.github.io/cis400/css/format-print.css?1714501677" rel="stylesheet">
    <link href="https://ksu-cs-textbooks.github.io/cis400/css/ie.css?1714501677" rel="stylesheet">
    <script src="https://ksu-cs-textbooks.github.io/cis400/js/url.js?1714501677"></script>
    <script src="https://ksu-cs-textbooks.github.io/cis400/js/variant.js?1714501677"></script>
    <script>
      // hack to let hugo tell us how to get to the root when using relativeURLs, it needs to be called *url= for it to do its magic:
      // https://github.com/gohugoio/hugo/blob/145b3fcce35fbac25c7033c91c1b7ae6d1179da8/transform/urlreplacers/absurlreplacer.go#L72
      window.index_js_url="https://ksu-cs-textbooks.github.io/cis400/index.search.js";
      var root_url="https://ksu-cs-textbooks.github.io/cis400/";
      var baseUri=root_url.replace(/\/$/, '');
      // translations
      window.T_Copy_to_clipboard = 'Copy to clipboard';
      window.T_Copied_to_clipboard = 'Copied to clipboard!';
      window.T_Copy_link_to_clipboard = 'Copy link to clipboard';
      window.T_Link_copied_to_clipboard = 'Copied link to clipboard!';
      window.T_No_results_found = 'No results found for \u0022{0}\u0022';
      window.T_N_results_found = '{1} results found for \u0022{0}\u0022';
      // some further base stuff
      var baseUriFull='https:\/\/ksu-cs-textbooks.github.io\/cis400/';
      window.variants && variants.init( [ 'auto', 'light-theme', 'dark-theme' ] );
    </script>
    
    <link href="https://ksu-cs-textbooks.github.io/cis400/css/custom.css?1714501677" rel="stylesheet">

  </head>
  <body class="mobile-support print disableInlineCopyToClipboard" data-url="https://ksu-cs-textbooks.github.io/cis400/c-exercises-s23/12-web-data/index.html">
    <div id="body" class="default-animation">
      <div id="sidebar-overlay"></div>
      <div id="toc-overlay"></div>
      <nav id="topbar" class="highlightable">
        <div>
          <div id="top-tele-link">
            <a class="print-link" title='Teleprompter View' href="https://ksu-cs-textbooks.github.io/cis400/c-exercises-s23/12-web-data/tele.html">
              <i class="fas fa-tv fa-fw"></i>
            </a>
          </div>
          <div id="top-embed-link">
            <a class="print-link" title='Embeddable Version' href="https://ksu-cs-textbooks.github.io/cis400/c-exercises-s23/12-web-data/embed.html">
              <i class="fas fa-expand-arrows-alt fa-fw"></i>
            </a>
          </div>
          <div id="breadcrumbs">
            <span id="sidebar-toggle-span">
              <a href="#" id="sidebar-toggle" class="topbar-link" title='Menu (CTRL+ALT+n)'><i class="fas fa-bars fa-fw"></i></a>
            </span>
            <ol class="links" itemscope itemtype="http://schema.org/BreadcrumbList">
              <li itemscope itemtype="https://schema.org/ListItem" itemprop="itemListElement"><a itemprop="item" href="https://ksu-cs-textbooks.github.io/cis400/index.html"><span itemprop="name">CIS 400: Object-Oriented Design, Implementation, and Testing</span></a><meta itemprop="position" content="1"> &gt; </li>
              <li itemscope itemtype="https://schema.org/ListItem" itemprop="itemListElement"><a itemprop="item" href="https://ksu-cs-textbooks.github.io/cis400/c-exercises-s23/index.html"><span itemprop="name">Exercises</span></a><meta itemprop="position" content="2"> &gt; </li>
              <li itemscope itemtype="https://schema.org/ListItem" itemprop="itemListElement"><span itemprop="name">Web Data</span><meta itemprop="position" content="3"></li>
            </ol>
          </div>
        </div>
      </nav>
      <main id="body-inner" class="highlightable default" tabindex="-1">
        <div class="flex-block-wrapper">
          <article class="default">
            <header class="headline">
            </header>
<h1 id="web-data">Web Data</h1>

<p>Now that we&rsquo;ve seen how to dynamically create the content of a Razor Page on the server, we should turn our attention to how we can do so based on our user&rsquo;s needs.  Consider the example application we have been developing - it exposes a database of movie information to the user.  How might a user want to use this database?  They might want to find the details for a specific movie - who directed it, when was it released, etc.  They might be looking for a movie they want to watch in a favorite genre.  They might be looking to find all the movies directed by a favorite director&hellip; there are a lot of possibilities.</p>
<p>As software developers, we need to anticipate how our users will likely want to use the software we are developing.  And with that in mind, we need to develop user interfaces that allow the user to communicate those needs to the software we are writing as concisely as possible.  Remember that in HTTP, all communication between the client (and its user) and the server (our web application), is mediated through the request-response mechanism:</p>
<p>
<a href="#image-8d7e7880bc464045a77203031590353a" class="lightbox-link">
<img src="https://ksu-cs-textbooks.github.io/cis400/images/request-response-pattern.png" alt="Request-Response Mechanism" style="height: auto; width: auto;" loading="lazy">
</a>
<a href="javascript:history.back();" class="lightbox" id="image-8d7e7880bc464045a77203031590353a">
<img src="https://ksu-cs-textbooks.github.io/cis400/images/request-response-pattern.png" alt="Request-Response Mechanism" class="lightbox-image" loading="lazy">
</a></p>
<p>Thus, any information the user wants to supply the server is typically communicated <em>through</em> a request.  HTML provides a mechanism for enabling this communication in a structured way - forms.  A <code>&lt;form&gt;</code> element, when submitted, serializes the values of all <code>&lt;input&gt;</code> elements contained within it and submits them to the server in the request.</p>
<p>The values in the form are serialized (converted into text) and submitted with the request.  Exactly how this serialization happens depends on the kind of request.  For GET requests the serialized data is added to the url as the query string.  For POST requests, the serialized data is sent as the body of the request.</p>
<p>You can usually use either form (except when uploading files, which must be POSTed).  However, you might think about the semantics of each action.  A GET request is for retrieving something <em>from</em> the server, so any data your sending is about modifying that request.  Thus, search and filter requests make sense as a GET request.  A POST request is about sending something <em>to</em> the server, thus account creation, blog posts, and so on make sense as a POST request.</p>

  
  
<div class="box notices cstyle info">
  <div class="box-label"><i class="fa-fw fas fa-info-circle"></i> Info</div>
  <div class="box-content">

<p>When sent using secure HTTP (HTTPS), both the query string portion of the URL and the request body are encrypted, so there is no difference in the in-transit security.  However, browsers typically store the full URL in the history, so if sensitive information is being sent, you might want to use POST requests.</p>
</div>
</div>

            <footer class="footline">

            </footer>
          </article>

          <section>
            <h1 class="a11y-only">Subsections of Web Data</h1>
    
    
          <article class="default">
            <header class="headline">
            </header>
<h1 id="adding-search-to-the-movie-site">Adding Search to the Movie Site</h1>

<p>Let&rsquo;s add a search form and functionality to our movie website.  We&rsquo;ll add this to our <em>Index.cshtml</em> page, just above the <code>&lt;h1&gt;</code> element:</p>
<div class="wrap-code highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-html" data-lang="html"><span style="display:flex;"><span>    &lt;<span style="color:#f92672">form</span>&gt;
</span></span><span style="display:flex;"><span>        &lt;<span style="color:#f92672">input</span> <span style="color:#a6e22e">type</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;text&#34;</span> <span style="color:#a6e22e">name</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;SearchTerms&#34;</span>/&gt;
</span></span><span style="display:flex;"><span>        &lt;<span style="color:#f92672">input</span> <span style="color:#a6e22e">type</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;submit&#34;</span> <span style="color:#a6e22e">value</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;Search&#34;</span>&gt;
</span></span><span style="display:flex;"><span>    &lt;/<span style="color:#f92672">form</span>&gt;
</span></span><span style="display:flex;"><span>    &lt;<span style="color:#f92672">h1</span>&gt;Movie Results&lt;/<span style="color:#f92672">h1</span>&gt;</span></span></code></pre></div><p>We&rsquo;ll also change the <code>&lt;h1&gt;</code> contents to &ldquo;Movie Results&rdquo;.</p>
<p>Try typing a search term into the search box, and click the <em>search</em> button.  Has anything changed?</p>
<h3 id="the-request-object">The Request Object</h3>
<p>When you click the <em>search</em> button, the browser serializes your form, and makes a request against your server including the search terms.  By default this request is a <strong>GET</strong> request, and the contents of the form are serialized using <a href="https://developer.mozilla.org/en-US/docs/Glossary/percent-encoding" target="_blank">urlencoding (aka percent encoding)</a>
, a special string format.  This string is then appended to the requested url as the <a href="https://developer.mozilla.org/en-US/docs/Web/API/Location/search" target="_blank">query string (aka search string)</a>
 - a series of key-value pairs proceeded by the question mark symbol(<code>?</code>) and separated by the ampersand (<code>&amp;</code>).</p>
<p>This data is made available to us in our PageModel <em>Index.cshtml.cs</em> by ASP.NET.  Let&rsquo;s take a look at it now.  Notice the method <code>public void OnGet()</code>?  This method is invoked <em>every time the page is requested using a GET request</em>.  Thus, if we need to do some initialization and/or processing, this would be the place to do it.</p>
<p>Inside the PageModel, we can access the request data using the <code>Request</code> object.  The exact string can be accessed with <code>Request.QueryString</code>, or the parsed and deserialized results can be accessed from <code>Request.Query</code>.  Let&rsquo;s use the latter to pull out the search terms:</p>
<div class="wrap-code highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-csharp" data-lang="csharp"><span style="display:flex;"><span>    <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">void</span> OnGet() 
</span></span><span style="display:flex;"><span>    {
</span></span><span style="display:flex;"><span>        String terms = Request.Query[<span style="color:#e6db74">&#34;SearchTerms&#34;</span>];
</span></span><span style="display:flex;"><span>    }</span></span></code></pre></div><p>We can store that value, and make it available to the page itself, by creating a public property.  Let&rsquo;s create one named <code>SearchTerms</code>:</p>
<div class="wrap-code highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-csharp" data-lang="csharp"><span style="display:flex;"><span>    <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">string</span> SearchTerms { <span style="color:#66d9ef">get</span>; <span style="color:#66d9ef">set</span>; }</span></span></code></pre></div><p>And we&rsquo;ll refactor our <code>OnGet()</code> to store the search terms coming in from the request:</p>
<div class="wrap-code highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-csharp" data-lang="csharp"><span style="display:flex;"><span>    <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">void</span> OnGet() 
</span></span><span style="display:flex;"><span>    {
</span></span><span style="display:flex;"><span>        SearchTerms = Request.Query[<span style="color:#e6db74">&#34;SearchTerms&#34;</span>];
</span></span><span style="display:flex;"><span>    }</span></span></code></pre></div><p>Now we can refactor our input element to use that public property from our model as its default value:</p>
<div class="wrap-code highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-html" data-lang="html"><span style="display:flex;"><span>    &lt;<span style="color:#f92672">input</span> <span style="color:#a6e22e">type</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;text&#34;</span> <span style="color:#a6e22e">name</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;SearchTerms&#34;</span> <span style="color:#a6e22e">value</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;@Model.SearchTerms&#34;</span>/&gt;</span></span></code></pre></div><p>The first time we visit the index page, the <code>SearchTerms</code> value will be null, so our input would have <code>value=&quot;&quot;</code>.  The browser interprets this as empty.  If we add a search term and click the <em>search</em> button, we&rsquo;ll see the page reload.  And since <code>@Model.SearchTerms</code> has a value this time, we&rsquo;ll see that string appear in search box!</p>
<p>Now we just need to search for those terms&hellip;</p>
<h3 id="adding-search-to-the-database">Adding Search to the Database</h3>
<p>We&rsquo;ll start by defining a new static method in our <em>MovieDatabase.cs</em> file to search for movies using the search terms:</p>
<div class="wrap-code highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-csharp" data-lang="csharp"><span style="display:flex;"><span>    <span style="color:#75715e">/// &lt;summary&gt;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">/// Searches the database for matching movies</span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">/// &lt;/summary&gt;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">/// &lt;param name=&#34;terms&#34;&gt;The terms to search for&lt;/param&gt;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">/// &lt;returns&gt;A collection of movies&lt;/returns&gt;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">static</span> IEnumerable&lt;Movie&gt; Search(<span style="color:#66d9ef">string</span> terms)
</span></span><span style="display:flex;"><span>    {
</span></span><span style="display:flex;"><span>        <span style="color:#75715e">// TODO: Search database</span>
</span></span><span style="display:flex;"><span>    }</span></span></code></pre></div><p>We&rsquo;ll need a collection of results that implements the <code>IEnumerable&lt;T&gt;</code> interface.  Let&rsquo;s use the familiar <code>List&lt;T&gt;</code>:</p>
<div class="wrap-code highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-csharp" data-lang="csharp"><span style="display:flex;"><span>    List&lt;Movie&gt; results = <span style="color:#66d9ef">new</span> List&lt;Movie&gt;();</span></span></code></pre></div><p>Now, there is a chance that the search terms we receive are <code>null</code>.  If that&rsquo;s the case, we would either 1) return <em>all</em> the movies, or 2) return <em>no</em> movies.  You can choose either option, but for now, I&rsquo;ll return all movies</p>
<div class="wrap-code highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-csharp" data-lang="csharp"><span style="display:flex;"><span>    <span style="color:#75715e">// Return all movies if there are no search terms</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">if</span>(terms == <span style="color:#66d9ef">null</span>) <span style="color:#66d9ef">return</span> All;</span></span></code></pre></div><p>If we <em>do</em> have search terms, we need to add any movies from our database that include those terms in the title.  This requires us to check <em>each movie</em> in our database:</p>
<div class="wrap-code highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-csharp" data-lang="csharp"><span style="display:flex;"><span>    <span style="color:#75715e">// return each movie in the database containing the terms substring</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">foreach</span>(Movie movie <span style="color:#66d9ef">in</span> All)
</span></span><span style="display:flex;"><span>    {
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">if</span>(movie.Title.Contains(terms, StringComparison.InvariantCultureIgnoreCase)) 
</span></span><span style="display:flex;"><span>        {
</span></span><span style="display:flex;"><span>            results.Add(movie);
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>    }   </span></span></code></pre></div><p>We&rsquo;ll use <a href="https://docs.microsoft.com/en-us/dotnet/api/system.string.contains?view=netframework-4.8" target="_blank">String.Contains()</a>
 to determine if our terms are a <em>substring</em> within the title, ignoring case differences.  If we find it, we&rsquo;ll add the movie to our <code>results</code> list.</p>
<p>Finally, we&rsquo;ll return that list:</p>
<div class="wrap-code highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-csharp" data-lang="csharp"><span style="display:flex;"><span>    <span style="color:#66d9ef">return</span> results;</span></span></code></pre></div><p>Now, we can refactor our <em>Index.cshtml.cs</em> to use this new search method:</p>
<div class="wrap-code highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-csharp" data-lang="csharp"><span style="display:flex;"><span>    <span style="color:#75715e">/// &lt;summary&gt;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">/// The movies to display on the index page </span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">/// &lt;/summary&gt;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">public</span> IEnumerable&lt;Movie&gt; Movies { <span style="color:#66d9ef">get</span>; <span style="color:#66d9ef">protected</span> <span style="color:#66d9ef">set</span>; }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">/// &lt;summary&gt;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">/// The current search terms </span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">/// &lt;/summary&gt;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">string</span> SearchTerms { <span style="color:#66d9ef">get</span>; <span style="color:#66d9ef">set</span>; }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">/// &lt;summary&gt;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">/// Gets the search results for display on the page</span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">/// &lt;/summary&gt;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">void</span> OnGet() 
</span></span><span style="display:flex;"><span>    {
</span></span><span style="display:flex;"><span>        SearchTerms = Request.Query[<span style="color:#e6db74">&#34;SearchTerms&#34;</span>];
</span></span><span style="display:flex;"><span>        Movies = MovieDatabase.Search(SearchTerms);
</span></span><span style="display:flex;"><span>    }</span></span></code></pre></div><p>We&rsquo;ll also need ot refactor our <em>Index.cshtml.cs</em> to use the search results, instead of the entire database:</p>
<div class="wrap-code highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-html" data-lang="html"><span style="display:flex;"><span>&lt;<span style="color:#f92672">ul</span> <span style="color:#a6e22e">class</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;movie-list&#34;</span>&gt;
</span></span><span style="display:flex;"><span>    @foreach(Movie movie in @Model.Movies)
</span></span><span style="display:flex;"><span>    {
</span></span><span style="display:flex;"><span>        &lt;<span style="color:#f92672">li</span>&gt;
</span></span><span style="display:flex;"><span>            &lt;<span style="color:#f92672">div</span> <span style="color:#a6e22e">class</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;details&#34;</span>&gt;
</span></span><span style="display:flex;"><span>                &lt;<span style="color:#f92672">h3</span> <span style="color:#a6e22e">class</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;title&#34;</span>&gt;@movie.Title&lt;/<span style="color:#f92672">h3</span>&gt;
</span></span><span style="display:flex;"><span>                &lt;<span style="color:#f92672">div</span> <span style="color:#a6e22e">class</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;mpaa&#34;</span>&gt;@movie.MPAARating&lt;/<span style="color:#f92672">div</span>&gt;
</span></span><span style="display:flex;"><span>                &lt;<span style="color:#f92672">div</span> <span style="color:#a6e22e">class</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;genre&#34;</span>&gt;@movie.MajorGenre&lt;/<span style="color:#f92672">div</span>&gt;
</span></span><span style="display:flex;"><span>            &lt;/<span style="color:#f92672">div</span>&gt;
</span></span><span style="display:flex;"><span>            &lt;<span style="color:#f92672">div</span> <span style="color:#a6e22e">class</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;ratings&#34;</span>&gt;
</span></span><span style="display:flex;"><span>                @if(movie.IMDBRating != null)
</span></span><span style="display:flex;"><span>                {
</span></span><span style="display:flex;"><span>                    &lt;<span style="color:#f92672">div</span> <span style="color:#a6e22e">class</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;imdb&#34;</span>&gt;
</span></span><span style="display:flex;"><span>                        @movie.IMDBRating
</span></span><span style="display:flex;"><span>                    &lt;/<span style="color:#f92672">div</span>&gt;
</span></span><span style="display:flex;"><span>                }
</span></span><span style="display:flex;"><span>                @if(movie.RottenTomatoesRating != null)
</span></span><span style="display:flex;"><span>                {
</span></span><span style="display:flex;"><span>                    &lt;<span style="color:#f92672">div</span> <span style="color:#a6e22e">class</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;rotten-tomatoes&#34;</span>&gt;
</span></span><span style="display:flex;"><span>                        @movie.RottenTomatoesRating
</span></span><span style="display:flex;"><span>                    &lt;/<span style="color:#f92672">div</span>&gt;
</span></span><span style="display:flex;"><span>                }
</span></span><span style="display:flex;"><span>            &lt;/<span style="color:#f92672">div</span>&gt;
</span></span><span style="display:flex;"><span>        &lt;/<span style="color:#f92672">li</span>&gt;
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>&lt;/<span style="color:#f92672">ul</span>&gt;</span></span></code></pre></div><p>If we try running the project again, and searching for the term &ldquo;Love&rdquo;&hellip; it crashes?  What is going on?</p>
<p>
<a href="#image-2ae9662511571f9c8de20a4441cef092" class="lightbox-link">
<img src="https://ksu-cs-textbooks.github.io/cis400/images/6.8.2.png" alt="The Encountered Exception" style="height: auto; width: auto;" loading="lazy">
</a>
<a href="javascript:history.back();" class="lightbox" id="image-2ae9662511571f9c8de20a4441cef092">
<img src="https://ksu-cs-textbooks.github.io/cis400/images/6.8.2.png" alt="The Encountered Exception" class="lightbox-image" loading="lazy">
</a></p>
<p>Notice that the error is a <code>NullReferenceException</code>, and occurs in our <code>if</code> statement checking the title.</p>
<h3 id="bad-data">Bad Data</h3>
<p>If we think about what variables are involved in the line <code>if(movie.Title.Contains(terms, StringComparison.InvariantCultureIgnoreCase))</code>, we have:</p>
<ul>
<li><code>movie</code></li>
<li><code>movie.Title</code></li>
<li><code>terms</code></li>
</ul>
<p>Which of these three values can be null?  We know for certain <code>terms</code> is not, as we test for the null value and return if it exists just before this portion of our code.  Similarly, <code>movie</code> cannot be null, as it is an entry in the list provided by <code>All</code>, and if it were null, our page would have crashed before we added searching.  That leaves <code>movie.Title</code> as a possibility.</p>
<p>If we comb through the data in <em>movies.json</em>, we find on line 54957 a movie with <code>null</code> for a title:</p>
<div class="wrap-code highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-json" data-lang="json"><span style="display:flex;"><span>  {
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">&#34;Title&#34;</span>: <span style="color:#66d9ef">null</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">&#34;USGross&#34;</span>: <span style="color:#ae81ff">26403</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">&#34;WorldwideGross&#34;</span>: <span style="color:#ae81ff">3080493</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">&#34;USDVDSales&#34;</span>: <span style="color:#66d9ef">null</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">&#34;ProductionBudget&#34;</span>: <span style="color:#ae81ff">3700000</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">&#34;ReleaseDate&#34;</span>: <span style="color:#e6db74">&#34;Nov 03 2006&#34;</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">&#34;MPAARating&#34;</span>: <span style="color:#e6db74">&#34;Not Rated&#34;</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">&#34;RunningTime&#34;</span>: <span style="color:#ae81ff">85</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">&#34;Distributor&#34;</span>: <span style="color:#e6db74">&#34;IFC Films&#34;</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">&#34;Source&#34;</span>: <span style="color:#e6db74">&#34;Original Screenplay&#34;</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">&#34;MajorGenre&#34;</span>: <span style="color:#e6db74">&#34;Thriller/Suspense&#34;</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">&#34;CreativeType&#34;</span>: <span style="color:#e6db74">&#34;Contemporary Fiction&#34;</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">&#34;Director&#34;</span>: <span style="color:#66d9ef">null</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">&#34;RottenTomatoesRating&#34;</span>: <span style="color:#ae81ff">39</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">&#34;IMDBRating&#34;</span>: <span style="color:#ae81ff">6.6</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">&#34;IMDBVotes&#34;</span>: <span style="color:#ae81ff">11986</span>
</span></span><span style="display:flex;"><span>  }<span style="color:#960050;background-color:#1e0010">,</span></span></span></code></pre></div><p>Working from the provided metadata, we can eventually identify the film as one titled <a href="https://en.wikipedia.org/wiki/Unknown_%282006_film%29" target="_blank">Unknown</a>
.  It would seem that whomever wrote the script to create this JSON file interpreted &ldquo;Unknown&rdquo; to mean the title was unknown (hence null), rather than the literal word &ldquo;Unknown&rdquo;.</p>
<p>If we dig deeper into the JSON file, we can find other issues.  For example, the JSON identifies the controversial film <a href="https://en.wikipedia.org/wiki/The_Birth_of_a_Nation" target="_blank">Birth of a Nation</a>
 as being released in 2015, when it was actually the first full-length theatrical film ever released, in <em>1915</em>!  Most likely the original database from which these entries were derived only used two digits for the year, i.e. <code>15</code>, and the scripter who converted it to JSON chose a threshold date to determine if it was released in the 20 or 21st century, i.e.:</p>
<div class="wrap-code highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-csharp" data-lang="csharp"><span style="display:flex;"><span><span style="color:#66d9ef">if</span>(date &lt; <span style="color:#ae81ff">28</span>) 
</span></span><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>    date += <span style="color:#ae81ff">2000</span>;
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">else</span> {
</span></span><span style="display:flex;"><span>    date += <span style="color:#ae81ff">1900</span>;
</span></span><span style="display:flex;"><span>}</span></span></code></pre></div><p>The earliest movie release date in the JSON is 1928, for &ldquo;The Broadway Melody&rdquo;, which suggests that <em>all</em> the movies released between 1915 and 1928 have been mislabeled as being released in the 21st century!</p>
<p>Unfortunately, these kinds of errors are rampant in databases, so as software developers we must be aware that our data may well be <em>dirty</em> - containing erroneous values, and anticipate these errors much like we do with user input.  It is a good idea to clean up and fix these errors in our database so that it will be more reliable, but we also need to check for potential errors in our own code, as the database could be updated with more junk data in the future.  Thus, we&rsquo;ll add a <code>null</code> check to our <code>if</code> statement in <em>MovieDatabase.cs</em>:</p>
<div class="wrap-code highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-csharp" data-lang="csharp"><span style="display:flex;"><span><span style="color:#66d9ef">if</span>(movie.Title != <span style="color:#66d9ef">null</span> &amp;&amp; movie.Title.Contains(terms, StringComparison.InvariantCultureIgnoreCase)) </span></span></code></pre></div><p>This will protect us against a <code>NullReferenceException</code> when our movie titles are null.  Now if you try the search again, you should see the results:</p>
<p>
<a href="#image-022aeedd23946db2e6577513598d4bf1" class="lightbox-link">
<img src="https://ksu-cs-textbooks.github.io/cis400/images/6.8.3.png" alt="The Search Results for &amp;ldquo;Love&amp;rdquo;" style="height: auto; width: auto;" loading="lazy">
</a>
<a href="javascript:history.back();" class="lightbox" id="image-022aeedd23946db2e6577513598d4bf1">
<img src="https://ksu-cs-textbooks.github.io/cis400/images/6.8.3.png" alt="The Search Results for &amp;ldquo;Love&amp;rdquo;" class="lightbox-image" loading="lazy">
</a></p>

            <footer class="footline">

            </footer>
          </article>

    
    
          <article class="default">
            <header class="headline">
            </header>
<h1 id="adding-categorical-filters-to-the-movie-site">Adding Categorical Filters to the Movie Site</h1>

<p>Let&rsquo;s add some filters to the page as well.  We&rsquo;ll start with <em>categorical</em> filters, i.e. filtering by category.  Let&rsquo;s start by filtering for MPAA Rating.  We know that there are only a handful of ratings issued by the Motion Picture Association of America - G, PG, PG-13, R, and NC-17.  We might be tempted to use an enumeration to represent these values, but in C# an enumeration cannot have strings for values.  Nor can we use the hyphen (<code>-</code>) in an enumeration name.</p>
<h2 id="defining-the-mpaa-ratings">Defining the MPAA Ratings</h2>
<p>So let&rsquo;s define a string array with our MPAA values, and make it accessible from our <code>MovieDatabase</code> class:</p>
<div class="wrap-code highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-csharp" data-lang="csharp"><span style="display:flex;"><span>    <span style="color:#75715e">/// &lt;summary&gt;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">/// Gets the possible MPAARatings</span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">/// &lt;/summary&gt;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">static</span> <span style="color:#66d9ef">string</span>[] MPAARatings
</span></span><span style="display:flex;"><span>    {
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">get</span> =&gt; <span style="color:#66d9ef">new</span> <span style="color:#66d9ef">string</span>[]
</span></span><span style="display:flex;"><span>        {
</span></span><span style="display:flex;"><span>            <span style="color:#e6db74">&#34;G&#34;</span>,
</span></span><span style="display:flex;"><span>            <span style="color:#e6db74">&#34;PG&#34;</span>,
</span></span><span style="display:flex;"><span>            <span style="color:#e6db74">&#34;PG-13&#34;</span>,
</span></span><span style="display:flex;"><span>            <span style="color:#e6db74">&#34;R&#34;</span>,
</span></span><span style="display:flex;"><span>            <span style="color:#e6db74">&#34;NC-17&#34;</span>
</span></span><span style="display:flex;"><span>        };
</span></span><span style="display:flex;"><span>    }</span></span></code></pre></div><p>Now in our <code>&lt;form&gt;</code> in <em>Index.cshtml</em> we can add a checkbox for each of these possible values:</p>
<div class="wrap-code highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-html" data-lang="html"><span style="display:flex;"><span>&lt;<span style="color:#f92672">form</span>&gt;
</span></span><span style="display:flex;"><span>   &lt;<span style="color:#f92672">input</span> <span style="color:#a6e22e">type</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;text&#34;</span> <span style="color:#a6e22e">name</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;SearchTerms&#34;</span> <span style="color:#a6e22e">value</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;@Model.SearchTerms&#34;</span>/&gt;
</span></span><span style="display:flex;"><span>    &lt;<span style="color:#f92672">input</span> <span style="color:#a6e22e">type</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;submit&#34;</span> <span style="color:#a6e22e">value</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;Search&#34;</span>&gt;
</span></span><span style="display:flex;"><span>    @foreach  (string rating in MovieDatabase.MPAARating) 
</span></span><span style="display:flex;"><span>    {
</span></span><span style="display:flex;"><span>        &lt;<span style="color:#f92672">label</span>&gt;
</span></span><span style="display:flex;"><span>            &lt;<span style="color:#f92672">input</span> <span style="color:#a6e22e">type</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;checkbox&#34;</span> <span style="color:#a6e22e">name</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;MPAARatings&#34;</span> <span style="color:#a6e22e">value</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;@rating&#34;</span>/&gt;
</span></span><span style="display:flex;"><span>            @rating
</span></span><span style="display:flex;"><span>        &lt;/<span style="color:#f92672">label</span>&gt;
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>&lt;/<span style="color:#f92672">form</span>&gt;</span></span></code></pre></div><p>If you try running the project now, and check a few boxes, you&rsquo;ll see the query string results look something like:</p>
<div class="wrap-code highlight"><pre tabindex="0"><code>?SearchTerms=&amp;MPAARatings=G&amp;MPAARatings=PG-13</code></pre></div><p>Notice how the key <em>MPAARatings</em> is repeated twice?  What would that look like in our PageModel?  We can find out; declare a <code>var</code> to hold the value in the <code>OnGet()</code> method of <em>Index.cshtml.cs</em>:</p>
<div class="wrap-code highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-csharp" data-lang="csharp"><span style="display:flex;"><span>    <span style="color:#66d9ef">var</span> MPAARatings = Request.Query[<span style="color:#e6db74">&#34;MPAARatings&#34;</span>];</span></span></code></pre></div><p>If we add a breakpoint on this line, and run our code, then check several boxes (you&rsquo;ll have to <em>continue</em> the first time you hit the breakpoint), then step over the line, we&rsquo;ll see that the var <code>MPAA</code> rating is set to a <em>string collection</em>.  We could therefore store it in an array property in <em>Index.cshtml.cs</em>, much like we did with our <code>SearchTerms</code>:</p>
<div class="wrap-code highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-csharp" data-lang="csharp"><span style="display:flex;"><span>    <span style="color:#75715e">/// &lt;summary&gt;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">/// The filtered MPAA Ratings</span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">/// &lt;/summary&gt;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">string</span>[] MPAARatings { <span style="color:#66d9ef">get</span>; <span style="color:#66d9ef">set</span>; }</span></span></code></pre></div><p>And we can refactor the line we just added to <code>OnGet()</code> to use this new property:</p>
<div class="wrap-code highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-csharp" data-lang="csharp"><span style="display:flex;"><span>    MPAARatings = Request.Query[<span style="color:#e6db74">&#34;MPAARatings&#34;</span>];</span></span></code></pre></div><p>Then, in our <em>Index.cshtml</em> Razor Page, we can refactor the checkbox to be checked if we filtered against this rating in our last request:</p>
<div class="wrap-code highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-html" data-lang="html"><span style="display:flex;"><span>    &lt;<span style="color:#f92672">input</span> <span style="color:#a6e22e">type</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;checkbox&#34;</span> <span style="color:#a6e22e">name</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;MPAARatings&#34;</span> <span style="color:#a6e22e">value</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;@rating&#34;</span> <span style="color:#a6e22e">checked</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;@Model.MPAARatings.Contains(rating)&#34;</span>/&gt;</span></span></code></pre></div><p>Now our filters stick around when we submit the search request.  That just leaves making the filters actually <em>work</em>.</p>
<h2 id="applying-mpaa-rating-filters">Applying MPAA Rating Filters</h2>
<p>Let&rsquo;s add another method to our <code>MovieDatabase</code> class, <code>FilterByMPAARating()</code>:</p>
<div class="wrap-code highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-csharp" data-lang="csharp"><span style="display:flex;"><span>    <span style="color:#75715e">/// &lt;summary&gt;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">/// Filters the provided collection of movies</span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">/// &lt;/summary&gt;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">/// &lt;param name=&#34;movies&#34;&gt;The collection of movies to filter&lt;/param&gt;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">/// &lt;param name=&#34;ratings&#34;&gt;The ratings to include&lt;/param&gt;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">/// &lt;returns&gt;A collection containing only movies that match the filter&lt;/returns&gt;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">static</span> IEnumerable&lt;Movie&gt; FilterByMPAARating(IEnumerable&lt;Movie&gt; movies, IEnumerable&lt;<span style="color:#66d9ef">string</span>&gt; ratings)
</span></span><span style="display:flex;"><span>    {
</span></span><span style="display:flex;"><span>        <span style="color:#75715e">// TODO: Filter the list</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    }</span></span></code></pre></div><p>Notice that in <em>this</em> method, we accept an <code>IEnumerable&lt;Movie&gt;</code> parameter.  This is the list of movies we want to filter.  We use this, instead of the <code>All()</code> we did in the <code>Search()</code> method, as we would want to filter the <em>results</em> of a search.</p>
<p>Let&rsquo;s do a null/empty check, and just return this shortlist if no filters are specified:</p>
<div class="wrap-code highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-csharp" data-lang="csharp"><span style="display:flex;"><span>    <span style="color:#75715e">// If no filter is specified, just return the provided collection</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">if</span> (ratings == <span style="color:#66d9ef">null</span> || ratings.Count() == <span style="color:#ae81ff">0</span>) <span style="color:#66d9ef">return</span> movies;</span></span></code></pre></div><p>Otherwise, we&rsquo;ll use the same process we did before.  Start with an empty list of movies, and iterate over the collection seeing if any match.  However, as we have <em>two</em> collections (the movies <em>and</em> the ratings), we&rsquo;ll see if the ratings collection contains the supplied movie&rsquo;s rating.</p>
<div class="wrap-code highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-csharp" data-lang="csharp"><span style="display:flex;"><span>    <span style="color:#75715e">// Filter the supplied collection of movies</span>
</span></span><span style="display:flex;"><span>    List&lt;Movie&gt; results = <span style="color:#66d9ef">new</span> List&lt;Movie&gt;();
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">foreach</span>(Movie movie <span style="color:#66d9ef">in</span> movies)
</span></span><span style="display:flex;"><span>    {
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">if</span>(movie.MPAARating != <span style="color:#66d9ef">null</span> &amp;&amp; ratings.Contains(movie.MPAARating))
</span></span><span style="display:flex;"><span>        {
</span></span><span style="display:flex;"><span>            results.Add(movie);
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>    }</span></span></code></pre></div><p>Finally, we&rsquo;ll return our results:</p>
<div class="wrap-code highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-csharp" data-lang="csharp"><span style="display:flex;"><span>    <span style="color:#66d9ef">return</span> results;</span></span></code></pre></div><p>Now, back in our PageModel <em>Index.cshtml.cs</em>, we&rsquo;ll apply our filter to the results of our search.  The refactored <code>OnGet()</code> should then be:</p>
<div class="wrap-code highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-csharp" data-lang="csharp"><span style="display:flex;"><span>    <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">void</span> OnGet()
</span></span><span style="display:flex;"><span>    {
</span></span><span style="display:flex;"><span>        SearchTerms = Request.Query[<span style="color:#e6db74">&#34;SearchTerms&#34;</span>];
</span></span><span style="display:flex;"><span>        MPAARatings = Request.Query[<span style="color:#e6db74">&#34;MPAARatings&#34;</span>];
</span></span><span style="display:flex;"><span>        Movies = MovieDatabase.Search(SearchTerms);
</span></span><span style="display:flex;"><span>        Movies = MovieDatabase.FilterByMPAARating(Movies, MPAARatings);        
</span></span><span style="display:flex;"><span>    }</span></span></code></pre></div><p>Now we can run a search with filters applied.  For example, searching for the word &ldquo;Love&rdquo; and movies that are PG or PG-13 yields:</p>
<p>
<a href="#image-bdc8cabe423a63c767614ca557848258" class="lightbox-link">
<img src="https://ksu-cs-textbooks.github.io/cis400/images/6.8.4.png" alt="Filtered Search Results" style="height: auto; width: auto;" loading="lazy">
</a>
<a href="javascript:history.back();" class="lightbox" id="image-bdc8cabe423a63c767614ca557848258">
<img src="https://ksu-cs-textbooks.github.io/cis400/images/6.8.4.png" alt="Filtered Search Results" class="lightbox-image" loading="lazy">
</a></p>
<p>You might be wondering why <em>Cloverfield</em> is listed.  But remember, we&rsquo;re searching by substring, and C <strong>LOVE</strong> rfield contains love!</p>
<h2 id="filtering-by-genre">Filtering by Genre</h2>
<p>Let&rsquo;s add filters for genre next.  But what genres should be included?  This is not as clear-cut as our MPAA rating, as there is no standards organization that says &ldquo;these are the only offical genres that exist.&rdquo;  In fact, new genres emerge from time to time.  So a better source of this info might just be to see what Genres are defined in our data, i.e.:</p>
<div class="wrap-code highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-csharp" data-lang="csharp"><span style="display:flex;"><span>    HashSet&lt;<span style="color:#66d9ef">string</span>&gt; genres = <span style="color:#66d9ef">new</span> HashSet&lt;<span style="color:#66d9ef">string</span>&gt;();
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">foreach</span>(Movie movie <span style="color:#66d9ef">in</span> All) {
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">if</span>(movie.MajorGenre != <span style="color:#66d9ef">null</span>) 
</span></span><span style="display:flex;"><span>        {
</span></span><span style="display:flex;"><span>            genres.Add(movie.MajorGenre);
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>    }</span></span></code></pre></div><p>Here we use a <a href="https://docs.microsoft.com/en-us/dotnet/api/system.collections.generic.hashset-1?view=netframework-4.8" target="_blank">HashSet</a>
 instead of a list, as it only adds each unique item once.  Duplicates are ignored.</p>
<p>But where would this code go?  We could place it in a getter for <code>MovieDatabase.Genres</code>:</p>
<div class="wrap-code highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-csharp" data-lang="csharp"><span style="display:flex;"><span>    <span style="color:#66d9ef">public</span> IEnumerable&lt;<span style="color:#66d9ef">string</span>&gt; Genres 
</span></span><span style="display:flex;"><span>    {
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">get</span> 
</span></span><span style="display:flex;"><span>        {
</span></span><span style="display:flex;"><span>            HashSet&lt;<span style="color:#66d9ef">string</span>&gt; genres = <span style="color:#66d9ef">new</span> HashSet&lt;<span style="color:#66d9ef">string</span>&gt;();
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">foreach</span>(Movie movie <span style="color:#66d9ef">in</span> All) {
</span></span><span style="display:flex;"><span>                <span style="color:#66d9ef">if</span>(movie.MajorGenre != <span style="color:#66d9ef">null</span>) 
</span></span><span style="display:flex;"><span>                {
</span></span><span style="display:flex;"><span>                    genres.Add(movie.MajorGenre);
</span></span><span style="display:flex;"><span>                }
</span></span><span style="display:flex;"><span>            }
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>    }</span></span></code></pre></div><p>But this means that every time we want to access it, we&rsquo;ll search through all the movies&hellip; This is an O(n) operation, and will make our website slower.</p>
<p>Instead, let&rsquo;s create a private static variable in the <code>MovieDatabase</code> class to <em>cache</em> this collection as an array of strings:</p>
<div class="wrap-code highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-csharp" data-lang="csharp"><span style="display:flex;"><span>    <span style="color:#75715e">// The genres represented in the database</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">private</span> <span style="color:#66d9ef">static</span> <span style="color:#66d9ef">string</span>[] _genres;</span></span></code></pre></div><p>And expose it with a public static property:</p>
<div class="wrap-code highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-csharp" data-lang="csharp"><span style="display:flex;"><span>    <span style="color:#75715e">/// &lt;summary&gt;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">/// Gets the movie genres represented in the database </span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">/// &lt;/summary&gt;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">static</span> <span style="color:#66d9ef">string</span>[] Genres =&gt; _genres;</span></span></code></pre></div><p>And finally, we&rsquo;ll populate this array in the static constructor of <code>MovieDatabase</code>, after the JSON file has been processed:</p>
<div class="wrap-code highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-csharp" data-lang="csharp"><span style="display:flex;"><span>    HashSet&lt;<span style="color:#66d9ef">string</span>&gt; genreSet = <span style="color:#66d9ef">new</span> HashSet&lt;<span style="color:#66d9ef">string</span>&gt;();
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">foreach</span>(Movie movie <span style="color:#66d9ef">in</span> _movies) {
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">if</span>(movie.MajorGenre != <span style="color:#66d9ef">null</span>) 
</span></span><span style="display:flex;"><span>        {
</span></span><span style="display:flex;"><span>            genreSet.Add(movie.MajorGenre);
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>    _genres = genreSet.ToArray();</span></span></code></pre></div><p>This approach means the finding of genres only happens once, and getting the <code>Genre</code> property is a constant-time O(1) operation.</p>
<p>We can implement the filters for the genres in the same way as we did for the MPAA filters; I&rsquo;ll leave that as an exercise for the reader.</p>

            <footer class="footline">

            </footer>
          </article>

    
    
          <article class="default">
            <header class="headline">
            </header>
<h1 id="adding-categorical-filters-to-the-movie-site">Adding Categorical Filters to the Movie Site</h1>

<p>Let&rsquo;s add some filters to the page as well.  We&rsquo;ll start with <em>categorical</em> filters, i.e. filtering by category.  Let&rsquo;s start by filtering for MPAA Rating.  We know that there are only a handful of ratings issued by the Motion Picture Association of America - G, PG, PG-13, R, and NC-17.  We might be tempted to use an enumeration to represent these values, but in C# an enumeration cannot have strings for values.  Nor can we use the hyphen (<code>-</code>) in an enumeration name.</p>
<h2 id="defining-the-mpaa-ratings">Defining the MPAA Ratings</h2>
<p>So let&rsquo;s define a string array with our MPAA values, and make it accessible from our <code>MovieDatabase</code> class:</p>
<div class="wrap-code highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-csharp" data-lang="csharp"><span style="display:flex;"><span>    <span style="color:#75715e">/// &lt;summary&gt;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">/// Gets the possible MPAARatings</span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">/// &lt;/summary&gt;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">static</span> <span style="color:#66d9ef">string</span>[] MPAARatings
</span></span><span style="display:flex;"><span>    {
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">get</span> =&gt; <span style="color:#66d9ef">new</span> <span style="color:#66d9ef">string</span>[]
</span></span><span style="display:flex;"><span>        {
</span></span><span style="display:flex;"><span>            <span style="color:#e6db74">&#34;G&#34;</span>,
</span></span><span style="display:flex;"><span>            <span style="color:#e6db74">&#34;PG&#34;</span>,
</span></span><span style="display:flex;"><span>            <span style="color:#e6db74">&#34;PG-13&#34;</span>,
</span></span><span style="display:flex;"><span>            <span style="color:#e6db74">&#34;R&#34;</span>,
</span></span><span style="display:flex;"><span>            <span style="color:#e6db74">&#34;NC-17&#34;</span>
</span></span><span style="display:flex;"><span>        };
</span></span><span style="display:flex;"><span>    }</span></span></code></pre></div><p>Now in our <code>&lt;form&gt;</code> in <em>Index.cshtml</em> we can add a checkbox for each of these possible values:</p>
<div class="wrap-code highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-html" data-lang="html"><span style="display:flex;"><span>&lt;<span style="color:#f92672">form</span>&gt;
</span></span><span style="display:flex;"><span>   &lt;<span style="color:#f92672">input</span> <span style="color:#a6e22e">type</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;text&#34;</span> <span style="color:#a6e22e">name</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;SearchTerms&#34;</span> <span style="color:#a6e22e">value</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;@Model.SearchTerms&#34;</span>/&gt;
</span></span><span style="display:flex;"><span>    &lt;<span style="color:#f92672">input</span> <span style="color:#a6e22e">type</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;submit&#34;</span> <span style="color:#a6e22e">value</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;Search&#34;</span>&gt;
</span></span><span style="display:flex;"><span>    @foreach  (string rating in MovieDatabase.MPAARating) 
</span></span><span style="display:flex;"><span>    {
</span></span><span style="display:flex;"><span>        &lt;<span style="color:#f92672">label</span>&gt;
</span></span><span style="display:flex;"><span>            &lt;<span style="color:#f92672">input</span> <span style="color:#a6e22e">type</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;checkbox&#34;</span> <span style="color:#a6e22e">name</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;MPAARatings&#34;</span> <span style="color:#a6e22e">value</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;@rating&#34;</span>/&gt;
</span></span><span style="display:flex;"><span>            @rating
</span></span><span style="display:flex;"><span>        &lt;/<span style="color:#f92672">label</span>&gt;
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>&lt;/<span style="color:#f92672">form</span>&gt;</span></span></code></pre></div><p>If you try running the project now, and check a few boxes, you&rsquo;ll see the query string results look something like:</p>
<div class="wrap-code highlight"><pre tabindex="0"><code>?SearchTerms=&amp;MPAARatings=G&amp;MPAARatings=PG-13</code></pre></div><p>Notice how the key <em>MPAARatings</em> is repeated twice?  What would that look like in our PageModel?  We can find out; declare a <code>var</code> to hold the value in the <code>OnGet()</code> method of <em>Index.cshtml.cs</em>:</p>
<div class="wrap-code highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-csharp" data-lang="csharp"><span style="display:flex;"><span>    <span style="color:#66d9ef">var</span> MPAARatings = Request.Query[<span style="color:#e6db74">&#34;MPAARatings&#34;</span>];</span></span></code></pre></div><p>If we add a breakpoint on this line, and run our code, then check several boxes (you&rsquo;ll have to <em>continue</em> the first time you hit the breakpoint), then step over the line, we&rsquo;ll see that the var <code>MPAA</code> rating is set to a <em>string collection</em>.  We could therefore store it in an array property in <em>Index.cshtml.cs</em>, much like we did with our <code>SearchTerms</code>:</p>
<div class="wrap-code highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-csharp" data-lang="csharp"><span style="display:flex;"><span>    <span style="color:#75715e">/// &lt;summary&gt;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">/// The filtered MPAA Ratings</span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">/// &lt;/summary&gt;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">string</span>[] MPAARatings { <span style="color:#66d9ef">get</span>; <span style="color:#66d9ef">set</span>; }</span></span></code></pre></div><p>And we can refactor the line we just added to <code>OnGet()</code> to use this new property:</p>
<div class="wrap-code highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-csharp" data-lang="csharp"><span style="display:flex;"><span>    MPAARatings = Request.Query[<span style="color:#e6db74">&#34;MPAARatings&#34;</span>];</span></span></code></pre></div><p>Then, in our <em>Index.cshtml</em> Razor Page, we can refactor the checkbox to be checked if we filtered against this rating in our last request:</p>
<div class="wrap-code highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-html" data-lang="html"><span style="display:flex;"><span>    &lt;<span style="color:#f92672">input</span> <span style="color:#a6e22e">type</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;checkbox&#34;</span> <span style="color:#a6e22e">name</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;MPAARatings&#34;</span> <span style="color:#a6e22e">value</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;@rating&#34;</span> <span style="color:#a6e22e">checked</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;@Model.MPAARatings.Contains(rating)&#34;</span>/&gt;</span></span></code></pre></div><p>Now our filters stick around when we submit the search request.  That just leaves making the filters actually <em>work</em>.</p>
<h2 id="applying-mpaa-rating-filters">Applying MPAA Rating Filters</h2>
<p>Let&rsquo;s add another method to our <code>MovieDatabase</code> class, <code>FilterByMPAARating()</code>:</p>
<div class="wrap-code highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-csharp" data-lang="csharp"><span style="display:flex;"><span>    <span style="color:#75715e">/// &lt;summary&gt;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">/// Filters the provided collection of movies</span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">/// &lt;/summary&gt;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">/// &lt;param name=&#34;movies&#34;&gt;The collection of movies to filter&lt;/param&gt;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">/// &lt;param name=&#34;ratings&#34;&gt;The ratings to include&lt;/param&gt;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">/// &lt;returns&gt;A collection containing only movies that match the filter&lt;/returns&gt;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">static</span> IEnumerable&lt;Movie&gt; FilterByMPAARating(IEnumerable&lt;Movie&gt; movies, IEnumerable&lt;<span style="color:#66d9ef">string</span>&gt; ratings)
</span></span><span style="display:flex;"><span>    {
</span></span><span style="display:flex;"><span>        <span style="color:#75715e">// TODO: Filter the list</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    }</span></span></code></pre></div><p>Notice that in <em>this</em> method, we accept an <code>IEnumerable&lt;Movie&gt;</code> parameter.  This is the list of movies we want to filter.  We use this, instead of the <code>All()</code> we did in the <code>Search()</code> method, as we would want to filter the <em>results</em> of a search.</p>
<p>Let&rsquo;s do a null/empty check, and just return this shortlist if no filters are specified:</p>
<div class="wrap-code highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-csharp" data-lang="csharp"><span style="display:flex;"><span>    <span style="color:#75715e">// If no filter is specified, just return the provided collection</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">if</span> (ratings == <span style="color:#66d9ef">null</span> || ratings.Count() == <span style="color:#ae81ff">0</span>) <span style="color:#66d9ef">return</span> movies;</span></span></code></pre></div><p>Otherwise, we&rsquo;ll use the same process we did before.  Start with an empty list of movies, and iterate over the collection seeing if any match.  However, as we have <em>two</em> collections (the movies <em>and</em> the ratings), we&rsquo;ll see if the ratings collection contains the supplied movie&rsquo;s rating.</p>
<div class="wrap-code highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-csharp" data-lang="csharp"><span style="display:flex;"><span>    <span style="color:#75715e">// Filter the supplied collection of movies</span>
</span></span><span style="display:flex;"><span>    List&lt;Movie&gt; results = <span style="color:#66d9ef">new</span> List&lt;Movie&gt;();
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">foreach</span>(Movie movie <span style="color:#66d9ef">in</span> movies)
</span></span><span style="display:flex;"><span>    {
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">if</span>(movie.MPAARating != <span style="color:#66d9ef">null</span> &amp;&amp; ratings.Contains(movie.MPAARating))
</span></span><span style="display:flex;"><span>        {
</span></span><span style="display:flex;"><span>            results.Add(movie);
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>    }</span></span></code></pre></div><p>Finally, we&rsquo;ll return our results:</p>
<div class="wrap-code highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-csharp" data-lang="csharp"><span style="display:flex;"><span>    <span style="color:#66d9ef">return</span> results;</span></span></code></pre></div><p>Now, back in our PageModel <em>Index.cshtml.cs</em>, we&rsquo;ll apply our filter to the results of our search.  The refactored <code>OnGet()</code> should then be:</p>
<div class="wrap-code highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-csharp" data-lang="csharp"><span style="display:flex;"><span>    <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">void</span> OnGet()
</span></span><span style="display:flex;"><span>    {
</span></span><span style="display:flex;"><span>        SearchTerms = Request.Query[<span style="color:#e6db74">&#34;SearchTerms&#34;</span>];
</span></span><span style="display:flex;"><span>        MPAARatings = Request.Query[<span style="color:#e6db74">&#34;MPAARatings&#34;</span>];
</span></span><span style="display:flex;"><span>        Movies = MovieDatabase.Search(SearchTerms);
</span></span><span style="display:flex;"><span>        Movies = MovieDatabase.FilterByMPAARating(Movies, MPAARatings);        
</span></span><span style="display:flex;"><span>    }</span></span></code></pre></div><p>Now we can run a search with filters applied.  For example, searching for the word &ldquo;Love&rdquo; and movies that are PG or PG-13 yields:</p>
<p>
<a href="#image-c35083b5bbff6ec69d589d49837f21fb" class="lightbox-link">
<img src="https://ksu-cs-textbooks.github.io/cis400/images/6.8.4.png" alt="Filtered Search Results" style="height: auto; width: auto;" loading="lazy">
</a>
<a href="javascript:history.back();" class="lightbox" id="image-c35083b5bbff6ec69d589d49837f21fb">
<img src="https://ksu-cs-textbooks.github.io/cis400/images/6.8.4.png" alt="Filtered Search Results" class="lightbox-image" loading="lazy">
</a></p>
<p>You might be wondering why <em>Cloverfield</em> is listed.  But remember, we&rsquo;re searching by substring, and C <strong>LOVE</strong> rfield contains love!</p>
<h2 id="filtering-by-genre">Filtering by Genre</h2>
<p>Let&rsquo;s add filters for genre next.  But what genres should be included?  This is not as clear-cut as our MPAA rating, as there is no standards organization that says &ldquo;these are the only offical genres that exist.&rdquo;  In fact, new genres emerge from time to time.  So a better source of this info might just be to see what Genres are defined in our data, i.e.:</p>
<div class="wrap-code highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-csharp" data-lang="csharp"><span style="display:flex;"><span>    HashSet&lt;<span style="color:#66d9ef">string</span>&gt; genres = <span style="color:#66d9ef">new</span> HashSet&lt;<span style="color:#66d9ef">string</span>&gt;();
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">foreach</span>(Movie movie <span style="color:#66d9ef">in</span> All) {
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">if</span>(movie.MajorGenre != <span style="color:#66d9ef">null</span>) 
</span></span><span style="display:flex;"><span>        {
</span></span><span style="display:flex;"><span>            genres.Add(movie.MajorGenre);
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>    }</span></span></code></pre></div><p>Here we use a <a href="https://docs.microsoft.com/en-us/dotnet/api/system.collections.generic.hashset-1?view=netframework-4.8" target="_blank">HashSet</a>
 instead of a list, as it only adds each unique item once.  Duplicates are ignored.</p>
<p>But where would this code go?  We could place it in a getter for <code>MovieDatabase.Genres</code>:</p>
<div class="wrap-code highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-csharp" data-lang="csharp"><span style="display:flex;"><span>    <span style="color:#66d9ef">public</span> IEnumerable&lt;<span style="color:#66d9ef">string</span>&gt; Genres 
</span></span><span style="display:flex;"><span>    {
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">get</span> 
</span></span><span style="display:flex;"><span>        {
</span></span><span style="display:flex;"><span>            HashSet&lt;<span style="color:#66d9ef">string</span>&gt; genres = <span style="color:#66d9ef">new</span> HashSet&lt;<span style="color:#66d9ef">string</span>&gt;();
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">foreach</span>(Movie movie <span style="color:#66d9ef">in</span> All) {
</span></span><span style="display:flex;"><span>                <span style="color:#66d9ef">if</span>(movie.MajorGenre != <span style="color:#66d9ef">null</span>) 
</span></span><span style="display:flex;"><span>                {
</span></span><span style="display:flex;"><span>                    genres.Add(movie.MajorGenre);
</span></span><span style="display:flex;"><span>                }
</span></span><span style="display:flex;"><span>            }
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>    }</span></span></code></pre></div><p>But this means that every time we want to access it, we&rsquo;ll search through all the movies&hellip; This is an O(n) operation, and will make our website slower.</p>
<p>Instead, let&rsquo;s create a private static variable in the <code>MovieDatabase</code> class to <em>cache</em> this collection as an array of strings:</p>
<div class="wrap-code highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-csharp" data-lang="csharp"><span style="display:flex;"><span>    <span style="color:#75715e">// The genres represented in the database</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">private</span> <span style="color:#66d9ef">static</span> <span style="color:#66d9ef">string</span>[] _genres;</span></span></code></pre></div><p>And expose it with a public static property:</p>
<div class="wrap-code highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-csharp" data-lang="csharp"><span style="display:flex;"><span>    <span style="color:#75715e">/// &lt;summary&gt;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">/// Gets the movie genres represented in the database </span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">/// &lt;/summary&gt;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">static</span> <span style="color:#66d9ef">string</span>[] Genres =&gt; _genres;</span></span></code></pre></div><p>And finally, we&rsquo;ll populate this array in the static constructor of <code>MovieDatabase</code>, after the JSON file has been processed:</p>
<div class="wrap-code highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-csharp" data-lang="csharp"><span style="display:flex;"><span>    HashSet&lt;<span style="color:#66d9ef">string</span>&gt; genreSet = <span style="color:#66d9ef">new</span> HashSet&lt;<span style="color:#66d9ef">string</span>&gt;();
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">foreach</span>(Movie movie <span style="color:#66d9ef">in</span> _movies) {
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">if</span>(movie.MajorGenre != <span style="color:#66d9ef">null</span>) 
</span></span><span style="display:flex;"><span>        {
</span></span><span style="display:flex;"><span>            genreSet.Add(movie.MajorGenre);
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>    _genres = genreSet.ToArray();</span></span></code></pre></div><p>This approach means the finding of genres only happens once, and getting the <code>Genre</code> property is a constant-time O(1) operation.</p>
<p>We can implement the filters for the genres in the same way as we did for the MPAA filters; I&rsquo;ll leave that as an exercise for the reader.</p>

            <footer class="footline">

            </footer>
          </article>

    
    
          <article class="default">
            <header class="headline">
            </header>
<h1 id="adding-categorical-filters-to-the-movie-site">Adding Categorical Filters to the Movie Site</h1>

<p>Let&rsquo;s add some filters to the page as well.  We&rsquo;ll start with <em>categorical</em> filters, i.e. filtering by category.  Let&rsquo;s start by filtering for MPAA Rating.  We know that there are only a handful of ratings issued by the Motion Picture Association of America - G, PG, PG-13, R, and NC-17.  We might be tempted to use an enumeration to represent these values, but in C# an enumeration cannot have strings for values.  Nor can we use the hyphen (<code>-</code>) in an enumeration name.</p>
<h2 id="defining-the-mpaa-ratings">Defining the MPAA Ratings</h2>
<p>So let&rsquo;s define a string array with our MPAA values, and make it accessible from our <code>MovieDatabase</code> class:</p>
<div class="wrap-code highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-csharp" data-lang="csharp"><span style="display:flex;"><span>    <span style="color:#75715e">/// &lt;summary&gt;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">/// Gets the possible MPAARatings</span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">/// &lt;/summary&gt;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">static</span> <span style="color:#66d9ef">string</span>[] MPAARatings
</span></span><span style="display:flex;"><span>    {
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">get</span> =&gt; <span style="color:#66d9ef">new</span> <span style="color:#66d9ef">string</span>[]
</span></span><span style="display:flex;"><span>        {
</span></span><span style="display:flex;"><span>            <span style="color:#e6db74">&#34;G&#34;</span>,
</span></span><span style="display:flex;"><span>            <span style="color:#e6db74">&#34;PG&#34;</span>,
</span></span><span style="display:flex;"><span>            <span style="color:#e6db74">&#34;PG-13&#34;</span>,
</span></span><span style="display:flex;"><span>            <span style="color:#e6db74">&#34;R&#34;</span>,
</span></span><span style="display:flex;"><span>            <span style="color:#e6db74">&#34;NC-17&#34;</span>
</span></span><span style="display:flex;"><span>        };
</span></span><span style="display:flex;"><span>    }</span></span></code></pre></div><p>Now in our <code>&lt;form&gt;</code> in <em>Index.cshtml</em> we can add a checkbox for each of these possible values:</p>
<div class="wrap-code highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-html" data-lang="html"><span style="display:flex;"><span>&lt;<span style="color:#f92672">form</span>&gt;
</span></span><span style="display:flex;"><span>   &lt;<span style="color:#f92672">input</span> <span style="color:#a6e22e">type</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;text&#34;</span> <span style="color:#a6e22e">name</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;SearchTerms&#34;</span> <span style="color:#a6e22e">value</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;@Model.SearchTerms&#34;</span>/&gt;
</span></span><span style="display:flex;"><span>    &lt;<span style="color:#f92672">input</span> <span style="color:#a6e22e">type</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;submit&#34;</span> <span style="color:#a6e22e">value</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;Search&#34;</span>&gt;
</span></span><span style="display:flex;"><span>    @foreach  (string rating in MovieDatabase.MPAARatings) 
</span></span><span style="display:flex;"><span>    {
</span></span><span style="display:flex;"><span>        &lt;<span style="color:#f92672">label</span>&gt;
</span></span><span style="display:flex;"><span>            &lt;<span style="color:#f92672">input</span> <span style="color:#a6e22e">type</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;checkbox&#34;</span> <span style="color:#a6e22e">name</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;MPAARatings&#34;</span> <span style="color:#a6e22e">value</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;@rating&#34;</span>/&gt;
</span></span><span style="display:flex;"><span>            @rating
</span></span><span style="display:flex;"><span>        &lt;/<span style="color:#f92672">label</span>&gt;
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>&lt;/<span style="color:#f92672">form</span>&gt;</span></span></code></pre></div><p>If you try running the project now, and check a few boxes, you&rsquo;ll see the query string results look something like:</p>
<div class="wrap-code highlight"><pre tabindex="0"><code>?SearchTerms=&amp;MPAARatings=G&amp;MPAARatings=PG-13</code></pre></div><p>Notice how the key <em>MPAARatings</em> is repeated twice?  What would that look like in our PageModel?  We can find out; declare a <code>var</code> to hold the value in the <code>OnGet()</code> method of <em>Index.cshtml.cs</em>:</p>
<div class="wrap-code highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-csharp" data-lang="csharp"><span style="display:flex;"><span>    <span style="color:#66d9ef">var</span> MPAARatings = Request.Query[<span style="color:#e6db74">&#34;MPAARatings&#34;</span>];</span></span></code></pre></div><p>If we add a breakpoint on this line, and run our code, then check several boxes (you&rsquo;ll have to <em>continue</em> the first time you hit the breakpoint), then step over the line, we&rsquo;ll see that the var <code>MPAA</code> rating is set to a <em>string collection</em>.  We could therefore store it in an array property in <em>Index.cshtml.cs</em>, much like we did with our <code>SearchTerms</code>:</p>
<div class="wrap-code highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-csharp" data-lang="csharp"><span style="display:flex;"><span>    <span style="color:#75715e">/// &lt;summary&gt;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">/// The filtered MPAA Ratings</span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">/// &lt;/summary&gt;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">string</span>[] MPAARatings { <span style="color:#66d9ef">get</span>; <span style="color:#66d9ef">set</span>; }</span></span></code></pre></div><p>And we can refactor the line we just added to <code>OnGet()</code> to use this new property:</p>
<div class="wrap-code highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-csharp" data-lang="csharp"><span style="display:flex;"><span>    MPAARatings = Request.Query[<span style="color:#e6db74">&#34;MPAARatings&#34;</span>];</span></span></code></pre></div><p>Then, in our <em>Index.cshtml</em> Razor Page, we can refactor the checkbox to be checked if we filtered against this rating in our last request:</p>
<div class="wrap-code highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-html" data-lang="html"><span style="display:flex;"><span>    &lt;<span style="color:#f92672">input</span> <span style="color:#a6e22e">type</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;checkbox&#34;</span> <span style="color:#a6e22e">name</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;MPAARatings&#34;</span> <span style="color:#a6e22e">value</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;@rating&#34;</span> <span style="color:#a6e22e">checked</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;@Model.MPAARatings.Contains(rating)&#34;</span>/&gt;</span></span></code></pre></div><p>Now our filters stick around when we submit the search request.  That just leaves making the filters actually <em>work</em>.</p>
<h2 id="applying-mpaa-rating-filters">Applying MPAA Rating Filters</h2>
<p>Let&rsquo;s add another method to our <code>MovieDatabase</code> class, <code>FilterByMPAARating()</code>:</p>
<div class="wrap-code highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-csharp" data-lang="csharp"><span style="display:flex;"><span>    <span style="color:#75715e">/// &lt;summary&gt;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">/// Filters the provided collection of movies</span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">/// &lt;/summary&gt;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">/// &lt;param name=&#34;movies&#34;&gt;The collection of movies to filter&lt;/param&gt;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">/// &lt;param name=&#34;ratings&#34;&gt;The ratings to include&lt;/param&gt;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">/// &lt;returns&gt;A collection containing only movies that match the filter&lt;/returns&gt;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">static</span> IEnumerable&lt;Movie&gt; FilterByMPAARating(IEnumerable&lt;Movie&gt; movies, IEnumerable&lt;<span style="color:#66d9ef">string</span>&gt; ratings)
</span></span><span style="display:flex;"><span>    {
</span></span><span style="display:flex;"><span>        <span style="color:#75715e">// TODO: Filter the list</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    }</span></span></code></pre></div><p>Notice that in <em>this</em> method, we accept an <code>IEnumerable&lt;Movie&gt;</code> parameter.  This is the list of movies we want to filter.  We use this, instead of the <code>All()</code> we did in the <code>Search()</code> method, as we would want to filter the <em>results</em> of a search.</p>
<p>Let&rsquo;s do a null/empty check, and just return this shortlist if no filters are specified:</p>
<div class="wrap-code highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-csharp" data-lang="csharp"><span style="display:flex;"><span>    <span style="color:#75715e">// If no filter is specified, just return the provided collection</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">if</span> (ratings == <span style="color:#66d9ef">null</span> || ratings.Count() == <span style="color:#ae81ff">0</span>) <span style="color:#66d9ef">return</span> movies;</span></span></code></pre></div><p>Otherwise, we&rsquo;ll use the same process we did before.  Start with an empty list of movies, and iterate over the collection seeing if any match.  However, as we have <em>two</em> collections (the movies <em>and</em> the ratings), we&rsquo;ll see if the ratings collection contains the supplied movie&rsquo;s rating.</p>
<div class="wrap-code highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-csharp" data-lang="csharp"><span style="display:flex;"><span>    <span style="color:#75715e">// Filter the supplied collection of movies</span>
</span></span><span style="display:flex;"><span>    List&lt;Movie&gt; results = <span style="color:#66d9ef">new</span> List&lt;Movie&gt;();
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">foreach</span>(Movie movie <span style="color:#66d9ef">in</span> movies)
</span></span><span style="display:flex;"><span>    {
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">if</span>(movie.MPAARating != <span style="color:#66d9ef">null</span> &amp;&amp; ratings.Contains(movie.MPAARating))
</span></span><span style="display:flex;"><span>        {
</span></span><span style="display:flex;"><span>            results.Add(movie);
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>    }</span></span></code></pre></div><p>Finally, we&rsquo;ll return our results:</p>
<div class="wrap-code highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-csharp" data-lang="csharp"><span style="display:flex;"><span>    <span style="color:#66d9ef">return</span> results;</span></span></code></pre></div><p>Now, back in our PageModel <em>Index.cshtml.cs</em>, we&rsquo;ll apply our filter to the results of our search.  The refactored <code>OnGet()</code> should then be:</p>
<div class="wrap-code highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-csharp" data-lang="csharp"><span style="display:flex;"><span>    <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">void</span> OnGet()
</span></span><span style="display:flex;"><span>    {
</span></span><span style="display:flex;"><span>        SearchTerms = Request.Query[<span style="color:#e6db74">&#34;SearchTerms&#34;</span>];
</span></span><span style="display:flex;"><span>        MPAARatings = Request.Query[<span style="color:#e6db74">&#34;MPAARatings&#34;</span>];
</span></span><span style="display:flex;"><span>        Movies = MovieDatabase.Search(SearchTerms);
</span></span><span style="display:flex;"><span>        Movies = MovieDatabase.FilterByMPAARating(Movies, MPAARatings);        
</span></span><span style="display:flex;"><span>    }</span></span></code></pre></div><p>Now we can run a search with filters applied.  For example, searching for the word &ldquo;Love&rdquo; and movies that are PG or PG-13 yields:</p>
<p>
<a href="#image-95edf94512ac47b807981045d043b22e" class="lightbox-link">
<img src="https://ksu-cs-textbooks.github.io/cis400/images/6.8.4.png" alt="Filtered Search Results" style="height: auto; width: auto;" loading="lazy">
</a>
<a href="javascript:history.back();" class="lightbox" id="image-95edf94512ac47b807981045d043b22e">
<img src="https://ksu-cs-textbooks.github.io/cis400/images/6.8.4.png" alt="Filtered Search Results" class="lightbox-image" loading="lazy">
</a></p>
<p>You might be wondering why <em>Cloverfield</em> is listed.  But remember, we&rsquo;re searching by substring, and C <strong>LOVE</strong> rfield contains love!</p>
<h2 id="filtering-by-genre">Filtering by Genre</h2>
<p>Let&rsquo;s add filters for genre next.  But what genres should be included?  This is not as clear-cut as our MPAA rating, as there is no standards organization that says &ldquo;these are the only offical genres that exist.&rdquo;  In fact, new genres emerge from time to time.  So a better source of this info might just be to see what Genres are defined in our data, i.e.:</p>
<div class="wrap-code highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-csharp" data-lang="csharp"><span style="display:flex;"><span>    HashSet&lt;<span style="color:#66d9ef">string</span>&gt; genres = <span style="color:#66d9ef">new</span> HashSet&lt;<span style="color:#66d9ef">string</span>&gt;();
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">foreach</span>(Movie movie <span style="color:#66d9ef">in</span> All) {
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">if</span>(movie.MajorGenre != <span style="color:#66d9ef">null</span>) 
</span></span><span style="display:flex;"><span>        {
</span></span><span style="display:flex;"><span>            genres.Add(movie.MajorGenre);
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>    }</span></span></code></pre></div><p>Here we use a <a href="https://docs.microsoft.com/en-us/dotnet/api/system.collections.generic.hashset-1?view=netframework-4.8" target="_blank">HashSet</a>
 instead of a list, as it only adds each unique item once.  Duplicates are ignored.</p>
<p>But where would this code go?  We could place it in a getter for <code>MovieDatabase.Genres</code>:</p>
<div class="wrap-code highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-csharp" data-lang="csharp"><span style="display:flex;"><span>    <span style="color:#66d9ef">public</span> IEnumerable&lt;<span style="color:#66d9ef">string</span>&gt; Genres 
</span></span><span style="display:flex;"><span>    {
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">get</span> 
</span></span><span style="display:flex;"><span>        {
</span></span><span style="display:flex;"><span>            HashSet&lt;<span style="color:#66d9ef">string</span>&gt; genres = <span style="color:#66d9ef">new</span> HashSet&lt;<span style="color:#66d9ef">string</span>&gt;();
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">foreach</span>(Movie movie <span style="color:#66d9ef">in</span> All) {
</span></span><span style="display:flex;"><span>                <span style="color:#66d9ef">if</span>(movie.MajorGenre != <span style="color:#66d9ef">null</span>) 
</span></span><span style="display:flex;"><span>                {
</span></span><span style="display:flex;"><span>                    genres.Add(movie.MajorGenre);
</span></span><span style="display:flex;"><span>                }
</span></span><span style="display:flex;"><span>            }
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>    }</span></span></code></pre></div><p>But this means that every time we want to access it, we&rsquo;ll search through all the movies&hellip; This is an O(n) operation, and will make our website slower.</p>
<p>Instead, let&rsquo;s create a private static variable in the <code>MovieDatabase</code> class to <em>cache</em> this collection as an array of strings:</p>
<div class="wrap-code highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-csharp" data-lang="csharp"><span style="display:flex;"><span>    <span style="color:#75715e">// The genres represented in the database</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">private</span> <span style="color:#66d9ef">static</span> <span style="color:#66d9ef">string</span>[] _genres;</span></span></code></pre></div><p>And expose it with a public static property:</p>
<div class="wrap-code highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-csharp" data-lang="csharp"><span style="display:flex;"><span>    <span style="color:#75715e">/// &lt;summary&gt;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">/// Gets the movie genres represented in the database </span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">/// &lt;/summary&gt;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">static</span> <span style="color:#66d9ef">string</span>[] Genres =&gt; _genres;</span></span></code></pre></div><p>And finally, we&rsquo;ll populate this array in the static constructor of <code>MovieDatabase</code>, after the JSON file has been processed:</p>
<div class="wrap-code highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-csharp" data-lang="csharp"><span style="display:flex;"><span>    HashSet&lt;<span style="color:#66d9ef">string</span>&gt; genreSet = <span style="color:#66d9ef">new</span> HashSet&lt;<span style="color:#66d9ef">string</span>&gt;();
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">foreach</span>(Movie movie <span style="color:#66d9ef">in</span> _movies) {
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">if</span>(movie.MajorGenre != <span style="color:#66d9ef">null</span>) 
</span></span><span style="display:flex;"><span>        {
</span></span><span style="display:flex;"><span>            genreSet.Add(movie.MajorGenre);
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>    _genres = genreSet.ToArray();</span></span></code></pre></div><p>This approach means the finding of genres only happens once, and getting the <code>Genre</code> property is a constant-time O(1) operation.</p>
<p>We can implement the filters for the genres in the same way as we did for the MPAA filters; I&rsquo;ll leave that as an exercise for the reader.</p>

            <footer class="footline">

            </footer>
          </article>

    
    
          <article class="default">
            <header class="headline">
            </header>
<h1 id="adding-categorical-filters-to-the-movie-site">Adding Categorical Filters to the Movie Site</h1>

<p>Let&rsquo;s add some filters to the page as well.  We&rsquo;ll start with <em>categorical</em> filters, i.e. filtering by category.  Let&rsquo;s start by filtering for MPAA Rating.  We know that there are only a handful of ratings issued by the Motion Picture Association of America - G, PG, PG-13, R, and NC-17.  We might be tempted to use an enumeration to represent these values, but in C# an enumeration cannot have strings for values.  Nor can we use the hyphen (<code>-</code>) in an enumeration name.</p>
<h2 id="defining-the-mpaa-ratings">Defining the MPAA Ratings</h2>
<p>So let&rsquo;s define a string array with our MPAA values, and make it accessible from our <code>MovieDatabase</code> class:</p>
<div class="wrap-code highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-csharp" data-lang="csharp"><span style="display:flex;"><span>    <span style="color:#75715e">/// &lt;summary&gt;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">/// Gets the possible MPAARatings</span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">/// &lt;/summary&gt;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">static</span> <span style="color:#66d9ef">string</span>[] MPAARatings
</span></span><span style="display:flex;"><span>    {
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">get</span> =&gt; <span style="color:#66d9ef">new</span> <span style="color:#66d9ef">string</span>[]
</span></span><span style="display:flex;"><span>        {
</span></span><span style="display:flex;"><span>            <span style="color:#e6db74">&#34;G&#34;</span>,
</span></span><span style="display:flex;"><span>            <span style="color:#e6db74">&#34;PG&#34;</span>,
</span></span><span style="display:flex;"><span>            <span style="color:#e6db74">&#34;PG-13&#34;</span>,
</span></span><span style="display:flex;"><span>            <span style="color:#e6db74">&#34;R&#34;</span>,
</span></span><span style="display:flex;"><span>            <span style="color:#e6db74">&#34;NC-17&#34;</span>
</span></span><span style="display:flex;"><span>        };
</span></span><span style="display:flex;"><span>    }</span></span></code></pre></div><p>Now in our <code>&lt;form&gt;</code> in <em>Index.cshtml</em> we can add a checkbox for each of these possible values:</p>
<div class="wrap-code highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-html" data-lang="html"><span style="display:flex;"><span>&lt;<span style="color:#f92672">form</span>&gt;
</span></span><span style="display:flex;"><span>   &lt;<span style="color:#f92672">input</span> <span style="color:#a6e22e">type</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;text&#34;</span> <span style="color:#a6e22e">name</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;SearchTerms&#34;</span> <span style="color:#a6e22e">value</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;@Model.SearchTerms&#34;</span>/&gt;
</span></span><span style="display:flex;"><span>    &lt;<span style="color:#f92672">input</span> <span style="color:#a6e22e">type</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;submit&#34;</span> <span style="color:#a6e22e">value</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;Search&#34;</span>&gt;
</span></span><span style="display:flex;"><span>    @foreach  (string rating in MovieDatabase.MPAARatings) 
</span></span><span style="display:flex;"><span>    {
</span></span><span style="display:flex;"><span>        &lt;<span style="color:#f92672">label</span>&gt;
</span></span><span style="display:flex;"><span>            &lt;<span style="color:#f92672">input</span> <span style="color:#a6e22e">type</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;checkbox&#34;</span> <span style="color:#a6e22e">name</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;MPAARatings&#34;</span> <span style="color:#a6e22e">value</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;@rating&#34;</span>/&gt;
</span></span><span style="display:flex;"><span>            @rating
</span></span><span style="display:flex;"><span>        &lt;/<span style="color:#f92672">label</span>&gt;
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>&lt;/<span style="color:#f92672">form</span>&gt;</span></span></code></pre></div><p>If you try running the project now, and check a few boxes, you&rsquo;ll see the query string results look something like:</p>
<div class="wrap-code highlight"><pre tabindex="0"><code>?SearchTerms=&amp;MPAARatings=G&amp;MPAARatings=PG-13</code></pre></div><p>Notice how the key <em>MPAARatings</em> is repeated twice?  What would that look like in our PageModel?  We can find out; declare a <code>var</code> to hold the value in the <code>OnGet()</code> method of <em>Index.cshtml.cs</em>:</p>
<div class="wrap-code highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-csharp" data-lang="csharp"><span style="display:flex;"><span>    <span style="color:#66d9ef">var</span> MPAARatings = Request.Query[<span style="color:#e6db74">&#34;MPAARatings&#34;</span>];</span></span></code></pre></div><p>If we add a breakpoint on this line, and run our code, then check several boxes (you&rsquo;ll have to <em>continue</em> the first time you hit the breakpoint), then step over the line, we&rsquo;ll see that the var <code>MPAA</code> rating is set to a <em>string collection</em>.  We could therefore store it in an array property in <em>Index.cshtml.cs</em>, much like we did with our <code>SearchTerms</code>:</p>
<div class="wrap-code highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-csharp" data-lang="csharp"><span style="display:flex;"><span>    <span style="color:#75715e">/// &lt;summary&gt;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">/// The filtered MPAA Ratings</span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">/// &lt;/summary&gt;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">string</span>[] MPAARatings { <span style="color:#66d9ef">get</span>; <span style="color:#66d9ef">set</span>; }</span></span></code></pre></div><p>And we can refactor the line we just added to <code>OnGet()</code> to use this new property:</p>
<div class="wrap-code highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-csharp" data-lang="csharp"><span style="display:flex;"><span>    MPAARatings = Request.Query[<span style="color:#e6db74">&#34;MPAARatings&#34;</span>];</span></span></code></pre></div><p>Then, in our <em>Index.cshtml</em> Razor Page, we can refactor the checkbox to be checked if we filtered against this rating in our last request:</p>
<div class="wrap-code highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-html" data-lang="html"><span style="display:flex;"><span>    &lt;<span style="color:#f92672">input</span> <span style="color:#a6e22e">type</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;checkbox&#34;</span> <span style="color:#a6e22e">name</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;MPAARatings&#34;</span> <span style="color:#a6e22e">value</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;@rating&#34;</span> <span style="color:#a6e22e">checked</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;@Model.MPAARatings.Contains(rating)&#34;</span>/&gt;</span></span></code></pre></div><p>Now our filters stick around when we submit the search request.  That just leaves making the filters actually <em>work</em>.</p>
<h2 id="applying-mpaa-rating-filters">Applying MPAA Rating Filters</h2>
<p>Let&rsquo;s add another method to our <code>MovieDatabase</code> class, <code>FilterByMPAARating()</code>:</p>
<div class="wrap-code highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-csharp" data-lang="csharp"><span style="display:flex;"><span>    <span style="color:#75715e">/// &lt;summary&gt;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">/// Filters the provided collection of movies</span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">/// &lt;/summary&gt;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">/// &lt;param name=&#34;movies&#34;&gt;The collection of movies to filter&lt;/param&gt;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">/// &lt;param name=&#34;ratings&#34;&gt;The ratings to include&lt;/param&gt;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">/// &lt;returns&gt;A collection containing only movies that match the filter&lt;/returns&gt;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">static</span> IEnumerable&lt;Movie&gt; FilterByMPAARating(IEnumerable&lt;Movie&gt; movies, IEnumerable&lt;<span style="color:#66d9ef">string</span>&gt; ratings)
</span></span><span style="display:flex;"><span>    {
</span></span><span style="display:flex;"><span>        <span style="color:#75715e">// TODO: Filter the list</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    }</span></span></code></pre></div><p>Notice that in <em>this</em> method, we accept an <code>IEnumerable&lt;Movie&gt;</code> parameter.  This is the list of movies we want to filter.  We use this, instead of the <code>All()</code> we did in the <code>Search()</code> method, as we would want to filter the <em>results</em> of a search.</p>
<p>Let&rsquo;s do a null/empty check, and just return this shortlist if no filters are specified:</p>
<div class="wrap-code highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-csharp" data-lang="csharp"><span style="display:flex;"><span>    <span style="color:#75715e">// If no filter is specified, just return the provided collection</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">if</span> (ratings == <span style="color:#66d9ef">null</span> || ratings.Count() == <span style="color:#ae81ff">0</span>) <span style="color:#66d9ef">return</span> movies;</span></span></code></pre></div><p>Otherwise, we&rsquo;ll use the same process we did before.  Start with an empty list of movies, and iterate over the collection seeing if any match.  However, as we have <em>two</em> collections (the movies <em>and</em> the ratings), we&rsquo;ll see if the ratings collection contains the supplied movie&rsquo;s rating.</p>
<div class="wrap-code highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-csharp" data-lang="csharp"><span style="display:flex;"><span>    <span style="color:#75715e">// Filter the supplied collection of movies</span>
</span></span><span style="display:flex;"><span>    List&lt;Movie&gt; results = <span style="color:#66d9ef">new</span> List&lt;Movie&gt;();
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">foreach</span>(Movie movie <span style="color:#66d9ef">in</span> movies)
</span></span><span style="display:flex;"><span>    {
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">if</span>(movie.MPAARating != <span style="color:#66d9ef">null</span> &amp;&amp; ratings.Contains(movie.MPAARating))
</span></span><span style="display:flex;"><span>        {
</span></span><span style="display:flex;"><span>            results.Add(movie);
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>    }</span></span></code></pre></div><p>Finally, we&rsquo;ll return our results:</p>
<div class="wrap-code highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-csharp" data-lang="csharp"><span style="display:flex;"><span>    <span style="color:#66d9ef">return</span> results;</span></span></code></pre></div><p>Now, back in our PageModel <em>Index.cshtml.cs</em>, we&rsquo;ll apply our filter to the results of our search.  The refactored <code>OnGet()</code> should then be:</p>
<div class="wrap-code highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-csharp" data-lang="csharp"><span style="display:flex;"><span>    <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">void</span> OnGet()
</span></span><span style="display:flex;"><span>    {
</span></span><span style="display:flex;"><span>        SearchTerms = Request.Query[<span style="color:#e6db74">&#34;SearchTerms&#34;</span>];
</span></span><span style="display:flex;"><span>        MPAARatings = Request.Query[<span style="color:#e6db74">&#34;MPAARatings&#34;</span>];
</span></span><span style="display:flex;"><span>        Movies = MovieDatabase.Search(SearchTerms);
</span></span><span style="display:flex;"><span>        Movies = MovieDatabase.FilterByMPAARating(Movies, MPAARatings);        
</span></span><span style="display:flex;"><span>    }</span></span></code></pre></div><p>Now we can run a search with filters applied.  For example, searching for the word &ldquo;Love&rdquo; and movies that are PG or PG-13 yields:</p>
<p>
<a href="#image-b4c397098e24756acbab4983b90e9261" class="lightbox-link">
<img src="https://ksu-cs-textbooks.github.io/cis400/images/6.8.4.png" alt="Filtered Search Results" style="height: auto; width: auto;" loading="lazy">
</a>
<a href="javascript:history.back();" class="lightbox" id="image-b4c397098e24756acbab4983b90e9261">
<img src="https://ksu-cs-textbooks.github.io/cis400/images/6.8.4.png" alt="Filtered Search Results" class="lightbox-image" loading="lazy">
</a></p>
<p>You might be wondering why <em>Cloverfield</em> is listed.  But remember, we&rsquo;re searching by substring, and C <strong>LOVE</strong> rfield contains love!</p>
<h2 id="filtering-by-genre">Filtering by Genre</h2>
<p>Let&rsquo;s add filters for genre next.  But what genres should be included?  This is not as clear-cut as our MPAA rating, as there is no standards organization that says &ldquo;these are the only offical genres that exist.&rdquo;  In fact, new genres emerge from time to time.  So a better source of this info might just be to see what Genres are defined in our data, i.e.:</p>
<div class="wrap-code highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-csharp" data-lang="csharp"><span style="display:flex;"><span>    HashSet&lt;<span style="color:#66d9ef">string</span>&gt; genres = <span style="color:#66d9ef">new</span> HashSet&lt;<span style="color:#66d9ef">string</span>&gt;();
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">foreach</span>(Movie movie <span style="color:#66d9ef">in</span> All) {
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">if</span>(movie.MajorGenre != <span style="color:#66d9ef">null</span>) 
</span></span><span style="display:flex;"><span>        {
</span></span><span style="display:flex;"><span>            genres.Add(movie.MajorGenre);
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>    }</span></span></code></pre></div><p>Here we use a <a href="https://docs.microsoft.com/en-us/dotnet/api/system.collections.generic.hashset-1?view=netframework-4.8" target="_blank">HashSet</a>
 instead of a list, as it only adds each unique item once.  Duplicates are ignored.</p>
<p>But where would this code go?  We could place it in a getter for <code>MovieDatabase.Genres</code>:</p>
<div class="wrap-code highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-csharp" data-lang="csharp"><span style="display:flex;"><span>    <span style="color:#66d9ef">public</span> IEnumerable&lt;<span style="color:#66d9ef">string</span>&gt; Genres 
</span></span><span style="display:flex;"><span>    {
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">get</span> 
</span></span><span style="display:flex;"><span>        {
</span></span><span style="display:flex;"><span>            HashSet&lt;<span style="color:#66d9ef">string</span>&gt; genres = <span style="color:#66d9ef">new</span> HashSet&lt;<span style="color:#66d9ef">string</span>&gt;();
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">foreach</span>(Movie movie <span style="color:#66d9ef">in</span> All) {
</span></span><span style="display:flex;"><span>                <span style="color:#66d9ef">if</span>(movie.MajorGenre != <span style="color:#66d9ef">null</span>) 
</span></span><span style="display:flex;"><span>                {
</span></span><span style="display:flex;"><span>                    genres.Add(movie.MajorGenre);
</span></span><span style="display:flex;"><span>                }
</span></span><span style="display:flex;"><span>            }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">return</span> genres;
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>    }</span></span></code></pre></div><p>But this means that every time we want to access it, we&rsquo;ll search through all the movies&hellip; This is an O(n) operation, and will make our website slower.</p>
<p>Instead, let&rsquo;s create a private static variable in the <code>MovieDatabase</code> class to <em>cache</em> this collection as an array of strings:</p>
<div class="wrap-code highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-csharp" data-lang="csharp"><span style="display:flex;"><span>    <span style="color:#75715e">// The genres represented in the database</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">private</span> <span style="color:#66d9ef">static</span> <span style="color:#66d9ef">string</span>[] _genres;</span></span></code></pre></div><p>And expose it with a public static property:</p>
<div class="wrap-code highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-csharp" data-lang="csharp"><span style="display:flex;"><span>    <span style="color:#75715e">/// &lt;summary&gt;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">/// Gets the movie genres represented in the database </span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">/// &lt;/summary&gt;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">static</span> <span style="color:#66d9ef">string</span>[] Genres =&gt; _genres;</span></span></code></pre></div><p>And finally, we&rsquo;ll populate this array in the static constructor of <code>MovieDatabase</code>, after the JSON file has been processed:</p>
<div class="wrap-code highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-csharp" data-lang="csharp"><span style="display:flex;"><span>    HashSet&lt;<span style="color:#66d9ef">string</span>&gt; genreSet = <span style="color:#66d9ef">new</span> HashSet&lt;<span style="color:#66d9ef">string</span>&gt;();
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">foreach</span>(Movie movie <span style="color:#66d9ef">in</span> _movies) {
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">if</span>(movie.MajorGenre != <span style="color:#66d9ef">null</span>) 
</span></span><span style="display:flex;"><span>        {
</span></span><span style="display:flex;"><span>            genreSet.Add(movie.MajorGenre);
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>    _genres = genreSet.ToArray();</span></span></code></pre></div><p>This approach means the finding of genres only happens once, and getting the <code>Genre</code> property is a constant-time O(1) operation.</p>
<p>We can implement the filters for the genres in the same way as we did for the MPAA filters; I&rsquo;ll leave that as an exercise for the reader.</p>

            <footer class="footline">

            </footer>
          </article>

    
    
          <article class="default">
            <header class="headline">
            </header>
<h1 id="adding-categorical-filters-to-the-movie-site">Adding Categorical Filters to the Movie Site</h1>

<p>Let&rsquo;s add some filters to the page as well.  We&rsquo;ll start with <em>categorical</em> filters, i.e. filtering by category.  Let&rsquo;s start by filtering for MPAA Rating.  We know that there are only a handful of ratings issued by the Motion Picture Association of America - G, PG, PG-13, R, and NC-17.  We might be tempted to use an enumeration to represent these values, but in C# an enumeration cannot have strings for values.  Nor can we use the hyphen (<code>-</code>) in an enumeration name.</p>
<h2 id="defining-the-mpaa-ratings">Defining the MPAA Ratings</h2>
<p>So let&rsquo;s define a string array with our MPAA values, and make it accessible from our <code>MovieDatabase</code> class:</p>
<div class="wrap-code highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-csharp" data-lang="csharp"><span style="display:flex;"><span>    <span style="color:#75715e">/// &lt;summary&gt;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">/// Gets the possible MPAARatings</span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">/// &lt;/summary&gt;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">static</span> <span style="color:#66d9ef">string</span>[] MPAARatings
</span></span><span style="display:flex;"><span>    {
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">get</span> =&gt; <span style="color:#66d9ef">new</span> <span style="color:#66d9ef">string</span>[]
</span></span><span style="display:flex;"><span>        {
</span></span><span style="display:flex;"><span>            <span style="color:#e6db74">&#34;G&#34;</span>,
</span></span><span style="display:flex;"><span>            <span style="color:#e6db74">&#34;PG&#34;</span>,
</span></span><span style="display:flex;"><span>            <span style="color:#e6db74">&#34;PG-13&#34;</span>,
</span></span><span style="display:flex;"><span>            <span style="color:#e6db74">&#34;R&#34;</span>,
</span></span><span style="display:flex;"><span>            <span style="color:#e6db74">&#34;NC-17&#34;</span>
</span></span><span style="display:flex;"><span>        };
</span></span><span style="display:flex;"><span>    }</span></span></code></pre></div><p>Now in our <code>&lt;form&gt;</code> in <em>Index.cshtml</em> we can add a checkbox for each of these possible values:</p>
<div class="wrap-code highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-html" data-lang="html"><span style="display:flex;"><span>&lt;<span style="color:#f92672">form</span>&gt;
</span></span><span style="display:flex;"><span>   &lt;<span style="color:#f92672">input</span> <span style="color:#a6e22e">type</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;text&#34;</span> <span style="color:#a6e22e">name</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;SearchTerms&#34;</span> <span style="color:#a6e22e">value</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;@Model.SearchTerms&#34;</span>/&gt;
</span></span><span style="display:flex;"><span>    &lt;<span style="color:#f92672">input</span> <span style="color:#a6e22e">type</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;submit&#34;</span> <span style="color:#a6e22e">value</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;Search&#34;</span>&gt;
</span></span><span style="display:flex;"><span>    @foreach  (string rating in MovieDatabase.MPAARatings) 
</span></span><span style="display:flex;"><span>    {
</span></span><span style="display:flex;"><span>        &lt;<span style="color:#f92672">label</span>&gt;
</span></span><span style="display:flex;"><span>            &lt;<span style="color:#f92672">input</span> <span style="color:#a6e22e">type</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;checkbox&#34;</span> <span style="color:#a6e22e">name</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;MPAARatings&#34;</span> <span style="color:#a6e22e">value</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;@rating&#34;</span>/&gt;
</span></span><span style="display:flex;"><span>            @rating
</span></span><span style="display:flex;"><span>        &lt;/<span style="color:#f92672">label</span>&gt;
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>&lt;/<span style="color:#f92672">form</span>&gt;</span></span></code></pre></div><p>If you try running the project now, and check a few boxes, you&rsquo;ll see the query string results look something like:</p>
<div class="wrap-code highlight"><pre tabindex="0"><code>?SearchTerms=&amp;MPAARatings=G&amp;MPAARatings=PG-13</code></pre></div><p>Notice how the key <em>MPAARatings</em> is repeated twice?  What would that look like in our PageModel?  We can find out; declare a <code>var</code> to hold the value in the <code>OnGet()</code> method of <em>Index.cshtml.cs</em>:</p>
<div class="wrap-code highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-csharp" data-lang="csharp"><span style="display:flex;"><span>    <span style="color:#66d9ef">var</span> MPAARatings = Request.Query[<span style="color:#e6db74">&#34;MPAARatings&#34;</span>];</span></span></code></pre></div><p>If we add a breakpoint on this line, and run our code, then check several boxes (you&rsquo;ll have to <em>continue</em> the first time you hit the breakpoint), then step over the line, we&rsquo;ll see that the var <code>MPAA</code> rating is set to a <em>string collection</em>.  We could therefore store it in an array property in <em>Index.cshtml.cs</em>, much like we did with our <code>SearchTerms</code>:</p>
<div class="wrap-code highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-csharp" data-lang="csharp"><span style="display:flex;"><span>    <span style="color:#75715e">/// &lt;summary&gt;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">/// The filtered MPAA Ratings</span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">/// &lt;/summary&gt;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">string</span>[] MPAARatings { <span style="color:#66d9ef">get</span>; <span style="color:#66d9ef">set</span>; }</span></span></code></pre></div><p>And we can refactor the line we just added to <code>OnGet()</code> to use this new property:</p>
<div class="wrap-code highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-csharp" data-lang="csharp"><span style="display:flex;"><span>    MPAARatings = Request.Query[<span style="color:#e6db74">&#34;MPAARatings&#34;</span>];</span></span></code></pre></div><p>Then, in our <em>Index.cshtml</em> Razor Page, we can refactor the checkbox to be checked if we filtered against this rating in our last request:</p>
<div class="wrap-code highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-html" data-lang="html"><span style="display:flex;"><span>    &lt;<span style="color:#f92672">input</span> <span style="color:#a6e22e">type</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;checkbox&#34;</span> <span style="color:#a6e22e">name</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;MPAARatings&#34;</span> <span style="color:#a6e22e">value</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;@rating&#34;</span> <span style="color:#a6e22e">checked</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;@Model.MPAARatings.Contains(rating)&#34;</span>/&gt;</span></span></code></pre></div><p>Now our filters stick around when we submit the search request.  That just leaves making the filters actually <em>work</em>.</p>
<h2 id="applying-mpaa-rating-filters">Applying MPAA Rating Filters</h2>
<p>Let&rsquo;s add another method to our <code>MovieDatabase</code> class, <code>FilterByMPAARating()</code>:</p>
<div class="wrap-code highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-csharp" data-lang="csharp"><span style="display:flex;"><span>    <span style="color:#75715e">/// &lt;summary&gt;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">/// Filters the provided collection of movies</span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">/// &lt;/summary&gt;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">/// &lt;param name=&#34;movies&#34;&gt;The collection of movies to filter&lt;/param&gt;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">/// &lt;param name=&#34;ratings&#34;&gt;The ratings to include&lt;/param&gt;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">/// &lt;returns&gt;A collection containing only movies that match the filter&lt;/returns&gt;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">static</span> IEnumerable&lt;Movie&gt; FilterByMPAARating(IEnumerable&lt;Movie&gt; movies, IEnumerable&lt;<span style="color:#66d9ef">string</span>&gt; ratings)
</span></span><span style="display:flex;"><span>    {
</span></span><span style="display:flex;"><span>        <span style="color:#75715e">// TODO: Filter the list</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    }</span></span></code></pre></div><p>Notice that in <em>this</em> method, we accept an <code>IEnumerable&lt;Movie&gt;</code> parameter.  This is the list of movies we want to filter.  We use this, instead of the <code>All()</code> we did in the <code>Search()</code> method, as we would want to filter the <em>results</em> of a search.</p>
<p>Let&rsquo;s do a null/empty check, and just return this shortlist if no filters are specified:</p>
<div class="wrap-code highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-csharp" data-lang="csharp"><span style="display:flex;"><span>    <span style="color:#75715e">// If no filter is specified, just return the provided collection</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">if</span> (ratings == <span style="color:#66d9ef">null</span> || ratings.Count() == <span style="color:#ae81ff">0</span>) <span style="color:#66d9ef">return</span> movies;</span></span></code></pre></div><p>Otherwise, we&rsquo;ll use the same process we did before.  Start with an empty list of movies, and iterate over the collection seeing if any match.  However, as we have <em>two</em> collections (the movies <em>and</em> the ratings), we&rsquo;ll see if the ratings collection contains the supplied movie&rsquo;s rating.</p>
<div class="wrap-code highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-csharp" data-lang="csharp"><span style="display:flex;"><span>    <span style="color:#75715e">// Filter the supplied collection of movies</span>
</span></span><span style="display:flex;"><span>    List&lt;Movie&gt; results = <span style="color:#66d9ef">new</span> List&lt;Movie&gt;();
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">foreach</span>(Movie movie <span style="color:#66d9ef">in</span> movies)
</span></span><span style="display:flex;"><span>    {
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">if</span>(movie.MPAARating != <span style="color:#66d9ef">null</span> &amp;&amp; ratings.Contains(movie.MPAARating))
</span></span><span style="display:flex;"><span>        {
</span></span><span style="display:flex;"><span>            results.Add(movie);
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>    }</span></span></code></pre></div><p>Finally, we&rsquo;ll return our results:</p>
<div class="wrap-code highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-csharp" data-lang="csharp"><span style="display:flex;"><span>    <span style="color:#66d9ef">return</span> results;</span></span></code></pre></div><p>Now, back in our PageModel <em>Index.cshtml.cs</em>, we&rsquo;ll apply our filter to the results of our search.  The refactored <code>OnGet()</code> should then be:</p>
<div class="wrap-code highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-csharp" data-lang="csharp"><span style="display:flex;"><span>    <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">void</span> OnGet()
</span></span><span style="display:flex;"><span>    {
</span></span><span style="display:flex;"><span>        SearchTerms = Request.Query[<span style="color:#e6db74">&#34;SearchTerms&#34;</span>];
</span></span><span style="display:flex;"><span>        MPAARatings = Request.Query[<span style="color:#e6db74">&#34;MPAARatings&#34;</span>];
</span></span><span style="display:flex;"><span>        Movies = MovieDatabase.Search(SearchTerms);
</span></span><span style="display:flex;"><span>        Movies = MovieDatabase.FilterByMPAARating(Movies, MPAARatings);        
</span></span><span style="display:flex;"><span>    }</span></span></code></pre></div><p>Now we can run a search with filters applied.  For example, searching for the word &ldquo;Love&rdquo; and movies that are PG or PG-13 yields:</p>
<p>
<a href="#image-e1653426c61bbafee2a52477316e9029" class="lightbox-link">
<img src="https://ksu-cs-textbooks.github.io/cis400/images/6.8.4.png" alt="Filtered Search Results" style="height: auto; width: auto;" loading="lazy">
</a>
<a href="javascript:history.back();" class="lightbox" id="image-e1653426c61bbafee2a52477316e9029">
<img src="https://ksu-cs-textbooks.github.io/cis400/images/6.8.4.png" alt="Filtered Search Results" class="lightbox-image" loading="lazy">
</a></p>
<p>You might be wondering why <em>Cloverfield</em> is listed.  But remember, we&rsquo;re searching by substring, and C <strong>LOVE</strong> rfield contains love!</p>
<h2 id="filtering-by-genre">Filtering by Genre</h2>
<p>Let&rsquo;s add filters for genre next.  But what genres should be included?  This is not as clear-cut as our MPAA rating, as there is no standards organization that says &ldquo;these are the only offical genres that exist.&rdquo;  In fact, new genres emerge from time to time.  So a better source of this info might just be to see what Genres are defined in our data, i.e.:</p>
<div class="wrap-code highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-csharp" data-lang="csharp"><span style="display:flex;"><span>    HashSet&lt;<span style="color:#66d9ef">string</span>&gt; genres = <span style="color:#66d9ef">new</span> HashSet&lt;<span style="color:#66d9ef">string</span>&gt;();
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">foreach</span>(Movie movie <span style="color:#66d9ef">in</span> All) {
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">if</span>(movie.MajorGenre != <span style="color:#66d9ef">null</span>) 
</span></span><span style="display:flex;"><span>        {
</span></span><span style="display:flex;"><span>            genres.Add(movie.MajorGenre);
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>    }</span></span></code></pre></div><p>Here we use a <a href="https://docs.microsoft.com/en-us/dotnet/api/system.collections.generic.hashset-1?view=netframework-4.8" target="_blank">HashSet</a>
 instead of a list, as it only adds each unique item once.  Duplicates are ignored.</p>
<p>But where would this code go?  We could place it in a getter for <code>MovieDatabase.Genres</code>:</p>
<div class="wrap-code highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-csharp" data-lang="csharp"><span style="display:flex;"><span>    <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">static</span> IEnumerable&lt;<span style="color:#66d9ef">string</span>&gt; Genres 
</span></span><span style="display:flex;"><span>    {
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">get</span> 
</span></span><span style="display:flex;"><span>        {
</span></span><span style="display:flex;"><span>            HashSet&lt;<span style="color:#66d9ef">string</span>&gt; genres = <span style="color:#66d9ef">new</span> HashSet&lt;<span style="color:#66d9ef">string</span>&gt;();
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">foreach</span>(Movie movie <span style="color:#66d9ef">in</span> All) {
</span></span><span style="display:flex;"><span>                <span style="color:#66d9ef">if</span>(movie.MajorGenre != <span style="color:#66d9ef">null</span>) 
</span></span><span style="display:flex;"><span>                {
</span></span><span style="display:flex;"><span>                    genres.Add(movie.MajorGenre);
</span></span><span style="display:flex;"><span>                }
</span></span><span style="display:flex;"><span>            }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">return</span> genres;
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>    }</span></span></code></pre></div><p>But this means that every time we want to access it, we&rsquo;ll search through all the movies&hellip; This is an O(n) operation, and will make our website slower.</p>
<p>Instead, let&rsquo;s create a private static variable in the <code>MovieDatabase</code> class to <em>cache</em> this collection as an array of strings:</p>
<div class="wrap-code highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-csharp" data-lang="csharp"><span style="display:flex;"><span>    <span style="color:#75715e">// The genres represented in the database</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">private</span> <span style="color:#66d9ef">static</span> <span style="color:#66d9ef">string</span>[] _genres;</span></span></code></pre></div><p>And expose it with a public static property:</p>
<div class="wrap-code highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-csharp" data-lang="csharp"><span style="display:flex;"><span>    <span style="color:#75715e">/// &lt;summary&gt;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">/// Gets the movie genres represented in the database </span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">/// &lt;/summary&gt;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">static</span> <span style="color:#66d9ef">string</span>[] Genres =&gt; _genres;</span></span></code></pre></div><p>And finally, we&rsquo;ll populate this array in the static constructor of <code>MovieDatabase</code>, after the JSON file has been processed:</p>
<div class="wrap-code highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-csharp" data-lang="csharp"><span style="display:flex;"><span>    HashSet&lt;<span style="color:#66d9ef">string</span>&gt; genreSet = <span style="color:#66d9ef">new</span> HashSet&lt;<span style="color:#66d9ef">string</span>&gt;();
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">foreach</span>(Movie movie <span style="color:#66d9ef">in</span> _movies) {
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">if</span>(movie.MajorGenre != <span style="color:#66d9ef">null</span>) 
</span></span><span style="display:flex;"><span>        {
</span></span><span style="display:flex;"><span>            genreSet.Add(movie.MajorGenre);
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>    _genres = genreSet.ToArray();</span></span></code></pre></div><p>This approach means the finding of genres only happens once, and getting the <code>Genre</code> property is a constant-time O(1) operation.</p>
<p>We can implement the filters for the genres in the same way as we did for the MPAA filters; I&rsquo;ll leave that as an exercise for the reader.</p>

            <footer class="footline">

            </footer>
          </article>

    
    
          <article class="default">
            <header class="headline">
            </header>
<h1 id="adding-categorical-filters-to-the-movie-site">Adding Categorical Filters to the Movie Site</h1>

<p>Let&rsquo;s add some filters to the page as well.  We&rsquo;ll start with <em>categorical</em> filters, i.e. filtering by category.  Let&rsquo;s start by filtering for MPAA Rating.  We know that there are only a handful of ratings issued by the Motion Picture Association of America - G, PG, PG-13, R, and NC-17.  We might be tempted to use an enumeration to represent these values, but in C# an enumeration cannot have strings for values.  Nor can we use the hyphen (<code>-</code>) in an enumeration name.</p>
<h2 id="defining-the-mpaa-ratings">Defining the MPAA Ratings</h2>
<p>So let&rsquo;s define a string array with our MPAA values, and make it accessible from our <code>MovieDatabase</code> class:</p>
<div class="wrap-code highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-csharp" data-lang="csharp"><span style="display:flex;"><span>    <span style="color:#75715e">/// &lt;summary&gt;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">/// Gets the possible MPAARatings</span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">/// &lt;/summary&gt;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">static</span> <span style="color:#66d9ef">string</span>[] MPAARatings
</span></span><span style="display:flex;"><span>    {
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">get</span> =&gt; <span style="color:#66d9ef">new</span> <span style="color:#66d9ef">string</span>[]
</span></span><span style="display:flex;"><span>        {
</span></span><span style="display:flex;"><span>            <span style="color:#e6db74">&#34;G&#34;</span>,
</span></span><span style="display:flex;"><span>            <span style="color:#e6db74">&#34;PG&#34;</span>,
</span></span><span style="display:flex;"><span>            <span style="color:#e6db74">&#34;PG-13&#34;</span>,
</span></span><span style="display:flex;"><span>            <span style="color:#e6db74">&#34;R&#34;</span>,
</span></span><span style="display:flex;"><span>            <span style="color:#e6db74">&#34;NC-17&#34;</span>
</span></span><span style="display:flex;"><span>        };
</span></span><span style="display:flex;"><span>    }</span></span></code></pre></div><p>Now in our <code>&lt;form&gt;</code> in <em>Index.cshtml</em> we can add a checkbox for each of these possible values:</p>
<div class="wrap-code highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-html" data-lang="html"><span style="display:flex;"><span>&lt;<span style="color:#f92672">form</span>&gt;
</span></span><span style="display:flex;"><span>    @foreach  (string rating in MovieDatabase.MPAARatings) 
</span></span><span style="display:flex;"><span>    {
</span></span><span style="display:flex;"><span>        &lt;<span style="color:#f92672">label</span>&gt;
</span></span><span style="display:flex;"><span>            &lt;<span style="color:#f92672">input</span> <span style="color:#a6e22e">type</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;checkbox&#34;</span> <span style="color:#a6e22e">name</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;MPAARatings&#34;</span> <span style="color:#a6e22e">value</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;@rating&#34;</span>/&gt;
</span></span><span style="display:flex;"><span>            @rating
</span></span><span style="display:flex;"><span>        &lt;/<span style="color:#f92672">label</span>&gt;
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    &lt;<span style="color:#f92672">input</span> <span style="color:#a6e22e">type</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;text&#34;</span> <span style="color:#a6e22e">name</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;SearchTerms&#34;</span> <span style="color:#a6e22e">value</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;@Model.SearchTerms&#34;</span>/&gt;
</span></span><span style="display:flex;"><span>    &lt;<span style="color:#f92672">input</span> <span style="color:#a6e22e">type</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;submit&#34;</span> <span style="color:#a6e22e">value</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;Search&#34;</span>&gt;
</span></span><span style="display:flex;"><span>&lt;/<span style="color:#f92672">form</span>&gt;</span></span></code></pre></div><p>If you try running the project now, and check a few boxes, you&rsquo;ll see the query string results look something like:</p>
<div class="wrap-code highlight"><pre tabindex="0"><code>?SearchTerms=&amp;MPAARatings=G&amp;MPAARatings=PG-13</code></pre></div><p>Notice how the key <em>MPAARatings</em> is repeated twice?  What would that look like in our PageModel?  We can find out; declare a <code>var</code> to hold the value in the <code>OnGet()</code> method of <em>Index.cshtml.cs</em>:</p>
<div class="wrap-code highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-csharp" data-lang="csharp"><span style="display:flex;"><span>    <span style="color:#66d9ef">var</span> MPAARatings = Request.Query[<span style="color:#e6db74">&#34;MPAARatings&#34;</span>];</span></span></code></pre></div><p>If we add a breakpoint on this line, and run our code, then check several boxes (you&rsquo;ll have to <em>continue</em> the first time you hit the breakpoint), then step over the line, we&rsquo;ll see that the var <code>MPAA</code> rating is set to a <em>string collection</em>.  We could therefore store it in an array property in <em>Index.cshtml.cs</em>, much like we did with our <code>SearchTerms</code>:</p>
<div class="wrap-code highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-csharp" data-lang="csharp"><span style="display:flex;"><span>    <span style="color:#75715e">/// &lt;summary&gt;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">/// The filtered MPAA Ratings</span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">/// &lt;/summary&gt;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">string</span>[] MPAARatings { <span style="color:#66d9ef">get</span>; <span style="color:#66d9ef">set</span>; }</span></span></code></pre></div><p>And we can refactor the line we just added to <code>OnGet()</code> to use this new property:</p>
<div class="wrap-code highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-csharp" data-lang="csharp"><span style="display:flex;"><span>    MPAARatings = Request.Query[<span style="color:#e6db74">&#34;MPAARatings&#34;</span>];</span></span></code></pre></div><p>Then, in our <em>Index.cshtml</em> Razor Page, we can refactor the checkbox to be checked if we filtered against this rating in our last request:</p>
<div class="wrap-code highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-html" data-lang="html"><span style="display:flex;"><span>    &lt;<span style="color:#f92672">input</span> <span style="color:#a6e22e">type</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;checkbox&#34;</span> <span style="color:#a6e22e">name</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;MPAARatings&#34;</span> <span style="color:#a6e22e">value</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;@rating&#34;</span> <span style="color:#a6e22e">checked</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;@Model.MPAARatings.Contains(rating)&#34;</span>/&gt;</span></span></code></pre></div><p>Now our filters stick around when we submit the search request.  That just leaves making the filters actually <em>work</em>.</p>
<h2 id="applying-mpaa-rating-filters">Applying MPAA Rating Filters</h2>
<p>Let&rsquo;s add another method to our <code>MovieDatabase</code> class, <code>FilterByMPAARating()</code>:</p>
<div class="wrap-code highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-csharp" data-lang="csharp"><span style="display:flex;"><span>    <span style="color:#75715e">/// &lt;summary&gt;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">/// Filters the provided collection of movies</span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">/// &lt;/summary&gt;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">/// &lt;param name=&#34;movies&#34;&gt;The collection of movies to filter&lt;/param&gt;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">/// &lt;param name=&#34;ratings&#34;&gt;The ratings to include&lt;/param&gt;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">/// &lt;returns&gt;A collection containing only movies that match the filter&lt;/returns&gt;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">static</span> IEnumerable&lt;Movie&gt; FilterByMPAARating(IEnumerable&lt;Movie&gt; movies, IEnumerable&lt;<span style="color:#66d9ef">string</span>&gt; ratings)
</span></span><span style="display:flex;"><span>    {
</span></span><span style="display:flex;"><span>        <span style="color:#75715e">// TODO: Filter the list</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    }</span></span></code></pre></div><p>Notice that in <em>this</em> method, we accept an <code>IEnumerable&lt;Movie&gt;</code> parameter.  This is the list of movies we want to filter.  We use this, instead of the <code>All()</code> we did in the <code>Search()</code> method, as we would want to filter the <em>results</em> of a search.</p>
<p>Let&rsquo;s do a null/empty check, and just return this shortlist if no filters are specified:</p>
<div class="wrap-code highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-csharp" data-lang="csharp"><span style="display:flex;"><span>    <span style="color:#75715e">// If no filter is specified, just return the provided collection</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">if</span> (ratings == <span style="color:#66d9ef">null</span> || ratings.Count() == <span style="color:#ae81ff">0</span>) <span style="color:#66d9ef">return</span> movies;</span></span></code></pre></div><p>Otherwise, we&rsquo;ll use the same process we did before.  Start with an empty list of movies, and iterate over the collection seeing if any match.  However, as we have <em>two</em> collections (the movies <em>and</em> the ratings), we&rsquo;ll see if the ratings collection contains the supplied movie&rsquo;s rating.</p>
<div class="wrap-code highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-csharp" data-lang="csharp"><span style="display:flex;"><span>    <span style="color:#75715e">// Filter the supplied collection of movies</span>
</span></span><span style="display:flex;"><span>    List&lt;Movie&gt; results = <span style="color:#66d9ef">new</span> List&lt;Movie&gt;();
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">foreach</span>(Movie movie <span style="color:#66d9ef">in</span> movies)
</span></span><span style="display:flex;"><span>    {
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">if</span>(movie.MPAARatings != <span style="color:#66d9ef">null</span> &amp;&amp; ratings.Contains(movie.MPAARatings))
</span></span><span style="display:flex;"><span>        {
</span></span><span style="display:flex;"><span>            results.Add(movie);
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>    }</span></span></code></pre></div><p>Finally, we&rsquo;ll return our results:</p>
<div class="wrap-code highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-csharp" data-lang="csharp"><span style="display:flex;"><span>    <span style="color:#66d9ef">return</span> results;</span></span></code></pre></div><p>Now, back in our PageModel <em>Index.cshtml.cs</em>, we&rsquo;ll apply our filter to the results of our search.  The refactored <code>OnGet()</code> should then be:</p>
<div class="wrap-code highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-csharp" data-lang="csharp"><span style="display:flex;"><span>    <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">void</span> OnGet()
</span></span><span style="display:flex;"><span>    {
</span></span><span style="display:flex;"><span>        SearchTerms = Request.Query[<span style="color:#e6db74">&#34;SearchTerms&#34;</span>];
</span></span><span style="display:flex;"><span>        MPAARatings = Request.Query[<span style="color:#e6db74">&#34;MPAARatings&#34;</span>];
</span></span><span style="display:flex;"><span>        Movies = MovieDatabase.Search(SearchTerms);
</span></span><span style="display:flex;"><span>        Movies = MovieDatabase.FilterByMPAARating(Movies, MPAARatings);        
</span></span><span style="display:flex;"><span>    }</span></span></code></pre></div><p>Now we can run a search with filters applied.  For example, searching for the word &ldquo;Love&rdquo; and movies that are PG or PG-13 yields:</p>
<p>
<a href="#image-44f7f3b8135aa82d551be3760a3e7df9" class="lightbox-link">
<img src="https://ksu-cs-textbooks.github.io/cis400/images/6.8.4.png" alt="Filtered Search Results" style="height: auto; width: auto;" loading="lazy">
</a>
<a href="javascript:history.back();" class="lightbox" id="image-44f7f3b8135aa82d551be3760a3e7df9">
<img src="https://ksu-cs-textbooks.github.io/cis400/images/6.8.4.png" alt="Filtered Search Results" class="lightbox-image" loading="lazy">
</a></p>
<p>You might be wondering why <em>Cloverfield</em> is listed.  But remember, we&rsquo;re searching by substring, and C <strong>LOVE</strong> rfield contains love!</p>
<h2 id="filtering-by-genre">Filtering by Genre</h2>
<p>Let&rsquo;s add filters for genre next.  But what genres should be included?  This is not as clear-cut as our MPAA rating, as there is no standards organization that says &ldquo;these are the only offical genres that exist.&rdquo;  In fact, new genres emerge from time to time.  So a better source of this info might just be to see what Genres are defined in our data, i.e.:</p>
<div class="wrap-code highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-csharp" data-lang="csharp"><span style="display:flex;"><span>    HashSet&lt;<span style="color:#66d9ef">string</span>&gt; genres = <span style="color:#66d9ef">new</span> HashSet&lt;<span style="color:#66d9ef">string</span>&gt;();
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">foreach</span>(Movie movie <span style="color:#66d9ef">in</span> All) {
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">if</span>(movie.MajorGenre != <span style="color:#66d9ef">null</span>) 
</span></span><span style="display:flex;"><span>        {
</span></span><span style="display:flex;"><span>            genres.Add(movie.MajorGenre);
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>    }</span></span></code></pre></div><p>Here we use a <a href="https://docs.microsoft.com/en-us/dotnet/api/system.collections.generic.hashset-1?view=netframework-4.8" target="_blank">HashSet</a>
 instead of a list, as it only adds each unique item once.  Duplicates are ignored.</p>
<p>But where would this code go?  We could place it in a getter for <code>MovieDatabase.Genres</code>:</p>
<div class="wrap-code highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-csharp" data-lang="csharp"><span style="display:flex;"><span>    <span style="color:#66d9ef">public</span> IEnumerable&lt;<span style="color:#66d9ef">string</span>&gt; Genres 
</span></span><span style="display:flex;"><span>    {
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">get</span> 
</span></span><span style="display:flex;"><span>        {
</span></span><span style="display:flex;"><span>            HashSet&lt;<span style="color:#66d9ef">string</span>&gt; genres = <span style="color:#66d9ef">new</span> HashSet&lt;<span style="color:#66d9ef">string</span>&gt;();
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">foreach</span>(Movie movie <span style="color:#66d9ef">in</span> All) {
</span></span><span style="display:flex;"><span>                <span style="color:#66d9ef">if</span>(movie.MajorGenre != <span style="color:#66d9ef">null</span>) 
</span></span><span style="display:flex;"><span>                {
</span></span><span style="display:flex;"><span>                    genres.Add(movie.MajorGenre);
</span></span><span style="display:flex;"><span>                }
</span></span><span style="display:flex;"><span>            }
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>    }</span></span></code></pre></div><p>But this means that every time we want to access it, we&rsquo;ll search through all the movies&hellip; This is an O(n) operation, and will make our website slower.</p>
<p>Instead, let&rsquo;s create a private static variable in the <code>MovieDatabase</code> class to <em>cache</em> this collection as an array of strings:</p>
<div class="wrap-code highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-csharp" data-lang="csharp"><span style="display:flex;"><span>    <span style="color:#75715e">// The genres represented in the database</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">private</span> <span style="color:#66d9ef">static</span> <span style="color:#66d9ef">string</span>[] _genres;</span></span></code></pre></div><p>And expose it with a public static property:</p>
<div class="wrap-code highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-csharp" data-lang="csharp"><span style="display:flex;"><span>    <span style="color:#75715e">/// &lt;summary&gt;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">/// Gets the movie genres represented in the database </span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">/// &lt;/summary&gt;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">static</span> <span style="color:#66d9ef">string</span>[] Genres =&gt; _genres;</span></span></code></pre></div><p>And finally, we&rsquo;ll populate this array in the static constructor of <code>MovieDatabase</code>, after the JSON file has been processed:</p>
<div class="wrap-code highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-csharp" data-lang="csharp"><span style="display:flex;"><span>    HashSet&lt;<span style="color:#66d9ef">string</span>&gt; genreSet = <span style="color:#66d9ef">new</span> HashSet&lt;<span style="color:#66d9ef">string</span>&gt;();
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">foreach</span>(Movie movie <span style="color:#66d9ef">in</span> _movies) {
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">if</span>(movie.MajorGenre != <span style="color:#66d9ef">null</span>) 
</span></span><span style="display:flex;"><span>        {
</span></span><span style="display:flex;"><span>            genreSet.Add(movie.MajorGenre);
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>    _genres = genreSet.ToArray();</span></span></code></pre></div><p>This approach means the finding of genres only happens once, and getting the <code>Genre</code> property is a constant-time O(1) operation.</p>
<p>We can implement the filters for the genres in the same way as we did for the MPAA filters; I&rsquo;ll leave that as an exercise for the reader.</p>

            <footer class="footline">

            </footer>
          </article>

    
    
          <article class="default">
            <header class="headline">
            </header>
<h1 id="numerical-filters">Numerical Filters</h1>

<p>Let&rsquo;s tackle one of the critics ratings next.  While we could create categories and use checkboxes, this doesn&rsquo;t capture the incremental values (i.e. 4.3), and it would be a <em>lot</em> of checkboxes for Rotten Tomatoes ratings!  Instead, we&rsquo;ll use a <em>numerical filter</em>, which limits our possible results to a range - between a minimum and maximum value.</p>
<p>Moreover, let&rsquo;s clean up our Index page, as it is getting difficult to determine what filter(s) go together, and and are adding more.</p>
<h2 id="refactoring-the-index-page">Refactoring the Index Page</h2>
<p>Let&rsquo;s move the filters to a column on the left, leave the search bar above, and show our results on the right.  This will require refactoring our <em>Index.cshtml</em> file:</p>
<div class="wrap-code highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-csharp" data-lang="csharp"><span style="display:flex;"><span>    &lt;form id=<span style="color:#e6db74">&#34;movie-database&#34;</span>&gt;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        &lt;div id=<span style="color:#e6db74">&#34;search&#34;</span>&gt;
</span></span><span style="display:flex;"><span>            &lt;input type=<span style="color:#e6db74">&#34;text&#34;</span> name=<span style="color:#e6db74">&#34;SearchTerms&#34;</span> <span style="color:#66d9ef">value</span>=<span style="color:#e6db74">&#34;@Model.SearchTerms&#34;</span> /&gt;
</span></span><span style="display:flex;"><span>            &lt;input type=<span style="color:#e6db74">&#34;submit&#34;</span> <span style="color:#66d9ef">value</span>=<span style="color:#e6db74">&#34;Search&#34;</span>&gt;
</span></span><span style="display:flex;"><span>        &lt;/div&gt;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        &lt;div id=<span style="color:#e6db74">&#34;filters&#34;</span>&gt;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>            &lt;h4&gt;MPAA Rating&lt;/h4&gt;
</span></span><span style="display:flex;"><span>            @foreach (<span style="color:#66d9ef">string</span> rating <span style="color:#66d9ef">in</span> MovieDatabase.MPAARating)
</span></span><span style="display:flex;"><span>            {
</span></span><span style="display:flex;"><span>                &lt;label&gt;
</span></span><span style="display:flex;"><span>                    &lt;input type=<span style="color:#e6db74">&#34;checkbox&#34;</span> name=<span style="color:#e6db74">&#34;MPAARatings&#34;</span> <span style="color:#66d9ef">value</span>=<span style="color:#e6db74">&#34;@rating&#34;</span> <span style="color:#66d9ef">checked</span>=<span style="color:#e6db74">&#34;@Model.MPAARatings.Contains(rating)&#34;</span> /&gt;
</span></span><span style="display:flex;"><span>                    @rating
</span></span><span style="display:flex;"><span>                &lt;/label&gt;
</span></span><span style="display:flex;"><span>            }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>            &lt;h4&gt;Genre&lt;/h4&gt;
</span></span><span style="display:flex;"><span>            @foreach (<span style="color:#66d9ef">string</span> genre <span style="color:#66d9ef">in</span> MovieDatabase.Genres)
</span></span><span style="display:flex;"><span>            {
</span></span><span style="display:flex;"><span>                &lt;label&gt;
</span></span><span style="display:flex;"><span>                    &lt;input type=<span style="color:#e6db74">&#34;checkbox&#34;</span> name=<span style="color:#e6db74">&#34;Genres&#34;</span> <span style="color:#66d9ef">value</span>=<span style="color:#e6db74">&#34;@genre&#34;</span> /&gt;
</span></span><span style="display:flex;"><span>                    @genre
</span></span><span style="display:flex;"><span>                &lt;/label&gt;
</span></span><span style="display:flex;"><span>            }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>            &lt;h4&gt;IMDB Rating&lt;/h4&gt;
</span></span><span style="display:flex;"><span>            &lt;div&gt;
</span></span><span style="display:flex;"><span>                Between
</span></span><span style="display:flex;"><span>                &lt;input name=<span style="color:#e6db74">&#34;IMDBMin&#34;</span> type=<span style="color:#e6db74">&#34;number&#34;</span> min=<span style="color:#e6db74">&#34;0&#34;</span> max=<span style="color:#e6db74">&#34;10&#34;</span> step=<span style="color:#e6db74">&#34;0.1&#34;</span> placeholder=<span style="color:#e6db74">&#34;min&#34;</span>/&gt;
</span></span><span style="display:flex;"><span>                and
</span></span><span style="display:flex;"><span>                &lt;input name=<span style="color:#e6db74">&#34;IMDBMax&#34;</span> type=<span style="color:#e6db74">&#34;number&#34;</span> min=<span style="color:#e6db74">&#34;0&#34;</span> max=<span style="color:#e6db74">&#34;10&#34;</span> step=<span style="color:#e6db74">&#34;0.1&#34;</span> placeholder=<span style="color:#e6db74">&#34;max&#34;</span>/&gt;
</span></span><span style="display:flex;"><span>            &lt;/div&gt;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        &lt;/div&gt;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        &lt;div id=<span style="color:#e6db74">&#34;results&#34;</span>&gt;
</span></span><span style="display:flex;"><span>            &lt;h1&gt;Movie Results&lt;/h1&gt;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>            &lt;ul class=<span style="color:#e6db74">&#34;movie-list&#34;</span>&gt;
</span></span><span style="display:flex;"><span>                @foreach (Movie movie <span style="color:#66d9ef">in</span> @Model.Movies)
</span></span><span style="display:flex;"><span>                {
</span></span><span style="display:flex;"><span>                    &lt;li&gt;
</span></span><span style="display:flex;"><span>                        &lt;div class=<span style="color:#e6db74">&#34;details&#34;</span>&gt;
</span></span><span style="display:flex;"><span>                            &lt;h3 class=<span style="color:#e6db74">&#34;title&#34;</span>&gt;@movie.Title&lt;/h3&gt;
</span></span><span style="display:flex;"><span>                            &lt;div class=<span style="color:#e6db74">&#34;mpaa&#34;</span>&gt;@movie.MPAARating&lt;/div&gt;
</span></span><span style="display:flex;"><span>                            &lt;div class=<span style="color:#e6db74">&#34;genre&#34;</span>&gt;@movie.MajorGenre&lt;/div&gt;
</span></span><span style="display:flex;"><span>                        &lt;/div&gt;
</span></span><span style="display:flex;"><span>                        &lt;div class=<span style="color:#e6db74">&#34;ratings&#34;</span>&gt;
</span></span><span style="display:flex;"><span>                            @if (movie.IMDBRating != <span style="color:#66d9ef">null</span>)
</span></span><span style="display:flex;"><span>                            {
</span></span><span style="display:flex;"><span>                                &lt;div class=<span style="color:#e6db74">&#34;imdb&#34;</span>&gt;
</span></span><span style="display:flex;"><span>                                    @movie.IMDBRating
</span></span><span style="display:flex;"><span>                                &lt;/div&gt;
</span></span><span style="display:flex;"><span>                            }
</span></span><span style="display:flex;"><span>                            @if (movie.RottenTomatoesRating != <span style="color:#66d9ef">null</span>)
</span></span><span style="display:flex;"><span>                            {
</span></span><span style="display:flex;"><span>                                &lt;div class=<span style="color:#e6db74">&#34;rotten-tomatoes&#34;</span>&gt;
</span></span><span style="display:flex;"><span>                                    @movie.RottenTomatoesRating
</span></span><span style="display:flex;"><span>                                &lt;/div&gt;
</span></span><span style="display:flex;"><span>                            }
</span></span><span style="display:flex;"><span>                        &lt;/div&gt;
</span></span><span style="display:flex;"><span>                    &lt;/li&gt;
</span></span><span style="display:flex;"><span>                }
</span></span><span style="display:flex;"><span>            &lt;/ul&gt;
</span></span><span style="display:flex;"><span>        &lt;/div&gt;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    &lt;/form&gt;</span></span></code></pre></div><p>Most of this is simply moving elements around the page, but note that we are using inputs of <code>type=number</code> to represent our range of IMDB values.  We can specify a minimum and maximum for this range, as well as an allowable increment.  Also, we use the <code>placeholder</code> attribute to put text into the <code>input</code> until a value is added.</p>
<h2 id="adding-more-styles">Adding More Styles</h2>
<p>Now we&rsquo;ll need to add some rules to our <em>wwwroot/css/styles.css</em>.  First, we&rsquo;ll use a <code>grid</code> for the layout of the form:</p>
<div class="wrap-code highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-css" data-lang="css"><span style="display:flex;"><span><span style="color:#f92672">form</span>#movie-database {
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">display</span>: <span style="color:#66d9ef">grid</span>;
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">grid-template-columns</span>: <span style="color:#ae81ff">1</span>fr <span style="color:#ae81ff">3</span>fr;
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">grid-template-rows</span>: <span style="color:#66d9ef">auto</span> <span style="color:#66d9ef">auto</span>;
</span></span><span style="display:flex;"><span>}</span></span></code></pre></div><p>The right column will be three times as big as the right.</p>
<p>We can make our search bar span both columns with <code>grid-column-start</code> and <code>grid-column-end</code>:</p>
<div class="wrap-code highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-css" data-lang="css"><span style="display:flex;"><span>#search {
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">grid-column-start</span>: <span style="color:#ae81ff">1</span>;
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">grid-column-end</span>: <span style="color:#ae81ff">3</span>;
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">text-align</span>: <span style="color:#66d9ef">center</span>;
</span></span><span style="display:flex;"><span>}</span></span></code></pre></div><p>Notice too that for CSS, we start counting at 1, not 0.  The filters and the results will fall in the next row automatically, each taking up their own respective grid cell.  You can read more about the grid layout in <a href="https://css-tricks.com/snippets/css/complete-guide-grid/" target="_blank">A Complete Guide to Grid</a>
.</p>
<p>Let&rsquo;s go ahead and use flexbox to lay out our filters in a column:</p>
<div class="wrap-code highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-css" data-lang="css"><span style="display:flex;"><span>#filters {
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">display</span>: <span style="color:#66d9ef">flex</span>;
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">flex-direction</span>: <span style="color:#66d9ef">column</span>;
</span></span><span style="display:flex;"><span>}</span></span></code></pre></div><p>And make our number inputs bigger:</p>
<div class="wrap-code highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-css" data-lang="css"><span style="display:flex;"><span>#filters <span style="color:#f92672">input</span><span style="color:#f92672">[</span><span style="color:#f92672">type</span><span style="color:#f92672">=</span><span style="color:#f92672">number</span><span style="color:#f92672">]</span> {
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">width</span>: <span style="color:#ae81ff">4</span><span style="color:#66d9ef">rem</span>;
</span></span><span style="display:flex;"><span>}</span></span></code></pre></div><p>Notice the use of square brackets in our CSS Selector to only apply to inputs with type number.</p>
<p>Also, let&rsquo;s add a margin above and remove most of the margin below our <code>&lt;h4&gt;</code> elements:</p>
<div class="wrap-code highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-css" data-lang="css"><span style="display:flex;"><span>#filters <span style="color:#f92672">h4</span> {
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">margin-bottom</span>: <span style="color:#ae81ff">0.2</span><span style="color:#66d9ef">rem</span>;
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">margin-top</span>: <span style="color:#ae81ff">2</span><span style="color:#66d9ef">rem</span>;
</span></span><span style="display:flex;"><span>}</span></span></code></pre></div><p>The resulting page looks much cleaner:</p>
<p>
<a href="#image-432c08983914c307a8383302701a93d5" class="lightbox-link">
<img src="https://ksu-cs-textbooks.github.io/cis400/images/6.8.5.png" alt="The Styled Page" style="height: auto; width: auto;" loading="lazy">
</a>
<a href="javascript:history.back();" class="lightbox" id="image-432c08983914c307a8383302701a93d5">
<img src="https://ksu-cs-textbooks.github.io/cis400/images/6.8.5.png" alt="The Styled Page" class="lightbox-image" loading="lazy">
</a></p>
<h2 id="capturing-the-filter-values">Capturing the Filter Values</h2>
<p>Now we need to get the filter values from our GET request query string.  We could do this like we&rsquo;ve been doing before, with:</p>
<div class="wrap-code highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-csharp" data-lang="csharp"><span style="display:flex;"><span>    Request.Query[<span style="color:#e6db74">&#34;IMDBMin&#34;</span>];</span></span></code></pre></div><p>But the returned value would be a string, so we&rsquo;d need to parse it:</p>
<div class="wrap-code highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-csharp" data-lang="csharp"><span style="display:flex;"><span>    IMDBMin = <span style="color:#66d9ef">double</span>.Parse(Request.Query[<span style="color:#e6db74">&#34;IMDBMin&#34;</span>]);</span></span></code></pre></div><p>If the query was <code>null</code>, then this would evaluate to <code>NaN</code>, which we wouldn&rsquo;t want to set our <code>&lt;input&gt;</code> to&hellip;</p>
<p>Instead, we&rsquo;ll look at some options built into the PageModel.</p>
<h2 id="parameter-binding">Parameter Binding</h2>
<p>The first of these options is <a href="https://docs.microsoft.com/en-us/aspnet/web-api/overview/formats-and-model-binding/parameter-binding-in-aspnet-web-api" target="_blank"><em>Parameter Binding</em></a>
.  In this approach, we define parameters to our <code>OnGet()</code> method to be parsed out of the request automatically, i.e.:</p>
<div class="wrap-code highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-csharp" data-lang="csharp"><span style="display:flex;"><span>    <span style="color:#75715e">/// &lt;summary&gt;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">/// Gets the search results for display on the page</span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">/// &lt;/summary&gt;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">void</span> OnGet(<span style="color:#66d9ef">string</span> SearchTerms, <span style="color:#66d9ef">string</span>[] MPAARatings, <span style="color:#66d9ef">string</span>[] Genres, <span style="color:#66d9ef">double?</span> IMDBMin, <span style="color:#66d9ef">double?</span> IMDBMax) {
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">this</span>.SearchTerms = SearchTerms;
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">this</span>.MPAARatings = MPAARatings;
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">this</span>.Genres = Genres;
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">this</span>.IMDBMin = IMDBMin;
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">this</span>.IMDBMax = IMDBMax;
</span></span><span style="display:flex;"><span>        Movies = MovieDatabase.Search(SearchTerms);
</span></span><span style="display:flex;"><span>        Movies = MovieDatabase.FilterByMPAARating(Movies, MPAARatings);
</span></span><span style="display:flex;"><span>        Movies = MovieDatabase.FilterByGenre(Movies, Genres);
</span></span><span style="display:flex;"><span>        Movies = MovieDatabase.FilterByIMDBRating(Movies, IMDBMin, IMDBMax);
</span></span><span style="display:flex;"><span>    }</span></span></code></pre></div><p>The benefit of this approach is that as long as C# knows a conversion into the type we specify, the conversion is done automatically.  Note that the parameter name matches the <code>name</code> property of the corresponding <code>&lt;input&gt;</code> - this must be the case for the Razor Page to bind the parameter to the corresponding input value.</p>
<p>Note that we still need to assign these parameter values to the corresponding properties of our PageModel.  If we don&rsquo;t, then those properties will all be <code>null</code>, and the <code>&lt;inputs&gt;</code> rendered on our page will always be blank.</p>
<h2 id="model-binding">Model Binding</h2>
<p>A second option is to use <a href="https://docs.microsoft.com/en-us/aspnet/core/mvc/models/model-binding?view=aspnetcore-3.1" target="_blank"><em>Model Binding</em></a>
.  Model binding also automatically converts incoming form data, but in this case it binds directly to the properties of our PageModel.  We indicate this form of binding with a <code>[BindProperty]</code> attribute, i.e.:</p>
<div class="wrap-code highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-csharp" data-lang="csharp"><span style="display:flex;"><span><span style="color:#66d9ef">public</span> <span style="color:#66d9ef">class</span> <span style="color:#a6e22e">IndexModel</span> : PageModel {
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">
</span></span></span><span style="display:flex;"><span><span style="color:#a6e22e">    [BindProperty(SupportsGet=true)]</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">string</span> SearchTerms {<span style="color:#66d9ef">get</span>; <span style="color:#66d9ef">set</span>;}
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">
</span></span></span><span style="display:flex;"><span><span style="color:#a6e22e">    [BindProperty(SupportsGet=true)]</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">string</span>[] MPAARatings {<span style="color:#66d9ef">get</span>; <span style="color:#66d9ef">set</span>;}
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">
</span></span></span><span style="display:flex;"><span><span style="color:#a6e22e">    [BindProperty(SupportsGet=true)]</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">string</span>[] Genres {<span style="color:#66d9ef">get</span>; <span style="color:#66d9ef">set</span>;}
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">
</span></span></span><span style="display:flex;"><span><span style="color:#a6e22e">    [BindProperty(SupportsGet=true)]</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">double?</span> IMDBMin {<span style="color:#66d9ef">get</span>; <span style="color:#66d9ef">set</span>;}
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">
</span></span></span><span style="display:flex;"><span><span style="color:#a6e22e">    [BindProperty(SupportsGet=true)]</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">double?</span> IMDBMax {<span style="color:#66d9ef">get</span>; <span style="color:#66d9ef">set</span>;}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">/// &lt;summary&gt;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">/// Gets the search results for display on the page</span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">/// &lt;/summary&gt;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">void</span> OnGet() {
</span></span><span style="display:flex;"><span>        Movies = MovieDatabase.Search(SearchTerms);
</span></span><span style="display:flex;"><span>        Movies = MovieDatabase.FilterByMPAARating(Movies, MPAARatings);
</span></span><span style="display:flex;"><span>        Movies = MovieDatabase.FilterByGenre(Movies, Genres);
</span></span><span style="display:flex;"><span>        Movies = MovieDatabase.FilterByIMDBRating(Movies, IMDBMin, IMDBMax);
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>}</span></span></code></pre></div><p>Note that with this approach, the incoming data is directly bound to the properties, so we don&rsquo;t need to do any special assignments within our <code>OnGet()</code> method.  Also, note that we have to use <code>SupportsGet=true</code> in order for this binding to occur on GET requests (by default, model binding only happens with POST requests).</p>

  
  
<div class="box notices cstyle note">
  <div class="box-label"><i class="fa-fw fas fa-exclamation-circle"></i> Note</div>
  <div class="box-content">

<p>You only need to do <em>one</em> binding approach per property in a PageModel.  I.e. you can just use the property decorator:</p>
<div class="wrap-code highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-csharp" data-lang="csharp"><span style="display:flex;"><span><span style="color:#66d9ef">public</span> <span style="color:#66d9ef">class</span> <span style="color:#a6e22e">SomePageModel</span> : PageModel
</span></span><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">    [BindProperty(SupportsGet=true)]</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">float</span> SomeProperty { <span style="color:#66d9ef">get</span>; <span style="color:#66d9ef">set</span>; }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">void</span> OnGet() {
</span></span><span style="display:flex;"><span>        DoSomething(SomeProperty);
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>}</span></span></code></pre></div><p><em>or</em> you might use parameter binding:</p>
<div class="wrap-code highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-csharp" data-lang="csharp"><span style="display:flex;"><span><span style="color:#66d9ef">public</span> <span style="color:#66d9ef">class</span> <span style="color:#a6e22e">SomePageModel</span> : PageModel
</span></span><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">void</span> OnGet(<span style="color:#66d9ef">float</span> SomeProperty) {
</span></span><span style="display:flex;"><span>        DoSomething(SomeProperty);
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>}</span></span></code></pre></div><p><em>or</em> you can parse it from the request:</p>
<div class="wrap-code highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-csharp" data-lang="csharp"><span style="display:flex;"><span><span style="color:#66d9ef">public</span> <span style="color:#66d9ef">class</span> <span style="color:#a6e22e">SomePageModel</span> : PageModel
</span></span><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">void</span> OnGet() {
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">var</span> someProperty = <span style="color:#66d9ef">float</span>.Parse(Request.Query[<span style="color:#e6db74">&#34;SomeProperty&#34;</span>]);
</span></span><span style="display:flex;"><span>        DoSomething(someProperty);
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>}</span></span></code></pre></div><p>These are all <em>different means</em> of accessing the <em>same data</em> from the incoming request.</p>
</div>
</div>
<p>Now all we need to do is implement the actual filter.</p>
<h3 id="implementing-the-imdb-rating-filter">Implementing the IMDB Rating Filter</h3>
<p>We&rsquo;ll define the new filter in our <code>MovieDatabase</code> class as another static method:</p>
<div class="wrap-code highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-csharp" data-lang="csharp"><span style="display:flex;"><span>    <span style="color:#75715e">/// &lt;summary&gt;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">/// Filters the provided collection of movies</span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">/// to those with IMDB ratings falling within</span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">/// the specified range</span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">/// &lt;/summary&gt;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">/// &lt;param name=&#34;movies&#34;&gt;The collection of movies to filter&lt;/param&gt;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">/// &lt;param name=&#34;min&#34;&gt;The minimum range value&lt;/param&gt;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">/// &lt;param name=&#34;max&#34;&gt;The maximum range value&lt;/param&gt;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">/// &lt;returns&gt;The filtered movie collection&lt;/returns&gt;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">static</span> IEnumerable&lt;Movie&gt; FilterByIMDBRating(IEnumerable&lt;Movie&gt; movies, <span style="color:#66d9ef">double?</span> min, <span style="color:#66d9ef">double?</span> max)
</span></span><span style="display:flex;"><span>    {
</span></span><span style="display:flex;"><span>        <span style="color:#75715e">// TODO: Filter movies</span>
</span></span><span style="display:flex;"><span>    }</span></span></code></pre></div><p>Notice that here too we use the nullable double value.  So our first step is probably to do a <code>null</code> check:</p>
<div class="wrap-code highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-csharp" data-lang="csharp"><span style="display:flex;"><span>    <span style="color:#66d9ef">if</span> (min == <span style="color:#66d9ef">null</span> &amp;&amp; max == <span style="color:#66d9ef">null</span>) <span style="color:#66d9ef">return</span> movies;</span></span></code></pre></div><p>But what if only one is null?  Should we filter for that part of the range?  It wouldn&rsquo;t be hard to do:</p>
<div class="wrap-code highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-csharp" data-lang="csharp"><span style="display:flex;"><span>    <span style="color:#66d9ef">var</span> results = <span style="color:#66d9ef">new</span> List&lt;Movie&gt;();
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">// only a maximum specified</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">if</span>(min == <span style="color:#66d9ef">null</span>)
</span></span><span style="display:flex;"><span>    {
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">foreach</span>(Movie movie <span style="color:#66d9ef">in</span> movies)
</span></span><span style="display:flex;"><span>        {
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">if</span> (movie.IMDBRating &lt;= max) results.Add(movie);
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">return</span> results;
</span></span><span style="display:flex;"><span>    }</span></span></code></pre></div><p>And the minimum would mirror that:</p>
<div class="wrap-code highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-csharp" data-lang="csharp"><span style="display:flex;"><span>    <span style="color:#75715e">// only a minimum specified</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">if</span>(max == <span style="color:#66d9ef">null</span>)
</span></span><span style="display:flex;"><span>    {
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">foreach</span>(Movie movie <span style="color:#66d9ef">in</span> movies)
</span></span><span style="display:flex;"><span>        {
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">if</span> (movie.IMDBRating &gt;= min) results.Add(movie);
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">return</span> results;
</span></span><span style="display:flex;"><span>    }</span></span></code></pre></div><p>Finally, we could handle the case where we have both a min and max value to our range:</p>
<div class="wrap-code highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-csharp" data-lang="csharp"><span style="display:flex;"><span>    <span style="color:#75715e">// Both minimum and maximum specified</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">foreach</span>(Movie movie <span style="color:#66d9ef">in</span> movies)
</span></span><span style="display:flex;"><span>    {
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">if</span>(movie.IMDBRating &gt;= min &amp;&amp; movie.IMDBRating &lt;= max)
</span></span><span style="display:flex;"><span>        {
</span></span><span style="display:flex;"><span>            results.Add(movie);
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">return</span> results;</span></span></code></pre></div><p>Notice too, that in each of these cases we&rsquo;re treating the range as <em>inclusive</em> (including the specified minimum and maximum).  This is the behavior most casual internet users will expect.  If the database and user expectations are different for your audience, you&rsquo;d want your code to match that expectation.</p>
<p>Now we can filter by IMDB rating:</p>
<p>
<a href="#image-d40a30d70f2b40bf72f3ddd1330d7a01" class="lightbox-link">
<img src="https://ksu-cs-textbooks.github.io/cis400/images/6.8.6.png" alt="Filtering By IMDB" style="height: auto; width: auto;" loading="lazy">
</a>
<a href="javascript:history.back();" class="lightbox" id="image-d40a30d70f2b40bf72f3ddd1330d7a01">
<img src="https://ksu-cs-textbooks.github.io/cis400/images/6.8.6.png" alt="Filtering By IMDB" class="lightbox-image" loading="lazy">
</a></p>
<h2 id="finishing-up">Finishing Up</h2>
<p>Since we&rsquo;re displaying the Rotten Tomatoes rating, we should probably also have a filter for it.  This will work almost exactly like the IMDB rating - but with the range from 0 to 100.  I&rsquo;ll leave this as an exercise for the reader.</p>

            <footer class="footline">

            </footer>
          </article>

    
    
          <article class="default">
            <header class="headline">
            </header>
<h1 id="numerical-filters">Numerical Filters</h1>

<p>Let&rsquo;s tackle one of the critics ratings next.  While we could create categories and use checkboxes, this doesn&rsquo;t capture the incremental values (i.e. 4.3), and it would be a <em>lot</em> of checkboxes for Rotten Tomatoes ratings!  Instead, we&rsquo;ll use a <em>numerical filter</em>, which limits our possible results to a range - between a minimum and maximum value.</p>
<p>Moreover, let&rsquo;s clean up our Index page, as it is getting difficult to determine what filter(s) go together, and and are adding more.</p>
<h2 id="refactoring-the-index-page">Refactoring the Index Page</h2>
<p>Let&rsquo;s move the filters to a column on the left, leave the search bar above, and show our results on the right.  This will require refactoring our <em>Index.cshtml</em> file:</p>
<div class="wrap-code highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-csharp" data-lang="csharp"><span style="display:flex;"><span>    &lt;form id=<span style="color:#e6db74">&#34;movie-database&#34;</span>&gt;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        &lt;div id=<span style="color:#e6db74">&#34;search&#34;</span>&gt;
</span></span><span style="display:flex;"><span>            &lt;input type=<span style="color:#e6db74">&#34;text&#34;</span> name=<span style="color:#e6db74">&#34;SearchTerms&#34;</span> <span style="color:#66d9ef">value</span>=<span style="color:#e6db74">&#34;@Model.SearchTerms&#34;</span> /&gt;
</span></span><span style="display:flex;"><span>            &lt;input type=<span style="color:#e6db74">&#34;submit&#34;</span> <span style="color:#66d9ef">value</span>=<span style="color:#e6db74">&#34;Search&#34;</span>&gt;
</span></span><span style="display:flex;"><span>        &lt;/div&gt;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        &lt;div id=<span style="color:#e6db74">&#34;filters&#34;</span>&gt;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>            &lt;h4&gt;MPAA Rating&lt;/h4&gt;
</span></span><span style="display:flex;"><span>            @foreach (<span style="color:#66d9ef">string</span> rating <span style="color:#66d9ef">in</span> MovieDatabase.MPAARating)
</span></span><span style="display:flex;"><span>            {
</span></span><span style="display:flex;"><span>                &lt;label&gt;
</span></span><span style="display:flex;"><span>                    &lt;input type=<span style="color:#e6db74">&#34;checkbox&#34;</span> name=<span style="color:#e6db74">&#34;MPAARatings&#34;</span> <span style="color:#66d9ef">value</span>=<span style="color:#e6db74">&#34;@rating&#34;</span> <span style="color:#66d9ef">checked</span>=<span style="color:#e6db74">&#34;@Model.MPAARatings.Contains(rating)&#34;</span> /&gt;
</span></span><span style="display:flex;"><span>                    @rating
</span></span><span style="display:flex;"><span>                &lt;/label&gt;
</span></span><span style="display:flex;"><span>            }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>            &lt;h4&gt;Genre&lt;/h4&gt;
</span></span><span style="display:flex;"><span>            @foreach (<span style="color:#66d9ef">string</span> genre <span style="color:#66d9ef">in</span> MovieDatabase.Genres)
</span></span><span style="display:flex;"><span>            {
</span></span><span style="display:flex;"><span>                &lt;label&gt;
</span></span><span style="display:flex;"><span>                    &lt;input type=<span style="color:#e6db74">&#34;checkbox&#34;</span> name=<span style="color:#e6db74">&#34;Genres&#34;</span> <span style="color:#66d9ef">value</span>=<span style="color:#e6db74">&#34;@genre&#34;</span> /&gt;
</span></span><span style="display:flex;"><span>                    @genre
</span></span><span style="display:flex;"><span>                &lt;/label&gt;
</span></span><span style="display:flex;"><span>            }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>            &lt;h4&gt;IMDB Rating&lt;/h4&gt;
</span></span><span style="display:flex;"><span>            &lt;div&gt;
</span></span><span style="display:flex;"><span>                Between
</span></span><span style="display:flex;"><span>                &lt;input name=<span style="color:#e6db74">&#34;IMDBMin&#34;</span> type=<span style="color:#e6db74">&#34;number&#34;</span> min=<span style="color:#e6db74">&#34;0&#34;</span> max=<span style="color:#e6db74">&#34;10&#34;</span> step=<span style="color:#e6db74">&#34;0.1&#34;</span> placeholder=<span style="color:#e6db74">&#34;min&#34;</span>/&gt;
</span></span><span style="display:flex;"><span>                and
</span></span><span style="display:flex;"><span>                &lt;input name=<span style="color:#e6db74">&#34;IMDBMax&#34;</span> type=<span style="color:#e6db74">&#34;number&#34;</span> min=<span style="color:#e6db74">&#34;0&#34;</span> max=<span style="color:#e6db74">&#34;10&#34;</span> step=<span style="color:#e6db74">&#34;0.1&#34;</span> placeholder=<span style="color:#e6db74">&#34;max&#34;</span>/&gt;
</span></span><span style="display:flex;"><span>            &lt;/div&gt;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        &lt;/div&gt;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        &lt;div id=<span style="color:#e6db74">&#34;results&#34;</span>&gt;
</span></span><span style="display:flex;"><span>            &lt;h1&gt;Movie Results&lt;/h1&gt;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>            &lt;ul class=<span style="color:#e6db74">&#34;movie-list&#34;</span>&gt;
</span></span><span style="display:flex;"><span>                @foreach (Movie movie <span style="color:#66d9ef">in</span> @Model.Movies)
</span></span><span style="display:flex;"><span>                {
</span></span><span style="display:flex;"><span>                    &lt;li&gt;
</span></span><span style="display:flex;"><span>                        &lt;div class=<span style="color:#e6db74">&#34;details&#34;</span>&gt;
</span></span><span style="display:flex;"><span>                            &lt;h3 class=<span style="color:#e6db74">&#34;title&#34;</span>&gt;@movie.Title&lt;/h3&gt;
</span></span><span style="display:flex;"><span>                            &lt;div class=<span style="color:#e6db74">&#34;mpaa&#34;</span>&gt;@movie.MPAARating&lt;/div&gt;
</span></span><span style="display:flex;"><span>                            &lt;div class=<span style="color:#e6db74">&#34;genre&#34;</span>&gt;@movie.MajorGenre&lt;/div&gt;
</span></span><span style="display:flex;"><span>                        &lt;/div&gt;
</span></span><span style="display:flex;"><span>                        &lt;div class=<span style="color:#e6db74">&#34;ratings&#34;</span>&gt;
</span></span><span style="display:flex;"><span>                            @if (movie.IMDBRating != <span style="color:#66d9ef">null</span>)
</span></span><span style="display:flex;"><span>                            {
</span></span><span style="display:flex;"><span>                                &lt;div class=<span style="color:#e6db74">&#34;imdb&#34;</span>&gt;
</span></span><span style="display:flex;"><span>                                    @movie.IMDBRating
</span></span><span style="display:flex;"><span>                                &lt;/div&gt;
</span></span><span style="display:flex;"><span>                            }
</span></span><span style="display:flex;"><span>                            @if (movie.RottenTomatoesRating != <span style="color:#66d9ef">null</span>)
</span></span><span style="display:flex;"><span>                            {
</span></span><span style="display:flex;"><span>                                &lt;div class=<span style="color:#e6db74">&#34;rotten-tomatoes&#34;</span>&gt;
</span></span><span style="display:flex;"><span>                                    @movie.RottenTomatoesRating
</span></span><span style="display:flex;"><span>                                &lt;/div&gt;
</span></span><span style="display:flex;"><span>                            }
</span></span><span style="display:flex;"><span>                        &lt;/div&gt;
</span></span><span style="display:flex;"><span>                    &lt;/li&gt;
</span></span><span style="display:flex;"><span>                }
</span></span><span style="display:flex;"><span>            &lt;/ul&gt;
</span></span><span style="display:flex;"><span>        &lt;/div&gt;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    &lt;/form&gt;</span></span></code></pre></div><p>Most of this is simply moving elements around the page, but note that we are using inputs of <code>type=number</code> to represent our range of IMDB values.  We can specify a minimum and maximum for this range, as well as an allowable increment.  Also, we use the <code>placeholder</code> attribute to put text into the <code>input</code> until a value is added.</p>
<h2 id="adding-more-styles">Adding More Styles</h2>
<p>Now we&rsquo;ll need to add some rules to our <em>wwwroot/css/styles.css</em>.  First, we&rsquo;ll use a <code>grid</code> for the layout of the form:</p>
<div class="wrap-code highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-css" data-lang="css"><span style="display:flex;"><span><span style="color:#f92672">form</span>#movie-database {
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">display</span>: <span style="color:#66d9ef">grid</span>;
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">grid-template-columns</span>: <span style="color:#ae81ff">1</span>fr <span style="color:#ae81ff">3</span>fr;
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">grid-template-rows</span>: <span style="color:#66d9ef">auto</span> <span style="color:#66d9ef">auto</span>;
</span></span><span style="display:flex;"><span>}</span></span></code></pre></div><p>The right column will be three times as big as the left.</p>
<p>We can make our search bar span both columns with <code>grid-column-start</code> and <code>grid-column-end</code>:</p>
<div class="wrap-code highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-css" data-lang="css"><span style="display:flex;"><span>#search {
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">grid-column-start</span>: <span style="color:#ae81ff">1</span>;
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">grid-column-end</span>: <span style="color:#ae81ff">3</span>;
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">text-align</span>: <span style="color:#66d9ef">center</span>;
</span></span><span style="display:flex;"><span>}</span></span></code></pre></div><p>Notice too that for CSS, we start counting at 1, not 0.  The filters and the results will fall in the next row automatically, each taking up their own respective grid cell.  You can read more about the grid layout in <a href="https://css-tricks.com/snippets/css/complete-guide-grid/" target="_blank">A Complete Guide to Grid</a>
.</p>
<p>Let&rsquo;s go ahead and use flexbox to lay out our filters in a column:</p>
<div class="wrap-code highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-css" data-lang="css"><span style="display:flex;"><span>#filters {
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">display</span>: <span style="color:#66d9ef">flex</span>;
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">flex-direction</span>: <span style="color:#66d9ef">column</span>;
</span></span><span style="display:flex;"><span>}</span></span></code></pre></div><p>And make our number inputs bigger:</p>
<div class="wrap-code highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-css" data-lang="css"><span style="display:flex;"><span>#filters <span style="color:#f92672">input</span><span style="color:#f92672">[</span><span style="color:#f92672">type</span><span style="color:#f92672">=</span><span style="color:#f92672">number</span><span style="color:#f92672">]</span> {
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">width</span>: <span style="color:#ae81ff">4</span><span style="color:#66d9ef">rem</span>;
</span></span><span style="display:flex;"><span>}</span></span></code></pre></div><p>Notice the use of square brackets in our CSS Selector to only apply to inputs with type number.</p>
<p>Also, let&rsquo;s add a margin above and remove most of the margin below our <code>&lt;h4&gt;</code> elements:</p>
<div class="wrap-code highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-css" data-lang="css"><span style="display:flex;"><span>#filters <span style="color:#f92672">h4</span> {
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">margin-bottom</span>: <span style="color:#ae81ff">0.2</span><span style="color:#66d9ef">rem</span>;
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">margin-top</span>: <span style="color:#ae81ff">2</span><span style="color:#66d9ef">rem</span>;
</span></span><span style="display:flex;"><span>}</span></span></code></pre></div><p>The resulting page looks much cleaner:</p>
<p>
<a href="#image-773cabd3b74e4ac70ffd8b121f6d4dec" class="lightbox-link">
<img src="https://ksu-cs-textbooks.github.io/cis400/images/6.8.5.png" alt="The Styled Page" style="height: auto; width: auto;" loading="lazy">
</a>
<a href="javascript:history.back();" class="lightbox" id="image-773cabd3b74e4ac70ffd8b121f6d4dec">
<img src="https://ksu-cs-textbooks.github.io/cis400/images/6.8.5.png" alt="The Styled Page" class="lightbox-image" loading="lazy">
</a></p>
<h2 id="capturing-the-filter-values">Capturing the Filter Values</h2>
<p>Now we need to get the filter values from our GET request query string.  We could do this like we&rsquo;ve been doing before, with:</p>
<div class="wrap-code highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-csharp" data-lang="csharp"><span style="display:flex;"><span>    Request.Query[<span style="color:#e6db74">&#34;IMDBMin&#34;</span>];</span></span></code></pre></div><p>But the returned value would be a string, so we&rsquo;d need to parse it:</p>
<div class="wrap-code highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-csharp" data-lang="csharp"><span style="display:flex;"><span>    IMDBMin = <span style="color:#66d9ef">double</span>.Parse(Request.Query[<span style="color:#e6db74">&#34;IMDBMin&#34;</span>]);</span></span></code></pre></div><p>If the query was <code>null</code>, then this would evaluate to <code>NaN</code>, which we wouldn&rsquo;t want to set our <code>&lt;input&gt;</code> to&hellip;</p>
<p>Instead, we&rsquo;ll look at some options built into the PageModel.</p>
<h2 id="parameter-binding">Parameter Binding</h2>
<p>The first of these options is <a href="https://docs.microsoft.com/en-us/aspnet/web-api/overview/formats-and-model-binding/parameter-binding-in-aspnet-web-api" target="_blank"><em>Parameter Binding</em></a>
.  In this approach, we define parameters to our <code>OnGet()</code> method to be parsed out of the request automatically, i.e.:</p>
<div class="wrap-code highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-csharp" data-lang="csharp"><span style="display:flex;"><span>    <span style="color:#75715e">/// &lt;summary&gt;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">/// Gets the search results for display on the page</span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">/// &lt;/summary&gt;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">void</span> OnGet(<span style="color:#66d9ef">string</span> SearchTerms, <span style="color:#66d9ef">string</span>[] MPAARatings, <span style="color:#66d9ef">string</span>[] Genres, <span style="color:#66d9ef">double?</span> IMDBMin, <span style="color:#66d9ef">double?</span> IMDBMax) {
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">this</span>.SearchTerms = SearchTerms;
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">this</span>.MPAARatings = MPAARatings;
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">this</span>.Genres = Genres;
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">this</span>.IMDBMin = IMDBMin;
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">this</span>.IMDBMax = IMDBMax;
</span></span><span style="display:flex;"><span>        Movies = MovieDatabase.Search(SearchTerms);
</span></span><span style="display:flex;"><span>        Movies = MovieDatabase.FilterByMPAARating(Movies, MPAARatings);
</span></span><span style="display:flex;"><span>        Movies = MovieDatabase.FilterByGenre(Movies, Genres);
</span></span><span style="display:flex;"><span>        Movies = MovieDatabase.FilterByIMDBRating(Movies, IMDBMin, IMDBMax);
</span></span><span style="display:flex;"><span>    }</span></span></code></pre></div><p>The benefit of this approach is that as long as C# knows a conversion into the type we specify, the conversion is done automatically.  Note that the parameter name matches the <code>name</code> property of the corresponding <code>&lt;input&gt;</code> - this must be the case for the Razor Page to bind the parameter to the corresponding input value.</p>
<p>Note that we still need to assign these parameter values to the corresponding properties of our PageModel.  If we don&rsquo;t, then those properties will all be <code>null</code>, and the <code>&lt;inputs&gt;</code> rendered on our page will always be blank.</p>
<h2 id="model-binding">Model Binding</h2>
<p>A second option is to use <a href="https://docs.microsoft.com/en-us/aspnet/core/mvc/models/model-binding?view=aspnetcore-3.1" target="_blank"><em>Model Binding</em></a>
.  Model binding also automatically converts incoming form data, but in this case it binds directly to the properties of our PageModel.  We indicate this form of binding with a <code>[BindProperty]</code> attribute, i.e.:</p>
<div class="wrap-code highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-csharp" data-lang="csharp"><span style="display:flex;"><span><span style="color:#66d9ef">public</span> <span style="color:#66d9ef">class</span> <span style="color:#a6e22e">IndexModel</span> : PageModel {
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">
</span></span></span><span style="display:flex;"><span><span style="color:#a6e22e">    [BindProperty(SupportsGet=true)]</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">string</span> SearchTerms {<span style="color:#66d9ef">get</span>; <span style="color:#66d9ef">set</span>;}
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">
</span></span></span><span style="display:flex;"><span><span style="color:#a6e22e">    [BindProperty(SupportsGet=true)]</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">string</span>[] MPAARatings {<span style="color:#66d9ef">get</span>; <span style="color:#66d9ef">set</span>;}
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">
</span></span></span><span style="display:flex;"><span><span style="color:#a6e22e">    [BindProperty(SupportsGet=true)]</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">string</span>[] Genres {<span style="color:#66d9ef">get</span>; <span style="color:#66d9ef">set</span>;}
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">
</span></span></span><span style="display:flex;"><span><span style="color:#a6e22e">    [BindProperty(SupportsGet=true)]</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">double?</span> IMDBMin {<span style="color:#66d9ef">get</span>; <span style="color:#66d9ef">set</span>;}
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">
</span></span></span><span style="display:flex;"><span><span style="color:#a6e22e">    [BindProperty(SupportsGet=true)]</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">double?</span> IMDBMax {<span style="color:#66d9ef">get</span>; <span style="color:#66d9ef">set</span>;}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">/// &lt;summary&gt;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">/// Gets the search results for display on the page</span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">/// &lt;/summary&gt;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">void</span> OnGet() {
</span></span><span style="display:flex;"><span>        Movies = MovieDatabase.Search(SearchTerms);
</span></span><span style="display:flex;"><span>        Movies = MovieDatabase.FilterByMPAARating(Movies, MPAARatings);
</span></span><span style="display:flex;"><span>        Movies = MovieDatabase.FilterByGenre(Movies, Genres);
</span></span><span style="display:flex;"><span>        Movies = MovieDatabase.FilterByIMDBRating(Movies, IMDBMin, IMDBMax);
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>}</span></span></code></pre></div><p>Note that with this approach, the incoming data is directly bound to the properties, so we don&rsquo;t need to do any special assignments within our <code>OnGet()</code> method.  Also, note that we have to use <code>SupportsGet=true</code> in order for this binding to occur on GET requests (by default, model binding only happens with POST requests).</p>

  
  
<div class="box notices cstyle note">
  <div class="box-label"><i class="fa-fw fas fa-exclamation-circle"></i> Note</div>
  <div class="box-content">

<p>You only need to do <em>one</em> binding approach per property in a PageModel.  I.e. you can just use the property decorator:</p>
<div class="wrap-code highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-csharp" data-lang="csharp"><span style="display:flex;"><span><span style="color:#66d9ef">public</span> <span style="color:#66d9ef">class</span> <span style="color:#a6e22e">SomePageModel</span> : PageModel
</span></span><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">    [BindProperty(SupportsGet=true)]</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">float</span> SomeProperty { <span style="color:#66d9ef">get</span>; <span style="color:#66d9ef">set</span>; }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">void</span> OnGet() {
</span></span><span style="display:flex;"><span>        DoSomething(SomeProperty);
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>}</span></span></code></pre></div><p><em>or</em> you might use parameter binding:</p>
<div class="wrap-code highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-csharp" data-lang="csharp"><span style="display:flex;"><span><span style="color:#66d9ef">public</span> <span style="color:#66d9ef">class</span> <span style="color:#a6e22e">SomePageModel</span> : PageModel
</span></span><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">void</span> OnGet(<span style="color:#66d9ef">float</span> SomeProperty) {
</span></span><span style="display:flex;"><span>        DoSomething(SomeProperty);
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>}</span></span></code></pre></div><p><em>or</em> you can parse it from the request:</p>
<div class="wrap-code highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-csharp" data-lang="csharp"><span style="display:flex;"><span><span style="color:#66d9ef">public</span> <span style="color:#66d9ef">class</span> <span style="color:#a6e22e">SomePageModel</span> : PageModel
</span></span><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">void</span> OnGet() {
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">var</span> someProperty = <span style="color:#66d9ef">float</span>.Parse(Request.Query[<span style="color:#e6db74">&#34;SomeProperty&#34;</span>]);
</span></span><span style="display:flex;"><span>        DoSomething(someProperty);
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>}</span></span></code></pre></div><p>These are all <em>different means</em> of accessing the <em>same data</em> from the incoming request.</p>
</div>
</div>
<p>Now all we need to do is implement the actual filter.</p>
<h3 id="implementing-the-imdb-rating-filter">Implementing the IMDB Rating Filter</h3>
<p>We&rsquo;ll define the new filter in our <code>MovieDatabase</code> class as another static method:</p>
<div class="wrap-code highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-csharp" data-lang="csharp"><span style="display:flex;"><span>    <span style="color:#75715e">/// &lt;summary&gt;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">/// Filters the provided collection of movies</span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">/// to those with IMDB ratings falling within</span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">/// the specified range</span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">/// &lt;/summary&gt;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">/// &lt;param name=&#34;movies&#34;&gt;The collection of movies to filter&lt;/param&gt;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">/// &lt;param name=&#34;min&#34;&gt;The minimum range value&lt;/param&gt;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">/// &lt;param name=&#34;max&#34;&gt;The maximum range value&lt;/param&gt;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">/// &lt;returns&gt;The filtered movie collection&lt;/returns&gt;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">static</span> IEnumerable&lt;Movie&gt; FilterByIMDBRating(IEnumerable&lt;Movie&gt; movies, <span style="color:#66d9ef">double?</span> min, <span style="color:#66d9ef">double?</span> max)
</span></span><span style="display:flex;"><span>    {
</span></span><span style="display:flex;"><span>        <span style="color:#75715e">// TODO: Filter movies</span>
</span></span><span style="display:flex;"><span>    }</span></span></code></pre></div><p>Notice that here too we use the nullable double value.  So our first step is probably to do a <code>null</code> check:</p>
<div class="wrap-code highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-csharp" data-lang="csharp"><span style="display:flex;"><span>    <span style="color:#66d9ef">if</span> (min == <span style="color:#66d9ef">null</span> &amp;&amp; max == <span style="color:#66d9ef">null</span>) <span style="color:#66d9ef">return</span> movies;</span></span></code></pre></div><p>But what if only one is null?  Should we filter for that part of the range?  It wouldn&rsquo;t be hard to do:</p>
<div class="wrap-code highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-csharp" data-lang="csharp"><span style="display:flex;"><span>    <span style="color:#66d9ef">var</span> results = <span style="color:#66d9ef">new</span> List&lt;Movie&gt;();
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">// only a maximum specified</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">if</span>(min == <span style="color:#66d9ef">null</span>)
</span></span><span style="display:flex;"><span>    {
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">foreach</span>(Movie movie <span style="color:#66d9ef">in</span> movies)
</span></span><span style="display:flex;"><span>        {
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">if</span> (movie.IMDBRating &lt;= max) results.Add(movie);
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">return</span> results;
</span></span><span style="display:flex;"><span>    }</span></span></code></pre></div><p>And the minimum would mirror that:</p>
<div class="wrap-code highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-csharp" data-lang="csharp"><span style="display:flex;"><span>    <span style="color:#75715e">// only a minimum specified</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">if</span>(max == <span style="color:#66d9ef">null</span>)
</span></span><span style="display:flex;"><span>    {
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">foreach</span>(Movie movie <span style="color:#66d9ef">in</span> movies)
</span></span><span style="display:flex;"><span>        {
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">if</span> (movie.IMDBRating &gt;= min) results.Add(movie);
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">return</span> results;
</span></span><span style="display:flex;"><span>    }</span></span></code></pre></div><p>Finally, we could handle the case where we have both a min and max value to our range:</p>
<div class="wrap-code highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-csharp" data-lang="csharp"><span style="display:flex;"><span>    <span style="color:#75715e">// Both minimum and maximum specified</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">foreach</span>(Movie movie <span style="color:#66d9ef">in</span> movies)
</span></span><span style="display:flex;"><span>    {
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">if</span>(movie.IMDBRating &gt;= min &amp;&amp; movie.IMDBRating &lt;= max)
</span></span><span style="display:flex;"><span>        {
</span></span><span style="display:flex;"><span>            results.Add(movie);
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">return</span> results;</span></span></code></pre></div><p>Notice too, that in each of these cases we&rsquo;re treating the range as <em>inclusive</em> (including the specified minimum and maximum).  This is the behavior most casual internet users will expect.  If the database and user expectations are different for your audience, you&rsquo;d want your code to match that expectation.</p>
<p>Now we can filter by IMDB rating:</p>
<p>
<a href="#image-e75044c33a0e3a4579f37645ef7d5c7e" class="lightbox-link">
<img src="https://ksu-cs-textbooks.github.io/cis400/images/6.8.6.png" alt="Filtering By IMDB" style="height: auto; width: auto;" loading="lazy">
</a>
<a href="javascript:history.back();" class="lightbox" id="image-e75044c33a0e3a4579f37645ef7d5c7e">
<img src="https://ksu-cs-textbooks.github.io/cis400/images/6.8.6.png" alt="Filtering By IMDB" class="lightbox-image" loading="lazy">
</a></p>
<h2 id="finishing-up">Finishing Up</h2>
<p>Since we&rsquo;re displaying the Rotten Tomatoes rating, we should probably also have a filter for it.  This will work almost exactly like the IMDB rating - but with the range from 0 to 100.  I&rsquo;ll leave this as an exercise for the reader.</p>

            <footer class="footline">

            </footer>
          </article>

    
    
          <article class="default">
            <header class="headline">
            </header>
<h1 id="numerical-filters">Numerical Filters</h1>

<p>Let&rsquo;s tackle one of the critics ratings next.  While we could create categories and use checkboxes, this doesn&rsquo;t capture the incremental values (i.e. 4.3), and it would be a <em>lot</em> of checkboxes for Rotten Tomatoes ratings!  Instead, we&rsquo;ll use a <em>numerical filter</em>, which limits our possible results to a range - between a minimum and maximum value.</p>
<p>Moreover, let&rsquo;s clean up our Index page, as it is getting difficult to determine what filter(s) go together, and and are adding more.</p>
<h2 id="refactoring-the-index-page">Refactoring the Index Page</h2>
<p>Let&rsquo;s move the filters to a column on the left, leave the search bar above, and show our results on the right.  This will require refactoring our <em>Index.cshtml</em> file:</p>
<div class="wrap-code highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-csharp" data-lang="csharp"><span style="display:flex;"><span>    &lt;form id=<span style="color:#e6db74">&#34;movie-database&#34;</span>&gt;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        &lt;div id=<span style="color:#e6db74">&#34;search&#34;</span>&gt;
</span></span><span style="display:flex;"><span>            &lt;input type=<span style="color:#e6db74">&#34;text&#34;</span> name=<span style="color:#e6db74">&#34;SearchTerms&#34;</span> <span style="color:#66d9ef">value</span>=<span style="color:#e6db74">&#34;@Model.SearchTerms&#34;</span> /&gt;
</span></span><span style="display:flex;"><span>            &lt;input type=<span style="color:#e6db74">&#34;submit&#34;</span> <span style="color:#66d9ef">value</span>=<span style="color:#e6db74">&#34;Search&#34;</span>&gt;
</span></span><span style="display:flex;"><span>        &lt;/div&gt;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        &lt;div id=<span style="color:#e6db74">&#34;filters&#34;</span>&gt;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>            &lt;h4&gt;MPAA Rating&lt;/h4&gt;
</span></span><span style="display:flex;"><span>            @foreach (<span style="color:#66d9ef">string</span> rating <span style="color:#66d9ef">in</span> MovieDatabase.MPAARatings)
</span></span><span style="display:flex;"><span>            {
</span></span><span style="display:flex;"><span>                &lt;label&gt;
</span></span><span style="display:flex;"><span>                    &lt;input type=<span style="color:#e6db74">&#34;checkbox&#34;</span> name=<span style="color:#e6db74">&#34;MPAARatings&#34;</span> <span style="color:#66d9ef">value</span>=<span style="color:#e6db74">&#34;@rating&#34;</span> <span style="color:#66d9ef">checked</span>=<span style="color:#e6db74">&#34;@Model.MPAARatings.Contains(rating)&#34;</span> /&gt;
</span></span><span style="display:flex;"><span>                    @rating
</span></span><span style="display:flex;"><span>                &lt;/label&gt;
</span></span><span style="display:flex;"><span>            }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>            &lt;h4&gt;Genre&lt;/h4&gt;
</span></span><span style="display:flex;"><span>            @foreach (<span style="color:#66d9ef">string</span> genre <span style="color:#66d9ef">in</span> MovieDatabase.Genres)
</span></span><span style="display:flex;"><span>            {
</span></span><span style="display:flex;"><span>                &lt;label&gt;
</span></span><span style="display:flex;"><span>                    &lt;input type=<span style="color:#e6db74">&#34;checkbox&#34;</span> name=<span style="color:#e6db74">&#34;Genres&#34;</span> <span style="color:#66d9ef">value</span>=<span style="color:#e6db74">&#34;@genre&#34;</span> /&gt;
</span></span><span style="display:flex;"><span>                    @genre
</span></span><span style="display:flex;"><span>                &lt;/label&gt;
</span></span><span style="display:flex;"><span>            }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>            &lt;h4&gt;IMDB Rating&lt;/h4&gt;
</span></span><span style="display:flex;"><span>            &lt;div&gt;
</span></span><span style="display:flex;"><span>                Between
</span></span><span style="display:flex;"><span>                &lt;input name=<span style="color:#e6db74">&#34;IMDBMin&#34;</span> type=<span style="color:#e6db74">&#34;number&#34;</span> min=<span style="color:#e6db74">&#34;0&#34;</span> max=<span style="color:#e6db74">&#34;10&#34;</span> step=<span style="color:#e6db74">&#34;0.1&#34;</span> placeholder=<span style="color:#e6db74">&#34;min&#34;</span>/&gt;
</span></span><span style="display:flex;"><span>                and
</span></span><span style="display:flex;"><span>                &lt;input name=<span style="color:#e6db74">&#34;IMDBMax&#34;</span> type=<span style="color:#e6db74">&#34;number&#34;</span> min=<span style="color:#e6db74">&#34;0&#34;</span> max=<span style="color:#e6db74">&#34;10&#34;</span> step=<span style="color:#e6db74">&#34;0.1&#34;</span> placeholder=<span style="color:#e6db74">&#34;max&#34;</span>/&gt;
</span></span><span style="display:flex;"><span>            &lt;/div&gt;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        &lt;/div&gt;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        &lt;div id=<span style="color:#e6db74">&#34;results&#34;</span>&gt;
</span></span><span style="display:flex;"><span>            &lt;h1&gt;Movie Results&lt;/h1&gt;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>            &lt;ul class=<span style="color:#e6db74">&#34;movie-list&#34;</span>&gt;
</span></span><span style="display:flex;"><span>                @foreach (Movie movie <span style="color:#66d9ef">in</span> @Model.Movies)
</span></span><span style="display:flex;"><span>                {
</span></span><span style="display:flex;"><span>                    &lt;li&gt;
</span></span><span style="display:flex;"><span>                        &lt;div class=<span style="color:#e6db74">&#34;details&#34;</span>&gt;
</span></span><span style="display:flex;"><span>                            &lt;h3 class=<span style="color:#e6db74">&#34;title&#34;</span>&gt;@movie.Title&lt;/h3&gt;
</span></span><span style="display:flex;"><span>                            &lt;div class=<span style="color:#e6db74">&#34;mpaa&#34;</span>&gt;@movie.MPAARating&lt;/div&gt;
</span></span><span style="display:flex;"><span>                            &lt;div class=<span style="color:#e6db74">&#34;genre&#34;</span>&gt;@movie.MajorGenre&lt;/div&gt;
</span></span><span style="display:flex;"><span>                        &lt;/div&gt;
</span></span><span style="display:flex;"><span>                        &lt;div class=<span style="color:#e6db74">&#34;ratings&#34;</span>&gt;
</span></span><span style="display:flex;"><span>                            @if (movie.IMDBRating != <span style="color:#66d9ef">null</span>)
</span></span><span style="display:flex;"><span>                            {
</span></span><span style="display:flex;"><span>                                &lt;div class=<span style="color:#e6db74">&#34;imdb&#34;</span>&gt;
</span></span><span style="display:flex;"><span>                                    @movie.IMDBRating
</span></span><span style="display:flex;"><span>                                &lt;/div&gt;
</span></span><span style="display:flex;"><span>                            }
</span></span><span style="display:flex;"><span>                            @if (movie.RottenTomatoesRating != <span style="color:#66d9ef">null</span>)
</span></span><span style="display:flex;"><span>                            {
</span></span><span style="display:flex;"><span>                                &lt;div class=<span style="color:#e6db74">&#34;rotten-tomatoes&#34;</span>&gt;
</span></span><span style="display:flex;"><span>                                    @movie.RottenTomatoesRating
</span></span><span style="display:flex;"><span>                                &lt;/div&gt;
</span></span><span style="display:flex;"><span>                            }
</span></span><span style="display:flex;"><span>                        &lt;/div&gt;
</span></span><span style="display:flex;"><span>                    &lt;/li&gt;
</span></span><span style="display:flex;"><span>                }
</span></span><span style="display:flex;"><span>            &lt;/ul&gt;
</span></span><span style="display:flex;"><span>        &lt;/div&gt;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    &lt;/form&gt;</span></span></code></pre></div><p>Most of this is simply moving elements around the page, but note that we are using inputs of <code>type=number</code> to represent our range of IMDB values.  We can specify a minimum and maximum for this range, as well as an allowable increment.  Also, we use the <code>placeholder</code> attribute to put text into the <code>input</code> until a value is added.</p>
<h2 id="adding-more-styles">Adding More Styles</h2>
<p>Now we&rsquo;ll need to add some rules to our <em>wwwroot/css/styles.css</em>.  First, we&rsquo;ll use a <code>grid</code> for the layout of the form:</p>
<div class="wrap-code highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-css" data-lang="css"><span style="display:flex;"><span><span style="color:#f92672">form</span>#movie-database {
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">display</span>: <span style="color:#66d9ef">grid</span>;
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">grid-template-columns</span>: <span style="color:#ae81ff">1</span>fr <span style="color:#ae81ff">3</span>fr;
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">grid-template-rows</span>: <span style="color:#66d9ef">auto</span> <span style="color:#66d9ef">auto</span>;
</span></span><span style="display:flex;"><span>}</span></span></code></pre></div><p>The right column will be three times as big as the left.</p>
<p>We can make our search bar span both columns with <code>grid-column-start</code> and <code>grid-column-end</code>:</p>
<div class="wrap-code highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-css" data-lang="css"><span style="display:flex;"><span>#search {
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">grid-column-start</span>: <span style="color:#ae81ff">1</span>;
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">grid-column-end</span>: <span style="color:#ae81ff">3</span>;
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">text-align</span>: <span style="color:#66d9ef">center</span>;
</span></span><span style="display:flex;"><span>}</span></span></code></pre></div><p>Notice too that for CSS, we start counting at 1, not 0.  The filters and the results will fall in the next row automatically, each taking up their own respective grid cell.  You can read more about the grid layout in <a href="https://css-tricks.com/snippets/css/complete-guide-grid/" target="_blank">A Complete Guide to Grid</a>
.</p>
<p>Let&rsquo;s go ahead and use flexbox to lay out our filters in a column:</p>
<div class="wrap-code highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-css" data-lang="css"><span style="display:flex;"><span>#filters {
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">display</span>: <span style="color:#66d9ef">flex</span>;
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">flex-direction</span>: <span style="color:#66d9ef">column</span>;
</span></span><span style="display:flex;"><span>}</span></span></code></pre></div><p>And make our number inputs bigger:</p>
<div class="wrap-code highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-css" data-lang="css"><span style="display:flex;"><span>#filters <span style="color:#f92672">input</span><span style="color:#f92672">[</span><span style="color:#f92672">type</span><span style="color:#f92672">=</span><span style="color:#f92672">number</span><span style="color:#f92672">]</span> {
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">width</span>: <span style="color:#ae81ff">4</span><span style="color:#66d9ef">rem</span>;
</span></span><span style="display:flex;"><span>}</span></span></code></pre></div><p>Notice the use of square brackets in our CSS Selector to only apply to inputs with type number.</p>
<p>Also, let&rsquo;s add a margin above and remove most of the margin below our <code>&lt;h4&gt;</code> elements:</p>
<div class="wrap-code highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-css" data-lang="css"><span style="display:flex;"><span>#filters <span style="color:#f92672">h4</span> {
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">margin-bottom</span>: <span style="color:#ae81ff">0.2</span><span style="color:#66d9ef">rem</span>;
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">margin-top</span>: <span style="color:#ae81ff">2</span><span style="color:#66d9ef">rem</span>;
</span></span><span style="display:flex;"><span>}</span></span></code></pre></div><p>The resulting page looks much cleaner:</p>
<p>
<a href="#image-e789fc3adc28751ff6cb706cd65d119d" class="lightbox-link">
<img src="https://ksu-cs-textbooks.github.io/cis400/images/6.8.5.png" alt="The Styled Page" style="height: auto; width: auto;" loading="lazy">
</a>
<a href="javascript:history.back();" class="lightbox" id="image-e789fc3adc28751ff6cb706cd65d119d">
<img src="https://ksu-cs-textbooks.github.io/cis400/images/6.8.5.png" alt="The Styled Page" class="lightbox-image" loading="lazy">
</a></p>
<h2 id="capturing-the-filter-values">Capturing the Filter Values</h2>
<p>Now we need to get the filter values from our GET request query string.  We could do this like we&rsquo;ve been doing before, with:</p>
<div class="wrap-code highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-csharp" data-lang="csharp"><span style="display:flex;"><span>    Request.Query[<span style="color:#e6db74">&#34;IMDBMin&#34;</span>];</span></span></code></pre></div><p>But the returned value would be a string, so we&rsquo;d need to parse it:</p>
<div class="wrap-code highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-csharp" data-lang="csharp"><span style="display:flex;"><span>    IMDBMin = <span style="color:#66d9ef">double</span>.Parse(Request.Query[<span style="color:#e6db74">&#34;IMDBMin&#34;</span>]);</span></span></code></pre></div><p>If the query was <code>null</code>, then this would evaluate to <code>NaN</code>, which we wouldn&rsquo;t want to set our <code>&lt;input&gt;</code> to&hellip;</p>
<p>Instead, we&rsquo;ll look at some options built into the PageModel.</p>
<h2 id="parameter-binding">Parameter Binding</h2>
<p>The first of these options is <a href="https://docs.microsoft.com/en-us/aspnet/web-api/overview/formats-and-model-binding/parameter-binding-in-aspnet-web-api" target="_blank"><em>Parameter Binding</em></a>
.  In this approach, we define parameters to our <code>OnGet()</code> method to be parsed out of the request automatically, i.e.:</p>
<div class="wrap-code highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-csharp" data-lang="csharp"><span style="display:flex;"><span>    <span style="color:#75715e">/// &lt;summary&gt;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">/// Gets the search results for display on the page</span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">/// &lt;/summary&gt;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">void</span> OnGet(<span style="color:#66d9ef">string</span> SearchTerms, <span style="color:#66d9ef">string</span>[] MPAARatings, <span style="color:#66d9ef">string</span>[] Genres, <span style="color:#66d9ef">double?</span> IMDBMin, <span style="color:#66d9ef">double?</span> IMDBMax) {
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">this</span>.SearchTerms = SearchTerms;
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">this</span>.MPAARatings = MPAARatings;
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">this</span>.Genres = Genres;
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">this</span>.IMDBMin = IMDBMin;
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">this</span>.IMDBMax = IMDBMax;
</span></span><span style="display:flex;"><span>        Movies = MovieDatabase.Search(SearchTerms);
</span></span><span style="display:flex;"><span>        Movies = MovieDatabase.FilterByMPAARating(Movies, MPAARatings);
</span></span><span style="display:flex;"><span>        Movies = MovieDatabase.FilterByGenre(Movies, Genres);
</span></span><span style="display:flex;"><span>        Movies = MovieDatabase.FilterByIMDBRating(Movies, IMDBMin, IMDBMax);
</span></span><span style="display:flex;"><span>    }</span></span></code></pre></div><p>The benefit of this approach is that as long as C# knows a conversion into the type we specify, the conversion is done automatically.  Note that the parameter name matches the <code>name</code> property of the corresponding <code>&lt;input&gt;</code> - this must be the case for the Razor Page to bind the parameter to the corresponding input value.</p>
<p>Note that we still need to assign these parameter values to the corresponding properties of our PageModel.  If we don&rsquo;t, then those properties will all be <code>null</code>, and the <code>&lt;inputs&gt;</code> rendered on our page will always be blank.</p>
<h2 id="model-binding">Model Binding</h2>
<p>A second option is to use <a href="https://docs.microsoft.com/en-us/aspnet/core/mvc/models/model-binding?view=aspnetcore-3.1" target="_blank"><em>Model Binding</em></a>
.  Model binding also automatically converts incoming form data, but in this case it binds directly to the properties of our PageModel.  We indicate this form of binding with a <code>[BindProperty]</code> attribute, i.e.:</p>
<div class="wrap-code highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-csharp" data-lang="csharp"><span style="display:flex;"><span><span style="color:#66d9ef">public</span> <span style="color:#66d9ef">class</span> <span style="color:#a6e22e">IndexModel</span> : PageModel {
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">
</span></span></span><span style="display:flex;"><span><span style="color:#a6e22e">    [BindProperty(SupportsGet=true)]</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">string</span> SearchTerms {<span style="color:#66d9ef">get</span>; <span style="color:#66d9ef">set</span>;}
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">
</span></span></span><span style="display:flex;"><span><span style="color:#a6e22e">    [BindProperty(SupportsGet=true)]</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">string</span>[] MPAARatings {<span style="color:#66d9ef">get</span>; <span style="color:#66d9ef">set</span>;}
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">
</span></span></span><span style="display:flex;"><span><span style="color:#a6e22e">    [BindProperty(SupportsGet=true)]</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">string</span>[] Genres {<span style="color:#66d9ef">get</span>; <span style="color:#66d9ef">set</span>;}
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">
</span></span></span><span style="display:flex;"><span><span style="color:#a6e22e">    [BindProperty(SupportsGet=true)]</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">double?</span> IMDBMin {<span style="color:#66d9ef">get</span>; <span style="color:#66d9ef">set</span>;}
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">
</span></span></span><span style="display:flex;"><span><span style="color:#a6e22e">    [BindProperty(SupportsGet=true)]</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">double?</span> IMDBMax {<span style="color:#66d9ef">get</span>; <span style="color:#66d9ef">set</span>;}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">/// &lt;summary&gt;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">/// Gets the search results for display on the page</span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">/// &lt;/summary&gt;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">void</span> OnGet() {
</span></span><span style="display:flex;"><span>        Movies = MovieDatabase.Search(SearchTerms);
</span></span><span style="display:flex;"><span>        Movies = MovieDatabase.FilterByMPAARating(Movies, MPAARatings);
</span></span><span style="display:flex;"><span>        Movies = MovieDatabase.FilterByGenre(Movies, Genres);
</span></span><span style="display:flex;"><span>        Movies = MovieDatabase.FilterByIMDBRating(Movies, IMDBMin, IMDBMax);
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>}</span></span></code></pre></div><p>Note that with this approach, the incoming data is directly bound to the properties, so we don&rsquo;t need to do any special assignments within our <code>OnGet()</code> method.  Also, note that we have to use <code>SupportsGet=true</code> in order for this binding to occur on GET requests (by default, model binding only happens with POST requests).</p>

  
  
<div class="box notices cstyle note">
  <div class="box-label"><i class="fa-fw fas fa-exclamation-circle"></i> Note</div>
  <div class="box-content">

<p>You only need to do <em>one</em> binding approach per property in a PageModel.  I.e. you can just use the property decorator:</p>
<div class="wrap-code highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-csharp" data-lang="csharp"><span style="display:flex;"><span><span style="color:#66d9ef">public</span> <span style="color:#66d9ef">class</span> <span style="color:#a6e22e">SomePageModel</span> : PageModel
</span></span><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">    [BindProperty(SupportsGet=true)]</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">float</span> SomeProperty { <span style="color:#66d9ef">get</span>; <span style="color:#66d9ef">set</span>; }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">void</span> OnGet() {
</span></span><span style="display:flex;"><span>        DoSomething(SomeProperty);
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>}</span></span></code></pre></div><p><em>or</em> you might use parameter binding:</p>
<div class="wrap-code highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-csharp" data-lang="csharp"><span style="display:flex;"><span><span style="color:#66d9ef">public</span> <span style="color:#66d9ef">class</span> <span style="color:#a6e22e">SomePageModel</span> : PageModel
</span></span><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">void</span> OnGet(<span style="color:#66d9ef">float</span> SomeProperty) {
</span></span><span style="display:flex;"><span>        DoSomething(SomeProperty);
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>}</span></span></code></pre></div><p><em>or</em> you can parse it from the request:</p>
<div class="wrap-code highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-csharp" data-lang="csharp"><span style="display:flex;"><span><span style="color:#66d9ef">public</span> <span style="color:#66d9ef">class</span> <span style="color:#a6e22e">SomePageModel</span> : PageModel
</span></span><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">void</span> OnGet() {
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">var</span> someProperty = <span style="color:#66d9ef">float</span>.Parse(Request.Query[<span style="color:#e6db74">&#34;SomeProperty&#34;</span>]);
</span></span><span style="display:flex;"><span>        DoSomething(someProperty);
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>}</span></span></code></pre></div><p>These are all <em>different means</em> of accessing the <em>same data</em> from the incoming request.</p>
</div>
</div>
<p>Now all we need to do is implement the actual filter.</p>
<h3 id="implementing-the-imdb-rating-filter">Implementing the IMDB Rating Filter</h3>
<p>We&rsquo;ll define the new filter in our <code>MovieDatabase</code> class as another static method:</p>
<div class="wrap-code highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-csharp" data-lang="csharp"><span style="display:flex;"><span>    <span style="color:#75715e">/// &lt;summary&gt;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">/// Filters the provided collection of movies</span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">/// to those with IMDB ratings falling within</span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">/// the specified range</span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">/// &lt;/summary&gt;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">/// &lt;param name=&#34;movies&#34;&gt;The collection of movies to filter&lt;/param&gt;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">/// &lt;param name=&#34;min&#34;&gt;The minimum range value&lt;/param&gt;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">/// &lt;param name=&#34;max&#34;&gt;The maximum range value&lt;/param&gt;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">/// &lt;returns&gt;The filtered movie collection&lt;/returns&gt;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">static</span> IEnumerable&lt;Movie&gt; FilterByIMDBRating(IEnumerable&lt;Movie&gt; movies, <span style="color:#66d9ef">double?</span> min, <span style="color:#66d9ef">double?</span> max)
</span></span><span style="display:flex;"><span>    {
</span></span><span style="display:flex;"><span>        <span style="color:#75715e">// TODO: Filter movies</span>
</span></span><span style="display:flex;"><span>    }</span></span></code></pre></div><p>Notice that here too we use the nullable double value.  So our first step is probably to do a <code>null</code> check:</p>
<div class="wrap-code highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-csharp" data-lang="csharp"><span style="display:flex;"><span>    <span style="color:#66d9ef">if</span> (min == <span style="color:#66d9ef">null</span> &amp;&amp; max == <span style="color:#66d9ef">null</span>) <span style="color:#66d9ef">return</span> movies;</span></span></code></pre></div><p>But what if only one is null?  Should we filter for that part of the range?  It wouldn&rsquo;t be hard to do:</p>
<div class="wrap-code highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-csharp" data-lang="csharp"><span style="display:flex;"><span>    <span style="color:#66d9ef">var</span> results = <span style="color:#66d9ef">new</span> List&lt;Movie&gt;();
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">// only a maximum specified</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">if</span>(min == <span style="color:#66d9ef">null</span>)
</span></span><span style="display:flex;"><span>    {
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">foreach</span>(Movie movie <span style="color:#66d9ef">in</span> movies)
</span></span><span style="display:flex;"><span>        {
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">if</span> (movie.IMDBRating &lt;= max) results.Add(movie);
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">return</span> results;
</span></span><span style="display:flex;"><span>    }</span></span></code></pre></div><p>And the minimum would mirror that:</p>
<div class="wrap-code highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-csharp" data-lang="csharp"><span style="display:flex;"><span>    <span style="color:#75715e">// only a minimum specified</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">if</span>(max == <span style="color:#66d9ef">null</span>)
</span></span><span style="display:flex;"><span>    {
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">foreach</span>(Movie movie <span style="color:#66d9ef">in</span> movies)
</span></span><span style="display:flex;"><span>        {
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">if</span> (movie.IMDBRating &gt;= min) results.Add(movie);
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">return</span> results;
</span></span><span style="display:flex;"><span>    }</span></span></code></pre></div><p>Finally, we could handle the case where we have both a min and max value to our range:</p>
<div class="wrap-code highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-csharp" data-lang="csharp"><span style="display:flex;"><span>    <span style="color:#75715e">// Both minimum and maximum specified</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">foreach</span>(Movie movie <span style="color:#66d9ef">in</span> movies)
</span></span><span style="display:flex;"><span>    {
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">if</span>(movie.IMDBRating &gt;= min &amp;&amp; movie.IMDBRating &lt;= max)
</span></span><span style="display:flex;"><span>        {
</span></span><span style="display:flex;"><span>            results.Add(movie);
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">return</span> results;</span></span></code></pre></div><p>Notice too, that in each of these cases we&rsquo;re treating the range as <em>inclusive</em> (including the specified minimum and maximum).  This is the behavior most casual internet users will expect.  If the database and user expectations are different for your audience, you&rsquo;d want your code to match that expectation.</p>
<p>Now we can filter by IMDB rating:</p>
<p>
<a href="#image-06b97ea3234578a6ece6e72bec71b33a" class="lightbox-link">
<img src="https://ksu-cs-textbooks.github.io/cis400/images/6.8.6.png" alt="Filtering By IMDB" style="height: auto; width: auto;" loading="lazy">
</a>
<a href="javascript:history.back();" class="lightbox" id="image-06b97ea3234578a6ece6e72bec71b33a">
<img src="https://ksu-cs-textbooks.github.io/cis400/images/6.8.6.png" alt="Filtering By IMDB" class="lightbox-image" loading="lazy">
</a></p>
<h2 id="finishing-up">Finishing Up</h2>
<p>Since we&rsquo;re displaying the Rotten Tomatoes rating, we should probably also have a filter for it.  This will work almost exactly like the IMDB rating - but with the range from 0 to 100.  I&rsquo;ll leave this as an exercise for the reader.</p>

            <footer class="footline">

            </footer>
          </article>

    
    
          <article class="default">
            <header class="headline">
            </header>
<h1 id="numerical-filters">Numerical Filters</h1>

<p>Let&rsquo;s tackle one of the critics ratings next.  While we could create categories and use checkboxes, this doesn&rsquo;t capture the incremental values (i.e. 4.3), and it would be a <em>lot</em> of checkboxes for Rotten Tomatoes ratings!  Instead, we&rsquo;ll use a <em>numerical filter</em>, which limits our possible results to a range - between a minimum and maximum value.</p>
<p>Moreover, let&rsquo;s clean up our Index page, as it is getting difficult to determine what filter(s) go together, and and are adding more.</p>
<h2 id="refactoring-the-index-page">Refactoring the Index Page</h2>
<p>Let&rsquo;s move the filters to a column on the left, leave the search bar above, and show our results on the right.  This will require refactoring our <em>Index.cshtml</em> file:</p>
<div class="wrap-code highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-csharp" data-lang="csharp"><span style="display:flex;"><span>    &lt;form id=<span style="color:#e6db74">&#34;movie-database&#34;</span>&gt;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        &lt;div id=<span style="color:#e6db74">&#34;search&#34;</span>&gt;
</span></span><span style="display:flex;"><span>            &lt;input type=<span style="color:#e6db74">&#34;text&#34;</span> name=<span style="color:#e6db74">&#34;SearchTerms&#34;</span> <span style="color:#66d9ef">value</span>=<span style="color:#e6db74">&#34;@Model.SearchTerms&#34;</span> /&gt;
</span></span><span style="display:flex;"><span>            &lt;input type=<span style="color:#e6db74">&#34;submit&#34;</span> <span style="color:#66d9ef">value</span>=<span style="color:#e6db74">&#34;Search&#34;</span>&gt;
</span></span><span style="display:flex;"><span>        &lt;/div&gt;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        &lt;div id=<span style="color:#e6db74">&#34;filters&#34;</span>&gt;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>            &lt;h4&gt;MPAA Rating&lt;/h4&gt;
</span></span><span style="display:flex;"><span>            @foreach (<span style="color:#66d9ef">string</span> rating <span style="color:#66d9ef">in</span> MovieDatabase.MPAARatings)
</span></span><span style="display:flex;"><span>            {
</span></span><span style="display:flex;"><span>                &lt;label&gt;
</span></span><span style="display:flex;"><span>                    &lt;input type=<span style="color:#e6db74">&#34;checkbox&#34;</span> name=<span style="color:#e6db74">&#34;MPAARatings&#34;</span> <span style="color:#66d9ef">value</span>=<span style="color:#e6db74">&#34;@rating&#34;</span> <span style="color:#66d9ef">checked</span>=<span style="color:#e6db74">&#34;@Model.MPAARatings.Contains(rating)&#34;</span> /&gt;
</span></span><span style="display:flex;"><span>                    @rating
</span></span><span style="display:flex;"><span>                &lt;/label&gt;
</span></span><span style="display:flex;"><span>            }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>            &lt;h4&gt;Genre&lt;/h4&gt;
</span></span><span style="display:flex;"><span>            @foreach (<span style="color:#66d9ef">string</span> genre <span style="color:#66d9ef">in</span> MovieDatabase.Genres)
</span></span><span style="display:flex;"><span>            {
</span></span><span style="display:flex;"><span>                &lt;label&gt;
</span></span><span style="display:flex;"><span>                    &lt;input type=<span style="color:#e6db74">&#34;checkbox&#34;</span> name=<span style="color:#e6db74">&#34;Genres&#34;</span> <span style="color:#66d9ef">value</span>=<span style="color:#e6db74">&#34;@genre&#34;</span> /&gt;
</span></span><span style="display:flex;"><span>                    @genre
</span></span><span style="display:flex;"><span>                &lt;/label&gt;
</span></span><span style="display:flex;"><span>            }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>            &lt;h4&gt;IMDB Rating&lt;/h4&gt;
</span></span><span style="display:flex;"><span>            &lt;div&gt;
</span></span><span style="display:flex;"><span>                Between
</span></span><span style="display:flex;"><span>                &lt;input name=<span style="color:#e6db74">&#34;IMDBMin&#34;</span> type=<span style="color:#e6db74">&#34;number&#34;</span> min=<span style="color:#e6db74">&#34;0&#34;</span> max=<span style="color:#e6db74">&#34;10&#34;</span> step=<span style="color:#e6db74">&#34;0.1&#34;</span> placeholder=<span style="color:#e6db74">&#34;min&#34;</span>/&gt;
</span></span><span style="display:flex;"><span>                and
</span></span><span style="display:flex;"><span>                &lt;input name=<span style="color:#e6db74">&#34;IMDBMax&#34;</span> type=<span style="color:#e6db74">&#34;number&#34;</span> min=<span style="color:#e6db74">&#34;0&#34;</span> max=<span style="color:#e6db74">&#34;10&#34;</span> step=<span style="color:#e6db74">&#34;0.1&#34;</span> placeholder=<span style="color:#e6db74">&#34;max&#34;</span>/&gt;
</span></span><span style="display:flex;"><span>            &lt;/div&gt;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        &lt;/div&gt;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        &lt;div id=<span style="color:#e6db74">&#34;results&#34;</span>&gt;
</span></span><span style="display:flex;"><span>            &lt;h1&gt;Movie Results&lt;/h1&gt;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>            &lt;ul class=<span style="color:#e6db74">&#34;movie-list&#34;</span>&gt;
</span></span><span style="display:flex;"><span>                @foreach (Movie movie <span style="color:#66d9ef">in</span> @Model.Movies)
</span></span><span style="display:flex;"><span>                {
</span></span><span style="display:flex;"><span>                    &lt;li&gt;
</span></span><span style="display:flex;"><span>                        &lt;div class=<span style="color:#e6db74">&#34;details&#34;</span>&gt;
</span></span><span style="display:flex;"><span>                            &lt;h3 class=<span style="color:#e6db74">&#34;title&#34;</span>&gt;@movie.Title&lt;/h3&gt;
</span></span><span style="display:flex;"><span>                            &lt;div class=<span style="color:#e6db74">&#34;mpaa&#34;</span>&gt;@movie.MPAARating&lt;/div&gt;
</span></span><span style="display:flex;"><span>                            &lt;div class=<span style="color:#e6db74">&#34;genre&#34;</span>&gt;@movie.MajorGenre&lt;/div&gt;
</span></span><span style="display:flex;"><span>                        &lt;/div&gt;
</span></span><span style="display:flex;"><span>                        &lt;div class=<span style="color:#e6db74">&#34;ratings&#34;</span>&gt;
</span></span><span style="display:flex;"><span>                            @if (movie.IMDBRating != <span style="color:#66d9ef">null</span>)
</span></span><span style="display:flex;"><span>                            {
</span></span><span style="display:flex;"><span>                                &lt;div class=<span style="color:#e6db74">&#34;imdb&#34;</span>&gt;
</span></span><span style="display:flex;"><span>                                    @movie.IMDBRating
</span></span><span style="display:flex;"><span>                                &lt;/div&gt;
</span></span><span style="display:flex;"><span>                            }
</span></span><span style="display:flex;"><span>                            @if (movie.RottenTomatoesRating != <span style="color:#66d9ef">null</span>)
</span></span><span style="display:flex;"><span>                            {
</span></span><span style="display:flex;"><span>                                &lt;div class=<span style="color:#e6db74">&#34;rotten-tomatoes&#34;</span>&gt;
</span></span><span style="display:flex;"><span>                                    @movie.RottenTomatoesRating
</span></span><span style="display:flex;"><span>                                &lt;/div&gt;
</span></span><span style="display:flex;"><span>                            }
</span></span><span style="display:flex;"><span>                        &lt;/div&gt;
</span></span><span style="display:flex;"><span>                    &lt;/li&gt;
</span></span><span style="display:flex;"><span>                }
</span></span><span style="display:flex;"><span>            &lt;/ul&gt;
</span></span><span style="display:flex;"><span>        &lt;/div&gt;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    &lt;/form&gt;</span></span></code></pre></div><p>Most of this is simply moving elements around the page, but note that we are using inputs of <code>type=number</code> to represent our range of IMDB values.  We can specify a minimum and maximum for this range, as well as an allowable increment.  Also, we use the <code>placeholder</code> attribute to put text into the <code>input</code> until a value is added.</p>
<h2 id="adding-more-styles">Adding More Styles</h2>
<p>Now we&rsquo;ll need to add some rules to our <em>wwwroot/css/styles.css</em>.  First, we&rsquo;ll use a <code>grid</code> for the layout of the form:</p>
<div class="wrap-code highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-css" data-lang="css"><span style="display:flex;"><span><span style="color:#f92672">form</span>#movie-database {
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">display</span>: <span style="color:#66d9ef">grid</span>;
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">grid-template-columns</span>: <span style="color:#ae81ff">1</span>fr <span style="color:#ae81ff">3</span>fr;
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">grid-template-rows</span>: <span style="color:#66d9ef">auto</span> <span style="color:#66d9ef">auto</span>;
</span></span><span style="display:flex;"><span>}</span></span></code></pre></div><p>The right column will be three times as big as the left.</p>
<p>We can make our search bar span both columns with <code>grid-column-start</code> and <code>grid-column-end</code>:</p>
<div class="wrap-code highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-css" data-lang="css"><span style="display:flex;"><span>#search {
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">grid-column-start</span>: <span style="color:#ae81ff">1</span>;
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">grid-column-end</span>: <span style="color:#ae81ff">3</span>;
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">text-align</span>: <span style="color:#66d9ef">center</span>;
</span></span><span style="display:flex;"><span>}</span></span></code></pre></div><p>Notice too that for CSS, we start counting at 1, not 0.  The filters and the results will fall in the next row automatically, each taking up their own respective grid cell.  You can read more about the grid layout in <a href="https://css-tricks.com/snippets/css/complete-guide-grid/" target="_blank">A Complete Guide to Grid</a>
.</p>
<p>Let&rsquo;s go ahead and use flexbox to lay out our filters in a column:</p>
<div class="wrap-code highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-css" data-lang="css"><span style="display:flex;"><span>#filters {
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">display</span>: <span style="color:#66d9ef">flex</span>;
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">flex-direction</span>: <span style="color:#66d9ef">column</span>;
</span></span><span style="display:flex;"><span>}</span></span></code></pre></div><p>And make our number inputs bigger:</p>
<div class="wrap-code highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-css" data-lang="css"><span style="display:flex;"><span>#filters <span style="color:#f92672">input</span><span style="color:#f92672">[</span><span style="color:#f92672">type</span><span style="color:#f92672">=</span><span style="color:#f92672">number</span><span style="color:#f92672">]</span> {
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">width</span>: <span style="color:#ae81ff">4</span><span style="color:#66d9ef">rem</span>;
</span></span><span style="display:flex;"><span>}</span></span></code></pre></div><p>Notice the use of square brackets in our CSS Selector to only apply to inputs with type number.</p>
<p>Also, let&rsquo;s add a margin above and remove most of the margin below our <code>&lt;h4&gt;</code> elements:</p>
<div class="wrap-code highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-css" data-lang="css"><span style="display:flex;"><span>#filters <span style="color:#f92672">h4</span> {
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">margin-bottom</span>: <span style="color:#ae81ff">0.2</span><span style="color:#66d9ef">rem</span>;
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">margin-top</span>: <span style="color:#ae81ff">2</span><span style="color:#66d9ef">rem</span>;
</span></span><span style="display:flex;"><span>}</span></span></code></pre></div><p>The resulting page looks much cleaner:</p>
<p>
<a href="#image-838d23be39073f7fb73b80805fe833ef" class="lightbox-link">
<img src="https://ksu-cs-textbooks.github.io/cis400/images/6.8.5.png" alt="The Styled Page" style="height: auto; width: auto;" loading="lazy">
</a>
<a href="javascript:history.back();" class="lightbox" id="image-838d23be39073f7fb73b80805fe833ef">
<img src="https://ksu-cs-textbooks.github.io/cis400/images/6.8.5.png" alt="The Styled Page" class="lightbox-image" loading="lazy">
</a></p>
<h2 id="capturing-the-filter-values">Capturing the Filter Values</h2>
<p>Now we need to get the filter values from our GET request query string.  We could do this like we&rsquo;ve been doing before, with:</p>
<div class="wrap-code highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-csharp" data-lang="csharp"><span style="display:flex;"><span>    Request.Query[<span style="color:#e6db74">&#34;IMDBMin&#34;</span>];</span></span></code></pre></div><p>But the returned value would be a string, so we&rsquo;d need to parse it:</p>
<div class="wrap-code highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-csharp" data-lang="csharp"><span style="display:flex;"><span>    IMDBMin = <span style="color:#66d9ef">double</span>.Parse(Request.Query[<span style="color:#e6db74">&#34;IMDBMin&#34;</span>]);</span></span></code></pre></div><p>If the query was <code>null</code>, then this would evaluate to <code>NaN</code>, which we wouldn&rsquo;t want to set our <code>&lt;input&gt;</code> to&hellip;</p>
<p>Instead, we&rsquo;ll look at some options built into the PageModel.</p>
<h2 id="parameter-binding">Parameter Binding</h2>
<p>The first of these options is <a href="https://docs.microsoft.com/en-us/aspnet/web-api/overview/formats-and-model-binding/parameter-binding-in-aspnet-web-api" target="_blank"><em>Parameter Binding</em></a>
.  In this approach, we define parameters to our <code>OnGet()</code> method to be parsed out of the request automatically, i.e.:</p>
<div class="wrap-code highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-csharp" data-lang="csharp"><span style="display:flex;"><span>    <span style="color:#75715e">/// &lt;summary&gt;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">/// Gets the search results for display on the page</span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">/// &lt;/summary&gt;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">void</span> OnGet(<span style="color:#66d9ef">string</span> SearchTerms, <span style="color:#66d9ef">string</span>[] MPAARatings, <span style="color:#66d9ef">string</span>[] Genres, <span style="color:#66d9ef">double?</span> IMDBMin, <span style="color:#66d9ef">double?</span> IMDBMax) {
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">this</span>.SearchTerms = SearchTerms;
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">this</span>.MPAARatings = MPAARatings;
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">this</span>.Genres = Genres;
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">this</span>.IMDBMin = IMDBMin;
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">this</span>.IMDBMax = IMDBMax;
</span></span><span style="display:flex;"><span>        Movies = MovieDatabase.Search(SearchTerms);
</span></span><span style="display:flex;"><span>        Movies = MovieDatabase.FilterByMPAARating(Movies, MPAARatings);
</span></span><span style="display:flex;"><span>        Movies = MovieDatabase.FilterByGenre(Movies, Genres);
</span></span><span style="display:flex;"><span>        Movies = MovieDatabase.FilterByIMDBRating(Movies, IMDBMin, IMDBMax);
</span></span><span style="display:flex;"><span>    }</span></span></code></pre></div><p>The benefit of this approach is that as long as C# knows a conversion into the type we specify, the conversion is done automatically.  Note that the parameter name matches the <code>name</code> property of the corresponding <code>&lt;input&gt;</code> - this must be the case for the Razor Page to bind the parameter to the corresponding input value.</p>
<p>Note that we still need to assign these parameter values to the corresponding properties of our PageModel.  If we don&rsquo;t, then those properties will all be <code>null</code>, and the <code>&lt;inputs&gt;</code> rendered on our page will always be blank.</p>
<h2 id="model-binding">Model Binding</h2>
<p>A second option is to use <a href="https://docs.microsoft.com/en-us/aspnet/core/mvc/models/model-binding?view=aspnetcore-3.1" target="_blank"><em>Model Binding</em></a>
.  Model binding also automatically converts incoming form data, but in this case it binds directly to the properties of our PageModel.  We indicate this form of binding with a <code>[BindProperty]</code> attribute, i.e.:</p>
<div class="wrap-code highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-csharp" data-lang="csharp"><span style="display:flex;"><span><span style="color:#66d9ef">public</span> <span style="color:#66d9ef">class</span> <span style="color:#a6e22e">IndexModel</span> : PageModel {
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">
</span></span></span><span style="display:flex;"><span><span style="color:#a6e22e">    [BindProperty(SupportsGet=true)]</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">string</span> SearchTerms {<span style="color:#66d9ef">get</span>; <span style="color:#66d9ef">set</span>;}
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">
</span></span></span><span style="display:flex;"><span><span style="color:#a6e22e">    [BindProperty(SupportsGet=true)]</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">string</span>[] MPAARatings {<span style="color:#66d9ef">get</span>; <span style="color:#66d9ef">set</span>;}
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">
</span></span></span><span style="display:flex;"><span><span style="color:#a6e22e">    [BindProperty(SupportsGet=true)]</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">string</span>[] Genres {<span style="color:#66d9ef">get</span>; <span style="color:#66d9ef">set</span>;}
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">
</span></span></span><span style="display:flex;"><span><span style="color:#a6e22e">    [BindProperty(SupportsGet=true)]</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">double?</span> IMDBMin {<span style="color:#66d9ef">get</span>; <span style="color:#66d9ef">set</span>;}
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">
</span></span></span><span style="display:flex;"><span><span style="color:#a6e22e">    [BindProperty(SupportsGet=true)]</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">double?</span> IMDBMax {<span style="color:#66d9ef">get</span>; <span style="color:#66d9ef">set</span>;}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">/// &lt;summary&gt;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">/// Gets the search results for display on the page</span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">/// &lt;/summary&gt;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">void</span> OnGet() {
</span></span><span style="display:flex;"><span>        Movies = MovieDatabase.Search(SearchTerms);
</span></span><span style="display:flex;"><span>        Movies = MovieDatabase.FilterByMPAARating(Movies, MPAARatings);
</span></span><span style="display:flex;"><span>        Movies = MovieDatabase.FilterByGenre(Movies, Genres);
</span></span><span style="display:flex;"><span>        Movies = MovieDatabase.FilterByIMDBRating(Movies, IMDBMin, IMDBMax);
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>}</span></span></code></pre></div><p>Note that with this approach, the incoming data is directly bound to the properties, so we don&rsquo;t need to do any special assignments within our <code>OnGet()</code> method.  Also, note that we have to use <code>SupportsGet=true</code> in order for this binding to occur on GET requests (by default, model binding only happens with POST requests).</p>

  
  
<div class="box notices cstyle note">
  <div class="box-label"><i class="fa-fw fas fa-exclamation-circle"></i> Note</div>
  <div class="box-content">

<p>You only need to do <em>one</em> binding approach per property in a PageModel.  I.e. you can just use the property decorator:</p>
<div class="wrap-code highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-csharp" data-lang="csharp"><span style="display:flex;"><span><span style="color:#66d9ef">public</span> <span style="color:#66d9ef">class</span> <span style="color:#a6e22e">SomePageModel</span> : PageModel
</span></span><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">    [BindProperty(SupportsGet=true)]</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">float</span> SomeProperty { <span style="color:#66d9ef">get</span>; <span style="color:#66d9ef">set</span>; }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">void</span> OnGet() {
</span></span><span style="display:flex;"><span>        DoSomething(SomeProperty);
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>}</span></span></code></pre></div><p><em>or</em> you might use parameter binding:</p>
<div class="wrap-code highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-csharp" data-lang="csharp"><span style="display:flex;"><span><span style="color:#66d9ef">public</span> <span style="color:#66d9ef">class</span> <span style="color:#a6e22e">SomePageModel</span> : PageModel
</span></span><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">void</span> OnGet(<span style="color:#66d9ef">float</span> SomeProperty) {
</span></span><span style="display:flex;"><span>        DoSomething(SomeProperty);
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>}</span></span></code></pre></div><p><em>or</em> you can parse it from the request:</p>
<div class="wrap-code highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-csharp" data-lang="csharp"><span style="display:flex;"><span><span style="color:#66d9ef">public</span> <span style="color:#66d9ef">class</span> <span style="color:#a6e22e">SomePageModel</span> : PageModel
</span></span><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">void</span> OnGet() {
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">var</span> someProperty = <span style="color:#66d9ef">float</span>.Parse(Request.Query[<span style="color:#e6db74">&#34;SomeProperty&#34;</span>]);
</span></span><span style="display:flex;"><span>        DoSomething(someProperty);
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>}</span></span></code></pre></div><p>These are all <em>different means</em> of accessing the <em>same data</em> from the incoming request.</p>
</div>
</div>
<p>Now all we need to do is implement the actual filter.</p>
<h3 id="implementing-the-imdb-rating-filter">Implementing the IMDB Rating Filter</h3>
<p>We&rsquo;ll define the new filter in our <code>MovieDatabase</code> class as another static method:</p>
<div class="wrap-code highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-csharp" data-lang="csharp"><span style="display:flex;"><span>    <span style="color:#75715e">/// &lt;summary&gt;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">/// Filters the provided collection of movies</span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">/// to those with IMDB ratings falling within</span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">/// the specified range</span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">/// &lt;/summary&gt;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">/// &lt;param name=&#34;movies&#34;&gt;The collection of movies to filter&lt;/param&gt;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">/// &lt;param name=&#34;min&#34;&gt;The minimum range value&lt;/param&gt;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">/// &lt;param name=&#34;max&#34;&gt;The maximum range value&lt;/param&gt;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">/// &lt;returns&gt;The filtered movie collection&lt;/returns&gt;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">static</span> IEnumerable&lt;Movie&gt; FilterByIMDBRating(IEnumerable&lt;Movie&gt; movies, <span style="color:#66d9ef">double?</span> min, <span style="color:#66d9ef">double?</span> max)
</span></span><span style="display:flex;"><span>    {
</span></span><span style="display:flex;"><span>        <span style="color:#75715e">// TODO: Filter movies</span>
</span></span><span style="display:flex;"><span>    }</span></span></code></pre></div><p>Notice that here too we use the nullable double value.  So our first step is probably to do a <code>null</code> check:</p>
<div class="wrap-code highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-csharp" data-lang="csharp"><span style="display:flex;"><span>    <span style="color:#66d9ef">if</span> (min == <span style="color:#66d9ef">null</span> &amp;&amp; max == <span style="color:#66d9ef">null</span>) <span style="color:#66d9ef">return</span> movies;</span></span></code></pre></div><p>But what if only one is null?  Should we filter for that part of the range?  It wouldn&rsquo;t be hard to do:</p>
<div class="wrap-code highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-csharp" data-lang="csharp"><span style="display:flex;"><span>    <span style="color:#66d9ef">var</span> results = <span style="color:#66d9ef">new</span> List&lt;Movie&gt;();
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">// only a maximum specified</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">if</span>(min == <span style="color:#66d9ef">null</span>)
</span></span><span style="display:flex;"><span>    {
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">foreach</span>(Movie movie <span style="color:#66d9ef">in</span> movies)
</span></span><span style="display:flex;"><span>        {
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">if</span> (movie.IMDBRating &lt;= max) results.Add(movie);
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">return</span> results;
</span></span><span style="display:flex;"><span>    }</span></span></code></pre></div><p>And the minimum would mirror that:</p>
<div class="wrap-code highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-csharp" data-lang="csharp"><span style="display:flex;"><span>    <span style="color:#75715e">// only a minimum specified</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">if</span>(max == <span style="color:#66d9ef">null</span>)
</span></span><span style="display:flex;"><span>    {
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">foreach</span>(Movie movie <span style="color:#66d9ef">in</span> movies)
</span></span><span style="display:flex;"><span>        {
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">if</span> (movie.IMDBRating &gt;= min) results.Add(movie);
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">return</span> results;
</span></span><span style="display:flex;"><span>    }</span></span></code></pre></div><p>Finally, we could handle the case where we have both a min and max value to our range:</p>
<div class="wrap-code highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-csharp" data-lang="csharp"><span style="display:flex;"><span>    <span style="color:#75715e">// Both minimum and maximum specified</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">foreach</span>(Movie movie <span style="color:#66d9ef">in</span> movies)
</span></span><span style="display:flex;"><span>    {
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">if</span>(movie.IMDBRating &gt;= min &amp;&amp; movie.IMDBRating &lt;= max)
</span></span><span style="display:flex;"><span>        {
</span></span><span style="display:flex;"><span>            results.Add(movie);
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">return</span> results;</span></span></code></pre></div><p>Notice too, that in each of these cases we&rsquo;re treating the range as <em>inclusive</em> (including the specified minimum and maximum).  This is the behavior most casual internet users will expect.  If the database and user expectations are different for your audience, you&rsquo;d want your code to match that expectation.</p>
<p>Now we can filter by IMDB rating:</p>
<p>
<a href="#image-f1a61e9307b60f953e371985f8270a07" class="lightbox-link">
<img src="https://ksu-cs-textbooks.github.io/cis400/images/6.8.6.png" alt="Filtering By IMDB" style="height: auto; width: auto;" loading="lazy">
</a>
<a href="javascript:history.back();" class="lightbox" id="image-f1a61e9307b60f953e371985f8270a07">
<img src="https://ksu-cs-textbooks.github.io/cis400/images/6.8.6.png" alt="Filtering By IMDB" class="lightbox-image" loading="lazy">
</a></p>
<h2 id="finishing-up">Finishing Up</h2>
<p>Since we&rsquo;re displaying the Rotten Tomatoes rating, we should probably also have a filter for it.  This will work almost exactly like the IMDB rating - but with the range from 0 to 100.  I&rsquo;ll leave this as an exercise for the reader.</p>

            <footer class="footline">

            </footer>
          </article>

    
    
          <article class="default">
            <header class="headline">
            </header>
<h1 id="numerical-filters">Numerical Filters</h1>

<p>Let&rsquo;s tackle one of the critics ratings next.  While we could create categories and use checkboxes, this doesn&rsquo;t capture the incremental values (i.e. 4.3), and it would be a <em>lot</em> of checkboxes for Rotten Tomatoes ratings!  Instead, we&rsquo;ll use a <em>numerical filter</em>, which limits our possible results to a range - between a minimum and maximum value.</p>
<p>Moreover, let&rsquo;s clean up our Index page, as it is getting difficult to determine what filter(s) go together, and and are adding more.</p>
<h2 id="refactoring-the-index-page">Refactoring the Index Page</h2>
<p>Let&rsquo;s move the filters to a column on the left, leave the search bar above, and show our results on the right.  This will require refactoring our <em>Index.cshtml</em> file:</p>
<div class="wrap-code highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-csharp" data-lang="csharp"><span style="display:flex;"><span>    &lt;form id=<span style="color:#e6db74">&#34;movie-database&#34;</span>&gt;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        &lt;div id=<span style="color:#e6db74">&#34;search&#34;</span>&gt;
</span></span><span style="display:flex;"><span>            &lt;input type=<span style="color:#e6db74">&#34;text&#34;</span> name=<span style="color:#e6db74">&#34;SearchTerms&#34;</span> <span style="color:#66d9ef">value</span>=<span style="color:#e6db74">&#34;@Model.SearchTerms&#34;</span> /&gt;
</span></span><span style="display:flex;"><span>            &lt;input type=<span style="color:#e6db74">&#34;submit&#34;</span> <span style="color:#66d9ef">value</span>=<span style="color:#e6db74">&#34;Search&#34;</span>&gt;
</span></span><span style="display:flex;"><span>        &lt;/div&gt;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        &lt;div id=<span style="color:#e6db74">&#34;filters&#34;</span>&gt;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>            &lt;h4&gt;MPAA Rating&lt;/h4&gt;
</span></span><span style="display:flex;"><span>            @foreach (<span style="color:#66d9ef">string</span> rating <span style="color:#66d9ef">in</span> MovieDatabase.MPAARatings)
</span></span><span style="display:flex;"><span>            {
</span></span><span style="display:flex;"><span>                &lt;label&gt;
</span></span><span style="display:flex;"><span>                    &lt;input type=<span style="color:#e6db74">&#34;checkbox&#34;</span> name=<span style="color:#e6db74">&#34;MPAARatings&#34;</span> <span style="color:#66d9ef">value</span>=<span style="color:#e6db74">&#34;@rating&#34;</span> <span style="color:#66d9ef">checked</span>=<span style="color:#e6db74">&#34;@Model.MPAARatings.Contains(rating)&#34;</span> /&gt;
</span></span><span style="display:flex;"><span>                    @rating
</span></span><span style="display:flex;"><span>                &lt;/label&gt;
</span></span><span style="display:flex;"><span>            }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>            &lt;h4&gt;Genre&lt;/h4&gt;
</span></span><span style="display:flex;"><span>            @foreach (<span style="color:#66d9ef">string</span> genre <span style="color:#66d9ef">in</span> MovieDatabase.Genres)
</span></span><span style="display:flex;"><span>            {
</span></span><span style="display:flex;"><span>                &lt;label&gt;
</span></span><span style="display:flex;"><span>                    &lt;input type=<span style="color:#e6db74">&#34;checkbox&#34;</span> name=<span style="color:#e6db74">&#34;Genres&#34;</span> <span style="color:#66d9ef">value</span>=<span style="color:#e6db74">&#34;@genre&#34;</span> <span style="color:#66d9ef">checked</span>=<span style="color:#e6db74">&#34;@Model.Genres.Contains(genre)&#34;</span> /&gt;
</span></span><span style="display:flex;"><span>                    @genre
</span></span><span style="display:flex;"><span>                &lt;/label&gt;
</span></span><span style="display:flex;"><span>            }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>            &lt;h4&gt;IMDB Rating&lt;/h4&gt;
</span></span><span style="display:flex;"><span>            &lt;div&gt;
</span></span><span style="display:flex;"><span>                &lt;input name=<span style="color:#e6db74">&#34;IMDBMin&#34;</span> type=<span style="color:#e6db74">&#34;number&#34;</span> min=<span style="color:#e6db74">&#34;0&#34;</span> max=<span style="color:#e6db74">&#34;10&#34;</span> step=<span style="color:#e6db74">&#34;0.1&#34;</span> placeholder=<span style="color:#e6db74">&#34;min&#34;</span>/&gt;
</span></span><span style="display:flex;"><span>                to
</span></span><span style="display:flex;"><span>                &lt;input name=<span style="color:#e6db74">&#34;IMDBMax&#34;</span> type=<span style="color:#e6db74">&#34;number&#34;</span> min=<span style="color:#e6db74">&#34;0&#34;</span> max=<span style="color:#e6db74">&#34;10&#34;</span> step=<span style="color:#e6db74">&#34;0.1&#34;</span> placeholder=<span style="color:#e6db74">&#34;max&#34;</span>/&gt;
</span></span><span style="display:flex;"><span>            &lt;/div&gt;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        &lt;/div&gt;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        &lt;div id=<span style="color:#e6db74">&#34;results&#34;</span>&gt;
</span></span><span style="display:flex;"><span>            &lt;h1&gt;Movie Results&lt;/h1&gt;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>            &lt;ul class=<span style="color:#e6db74">&#34;movie-list&#34;</span>&gt;
</span></span><span style="display:flex;"><span>                @foreach (Movie movie <span style="color:#66d9ef">in</span> @Model.Movies)
</span></span><span style="display:flex;"><span>                {
</span></span><span style="display:flex;"><span>                    &lt;li&gt;
</span></span><span style="display:flex;"><span>                        &lt;div class=<span style="color:#e6db74">&#34;details&#34;</span>&gt;
</span></span><span style="display:flex;"><span>                            &lt;h3 class=<span style="color:#e6db74">&#34;title&#34;</span>&gt;@movie.Title&lt;/h3&gt;
</span></span><span style="display:flex;"><span>                            &lt;div class=<span style="color:#e6db74">&#34;mpaa&#34;</span>&gt;@movie.MPAARating&lt;/div&gt;
</span></span><span style="display:flex;"><span>                            &lt;div class=<span style="color:#e6db74">&#34;genre&#34;</span>&gt;@movie.MajorGenre&lt;/div&gt;
</span></span><span style="display:flex;"><span>                        &lt;/div&gt;
</span></span><span style="display:flex;"><span>                        &lt;div class=<span style="color:#e6db74">&#34;ratings&#34;</span>&gt;
</span></span><span style="display:flex;"><span>                            @if (movie.IMDBRating != <span style="color:#66d9ef">null</span>)
</span></span><span style="display:flex;"><span>                            {
</span></span><span style="display:flex;"><span>                                &lt;div class=<span style="color:#e6db74">&#34;imdb&#34;</span>&gt;
</span></span><span style="display:flex;"><span>                                    @movie.IMDBRating
</span></span><span style="display:flex;"><span>                                &lt;/div&gt;
</span></span><span style="display:flex;"><span>                            }
</span></span><span style="display:flex;"><span>                            @if (movie.RottenTomatoesRating != <span style="color:#66d9ef">null</span>)
</span></span><span style="display:flex;"><span>                            {
</span></span><span style="display:flex;"><span>                                &lt;div class=<span style="color:#e6db74">&#34;rotten-tomatoes&#34;</span>&gt;
</span></span><span style="display:flex;"><span>                                    @movie.RottenTomatoesRating
</span></span><span style="display:flex;"><span>                                &lt;/div&gt;
</span></span><span style="display:flex;"><span>                            }
</span></span><span style="display:flex;"><span>                        &lt;/div&gt;
</span></span><span style="display:flex;"><span>                    &lt;/li&gt;
</span></span><span style="display:flex;"><span>                }
</span></span><span style="display:flex;"><span>            &lt;/ul&gt;
</span></span><span style="display:flex;"><span>        &lt;/div&gt;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    &lt;/form&gt;</span></span></code></pre></div><p>Most of this is simply moving elements around the page, but note that we are using inputs of <code>type=number</code> to represent our range of IMDB values.  We can specify a minimum and maximum for this range, as well as an allowable increment.  Also, we use the <code>placeholder</code> attribute to put text into the <code>input</code> until a value is added.</p>
<h2 id="adding-more-styles">Adding More Styles</h2>
<p>Now we&rsquo;ll need to add some rules to our <em>wwwroot/css/styles.css</em>.  First, we&rsquo;ll use a <code>grid</code> for the layout of the form:</p>
<div class="wrap-code highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-css" data-lang="css"><span style="display:flex;"><span><span style="color:#f92672">form</span>#movie-database {
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">display</span>: <span style="color:#66d9ef">grid</span>;
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">grid-template-columns</span>: <span style="color:#ae81ff">1</span>fr <span style="color:#ae81ff">3</span>fr;
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">grid-template-rows</span>: <span style="color:#66d9ef">auto</span> <span style="color:#66d9ef">auto</span>;
</span></span><span style="display:flex;"><span>}</span></span></code></pre></div><p>The right column will be three times as big as the left.</p>
<p>We can make our search bar span both columns with <code>grid-column-start</code> and <code>grid-column-end</code>:</p>
<div class="wrap-code highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-css" data-lang="css"><span style="display:flex;"><span>#search {
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">grid-column-start</span>: <span style="color:#ae81ff">1</span>;
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">grid-column-end</span>: <span style="color:#ae81ff">3</span>;
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">text-align</span>: <span style="color:#66d9ef">center</span>;
</span></span><span style="display:flex;"><span>}</span></span></code></pre></div><p>Notice too that for CSS, we start counting at 1, not 0.  The filters and the results will fall in the next row automatically, each taking up their own respective grid cell.  You can read more about the grid layout in <a href="https://css-tricks.com/snippets/css/complete-guide-grid/" target="_blank">A Complete Guide to Grid</a>
.</p>
<p>Let&rsquo;s go ahead and use flexbox to lay out our filters in a column:</p>
<div class="wrap-code highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-css" data-lang="css"><span style="display:flex;"><span>#filters {
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">display</span>: <span style="color:#66d9ef">flex</span>;
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">flex-direction</span>: <span style="color:#66d9ef">column</span>;
</span></span><span style="display:flex;"><span>}</span></span></code></pre></div><p>And make our number inputs bigger:</p>
<div class="wrap-code highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-css" data-lang="css"><span style="display:flex;"><span>#filters <span style="color:#f92672">input</span><span style="color:#f92672">[</span><span style="color:#f92672">type</span><span style="color:#f92672">=</span><span style="color:#f92672">number</span><span style="color:#f92672">]</span> {
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">width</span>: <span style="color:#ae81ff">4</span><span style="color:#66d9ef">rem</span>;
</span></span><span style="display:flex;"><span>}</span></span></code></pre></div><p>Notice the use of square brackets in our CSS Selector to only apply to inputs with type number.</p>
<p>Also, let&rsquo;s add a margin above and remove most of the margin below our <code>&lt;h4&gt;</code> elements:</p>
<div class="wrap-code highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-css" data-lang="css"><span style="display:flex;"><span>#filters <span style="color:#f92672">h4</span> {
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">margin-bottom</span>: <span style="color:#ae81ff">0.2</span><span style="color:#66d9ef">rem</span>;
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">margin-top</span>: <span style="color:#ae81ff">2</span><span style="color:#66d9ef">rem</span>;
</span></span><span style="display:flex;"><span>}</span></span></code></pre></div><p>The resulting page looks much cleaner:</p>
<p>
<a href="#image-9c0e69fa3b472bf7da3026bf4971e914" class="lightbox-link">
<img src="https://ksu-cs-textbooks.github.io/cis400/images/6.8.5.png" alt="The Styled Page" style="height: auto; width: auto;" loading="lazy">
</a>
<a href="javascript:history.back();" class="lightbox" id="image-9c0e69fa3b472bf7da3026bf4971e914">
<img src="https://ksu-cs-textbooks.github.io/cis400/images/6.8.5.png" alt="The Styled Page" class="lightbox-image" loading="lazy">
</a></p>
<h2 id="capturing-the-filter-values">Capturing the Filter Values</h2>
<p>Now we need to get the filter values from our GET request query string.  We could do this like we&rsquo;ve been doing before, with:</p>
<div class="wrap-code highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-csharp" data-lang="csharp"><span style="display:flex;"><span>    Request.Query[<span style="color:#e6db74">&#34;IMDBMin&#34;</span>];</span></span></code></pre></div><p>But the returned value would be a string, so we&rsquo;d need to parse it:</p>
<div class="wrap-code highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-csharp" data-lang="csharp"><span style="display:flex;"><span>    IMDBMin = <span style="color:#66d9ef">double</span>.Parse(Request.Query[<span style="color:#e6db74">&#34;IMDBMin&#34;</span>]);</span></span></code></pre></div><p>If the query was <code>null</code>, then this would evaluate to <code>NaN</code>, which we wouldn&rsquo;t want to set our <code>&lt;input&gt;</code> to&hellip;</p>
<p>Instead, we&rsquo;ll look at some options built into the PageModel.</p>
<h2 id="parameter-binding">Parameter Binding</h2>
<p>The first of these options is <a href="https://docs.microsoft.com/en-us/aspnet/web-api/overview/formats-and-model-binding/parameter-binding-in-aspnet-web-api" target="_blank"><em>Parameter Binding</em></a>
.  In this approach, we define parameters to our <code>OnGet()</code> method to be parsed out of the request automatically, i.e.:</p>
<div class="wrap-code highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-csharp" data-lang="csharp"><span style="display:flex;"><span>    <span style="color:#75715e">/// &lt;summary&gt;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">/// Gets the search results for display on the page</span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">/// &lt;/summary&gt;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">void</span> OnGet(<span style="color:#66d9ef">string</span> SearchTerms, <span style="color:#66d9ef">string</span>[] MPAARatings, <span style="color:#66d9ef">string</span>[] Genres, <span style="color:#66d9ef">double?</span> IMDBMin, <span style="color:#66d9ef">double?</span> IMDBMax) {
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">this</span>.SearchTerms = SearchTerms;
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">this</span>.MPAARatings = MPAARatings;
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">this</span>.Genres = Genres;
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">this</span>.IMDBMin = IMDBMin;
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">this</span>.IMDBMax = IMDBMax;
</span></span><span style="display:flex;"><span>        Movies = MovieDatabase.Search(SearchTerms);
</span></span><span style="display:flex;"><span>        Movies = MovieDatabase.FilterByMPAARating(Movies, MPAARatings);
</span></span><span style="display:flex;"><span>        Movies = MovieDatabase.FilterByGenre(Movies, Genres);
</span></span><span style="display:flex;"><span>        Movies = MovieDatabase.FilterByIMDBRating(Movies, IMDBMin, IMDBMax);
</span></span><span style="display:flex;"><span>    }</span></span></code></pre></div><p>The benefit of this approach is that as long as C# knows a conversion into the type we specify, the conversion is done automatically.  Note that the parameter name matches the <code>name</code> property of the corresponding <code>&lt;input&gt;</code> - this must be the case for the Razor Page to bind the parameter to the corresponding input value.</p>
<p>Note that we still need to assign these parameter values to the corresponding properties of our PageModel.  If we don&rsquo;t, then those properties will all be <code>null</code>, and the <code>&lt;inputs&gt;</code> rendered on our page will always be blank.</p>
<h2 id="model-binding">Model Binding</h2>
<p>A second option is to use <a href="https://docs.microsoft.com/en-us/aspnet/core/mvc/models/model-binding?view=aspnetcore-3.1" target="_blank"><em>Model Binding</em></a>
.  Model binding also automatically converts incoming form data, but in this case it binds directly to the properties of our PageModel.  We indicate this form of binding with a <code>[BindProperty]</code> attribute, i.e.:</p>
<div class="wrap-code highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-csharp" data-lang="csharp"><span style="display:flex;"><span><span style="color:#66d9ef">public</span> <span style="color:#66d9ef">class</span> <span style="color:#a6e22e">IndexModel</span> : PageModel {
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">
</span></span></span><span style="display:flex;"><span><span style="color:#a6e22e">    [BindProperty(SupportsGet=true)]</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">string</span> SearchTerms {<span style="color:#66d9ef">get</span>; <span style="color:#66d9ef">set</span>;}
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">
</span></span></span><span style="display:flex;"><span><span style="color:#a6e22e">    [BindProperty(SupportsGet=true)]</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">string</span>[] MPAARatings {<span style="color:#66d9ef">get</span>; <span style="color:#66d9ef">set</span>;}
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">
</span></span></span><span style="display:flex;"><span><span style="color:#a6e22e">    [BindProperty(SupportsGet=true)]</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">string</span>[] Genres {<span style="color:#66d9ef">get</span>; <span style="color:#66d9ef">set</span>;}
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">
</span></span></span><span style="display:flex;"><span><span style="color:#a6e22e">    [BindProperty(SupportsGet=true)]</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">double?</span> IMDBMin {<span style="color:#66d9ef">get</span>; <span style="color:#66d9ef">set</span>;}
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">
</span></span></span><span style="display:flex;"><span><span style="color:#a6e22e">    [BindProperty(SupportsGet=true)]</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">double?</span> IMDBMax {<span style="color:#66d9ef">get</span>; <span style="color:#66d9ef">set</span>;}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">/// &lt;summary&gt;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">/// Gets the search results for display on the page</span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">/// &lt;/summary&gt;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">void</span> OnGet() {
</span></span><span style="display:flex;"><span>        Movies = MovieDatabase.Search(SearchTerms);
</span></span><span style="display:flex;"><span>        Movies = MovieDatabase.FilterByMPAARating(Movies, MPAARatings);
</span></span><span style="display:flex;"><span>        Movies = MovieDatabase.FilterByGenre(Movies, Genres);
</span></span><span style="display:flex;"><span>        Movies = MovieDatabase.FilterByIMDBRating(Movies, IMDBMin, IMDBMax);
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>}</span></span></code></pre></div><p>Note that with this approach, the incoming data is directly bound to the properties, so we don&rsquo;t need to do any special assignments within our <code>OnGet()</code> method.  Also, note that we have to use <code>SupportsGet=true</code> in order for this binding to occur on GET requests (by default, model binding only happens with POST requests).</p>

  
  
<div class="box notices cstyle note">
  <div class="box-label"><i class="fa-fw fas fa-exclamation-circle"></i> Note</div>
  <div class="box-content">

<p>You only need to do <em>one</em> binding approach per property in a PageModel.  I.e. you can just use the property decorator:</p>
<div class="wrap-code highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-csharp" data-lang="csharp"><span style="display:flex;"><span><span style="color:#66d9ef">public</span> <span style="color:#66d9ef">class</span> <span style="color:#a6e22e">SomePageModel</span> : PageModel
</span></span><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">    [BindProperty(SupportsGet=true)]</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">float</span> SomeProperty { <span style="color:#66d9ef">get</span>; <span style="color:#66d9ef">set</span>; }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">void</span> OnGet() {
</span></span><span style="display:flex;"><span>        DoSomething(SomeProperty);
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>}</span></span></code></pre></div><p><em>or</em> you might use parameter binding:</p>
<div class="wrap-code highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-csharp" data-lang="csharp"><span style="display:flex;"><span><span style="color:#66d9ef">public</span> <span style="color:#66d9ef">class</span> <span style="color:#a6e22e">SomePageModel</span> : PageModel
</span></span><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">void</span> OnGet(<span style="color:#66d9ef">float</span> SomeProperty) {
</span></span><span style="display:flex;"><span>        DoSomething(SomeProperty);
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>}</span></span></code></pre></div><p><em>or</em> you can parse it from the request:</p>
<div class="wrap-code highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-csharp" data-lang="csharp"><span style="display:flex;"><span><span style="color:#66d9ef">public</span> <span style="color:#66d9ef">class</span> <span style="color:#a6e22e">SomePageModel</span> : PageModel
</span></span><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">void</span> OnGet() {
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">var</span> someProperty = <span style="color:#66d9ef">float</span>.Parse(Request.Query[<span style="color:#e6db74">&#34;SomeProperty&#34;</span>]);
</span></span><span style="display:flex;"><span>        DoSomething(someProperty);
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>}</span></span></code></pre></div><p>These are all <em>different means</em> of accessing the <em>same data</em> from the incoming request.</p>
</div>
</div>
<p>Now all we need to do is implement the actual filter.</p>
<h3 id="implementing-the-imdb-rating-filter">Implementing the IMDB Rating Filter</h3>
<p>We&rsquo;ll define the new filter in our <code>MovieDatabase</code> class as another static method:</p>
<div class="wrap-code highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-csharp" data-lang="csharp"><span style="display:flex;"><span>    <span style="color:#75715e">/// &lt;summary&gt;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">/// Filters the provided collection of movies</span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">/// to those with IMDB ratings falling within</span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">/// the specified range</span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">/// &lt;/summary&gt;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">/// &lt;param name=&#34;movies&#34;&gt;The collection of movies to filter&lt;/param&gt;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">/// &lt;param name=&#34;min&#34;&gt;The minimum range value&lt;/param&gt;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">/// &lt;param name=&#34;max&#34;&gt;The maximum range value&lt;/param&gt;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">/// &lt;returns&gt;The filtered movie collection&lt;/returns&gt;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">static</span> IEnumerable&lt;Movie&gt; FilterByIMDBRating(IEnumerable&lt;Movie&gt; movies, <span style="color:#66d9ef">double?</span> min, <span style="color:#66d9ef">double?</span> max)
</span></span><span style="display:flex;"><span>    {
</span></span><span style="display:flex;"><span>        <span style="color:#75715e">// TODO: Filter movies</span>
</span></span><span style="display:flex;"><span>    }</span></span></code></pre></div><p>Notice that here too we use the nullable double value.  So our first step is probably to do a <code>null</code> check:</p>
<div class="wrap-code highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-csharp" data-lang="csharp"><span style="display:flex;"><span>    <span style="color:#66d9ef">if</span> (min == <span style="color:#66d9ef">null</span> &amp;&amp; max == <span style="color:#66d9ef">null</span>) <span style="color:#66d9ef">return</span> movies;</span></span></code></pre></div><p>But what if only one is null?  Should we filter for that part of the range?  It wouldn&rsquo;t be hard to do:</p>
<div class="wrap-code highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-csharp" data-lang="csharp"><span style="display:flex;"><span>    <span style="color:#66d9ef">var</span> results = <span style="color:#66d9ef">new</span> List&lt;Movie&gt;();
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">// only a maximum specified</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">if</span>(min == <span style="color:#66d9ef">null</span>)
</span></span><span style="display:flex;"><span>    {
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">foreach</span>(Movie movie <span style="color:#66d9ef">in</span> movies)
</span></span><span style="display:flex;"><span>        {
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">if</span> (movie.IMDBRating &lt;= max) results.Add(movie);
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">return</span> results;
</span></span><span style="display:flex;"><span>    }</span></span></code></pre></div><p>And the minimum would mirror that:</p>
<div class="wrap-code highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-csharp" data-lang="csharp"><span style="display:flex;"><span>    <span style="color:#75715e">// only a minimum specified</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">if</span>(max == <span style="color:#66d9ef">null</span>)
</span></span><span style="display:flex;"><span>    {
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">foreach</span>(Movie movie <span style="color:#66d9ef">in</span> movies)
</span></span><span style="display:flex;"><span>        {
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">if</span> (movie.IMDBRating &gt;= min) results.Add(movie);
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">return</span> results;
</span></span><span style="display:flex;"><span>    }</span></span></code></pre></div><p>Finally, we could handle the case where we have both a min and max value to our range:</p>
<div class="wrap-code highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-csharp" data-lang="csharp"><span style="display:flex;"><span>    <span style="color:#75715e">// Both minimum and maximum specified</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">foreach</span>(Movie movie <span style="color:#66d9ef">in</span> movies)
</span></span><span style="display:flex;"><span>    {
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">if</span>(movie.IMDBRating &gt;= min &amp;&amp; movie.IMDBRating &lt;= max)
</span></span><span style="display:flex;"><span>        {
</span></span><span style="display:flex;"><span>            results.Add(movie);
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">return</span> results;</span></span></code></pre></div><p>Notice too, that in each of these cases we&rsquo;re treating the range as <em>inclusive</em> (including the specified minimum and maximum).  This is the behavior most casual internet users will expect.  If the database and user expectations are different for your audience, you&rsquo;d want your code to match that expectation.</p>
<p>Now we can filter by IMDB rating:</p>
<p>
<a href="#image-7479f278e78e79181031c551dbd28931" class="lightbox-link">
<img src="https://ksu-cs-textbooks.github.io/cis400/images/6.8.6.png" alt="Filtering By IMDB" style="height: auto; width: auto;" loading="lazy">
</a>
<a href="javascript:history.back();" class="lightbox" id="image-7479f278e78e79181031c551dbd28931">
<img src="https://ksu-cs-textbooks.github.io/cis400/images/6.8.6.png" alt="Filtering By IMDB" class="lightbox-image" loading="lazy">
</a></p>
<h2 id="finishing-up">Finishing Up</h2>
<p>Since we&rsquo;re displaying the Rotten Tomatoes rating, we should probably also have a filter for it.  This will work almost exactly like the IMDB rating - but with the range from 0 to 100.  I&rsquo;ll leave this as an exercise for the reader.</p>

            <footer class="footline">

            </footer>
          </article>

    
    
          <article class="default">
            <header class="headline">
            </header>
<h1 id="numerical-filters">Numerical Filters</h1>

<p>Let&rsquo;s tackle one of the critics ratings next.  While we could create categories and use checkboxes, this doesn&rsquo;t capture the incremental values (i.e. 4.3), and it would be a <em>lot</em> of checkboxes for Rotten Tomatoes ratings!  Instead, we&rsquo;ll use a <em>numerical filter</em>, which limits our possible results to a range - between a minimum and maximum value.</p>
<p>Moreover, let&rsquo;s clean up our Index page, as it is getting difficult to determine what filter(s) go together, and are adding more.</p>
<h2 id="refactoring-the-index-page">Refactoring the Index Page</h2>
<p>Let&rsquo;s move the filters to a column on the left, leave the search bar above, and show our results on the right.  This will require refactoring our <em>Index.cshtml</em> file:</p>
<div class="wrap-code highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-csharp" data-lang="csharp"><span style="display:flex;"><span>    &lt;form id=<span style="color:#e6db74">&#34;movie-database&#34;</span>&gt;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        &lt;div id=<span style="color:#e6db74">&#34;search&#34;</span>&gt;
</span></span><span style="display:flex;"><span>            &lt;input type=<span style="color:#e6db74">&#34;text&#34;</span> name=<span style="color:#e6db74">&#34;SearchTerms&#34;</span> <span style="color:#66d9ef">value</span>=<span style="color:#e6db74">&#34;@Model.SearchTerms&#34;</span> /&gt;
</span></span><span style="display:flex;"><span>            &lt;input type=<span style="color:#e6db74">&#34;submit&#34;</span> <span style="color:#66d9ef">value</span>=<span style="color:#e6db74">&#34;Search&#34;</span>&gt;
</span></span><span style="display:flex;"><span>        &lt;/div&gt;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        &lt;div id=<span style="color:#e6db74">&#34;filters&#34;</span>&gt;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>            &lt;h4&gt;MPAA Rating&lt;/h4&gt;
</span></span><span style="display:flex;"><span>            @foreach (<span style="color:#66d9ef">string</span> rating <span style="color:#66d9ef">in</span> MovieDatabase.MPAARatings)
</span></span><span style="display:flex;"><span>            {
</span></span><span style="display:flex;"><span>                &lt;label&gt;
</span></span><span style="display:flex;"><span>                    &lt;input type=<span style="color:#e6db74">&#34;checkbox&#34;</span> name=<span style="color:#e6db74">&#34;MPAARatings&#34;</span> <span style="color:#66d9ef">value</span>=<span style="color:#e6db74">&#34;@rating&#34;</span> <span style="color:#66d9ef">checked</span>=<span style="color:#e6db74">&#34;@Model.MPAARatings.Contains(rating)&#34;</span> /&gt;
</span></span><span style="display:flex;"><span>                    @rating
</span></span><span style="display:flex;"><span>                &lt;/label&gt;
</span></span><span style="display:flex;"><span>            }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>            &lt;h4&gt;Genre&lt;/h4&gt;
</span></span><span style="display:flex;"><span>            @foreach (<span style="color:#66d9ef">string</span> genre <span style="color:#66d9ef">in</span> MovieDatabase.Genres)
</span></span><span style="display:flex;"><span>            {
</span></span><span style="display:flex;"><span>                &lt;label&gt;
</span></span><span style="display:flex;"><span>                    &lt;input type=<span style="color:#e6db74">&#34;checkbox&#34;</span> name=<span style="color:#e6db74">&#34;Genres&#34;</span> <span style="color:#66d9ef">value</span>=<span style="color:#e6db74">&#34;@genre&#34;</span> <span style="color:#66d9ef">checked</span>=<span style="color:#e6db74">&#34;@Model.Genres.Contains(genre)&#34;</span> /&gt;
</span></span><span style="display:flex;"><span>                    @genre
</span></span><span style="display:flex;"><span>                &lt;/label&gt;
</span></span><span style="display:flex;"><span>            }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>            &lt;h4&gt;IMDB Rating&lt;/h4&gt;
</span></span><span style="display:flex;"><span>            &lt;div&gt;
</span></span><span style="display:flex;"><span>                &lt;input name=<span style="color:#e6db74">&#34;IMDBMin&#34;</span> type=<span style="color:#e6db74">&#34;number&#34;</span> min=<span style="color:#e6db74">&#34;0&#34;</span> max=<span style="color:#e6db74">&#34;10&#34;</span> step=<span style="color:#e6db74">&#34;0.1&#34;</span> placeholder=<span style="color:#e6db74">&#34;min&#34;</span>/&gt;
</span></span><span style="display:flex;"><span>                to
</span></span><span style="display:flex;"><span>                &lt;input name=<span style="color:#e6db74">&#34;IMDBMax&#34;</span> type=<span style="color:#e6db74">&#34;number&#34;</span> min=<span style="color:#e6db74">&#34;0&#34;</span> max=<span style="color:#e6db74">&#34;10&#34;</span> step=<span style="color:#e6db74">&#34;0.1&#34;</span> placeholder=<span style="color:#e6db74">&#34;max&#34;</span>/&gt;
</span></span><span style="display:flex;"><span>            &lt;/div&gt;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        &lt;/div&gt;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        &lt;div id=<span style="color:#e6db74">&#34;results&#34;</span>&gt;
</span></span><span style="display:flex;"><span>            &lt;h1&gt;Movie Results&lt;/h1&gt;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>            &lt;ul class=<span style="color:#e6db74">&#34;movie-list&#34;</span>&gt;
</span></span><span style="display:flex;"><span>                @foreach (Movie movie <span style="color:#66d9ef">in</span> @Model.Movies)
</span></span><span style="display:flex;"><span>                {
</span></span><span style="display:flex;"><span>                    &lt;li&gt;
</span></span><span style="display:flex;"><span>                        &lt;div class=<span style="color:#e6db74">&#34;details&#34;</span>&gt;
</span></span><span style="display:flex;"><span>                            &lt;h3 class=<span style="color:#e6db74">&#34;title&#34;</span>&gt;@movie.Title&lt;/h3&gt;
</span></span><span style="display:flex;"><span>                            &lt;div class=<span style="color:#e6db74">&#34;mpaa&#34;</span>&gt;@movie.MPAARating&lt;/div&gt;
</span></span><span style="display:flex;"><span>                            &lt;div class=<span style="color:#e6db74">&#34;genre&#34;</span>&gt;@movie.MajorGenre&lt;/div&gt;
</span></span><span style="display:flex;"><span>                        &lt;/div&gt;
</span></span><span style="display:flex;"><span>                        &lt;div class=<span style="color:#e6db74">&#34;ratings&#34;</span>&gt;
</span></span><span style="display:flex;"><span>                            @if (movie.IMDBRating != <span style="color:#66d9ef">null</span>)
</span></span><span style="display:flex;"><span>                            {
</span></span><span style="display:flex;"><span>                                &lt;div class=<span style="color:#e6db74">&#34;imdb&#34;</span>&gt;
</span></span><span style="display:flex;"><span>                                    @movie.IMDBRating
</span></span><span style="display:flex;"><span>                                &lt;/div&gt;
</span></span><span style="display:flex;"><span>                            }
</span></span><span style="display:flex;"><span>                            @if (movie.RottenTomatoesRating != <span style="color:#66d9ef">null</span>)
</span></span><span style="display:flex;"><span>                            {
</span></span><span style="display:flex;"><span>                                &lt;div class=<span style="color:#e6db74">&#34;rotten-tomatoes&#34;</span>&gt;
</span></span><span style="display:flex;"><span>                                    @movie.RottenTomatoesRating
</span></span><span style="display:flex;"><span>                                &lt;/div&gt;
</span></span><span style="display:flex;"><span>                            }
</span></span><span style="display:flex;"><span>                        &lt;/div&gt;
</span></span><span style="display:flex;"><span>                    &lt;/li&gt;
</span></span><span style="display:flex;"><span>                }
</span></span><span style="display:flex;"><span>            &lt;/ul&gt;
</span></span><span style="display:flex;"><span>        &lt;/div&gt;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    &lt;/form&gt;</span></span></code></pre></div><p>Most of this is simply moving elements around the page, but note that we are using inputs of <code>type=number</code> to represent our range of IMDB values.  We can specify a minimum and maximum for this range, as well as an allowable increment.  Also, we use the <code>placeholder</code> attribute to put text into the <code>input</code> until a value is added.</p>
<h2 id="adding-more-styles">Adding More Styles</h2>
<p>Now we&rsquo;ll need to add some rules to our <em>wwwroot/css/styles.css</em>.  First, we&rsquo;ll use a <code>grid</code> for the layout of the form:</p>
<div class="wrap-code highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-css" data-lang="css"><span style="display:flex;"><span><span style="color:#f92672">form</span>#movie-database {
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">display</span>: <span style="color:#66d9ef">grid</span>;
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">grid-template-columns</span>: <span style="color:#ae81ff">1</span>fr <span style="color:#ae81ff">3</span>fr;
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">grid-template-rows</span>: <span style="color:#66d9ef">auto</span> <span style="color:#66d9ef">auto</span>;
</span></span><span style="display:flex;"><span>}</span></span></code></pre></div><p>The right column will be three times as big as the left.</p>
<p>We can make our search bar span both columns with <code>grid-column-start</code> and <code>grid-column-end</code>:</p>
<div class="wrap-code highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-css" data-lang="css"><span style="display:flex;"><span>#search {
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">grid-column-start</span>: <span style="color:#ae81ff">1</span>;
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">grid-column-end</span>: <span style="color:#ae81ff">3</span>;
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">text-align</span>: <span style="color:#66d9ef">center</span>;
</span></span><span style="display:flex;"><span>}</span></span></code></pre></div><p>Notice too that for CSS, we start counting at 1, not 0.  The filters and the results will fall in the next row automatically, each taking up their own respective grid cell.  You can read more about the grid layout in <a href="https://css-tricks.com/snippets/css/complete-guide-grid/" target="_blank">A Complete Guide to Grid</a>
.</p>
<p>Let&rsquo;s go ahead and use flexbox to lay out our filters in a column:</p>
<div class="wrap-code highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-css" data-lang="css"><span style="display:flex;"><span>#filters {
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">display</span>: <span style="color:#66d9ef">flex</span>;
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">flex-direction</span>: <span style="color:#66d9ef">column</span>;
</span></span><span style="display:flex;"><span>}</span></span></code></pre></div><p>And make our number inputs bigger:</p>
<div class="wrap-code highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-css" data-lang="css"><span style="display:flex;"><span>#filters <span style="color:#f92672">input</span><span style="color:#f92672">[</span><span style="color:#f92672">type</span><span style="color:#f92672">=</span><span style="color:#f92672">number</span><span style="color:#f92672">]</span> {
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">width</span>: <span style="color:#ae81ff">4</span><span style="color:#66d9ef">rem</span>;
</span></span><span style="display:flex;"><span>}</span></span></code></pre></div><p>Notice the use of square brackets in our CSS Selector to only apply to inputs with type number.</p>
<p>Also, let&rsquo;s add a margin above and remove most of the margin below our <code>&lt;h4&gt;</code> elements:</p>
<div class="wrap-code highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-css" data-lang="css"><span style="display:flex;"><span>#filters <span style="color:#f92672">h4</span> {
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">margin-bottom</span>: <span style="color:#ae81ff">0.2</span><span style="color:#66d9ef">rem</span>;
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">margin-top</span>: <span style="color:#ae81ff">2</span><span style="color:#66d9ef">rem</span>;
</span></span><span style="display:flex;"><span>}</span></span></code></pre></div><p>The resulting page looks much cleaner:</p>
<p>
<a href="#image-0458d8b468db1d06be9dcf9a8e676ec0" class="lightbox-link">
<img src="https://ksu-cs-textbooks.github.io/cis400/images/6.8.5.png" alt="The Styled Page" style="height: auto; width: auto;" loading="lazy">
</a>
<a href="javascript:history.back();" class="lightbox" id="image-0458d8b468db1d06be9dcf9a8e676ec0">
<img src="https://ksu-cs-textbooks.github.io/cis400/images/6.8.5.png" alt="The Styled Page" class="lightbox-image" loading="lazy">
</a></p>
<h2 id="capturing-the-filter-values">Capturing the Filter Values</h2>
<p>Now we need to get the filter values from our GET request query string.  We could do this like we&rsquo;ve been doing before, with:</p>
<div class="wrap-code highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-csharp" data-lang="csharp"><span style="display:flex;"><span>    Request.Query[<span style="color:#e6db74">&#34;IMDBMin&#34;</span>];</span></span></code></pre></div><p>But the returned value would be a string, so we&rsquo;d need to parse it:</p>
<div class="wrap-code highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-csharp" data-lang="csharp"><span style="display:flex;"><span>    IMDBMin = <span style="color:#66d9ef">double</span>.Parse(Request.Query[<span style="color:#e6db74">&#34;IMDBMin&#34;</span>]);</span></span></code></pre></div><p>If the query was <code>null</code>, then this would evaluate to <code>NaN</code>, which we wouldn&rsquo;t want to set our <code>&lt;input&gt;</code> to&hellip;</p>
<p>Instead, we&rsquo;ll look at some options built into the PageModel.</p>
<h2 id="parameter-binding">Parameter Binding</h2>
<p>The first of these options is <a href="https://docs.microsoft.com/en-us/aspnet/web-api/overview/formats-and-model-binding/parameter-binding-in-aspnet-web-api" target="_blank"><em>Parameter Binding</em></a>
.  In this approach, we define parameters to our <code>OnGet()</code> method to be parsed out of the request automatically, i.e.:</p>
<div class="wrap-code highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-csharp" data-lang="csharp"><span style="display:flex;"><span>    <span style="color:#75715e">/// &lt;summary&gt;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">/// Gets the search results for display on the page</span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">/// &lt;/summary&gt;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">void</span> OnGet(<span style="color:#66d9ef">string</span> SearchTerms, <span style="color:#66d9ef">string</span>[] MPAARatings, <span style="color:#66d9ef">string</span>[] Genres, <span style="color:#66d9ef">double?</span> IMDBMin, <span style="color:#66d9ef">double?</span> IMDBMax) {
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">this</span>.SearchTerms = SearchTerms;
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">this</span>.MPAARatings = MPAARatings;
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">this</span>.Genres = Genres;
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">this</span>.IMDBMin = IMDBMin;
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">this</span>.IMDBMax = IMDBMax;
</span></span><span style="display:flex;"><span>        Movies = MovieDatabase.Search(SearchTerms);
</span></span><span style="display:flex;"><span>        Movies = MovieDatabase.FilterByMPAARating(Movies, MPAARatings);
</span></span><span style="display:flex;"><span>        Movies = MovieDatabase.FilterByGenre(Movies, Genres);
</span></span><span style="display:flex;"><span>        Movies = MovieDatabase.FilterByIMDBRating(Movies, IMDBMin, IMDBMax);
</span></span><span style="display:flex;"><span>    }</span></span></code></pre></div><p>The benefit of this approach is that as long as C# knows a conversion into the type we specify, the conversion is done automatically.  Note that the parameter name matches the <code>name</code> property of the corresponding <code>&lt;input&gt;</code> - this must be the case for the Razor Page to bind the parameter to the corresponding input value.</p>
<p>Note that we still need to assign these parameter values to the corresponding properties of our PageModel.  If we don&rsquo;t, then those properties will all be <code>null</code>, and the <code>&lt;inputs&gt;</code> rendered on our page will always be blank.</p>
<h2 id="model-binding">Model Binding</h2>
<p>A second option is to use <a href="https://docs.microsoft.com/en-us/aspnet/core/mvc/models/model-binding?view=aspnetcore-3.1" target="_blank"><em>Model Binding</em></a>
.  Model binding also automatically converts incoming form data, but in this case it binds directly to the properties of our PageModel.  We indicate this form of binding with a <code>[BindProperty]</code> attribute, i.e.:</p>
<div class="wrap-code highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-csharp" data-lang="csharp"><span style="display:flex;"><span><span style="color:#66d9ef">public</span> <span style="color:#66d9ef">class</span> <span style="color:#a6e22e">IndexModel</span> : PageModel {
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">
</span></span></span><span style="display:flex;"><span><span style="color:#a6e22e">    [BindProperty(SupportsGet=true)]</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">string</span> SearchTerms {<span style="color:#66d9ef">get</span>; <span style="color:#66d9ef">set</span>;}
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">
</span></span></span><span style="display:flex;"><span><span style="color:#a6e22e">    [BindProperty(SupportsGet=true)]</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">string</span>[] MPAARatings {<span style="color:#66d9ef">get</span>; <span style="color:#66d9ef">set</span>;}
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">
</span></span></span><span style="display:flex;"><span><span style="color:#a6e22e">    [BindProperty(SupportsGet=true)]</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">string</span>[] Genres {<span style="color:#66d9ef">get</span>; <span style="color:#66d9ef">set</span>;}
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">
</span></span></span><span style="display:flex;"><span><span style="color:#a6e22e">    [BindProperty(SupportsGet=true)]</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">double?</span> IMDBMin {<span style="color:#66d9ef">get</span>; <span style="color:#66d9ef">set</span>;}
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">
</span></span></span><span style="display:flex;"><span><span style="color:#a6e22e">    [BindProperty(SupportsGet=true)]</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">double?</span> IMDBMax {<span style="color:#66d9ef">get</span>; <span style="color:#66d9ef">set</span>;}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">/// &lt;summary&gt;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">/// Gets the search results for display on the page</span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">/// &lt;/summary&gt;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">void</span> OnGet() {
</span></span><span style="display:flex;"><span>        Movies = MovieDatabase.Search(SearchTerms);
</span></span><span style="display:flex;"><span>        Movies = MovieDatabase.FilterByMPAARating(Movies, MPAARatings);
</span></span><span style="display:flex;"><span>        Movies = MovieDatabase.FilterByGenre(Movies, Genres);
</span></span><span style="display:flex;"><span>        Movies = MovieDatabase.FilterByIMDBRating(Movies, IMDBMin, IMDBMax);
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>}</span></span></code></pre></div><p>Note that with this approach, the incoming data is directly bound to the properties, so we don&rsquo;t need to do any special assignments within our <code>OnGet()</code> method.  Also, note that we have to use <code>SupportsGet=true</code> in order for this binding to occur on GET requests (by default, model binding only happens with POST requests).</p>

  
  
<div class="box notices cstyle note">
  <div class="box-label"><i class="fa-fw fas fa-exclamation-circle"></i> Note</div>
  <div class="box-content">

<p>You only need to do <em>one</em> binding approach per property in a PageModel.  I.e. you can just use the property decorator:</p>
<div class="wrap-code highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-csharp" data-lang="csharp"><span style="display:flex;"><span><span style="color:#66d9ef">public</span> <span style="color:#66d9ef">class</span> <span style="color:#a6e22e">SomePageModel</span> : PageModel
</span></span><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">    [BindProperty(SupportsGet=true)]</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">float</span> SomeProperty { <span style="color:#66d9ef">get</span>; <span style="color:#66d9ef">set</span>; }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">void</span> OnGet() {
</span></span><span style="display:flex;"><span>        DoSomething(SomeProperty);
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>}</span></span></code></pre></div><p><em>or</em> you might use parameter binding:</p>
<div class="wrap-code highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-csharp" data-lang="csharp"><span style="display:flex;"><span><span style="color:#66d9ef">public</span> <span style="color:#66d9ef">class</span> <span style="color:#a6e22e">SomePageModel</span> : PageModel
</span></span><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">void</span> OnGet(<span style="color:#66d9ef">float</span> SomeProperty) {
</span></span><span style="display:flex;"><span>        DoSomething(SomeProperty);
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>}</span></span></code></pre></div><p><em>or</em> you can parse it from the request:</p>
<div class="wrap-code highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-csharp" data-lang="csharp"><span style="display:flex;"><span><span style="color:#66d9ef">public</span> <span style="color:#66d9ef">class</span> <span style="color:#a6e22e">SomePageModel</span> : PageModel
</span></span><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">void</span> OnGet() {
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">var</span> someProperty = <span style="color:#66d9ef">float</span>.Parse(Request.Query[<span style="color:#e6db74">&#34;SomeProperty&#34;</span>]);
</span></span><span style="display:flex;"><span>        DoSomething(someProperty);
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>}</span></span></code></pre></div><p>These are all <em>different means</em> of accessing the <em>same data</em> from the incoming request.</p>
</div>
</div>
<p>Now all we need to do is implement the actual filter.</p>
<h3 id="implementing-the-imdb-rating-filter">Implementing the IMDB Rating Filter</h3>
<p>We&rsquo;ll define the new filter in our <code>MovieDatabase</code> class as another static method:</p>
<div class="wrap-code highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-csharp" data-lang="csharp"><span style="display:flex;"><span>    <span style="color:#75715e">/// &lt;summary&gt;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">/// Filters the provided collection of movies</span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">/// to those with IMDB ratings falling within</span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">/// the specified range</span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">/// &lt;/summary&gt;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">/// &lt;param name=&#34;movies&#34;&gt;The collection of movies to filter&lt;/param&gt;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">/// &lt;param name=&#34;min&#34;&gt;The minimum range value&lt;/param&gt;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">/// &lt;param name=&#34;max&#34;&gt;The maximum range value&lt;/param&gt;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">/// &lt;returns&gt;The filtered movie collection&lt;/returns&gt;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">static</span> IEnumerable&lt;Movie&gt; FilterByIMDBRating(IEnumerable&lt;Movie&gt; movies, <span style="color:#66d9ef">double?</span> min, <span style="color:#66d9ef">double?</span> max)
</span></span><span style="display:flex;"><span>    {
</span></span><span style="display:flex;"><span>        <span style="color:#75715e">// TODO: Filter movies</span>
</span></span><span style="display:flex;"><span>    }</span></span></code></pre></div><p>Notice that here too we use the nullable double value.  So our first step is probably to do a <code>null</code> check:</p>
<div class="wrap-code highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-csharp" data-lang="csharp"><span style="display:flex;"><span>    <span style="color:#66d9ef">if</span> (min == <span style="color:#66d9ef">null</span> &amp;&amp; max == <span style="color:#66d9ef">null</span>) <span style="color:#66d9ef">return</span> movies;</span></span></code></pre></div><p>But what if only one is null?  Should we filter for that part of the range?  It wouldn&rsquo;t be hard to do:</p>
<div class="wrap-code highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-csharp" data-lang="csharp"><span style="display:flex;"><span>    <span style="color:#66d9ef">var</span> results = <span style="color:#66d9ef">new</span> List&lt;Movie&gt;();
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">// only a maximum specified</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">if</span>(min == <span style="color:#66d9ef">null</span>)
</span></span><span style="display:flex;"><span>    {
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">foreach</span>(Movie movie <span style="color:#66d9ef">in</span> movies)
</span></span><span style="display:flex;"><span>        {
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">if</span> (movie.IMDBRating &lt;= max) results.Add(movie);
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">return</span> results;
</span></span><span style="display:flex;"><span>    }</span></span></code></pre></div><p>And the minimum would mirror that:</p>
<div class="wrap-code highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-csharp" data-lang="csharp"><span style="display:flex;"><span>    <span style="color:#75715e">// only a minimum specified</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">if</span>(max == <span style="color:#66d9ef">null</span>)
</span></span><span style="display:flex;"><span>    {
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">foreach</span>(Movie movie <span style="color:#66d9ef">in</span> movies)
</span></span><span style="display:flex;"><span>        {
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">if</span> (movie.IMDBRating &gt;= min) results.Add(movie);
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">return</span> results;
</span></span><span style="display:flex;"><span>    }</span></span></code></pre></div><p>Finally, we could handle the case where we have both a min and max value to our range:</p>
<div class="wrap-code highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-csharp" data-lang="csharp"><span style="display:flex;"><span>    <span style="color:#75715e">// Both minimum and maximum specified</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">foreach</span>(Movie movie <span style="color:#66d9ef">in</span> movies)
</span></span><span style="display:flex;"><span>    {
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">if</span>(movie.IMDBRating &gt;= min &amp;&amp; movie.IMDBRating &lt;= max)
</span></span><span style="display:flex;"><span>        {
</span></span><span style="display:flex;"><span>            results.Add(movie);
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">return</span> results;</span></span></code></pre></div><p>Notice too, that in each of these cases we&rsquo;re treating the range as <em>inclusive</em> (including the specified minimum and maximum).  This is the behavior most casual internet users will expect.  If the database and user expectations are different for your audience, you&rsquo;d want your code to match that expectation.</p>
<p>Now we can filter by IMDB rating:</p>
<p>
<a href="#image-ca42b59b20c1191773c2095f3de6767e" class="lightbox-link">
<img src="https://ksu-cs-textbooks.github.io/cis400/images/6.8.6.png" alt="Filtering By IMDB" style="height: auto; width: auto;" loading="lazy">
</a>
<a href="javascript:history.back();" class="lightbox" id="image-ca42b59b20c1191773c2095f3de6767e">
<img src="https://ksu-cs-textbooks.github.io/cis400/images/6.8.6.png" alt="Filtering By IMDB" class="lightbox-image" loading="lazy">
</a></p>
<h2 id="finishing-up">Finishing Up</h2>
<p>Since we&rsquo;re displaying the Rotten Tomatoes rating, we should probably also have a filter for it.  This will work almost exactly like the IMDB rating - but with the range from 0 to 100.  I&rsquo;ll leave this as an exercise for the reader.</p>

            <footer class="footline">

            </footer>
          </article>

    
    
          <article class="default">
            <header class="headline">
            </header>
<h1 id="using-linq">Using LINQ</h1>

<p>In our movie website, we&rsquo;ve been using a custom &ldquo;database&rdquo; object, <code>MovieDatabase</code> to provide the movie data and search and filter functionality.  In professional practice, we would probably replace this with an external database program.  These programs have been developed specifically for persisting and accessing data, and leverage specialized data structures like B+ trees that allow them to do searches and filters much more efficiently.</p>
<p>Some of the most widely adopted database programs are <em>relational databases</em> like MySQL, MsSQL, Postgres, and SQLLite.  These predate object-orientation, and accept requests for data in the form of SQL (Structured Query Language).  You will learn more about these databases and how to use them in CIS560.</p>
<h2 id="linq">LINQ</h2>
<p>Microsoft, inspired by SQL, introduced Language Integrated Query (LINQ) in 2007 to bring the concept of a query language into .NET.  LINQ allows you to construct queries in either chained method calls or in a syntax similar to SQL that can operate on collections or relational databases.</p>
<p>For relational databases, LINQ queries are converted internally to SQL queries, and dispatched to the database.  But their real power is that they can also be used with any collection that supports either the <code>IEnumerable</code> or <code>IEnumerable&lt;T&gt;</code> interfaces.  LINQ can be used to replace the kinds of filter and search functions we wrote for our <code>MovieDatabase</code>.  Let&rsquo;s try it out with our movie website.</p>
<p>LINQ operates through extension methods, so we need to be sure to add the LINQ namespace to our CS files where we are going to employ them.  We&rsquo;ll be adding our LINQ commands to our page model, so sure that is the case with your <em>Pages/Index.cshtml.cs</em>:</p>
<div class="wrap-code highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-csharp" data-lang="csharp"><span style="display:flex;"><span><span style="color:#66d9ef">using</span> System.Linq;</span></span></code></pre></div><p>Adding this using statement will bring in all the extension methods for LINQ, and will also prompt Visual Studio to recognize the query-style syntax.</p>
<h2 id="searching-with-linq">Searching with LINQ</h2>
<p>One of the most useful extension methods in LINQ is <a href="https://docs.microsoft.com/en-us/dotnet/api/system.linq.enumerable.where?view=netcore-3.1" target="_blank">Where()</a>
.  It can be invoked on any <code>IEnumerable</code> and accepts a <code>Func</code> (a delegate type).  This delegate takes a single argument - the current item being enumerated over, and its body should return a boolean value - <code>true</code> if the item should be included in the results, and <code>false</code> if it should not.</p>
<p>We can thus use our existing <code>SearchTerms</code> property as the basis for our test: <code>movie =&gt; movie.Title != null &amp;&amp; movie.Title.Contains(SearchTerms)</code> (note that with lambda expressions, if the result is single expression we can omit the <code>{}</code> and the <code>return</code> is implied).  Also note that we incorporate the null check directly into the expression using the boolean and <code>&amp;&amp;</code> operator.</p>
<p>We can replace our current search with a <code>Where()</code> call invoking this method:</p>
<div class="wrap-code highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-csharp" data-lang="csharp"><span style="display:flex;"><span>Movies = MovieDatabase.All.Where(movie =&gt; movie.Title != <span style="color:#66d9ef">null</span> &amp;&amp; movie.Title.Contains(SearchTerms, String));</span></span></code></pre></div><p>However if we run the program we will encounter a null exception.  On our first GET request, the value of <code>SearchTerms</code> is null, which is <em>not</em> a legal argument for <code>String.Contains()</code>.</p>
<h2 id="making-search-conditional">Making Search Conditional</h2>
<p>If the <code>SearchTerms</code> is null, that indicates that the user did not enter a search term - accordingly, we probably don&rsquo;t want to search.  We can wrap our filter in an <code>if</code> test to prevent applying the filter when there is no search term.  Thus, we would refactor our filtering expression to:</p>
<div class="wrap-code highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-csharp" data-lang="csharp"><span style="display:flex;"><span>Movies = MovieDatabase.All;
</span></span><span style="display:flex;"><span><span style="color:#75715e">// Search movie titles for the SearchTerms</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">if</span>(SearchTerms != <span style="color:#66d9ef">null</span>) {
</span></span><span style="display:flex;"><span>    Movies = Movies.Where(movie =&gt; movie.Title != <span style="color:#66d9ef">null</span> &amp;&amp; movie.Title.Contains(SearchTerms, StringComparison.InvariantCultureIgnoreCase));
</span></span><span style="display:flex;"><span>}</span></span></code></pre></div><p>Now if we run the program, and search for a specific term, we&rsquo;ll see our results is modified to contain <em>only</em> those movies with the terms in their title!</p>
<p>We can also use the query syntax instead of the extension method syntax, which is similar to SQL:</p>
<div class="wrap-code highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-csharp" data-lang="csharp"><span style="display:flex;"><span>Movies = MovieDatabase.All;
</span></span><span style="display:flex;"><span><span style="color:#75715e">// Search movie titles for the SearchTerms</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">if</span>(SerchTerms != <span style="color:#66d9ef">null</span>)
</span></span><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>    Movies = <span style="color:#66d9ef">from</span> movie <span style="color:#66d9ef">in</span> Movies
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">where</span> movie.Title != <span style="color:#66d9ef">null</span> &amp;&amp; movie.Title.Contains(SearchTerms, StringComparison.InvariantCultureIgnoreCase)
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">select</span> movie;
</span></span><span style="display:flex;"><span>}</span></span></code></pre></div><p>This syntax is converted by the C# compiler to use the extension methods as part of the compilation process.</p>

  
  
<div class="box notices cstyle info">
  <div class="box-label"><i class="fa-fw fas fa-info-circle"></i> Info</div>
  <div class="box-content">

<p>The search approach listed above will only find the <em>exact</em> search terms, i.e. searching for &ldquo;Clear Present Danger&rdquo; will <em>not</em> match the film &ldquo;Clear and Present Danger&rdquo;.  How might you tweak the search approach so that terms would be found individually?</p>
</div>
</div>
<p>You can use either form for writing your queries, though it is best to stay consistent within a single program.</p>
<h2 id="filtering-with-linq">Filtering with LINQ</h2>
<p>Filtering is also accomplished through the <a href="https://docs.microsoft.com/en-us/dotnet/api/system.linq.enumerable.where?view=netcore-3.1" target="_blank">Where()</a>
.  We can add additional tests within our search <code>Where()</code>, but it is more legible to add <em>additional</em> <code>Where</code> calls:</p>
<div class="wrap-code highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-csharp" data-lang="csharp"><span style="display:flex;"><span>Movies = MovieDatabase.All
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">// Search movie titles for the SearchTerms</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">if</span>(SearchTerms != <span style="color:#66d9ef">null</span>) {
</span></span><span style="display:flex;"><span>        Movies = Movies.Where(movie =&gt; movie.Title != <span style="color:#66d9ef">null</span> &amp;&amp; movie.Title.Contains(SearchTerms, StringComparison.InvariantCultureIgnoreCase));
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">// Filter by MPAA Rating</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">if</span>(MPAARatings != <span style="color:#66d9ef">null</span> &amp;&amp; MPAARatings.Length != <span style="color:#ae81ff">0</span>)
</span></span><span style="display:flex;"><span>    {
</span></span><span style="display:flex;"><span>        Movies = Movies.Where(movie =&gt;
</span></span><span style="display:flex;"><span>            movie.MPAARating != <span style="color:#66d9ef">null</span> &amp;&amp;
</span></span><span style="display:flex;"><span>            MPAARatings.Contains(movie.MPAARating)
</span></span><span style="display:flex;"><span>            );
</span></span><span style="display:flex;"><span>    }</span></span></code></pre></div>
  
  
<div class="box notices cstyle todo">
  <div class="box-label"></div>
  <div class="box-content">

<p>The numerical filters are handled the same way - with additional <code>Where</code> clauses.  I leave this as an exercise for the reader to complete.</p>
</div>
</div>
<h2 id="benefits-of-linq">Benefits of LINQ</h2>
<p>While LINQ is a bit less code for us to write, there is another big benefit - the actual filtering is only applied <em>when we start iterating through the results</em>.  This means that LINQ queries with multiple <code>Where()</code> invocations can combine them into a single iteration.</p>
<p>Consider our movie website example.  We have four filters - the search, the MPAA Ratings, the IMDB Ratings, and the Rotten Tomato Rating.  In the worst case, each movie in the database would pass each filter, so that our list never got smaller.  With the filter functions we wrote in <code>MovieDatabase</code>, we would have to iterate over that full list <em>four times</em>.  In terms of complexity, that&rsquo;s $O(4n)$.</p>
<p>In contrast, because LINQ doesn&rsquo;t actually run the filters until we start iterating, it can combine all the <code>While</code> tests into a single boolean expression.  The result is it only has to iterate through the list <em>once</em>.  Hence, its complexity becomes $O(n)$.  There is a little additional overhead for holding onto the query information that way, but it&rsquo;s small compared to the benefit.</p>
<p>Also, we could have done the same kind of optimization ourselves, but it takes a lot of work to set up, and may not be worth it for a single web app.  But LINQ provides us that benefit for free.</p>

            <footer class="footline">

            </footer>
          </article>

          </section>

        </div>
      </main>
    
<div class="git-footer">
<p class="theme-version-footer">5.18.0</p>
<p>Last modified by: 
            <i class='fas fa-user'></i> Julie Thornton
            <i class='fas fa-calendar'></i> <a href="https://gitlab.cs.ksu.edu/cs-textbooks/cis400-textbook/-/commit/49e1b7656e0b4e6d675d8aa55bc1e73c58f44a99">Aug 3, 2023</a>
</p>
</div>

    
    </div>
    <script src="https://ksu-cs-textbooks.github.io/cis400/js/clipboard.min.js?1714501683" defer></script>
    <script src="https://ksu-cs-textbooks.github.io/cis400/js/perfect-scrollbar.min.js?1714501683" defer></script>
    <script src="https://ksu-cs-textbooks.github.io/cis400/js/theme.js?1714501683" defer></script>
  </body>
</html>
