<!doctype html><html lang=en-us dir=ltr itemscope itemtype=http://schema.org/Article><head><meta charset=utf-8><meta name=viewport content="height=device-height,width=device-width,initial-scale=1,minimum-scale=1"><meta name=generator content="Hugo 0.128.0"><meta name=generator content="Relearn 6.0.0"><meta name=description content='Letâ€™s add a search form and functionality to our movie website. Weâ€™ll add this to our Index.cshtml page, just above the <h1> element:
<form> <input type="text" name="SearchTerms"/> <input type="submit" value="Search"> </form> <h1>Movie Results</h1>Weâ€™ll also change the <h1> contents to â€œMovie Resultsâ€.
Try typing a search term into the search box, and click the search button. Has anything changed?
The Request Object When you click the search button, the browser serializes your form, and makes a request against your server including the search terms.'><meta name=author content="Nathan Bean"><meta name=twitter:card content="summary"><meta name=twitter:title content="Adding Search to the Movie Site :: K-State CIS 400 Textbook"><meta name=twitter:description content='Letâ€™s add a search form and functionality to our movie website. Weâ€™ll add this to our Index.cshtml page, just above the <h1> element:
<form> <input type="text" name="SearchTerms"/> <input type="submit" value="Search"> </form> <h1>Movie Results</h1>Weâ€™ll also change the <h1> contents to â€œMovie Resultsâ€.
Try typing a search term into the search box, and click the search button. Has anything changed?
The Request Object When you click the search button, the browser serializes your form, and makes a request against your server including the search terms.'><meta property="og:url" content="https://textbooks.cs.ksu.edu/cis400/c-exercises-s23/12-web-data/01-simple-search/"><meta property="og:site_name" content="K-State CIS 400 Textbook"><meta property="og:title" content="Adding Search to the Movie Site :: K-State CIS 400 Textbook"><meta property="og:description" content='Letâ€™s add a search form and functionality to our movie website. Weâ€™ll add this to our Index.cshtml page, just above the <h1> element:
<form> <input type="text" name="SearchTerms"/> <input type="submit" value="Search"> </form> <h1>Movie Results</h1>Weâ€™ll also change the <h1> contents to â€œMovie Resultsâ€.
Try typing a search term into the search box, and click the search button. Has anything changed?
The Request Object When you click the search button, the browser serializes your form, and makes a request against your server including the search terms.'><meta property="og:locale" content="en-us"><meta property="og:type" content="article"><meta property="article:section" content="Exercises"><meta property="article:published_time" content="2018-08-24T10:53:26-05:00"><meta property="article:modified_time" content="2024-02-13T10:58:40-06:00"><meta itemprop=name content="Adding Search to the Movie Site :: K-State CIS 400 Textbook"><meta itemprop=description content='Letâ€™s add a search form and functionality to our movie website. Weâ€™ll add this to our Index.cshtml page, just above the <h1> element:
<form> <input type="text" name="SearchTerms"/> <input type="submit" value="Search"> </form> <h1>Movie Results</h1>Weâ€™ll also change the <h1> contents to â€œMovie Resultsâ€.
Try typing a search term into the search box, and click the search button. Has anything changed?
The Request Object When you click the search button, the browser serializes your form, and makes a request against your server including the search terms.'><meta itemprop=datePublished content="2018-08-24T10:53:26-05:00"><meta itemprop=dateModified content="2024-02-13T10:58:40-06:00"><meta itemprop=wordCount content="1237"><title>Adding Search to the Movie Site :: K-State CIS 400 Textbook</title>
<link href=https://textbooks.cs.ksu.edu/cis400/c-exercises-s23/12-web-data/01-simple-search/ rel=canonical type=text/html title="Adding Search to the Movie Site :: K-State CIS 400 Textbook"><link href=/cis400/c-exercises-s23/12-web-data/01-simple-search/index.xml rel=alternate type=application/rss+xml title="Adding Search to the Movie Site :: K-State CIS 400 Textbook"><link href=/cis400/c-exercises-s23/12-web-data/01-simple-search/tele.html rel=alternate type=text/html title="Adding Search to the Movie Site :: K-State CIS 400 Textbook"><link href=/cis400/c-exercises-s23/12-web-data/01-simple-search/embed.html rel=alternate type=text/html title="Adding Search to the Movie Site :: K-State CIS 400 Textbook"><link href=/cis400/css/fontawesome-all.min.css?1724347207 rel=stylesheet media=print onload='this.media="all",this.onload=null'><noscript><link href=/cis400/css/fontawesome-all.min.css?1724347207 rel=stylesheet></noscript><link href=/cis400/css/nucleus.css?1724347207 rel=stylesheet><link href=/cis400/css/auto-complete.css?1724347207 rel=stylesheet media=print onload='this.media="all",this.onload=null'><noscript><link href=/cis400/css/auto-complete.css?1724347207 rel=stylesheet></noscript><link href=/cis400/css/perfect-scrollbar.min.css?1724347207 rel=stylesheet><link href=/cis400/css/fonts.css?1724347207 rel=stylesheet media=print onload='this.media="all",this.onload=null'><noscript><link href=/cis400/css/fonts.css?1724347207 rel=stylesheet></noscript><link href=/cis400/css/theme.css?1724347207 rel=stylesheet><link href=/cis400/css/theme-auto.css?1724347207 rel=stylesheet id=R-variant-style><link href=/cis400/css/chroma-auto.css?1724347207 rel=stylesheet id=R-variant-chroma-style><link href=/cis400/css/variant.css?1724347207 rel=stylesheet><link href=/cis400/css/print.css?1724347207 rel=stylesheet media=print><link href=/cis400/css/format-print.css?1724347207 rel=stylesheet><script src=/cis400/js/variant.js?1724347207></script><script>window.relearn=window.relearn||{},window.relearn.relBasePath="../../..",window.relearn.relBaseUri="../../../..",window.relearn.absBaseUri="https://textbooks.cs.ksu.edu/cis400",window.index_js_url="/cis400/index.search.js",window.variants&&variants.init(["auto","light-theme","dark-theme"]),window.T_Copy_to_clipboard=`Copy to clipboard`,window.T_Copied_to_clipboard=`Copied to clipboard!`,window.T_Copy_link_to_clipboard=`Copy link to clipboard`,window.T_Link_copied_to_clipboard=`Copied link to clipboard!`,window.T_Reset_view=`Reset view`,window.T_View_reset=`View reset!`,window.T_No_results_found=`No results found for "{0}"`,window.T_N_results_found=`{1} results found for "{0}"`</script><link href=/cis400/css/custom.css?1724347207 rel=stylesheet></head><body class="mobile-support print disableInlineCopyToClipboard" data-url=/cis400/c-exercises-s23/12-web-data/01-simple-search/><div id=R-body class=default-animation><div id=R-body-overlay></div><nav id=R-topbar><div class=topbar-wrapper><div class=topbar-sidebar-divider></div><div class="topbar-area topbar-area-start" data-area=start><div class="topbar-button topbar-button-sidebar" data-content-empty=disable data-width-s=show data-width-m=hide data-width-l=hide><button class=topbar-control onclick=toggleNav() type=button title="Menu (CTRL+ALT+n)"><i class="fa-fw fas fa-bars"></i></button></div></div><ol class="topbar-breadcrumbs breadcrumbs highlightable" itemscope itemtype=http://schema.org/BreadcrumbList><li itemscope itemtype=https://schema.org/ListItem itemprop=itemListElement><a itemprop=item href=/cis400/c-exercises-s23/><span itemprop=name>Exercises</span></a><meta itemprop=position content="1">&nbsp;>&nbsp;</li><li itemscope itemtype=https://schema.org/ListItem itemprop=itemListElement><a itemprop=item href=/cis400/c-exercises-s23/12-web-data/><span itemprop=name>Web Data</span></a><meta itemprop=position content="2">&nbsp;>&nbsp;</li><li itemscope itemtype=https://schema.org/ListItem itemprop=itemListElement><span itemprop=name>Adding Search to the Movie Site</span><meta itemprop=position content="3"></li></ol><div class="topbar-area topbar-area-end" data-area=end><div class="topbar-button topbar-button-prev" data-content-empty=disable data-width-s=show data-width-m=show data-width-l=show><a class=topbar-control href=/cis400/c-exercises-s23/12-web-data/ title="Web Data (ðŸ¡)"><i class="fa-fw fas fa-chevron-left"></i></a></div><div class="topbar-button topbar-button-next" data-content-empty=disable data-width-s=show data-width-m=show data-width-l=show><a class=topbar-control href=/cis400/c-exercises-s23/12-web-data/02-categorical-filters-edit/ title="Adding Categorical Filters to the Movie Site (ðŸ¡’)"><i class="fa-fw fas fa-chevron-right"></i></a></div></div></div></nav><div id=R-main-overlay></div><main id=R-body-inner class="highlightable default" tabindex=-1><div class=flex-block-wrapper><article class=default><header class=headline></header><h1 id=adding-search-to-the-movie-site>Adding Search to the Movie Site</h1><p>Let&rsquo;s add a search form and functionality to our movie website. We&rsquo;ll add this to our <em>Index.cshtml</em> page, just above the <code>&lt;h1></code> element:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-html data-lang=html><span class=line><span class=cl>    <span class=p>&lt;</span><span class=nt>form</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>        <span class=p>&lt;</span><span class=nt>input</span> <span class=na>type</span><span class=o>=</span><span class=s>&#34;text&#34;</span> <span class=na>name</span><span class=o>=</span><span class=s>&#34;SearchTerms&#34;</span><span class=p>/&gt;</span>
</span></span><span class=line><span class=cl>        <span class=p>&lt;</span><span class=nt>input</span> <span class=na>type</span><span class=o>=</span><span class=s>&#34;submit&#34;</span> <span class=na>value</span><span class=o>=</span><span class=s>&#34;Search&#34;</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>    <span class=p>&lt;/</span><span class=nt>form</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>    <span class=p>&lt;</span><span class=nt>h1</span><span class=p>&gt;</span>Movie Results<span class=p>&lt;/</span><span class=nt>h1</span><span class=p>&gt;</span></span></span></code></pre></div><p>We&rsquo;ll also change the <code>&lt;h1></code> contents to &ldquo;Movie Results&rdquo;.</p><p>Try typing a search term into the search box, and click the <em>search</em> button. Has anything changed?</p><h3 id=the-request-object>The Request Object</h3><p>When you click the <em>search</em> button, the browser serializes your form, and makes a request against your server including the search terms. By default this request is a <strong>GET</strong> request, and the contents of the form are serialized using <a href=https://developer.mozilla.org/en-US/docs/Glossary/percent-encoding rel=external target=_blank>urlencoding (aka percent encoding)</a>, a special string format. This string is then appended to the requested url as the <a href=https://developer.mozilla.org/en-US/docs/Web/API/Location/search rel=external target=_blank>query string (aka search string)</a> - a series of key-value pairs proceeded by the question mark symbol(<code>?</code>) and separated by the ampersand (<code>&</code>).</p><p>This data is made available to us in our PageModel <em>Index.cshtml.cs</em> by ASP.NET. Let&rsquo;s take a look at it now. Notice the method <code>public void OnGet()</code>? This method is invoked <em>every time the page is requested using a GET request</em>. Thus, if we need to do some initialization and/or processing, this would be the place to do it.</p><p>Inside the PageModel, we can access the request data using the <code>Request</code> object. The exact string can be accessed with <code>Request.QueryString</code>, or the parsed and deserialized results can be accessed from <code>Request.Query</code>. Let&rsquo;s use the latter to pull out the search terms:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-csharp data-lang=csharp><span class=line><span class=cl>    <span class=kd>public</span> <span class=k>void</span> <span class=n>OnGet</span><span class=p>()</span> 
</span></span><span class=line><span class=cl>    <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=n>String</span> <span class=n>terms</span> <span class=p>=</span> <span class=n>Request</span><span class=p>.</span><span class=n>Query</span><span class=p>[</span><span class=s>&#34;SearchTerms&#34;</span><span class=p>];</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span></span></span></code></pre></div><p>We can store that value, and make it available to the page itself, by creating a public property. Let&rsquo;s create one named <code>SearchTerms</code>:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-csharp data-lang=csharp><span class=line><span class=cl>    <span class=kd>public</span> <span class=kt>string</span> <span class=n>SearchTerms</span> <span class=p>{</span> <span class=k>get</span><span class=p>;</span> <span class=k>set</span><span class=p>;</span> <span class=p>}</span></span></span></code></pre></div><p>And we&rsquo;ll refactor our <code>OnGet()</code> to store the search terms coming in from the request:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-csharp data-lang=csharp><span class=line><span class=cl>    <span class=kd>public</span> <span class=k>void</span> <span class=n>OnGet</span><span class=p>()</span> 
</span></span><span class=line><span class=cl>    <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=n>SearchTerms</span> <span class=p>=</span> <span class=n>Request</span><span class=p>.</span><span class=n>Query</span><span class=p>[</span><span class=s>&#34;SearchTerms&#34;</span><span class=p>];</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span></span></span></code></pre></div><p>Now we can refactor our input element to use that public property from our model as its default value:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-html data-lang=html><span class=line><span class=cl>    <span class=p>&lt;</span><span class=nt>input</span> <span class=na>type</span><span class=o>=</span><span class=s>&#34;text&#34;</span> <span class=na>name</span><span class=o>=</span><span class=s>&#34;SearchTerms&#34;</span> <span class=na>value</span><span class=o>=</span><span class=s>&#34;@Model.SearchTerms&#34;</span><span class=p>/&gt;</span></span></span></code></pre></div><p>The first time we visit the index page, the <code>SearchTerms</code> value will be null, so our input would have <code>value=""</code>. The browser interprets this as empty. If we add a search term and click the <em>search</em> button, we&rsquo;ll see the page reload. And since <code>@Model.SearchTerms</code> has a value this time, we&rsquo;ll see that string appear in search box!</p><p>Now we just need to search for those terms&mldr;</p><h3 id=adding-search-to-the-database>Adding Search to the Database</h3><p>We&rsquo;ll start by defining a new static method in our <em>MovieDatabase.cs</em> file to search for movies using the search terms:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-csharp data-lang=csharp><span class=line><span class=cl>    <span class=cs>/// &lt;summary&gt;</span>
</span></span><span class=line><span class=cl>    <span class=cs>/// Searches the database for matching movies</span>
</span></span><span class=line><span class=cl>    <span class=cs>/// &lt;/summary&gt;</span>
</span></span><span class=line><span class=cl>    <span class=cs>/// &lt;param name=&#34;terms&#34;&gt;The terms to search for&lt;/param&gt;</span>
</span></span><span class=line><span class=cl>    <span class=cs>/// &lt;returns&gt;A collection of movies&lt;/returns&gt;</span>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=kd>static</span> <span class=n>IEnumerable</span><span class=p>&lt;</span><span class=n>Movie</span><span class=p>&gt;</span> <span class=n>Search</span><span class=p>(</span><span class=kt>string</span> <span class=n>terms</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=c1>// TODO: Search database</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span></span></span></code></pre></div><p>We&rsquo;ll need a collection of results that implements the <code>IEnumerable&lt;T></code> interface. Let&rsquo;s use the familiar <code>List&lt;T></code>:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-csharp data-lang=csharp><span class=line><span class=cl>    <span class=n>List</span><span class=p>&lt;</span><span class=n>Movie</span><span class=p>&gt;</span> <span class=n>results</span> <span class=p>=</span> <span class=k>new</span> <span class=n>List</span><span class=p>&lt;</span><span class=n>Movie</span><span class=p>&gt;();</span></span></span></code></pre></div><p>Now, there is a chance that the search terms we receive are <code>null</code>. If that&rsquo;s the case, we would either 1) return <em>all</em> the movies, or 2) return <em>no</em> movies. You can choose either option, but for now, I&rsquo;ll return all movies</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-csharp data-lang=csharp><span class=line><span class=cl>    <span class=c1>// Return all movies if there are no search terms</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span><span class=p>(</span><span class=n>terms</span> <span class=p>==</span> <span class=kc>null</span><span class=p>)</span> <span class=k>return</span> <span class=n>All</span><span class=p>;</span></span></span></code></pre></div><p>If we <em>do</em> have search terms, we need to add any movies from our database that include those terms in the title. This requires us to check <em>each movie</em> in our database:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-csharp data-lang=csharp><span class=line><span class=cl>    <span class=c1>// return each movie in the database containing the terms substring</span>
</span></span><span class=line><span class=cl>    <span class=k>foreach</span><span class=p>(</span><span class=n>Movie</span> <span class=n>movie</span> <span class=k>in</span> <span class=n>All</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span><span class=p>(</span><span class=n>movie</span><span class=p>.</span><span class=n>Title</span><span class=p>.</span><span class=n>Contains</span><span class=p>(</span><span class=n>terms</span><span class=p>,</span> <span class=n>StringComparison</span><span class=p>.</span><span class=n>InvariantCultureIgnoreCase</span><span class=p>))</span> 
</span></span><span class=line><span class=cl>        <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=n>results</span><span class=p>.</span><span class=n>Add</span><span class=p>(</span><span class=n>movie</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>   </span></span></code></pre></div><p>We&rsquo;ll use <a href="https://docs.microsoft.com/en-us/dotnet/api/system.string.contains?view=netframework-4.8" rel=external target=_blank>String.Contains()</a> to determine if our terms are a <em>substring</em> within the title, ignoring case differences. If we find it, we&rsquo;ll add the movie to our <code>results</code> list.</p><p>Finally, we&rsquo;ll return that list:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-csharp data-lang=csharp><span class=line><span class=cl>    <span class=k>return</span> <span class=n>results</span><span class=p>;</span></span></span></code></pre></div><p>Now, we can refactor our <em>Index.cshtml.cs</em> to use this new search method:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-csharp data-lang=csharp><span class=line><span class=cl>    <span class=cs>/// &lt;summary&gt;</span>
</span></span><span class=line><span class=cl>    <span class=cs>/// The movies to display on the index page </span>
</span></span><span class=line><span class=cl>    <span class=cs>/// &lt;/summary&gt;</span>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=n>IEnumerable</span><span class=p>&lt;</span><span class=n>Movie</span><span class=p>&gt;</span> <span class=n>Movies</span> <span class=p>{</span> <span class=k>get</span><span class=p>;</span> <span class=kd>protected</span> <span class=k>set</span><span class=p>;</span> <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=cs>/// &lt;summary&gt;</span>
</span></span><span class=line><span class=cl>    <span class=cs>/// The current search terms </span>
</span></span><span class=line><span class=cl>    <span class=cs>/// &lt;/summary&gt;</span>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=kt>string</span> <span class=n>SearchTerms</span> <span class=p>{</span> <span class=k>get</span><span class=p>;</span> <span class=k>set</span><span class=p>;</span> <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=cs>/// &lt;summary&gt;</span>
</span></span><span class=line><span class=cl>    <span class=cs>/// Gets the search results for display on the page</span>
</span></span><span class=line><span class=cl>    <span class=cs>/// &lt;/summary&gt;</span>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=k>void</span> <span class=n>OnGet</span><span class=p>()</span> 
</span></span><span class=line><span class=cl>    <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=n>SearchTerms</span> <span class=p>=</span> <span class=n>Request</span><span class=p>.</span><span class=n>Query</span><span class=p>[</span><span class=s>&#34;SearchTerms&#34;</span><span class=p>];</span>
</span></span><span class=line><span class=cl>        <span class=n>Movies</span> <span class=p>=</span> <span class=n>MovieDatabase</span><span class=p>.</span><span class=n>Search</span><span class=p>(</span><span class=n>SearchTerms</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span></span></span></code></pre></div><p>We&rsquo;ll also need ot refactor our <em>Index.cshtml.cs</em> to use the search results, instead of the entire database:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-html data-lang=html><span class=line><span class=cl><span class=p>&lt;</span><span class=nt>ul</span> <span class=na>class</span><span class=o>=</span><span class=s>&#34;movie-list&#34;</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>    @foreach(Movie movie in @Model.Movies)
</span></span><span class=line><span class=cl>    {
</span></span><span class=line><span class=cl>        <span class=p>&lt;</span><span class=nt>li</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>            <span class=p>&lt;</span><span class=nt>div</span> <span class=na>class</span><span class=o>=</span><span class=s>&#34;details&#34;</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>                <span class=p>&lt;</span><span class=nt>h3</span> <span class=na>class</span><span class=o>=</span><span class=s>&#34;title&#34;</span><span class=p>&gt;</span>@movie.Title<span class=p>&lt;/</span><span class=nt>h3</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>                <span class=p>&lt;</span><span class=nt>div</span> <span class=na>class</span><span class=o>=</span><span class=s>&#34;mpaa&#34;</span><span class=p>&gt;</span>@movie.MPAARating<span class=p>&lt;/</span><span class=nt>div</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>                <span class=p>&lt;</span><span class=nt>div</span> <span class=na>class</span><span class=o>=</span><span class=s>&#34;genre&#34;</span><span class=p>&gt;</span>@movie.MajorGenre<span class=p>&lt;/</span><span class=nt>div</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>            <span class=p>&lt;/</span><span class=nt>div</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>            <span class=p>&lt;</span><span class=nt>div</span> <span class=na>class</span><span class=o>=</span><span class=s>&#34;ratings&#34;</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>                @if(movie.IMDBRating != null)
</span></span><span class=line><span class=cl>                {
</span></span><span class=line><span class=cl>                    <span class=p>&lt;</span><span class=nt>div</span> <span class=na>class</span><span class=o>=</span><span class=s>&#34;imdb&#34;</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>                        @movie.IMDBRating
</span></span><span class=line><span class=cl>                    <span class=p>&lt;/</span><span class=nt>div</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>                }
</span></span><span class=line><span class=cl>                @if(movie.RottenTomatoesRating != null)
</span></span><span class=line><span class=cl>                {
</span></span><span class=line><span class=cl>                    <span class=p>&lt;</span><span class=nt>div</span> <span class=na>class</span><span class=o>=</span><span class=s>&#34;rotten-tomatoes&#34;</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>                        @movie.RottenTomatoesRating
</span></span><span class=line><span class=cl>                    <span class=p>&lt;/</span><span class=nt>div</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>                }
</span></span><span class=line><span class=cl>            <span class=p>&lt;/</span><span class=nt>div</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>        <span class=p>&lt;/</span><span class=nt>li</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>    }
</span></span><span class=line><span class=cl><span class=p>&lt;/</span><span class=nt>ul</span><span class=p>&gt;</span></span></span></code></pre></div><p>If we try running the project again, and searching for the term &ldquo;Love&rdquo;&mldr; it crashes? What is going on?</p><p><a href=#R-image-717e29f1825453f3c4c9c1ec93d839cc class=lightbox-link><img alt="The Encountered Exception" class="border lazy lightbox noshadow figure-image" loading=lazy src=/cis400/images/6.8.2.png style=height:auto;width:auto></a>
<a href=javascript:history.back(); class=lightbox-back id=R-image-717e29f1825453f3c4c9c1ec93d839cc><img alt="The Encountered Exception" class="border lazy lightbox noshadow lightbox-image" loading=lazy src=/cis400/images/6.8.2.png></a></p><p>Notice that the error is a <code>NullReferenceException</code>, and occurs in our <code>if</code> statement checking the title.</p><h3 id=bad-data>Bad Data</h3><p>If we think about what variables are involved in the line <code>if(movie.Title.Contains(terms, StringComparison.InvariantCultureIgnoreCase))</code>, we have:</p><ul><li><code>movie</code></li><li><code>movie.Title</code></li><li><code>terms</code></li></ul><p>Which of these three values can be null? We know for certain <code>terms</code> is not, as we test for the null value and return if it exists just before this portion of our code. Similarly, <code>movie</code> cannot be null, as it is an entry in the list provided by <code>All</code>, and if it were null, our page would have crashed before we added searching. That leaves <code>movie.Title</code> as a possibility.</p><p>If we comb through the data in <em>movies.json</em>, we find on line 54957 a movie with <code>null</code> for a title:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-json data-lang=json><span class=line><span class=cl>  <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;Title&#34;</span><span class=p>:</span> <span class=kc>null</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;USGross&#34;</span><span class=p>:</span> <span class=mi>26403</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;WorldwideGross&#34;</span><span class=p>:</span> <span class=mi>3080493</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;USDVDSales&#34;</span><span class=p>:</span> <span class=kc>null</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;ProductionBudget&#34;</span><span class=p>:</span> <span class=mi>3700000</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;ReleaseDate&#34;</span><span class=p>:</span> <span class=s2>&#34;Nov 03 2006&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;MPAARating&#34;</span><span class=p>:</span> <span class=s2>&#34;Not Rated&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;RunningTime&#34;</span><span class=p>:</span> <span class=mi>85</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;Distributor&#34;</span><span class=p>:</span> <span class=s2>&#34;IFC Films&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;Source&#34;</span><span class=p>:</span> <span class=s2>&#34;Original Screenplay&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;MajorGenre&#34;</span><span class=p>:</span> <span class=s2>&#34;Thriller/Suspense&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;CreativeType&#34;</span><span class=p>:</span> <span class=s2>&#34;Contemporary Fiction&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;Director&#34;</span><span class=p>:</span> <span class=kc>null</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;RottenTomatoesRating&#34;</span><span class=p>:</span> <span class=mi>39</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;IMDBRating&#34;</span><span class=p>:</span> <span class=mf>6.6</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;IMDBVotes&#34;</span><span class=p>:</span> <span class=mi>11986</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span><span class=err>,</span></span></span></code></pre></div><p>Working from the provided metadata, we can eventually identify the film as one titled <a href=https://en.wikipedia.org/wiki/Unknown_(2006_film) rel=external target=_blank>Unknown</a>. It would seem that whomever wrote the script to create this JSON file interpreted &ldquo;Unknown&rdquo; to mean the title was unknown (hence null), rather than the literal word &ldquo;Unknown&rdquo;.</p><p>If we dig deeper into the JSON file, we can find other issues. For example, the JSON identifies the controversial film <a href=https://en.wikipedia.org/wiki/The_Birth_of_a_Nation rel=external target=_blank>Birth of a Nation</a> as being released in 2015, when it was actually the first full-length theatrical film ever released, in <em>1915</em>! Most likely the original database from which these entries were derived only used two digits for the year, i.e. <code>15</code>, and the scripter who converted it to JSON chose a threshold date to determine if it was released in the 20 or 21st century, i.e.:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-csharp data-lang=csharp><span class=line><span class=cl><span class=k>if</span><span class=p>(</span><span class=n>date</span> <span class=p>&lt;</span> <span class=m>28</span><span class=p>)</span> 
</span></span><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=n>date</span> <span class=p>+=</span> <span class=m>2000</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl><span class=k>else</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=n>date</span> <span class=p>+=</span> <span class=m>1900</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span></span></span></code></pre></div><p>The earliest movie release date in the JSON is 1928, for &ldquo;The Broadway Melody&rdquo;, which suggests that <em>all</em> the movies released between 1915 and 1928 have been mislabeled as being released in the 21st century!</p><p>Unfortunately, these kinds of errors are rampant in databases, so as software developers we must be aware that our data may well be <em>dirty</em> - containing erroneous values, and anticipate these errors much like we do with user input. It is a good idea to clean up and fix these errors in our database so that it will be more reliable, but we also need to check for potential errors in our own code, as the database could be updated with more junk data in the future. Thus, we&rsquo;ll add a <code>null</code> check to our <code>if</code> statement in <em>MovieDatabase.cs</em>:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-csharp data-lang=csharp><span class=line><span class=cl><span class=k>if</span><span class=p>(</span><span class=n>movie</span><span class=p>.</span><span class=n>Title</span> <span class=p>!=</span> <span class=kc>null</span> <span class=p>&amp;&amp;</span> <span class=n>movie</span><span class=p>.</span><span class=n>Title</span><span class=p>.</span><span class=n>Contains</span><span class=p>(</span><span class=n>terms</span><span class=p>,</span> <span class=n>StringComparison</span><span class=p>.</span><span class=n>InvariantCultureIgnoreCase</span><span class=p>))</span> </span></span></code></pre></div><p>This will protect us against a <code>NullReferenceException</code> when our movie titles are null. Now if you try the search again, you should see the results:</p><p><a href=#R-image-45bb92b4eef41af1d84c2ead75a33723 class=lightbox-link><img alt="The Search Results for &ldquo;Love&rdquo;" class="border lazy lightbox noshadow figure-image" loading=lazy src=/cis400/images/6.8.3.png style=height:auto;width:auto></a>
<a href=javascript:history.back(); class=lightbox-back id=R-image-45bb92b4eef41af1d84c2ead75a33723><img alt="The Search Results for &ldquo;Love&rdquo;" class="border lazy lightbox noshadow lightbox-image" loading=lazy src=/cis400/images/6.8.3.png></a></p><footer class=footline></footer></article></div></main><div class=git-footer><p class=theme-version-footer>6.0.0</p><p>Last modified by:
<i class='fas fa-user'></i> Julie Thornton
<i class='fas fa-calendar'></i> <a href=https://github.com/ksu-cs-textbooks/cis400/commit/a8014ca4947ac9316debc08d6fe1c024017d6edf>Feb 13, 2024</a></p></div></div><script src=/cis400/js/clipboard.min.js?1724347207 defer></script><script src=/cis400/js/perfect-scrollbar.min.js?1724347207 defer></script><script src=/cis400/js/theme.js?1724347207 defer></script></body></html>