<!doctype html><html lang=en-us dir=ltr itemscope itemtype=http://schema.org/Article><head><meta charset=utf-8><meta name=viewport content="height=device-height,width=device-width,initial-scale=1,minimum-scale=1"><meta name=generator content="Hugo 0.128.0"><meta name=generator content="Relearn 6.0.0"><meta name=description content="In our movie website, we’ve been using a custom “database” object, MovieDatabase to provide the movie data and search and filter functionality. In professional practice, we would probably replace this with an external database program. These programs have been developed specifically for persisting and accessing data, and leverage specialized data structures like B+ trees that allow them to do searches and filters much more efficiently.
Some of the most widely adopted database programs are relational databases like MySQL, MsSQL, Postgres, and SQLLite."><meta name=author content="Nathan Bean"><meta name=twitter:card content="summary"><meta name=twitter:title content="Using LINQ :: K-State CIS 400 Textbook"><meta name=twitter:description content="In our movie website, we’ve been using a custom “database” object, MovieDatabase to provide the movie data and search and filter functionality. In professional practice, we would probably replace this with an external database program. These programs have been developed specifically for persisting and accessing data, and leverage specialized data structures like B+ trees that allow them to do searches and filters much more efficiently.
Some of the most widely adopted database programs are relational databases like MySQL, MsSQL, Postgres, and SQLLite."><meta property="og:url" content="https://textbooks.cs.ksu.edu/cis400/c-exercises-s23/12-web-data/04-using-linq/"><meta property="og:site_name" content="K-State CIS 400 Textbook"><meta property="og:title" content="Using LINQ :: K-State CIS 400 Textbook"><meta property="og:description" content="In our movie website, we’ve been using a custom “database” object, MovieDatabase to provide the movie data and search and filter functionality. In professional practice, we would probably replace this with an external database program. These programs have been developed specifically for persisting and accessing data, and leverage specialized data structures like B+ trees that allow them to do searches and filters much more efficiently.
Some of the most widely adopted database programs are relational databases like MySQL, MsSQL, Postgres, and SQLLite."><meta property="og:locale" content="en-us"><meta property="og:type" content="article"><meta property="article:section" content="Exercises"><meta property="article:published_time" content="2018-08-24T10:53:26-05:00"><meta property="article:modified_time" content="2023-11-06T10:30:24-06:00"><meta itemprop=name content="Using LINQ :: K-State CIS 400 Textbook"><meta itemprop=description content="In our movie website, we’ve been using a custom “database” object, MovieDatabase to provide the movie data and search and filter functionality. In professional practice, we would probably replace this with an external database program. These programs have been developed specifically for persisting and accessing data, and leverage specialized data structures like B+ trees that allow them to do searches and filters much more efficiently.
Some of the most widely adopted database programs are relational databases like MySQL, MsSQL, Postgres, and SQLLite."><meta itemprop=datePublished content="2018-08-24T10:53:26-05:00"><meta itemprop=dateModified content="2023-11-06T10:30:24-06:00"><meta itemprop=wordCount content="1032"><title>Using LINQ :: K-State CIS 400 Textbook</title>
<link href=https://textbooks.cs.ksu.edu/cis400/c-exercises-s23/12-web-data/04-using-linq/ rel=canonical type=text/html title="Using LINQ :: K-State CIS 400 Textbook"><link href=/cis400/c-exercises-s23/12-web-data/04-using-linq/index.xml rel=alternate type=application/rss+xml title="Using LINQ :: K-State CIS 400 Textbook"><link href=/cis400/c-exercises-s23/12-web-data/04-using-linq/index.print.html rel=alternate type=text/html title="Using LINQ :: K-State CIS 400 Textbook"><link href=/cis400/c-exercises-s23/12-web-data/04-using-linq/embed.html rel=alternate type=text/html title="Using LINQ :: K-State CIS 400 Textbook"><link href=/cis400/css/fontawesome-all.min.css?1724766111 rel=stylesheet media=print onload='this.media="all",this.onload=null'><noscript><link href=/cis400/css/fontawesome-all.min.css?1724766111 rel=stylesheet></noscript><link href=/cis400/css/nucleus.css?1724766111 rel=stylesheet><link href=/cis400/css/auto-complete.css?1724766111 rel=stylesheet media=print onload='this.media="all",this.onload=null'><noscript><link href=/cis400/css/auto-complete.css?1724766111 rel=stylesheet></noscript><link href=/cis400/css/perfect-scrollbar.min.css?1724766111 rel=stylesheet><link href=/cis400/css/fonts.css?1724766111 rel=stylesheet media=print onload='this.media="all",this.onload=null'><noscript><link href=/cis400/css/fonts.css?1724766111 rel=stylesheet></noscript><link href=/cis400/css/theme.css?1724766111 rel=stylesheet><link href=/cis400/css/theme-auto.css?1724766111 rel=stylesheet id=R-variant-style><link href=/cis400/css/chroma-auto.css?1724766111 rel=stylesheet id=R-variant-chroma-style><link href=/cis400/css/variant.css?1724766111 rel=stylesheet><link href=/cis400/css/print.css?1724766111 rel=stylesheet media=print><script src=/cis400/js/variant.js?1724766111></script><script>window.relearn=window.relearn||{},window.relearn.relBasePath="../../..",window.relearn.relBaseUri="../../../..",window.relearn.absBaseUri="https://textbooks.cs.ksu.edu/cis400",window.index_js_url="/cis400/index.search.js",window.variants&&variants.init(["auto","light-theme","dark-theme"]),window.T_Copy_to_clipboard=`Copy to clipboard`,window.T_Copied_to_clipboard=`Copied to clipboard!`,window.T_Copy_link_to_clipboard=`Copy link to clipboard`,window.T_Link_copied_to_clipboard=`Copied link to clipboard!`,window.T_Reset_view=`Reset view`,window.T_View_reset=`View reset!`,window.T_No_results_found=`No results found for "{0}"`,window.T_N_results_found=`{1} results found for "{0}"`</script><link href=/cis400/css/custom.css?1724766111 rel=stylesheet></head><body class="mobile-support tele disableInlineCopyToClipboard" data-url=/cis400/c-exercises-s23/12-web-data/04-using-linq/><div id=tele class="tele mirror"><div id=R-body class=default-animation><div id=R-body-overlay></div><div id=R-main-overlay></div><main id=R-body-inner class="highlightable default" tabindex=-1><div class=flex-block-wrapper><article class=default><header class=headline></header><h1 id=using-linq>Using LINQ</h1><p>In our movie website, we&rsquo;ve been using a custom &ldquo;database&rdquo; object, <code>MovieDatabase</code> to provide the movie data and search and filter functionality. In professional practice, we would probably replace this with an external database program. These programs have been developed specifically for persisting and accessing data, and leverage specialized data structures like B+ trees that allow them to do searches and filters much more efficiently.</p><p>Some of the most widely adopted database programs are <em>relational databases</em> like MySQL, MsSQL, Postgres, and SQLLite. These predate object-orientation, and accept requests for data in the form of SQL (Structured Query Language). You will learn more about these databases and how to use them in CIS560.</p><h2 id=linq>LINQ</h2><p>Microsoft, inspired by SQL, introduced Language Integrated Query (LINQ) in 2007 to bring the concept of a query language into .NET. LINQ allows you to construct queries in either chained method calls or in a syntax similar to SQL that can operate on collections or relational databases.</p><p>For relational databases, LINQ queries are converted internally to SQL queries, and dispatched to the database. But their real power is that they can also be used with any collection that supports either the <code>IEnumerable</code> or <code>IEnumerable&lt;T></code> interfaces. LINQ can be used to replace the kinds of filter and search functions we wrote for our <code>MovieDatabase</code>. Let&rsquo;s try it out with our movie website.</p><p>LINQ operates through extension methods, so we need to be sure to add the LINQ namespace to our CS files where we are going to employ them. We&rsquo;ll be adding our LINQ commands to our page model, so sure that is the case with your <em>Pages/Index.cshtml.cs</em>:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-csharp data-lang=csharp><span class=line><span class=cl><span class=k>using</span> <span class=nn>System.Linq</span><span class=p>;</span></span></span></code></pre></div><p>Adding this using statement will bring in all the extension methods for LINQ, and will also prompt Visual Studio to recognize the query-style syntax.</p><h2 id=searching-with-linq>Searching with LINQ</h2><p>One of the most useful extension methods in LINQ is <a href="https://docs.microsoft.com/en-us/dotnet/api/system.linq.enumerable.where?view=netcore-3.1" rel=external target=_blank>Where()</a>. It can be invoked on any <code>IEnumerable</code> and accepts a <code>Func</code> (a delegate type). This delegate takes a single argument - the current item being enumerated over, and its body should return a boolean value - <code>true</code> if the item should be included in the results, and <code>false</code> if it should not.</p><p>We can thus use our existing <code>SearchTerms</code> property as the basis for our test: <code>movie => movie.Title != null && movie.Title.Contains(SearchTerms)</code> (note that with lambda expressions, if the result is single expression we can omit the <code>{}</code> and the <code>return</code> is implied). Also note that we incorporate the null check directly into the expression using the boolean and <code>&&</code> operator.</p><p>We can replace our current search with a <code>Where()</code> call invoking this method:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-csharp data-lang=csharp><span class=line><span class=cl><span class=n>Movies</span> <span class=p>=</span> <span class=n>MovieDatabase</span><span class=p>.</span><span class=n>All</span><span class=p>.</span><span class=n>Where</span><span class=p>(</span><span class=n>movie</span> <span class=p>=&gt;</span> <span class=n>movie</span><span class=p>.</span><span class=n>Title</span> <span class=p>!=</span> <span class=kc>null</span> <span class=p>&amp;&amp;</span> <span class=n>movie</span><span class=p>.</span><span class=n>Title</span><span class=p>.</span><span class=n>Contains</span><span class=p>(</span><span class=n>SearchTerms</span><span class=p>,</span> <span class=n>String</span><span class=p>));</span></span></span></code></pre></div><p>However if we run the program we will encounter a null exception. On our first GET request, the value of <code>SearchTerms</code> is null, which is <em>not</em> a legal argument for <code>String.Contains()</code>.</p><h2 id=making-search-conditional>Making Search Conditional</h2><p>If the <code>SearchTerms</code> is null, that indicates that the user did not enter a search term - accordingly, we probably don&rsquo;t want to search. We can wrap our filter in an <code>if</code> test to prevent applying the filter when there is no search term. Thus, we would refactor our filtering expression to:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-csharp data-lang=csharp><span class=line><span class=cl><span class=n>Movies</span> <span class=p>=</span> <span class=n>MovieDatabase</span><span class=p>.</span><span class=n>All</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=c1>// Search movie titles for the SearchTerms</span>
</span></span><span class=line><span class=cl><span class=k>if</span><span class=p>(</span><span class=n>SearchTerms</span> <span class=p>!=</span> <span class=kc>null</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=n>Movies</span> <span class=p>=</span> <span class=n>Movies</span><span class=p>.</span><span class=n>Where</span><span class=p>(</span><span class=n>movie</span> <span class=p>=&gt;</span> <span class=n>movie</span><span class=p>.</span><span class=n>Title</span> <span class=p>!=</span> <span class=kc>null</span> <span class=p>&amp;&amp;</span> <span class=n>movie</span><span class=p>.</span><span class=n>Title</span><span class=p>.</span><span class=n>Contains</span><span class=p>(</span><span class=n>SearchTerms</span><span class=p>,</span> <span class=n>StringComparison</span><span class=p>.</span><span class=n>InvariantCultureIgnoreCase</span><span class=p>));</span>
</span></span><span class=line><span class=cl><span class=p>}</span></span></span></code></pre></div><p>Now if we run the program, and search for a specific term, we&rsquo;ll see our results is modified to contain <em>only</em> those movies with the terms in their title!</p><p>We can also use the query syntax instead of the extension method syntax, which is similar to SQL:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-csharp data-lang=csharp><span class=line><span class=cl><span class=n>Movies</span> <span class=p>=</span> <span class=n>MovieDatabase</span><span class=p>.</span><span class=n>All</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=c1>// Search movie titles for the SearchTerms</span>
</span></span><span class=line><span class=cl><span class=k>if</span><span class=p>(</span><span class=n>SerchTerms</span> <span class=p>!=</span> <span class=kc>null</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=n>Movies</span> <span class=p>=</span> <span class=k>from</span> <span class=n>movie</span> <span class=k>in</span> <span class=n>Movies</span>
</span></span><span class=line><span class=cl>        <span class=k>where</span> <span class=n>movie</span><span class=p>.</span><span class=n>Title</span> <span class=p>!=</span> <span class=kc>null</span> <span class=p>&amp;&amp;</span> <span class=n>movie</span><span class=p>.</span><span class=n>Title</span><span class=p>.</span><span class=n>Contains</span><span class=p>(</span><span class=n>SearchTerms</span><span class=p>,</span> <span class=n>StringComparison</span><span class=p>.</span><span class=n>InvariantCultureIgnoreCase</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=k>select</span> <span class=n>movie</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span></span></span></code></pre></div><p>This syntax is converted by the C# compiler to use the extension methods as part of the compilation process.</p><div class="box notices cstyle info"><div class=box-label><i class="fa-fw fas fa-info-circle"></i> Info</div><div class=box-content><p>The search approach listed above will only find the <em>exact</em> search terms, i.e. searching for &ldquo;Clear Present Danger&rdquo; will <em>not</em> match the film &ldquo;Clear and Present Danger&rdquo;. How might you tweak the search approach so that terms would be found individually?</p></div></div><p>You can use either form for writing your queries, though it is best to stay consistent within a single program.</p><h2 id=filtering-with-linq>Filtering with LINQ</h2><p>Filtering is also accomplished through the <a href="https://docs.microsoft.com/en-us/dotnet/api/system.linq.enumerable.where?view=netcore-3.1" rel=external target=_blank>Where()</a>. We can add additional tests within our search <code>Where()</code>, but it is more legible to add <em>additional</em> <code>Where</code> calls:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-csharp data-lang=csharp><span class=line><span class=cl><span class=n>Movies</span> <span class=p>=</span> <span class=n>MovieDatabase</span><span class=p>.</span><span class=n>All</span>
</span></span><span class=line><span class=cl>    <span class=c1>// Search movie titles for the SearchTerms</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span><span class=p>(</span><span class=n>SearchTerms</span> <span class=p>!=</span> <span class=kc>null</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=n>Movies</span> <span class=p>=</span> <span class=n>Movies</span><span class=p>.</span><span class=n>Where</span><span class=p>(</span><span class=n>movie</span> <span class=p>=&gt;</span> <span class=n>movie</span><span class=p>.</span><span class=n>Title</span> <span class=p>!=</span> <span class=kc>null</span> <span class=p>&amp;&amp;</span> <span class=n>movie</span><span class=p>.</span><span class=n>Title</span><span class=p>.</span><span class=n>Contains</span><span class=p>(</span><span class=n>SearchTerms</span><span class=p>,</span> <span class=n>StringComparison</span><span class=p>.</span><span class=n>InvariantCultureIgnoreCase</span><span class=p>));</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=c1>// Filter by MPAA Rating</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span><span class=p>(</span><span class=n>MPAARatings</span> <span class=p>!=</span> <span class=kc>null</span> <span class=p>&amp;&amp;</span> <span class=n>MPAARatings</span><span class=p>.</span><span class=n>Length</span> <span class=p>!=</span> <span class=m>0</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=n>Movies</span> <span class=p>=</span> <span class=n>Movies</span><span class=p>.</span><span class=n>Where</span><span class=p>(</span><span class=n>movie</span> <span class=p>=&gt;</span>
</span></span><span class=line><span class=cl>            <span class=n>movie</span><span class=p>.</span><span class=n>MPAARating</span> <span class=p>!=</span> <span class=kc>null</span> <span class=p>&amp;&amp;</span>
</span></span><span class=line><span class=cl>            <span class=n>MPAARatings</span><span class=p>.</span><span class=n>Contains</span><span class=p>(</span><span class=n>movie</span><span class=p>.</span><span class=n>MPAARating</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            <span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span></span></span></code></pre></div><div class="box notices cstyle todo"><div class=box-label></div><div class=box-content><p>The numerical filters are handled the same way - with additional <code>Where</code> clauses. I leave this as an exercise for the reader to complete.</p></div></div><h2 id=benefits-of-linq>Benefits of LINQ</h2><p>While LINQ is a bit less code for us to write, there is another big benefit - the actual filtering is only applied <em>when we start iterating through the results</em>. This means that LINQ queries with multiple <code>Where()</code> invocations can combine them into a single iteration.</p><p>Consider our movie website example. We have four filters - the search, the MPAA Ratings, the IMDB Ratings, and the Rotten Tomato Rating. In the worst case, each movie in the database would pass each filter, so that our list never got smaller. With the filter functions we wrote in <code>MovieDatabase</code>, we would have to iterate over that full list <em>four times</em>. In terms of complexity, that&rsquo;s $O(4n)$.</p><p>In contrast, because LINQ doesn&rsquo;t actually run the filters until we start iterating, it can combine all the <code>While</code> tests into a single boolean expression. The result is it only has to iterate through the list <em>once</em>. Hence, its complexity becomes $O(n)$. There is a little additional overhead for holding onto the query information that way, but it&rsquo;s small compared to the benefit.</p><p>Also, we could have done the same kind of optimization ourselves, but it takes a lot of work to set up, and may not be worth it for a single web app. But LINQ provides us that benefit for free.</p><footer class=footline></footer></article></div></main></div></div><script src=/cis400/js/clipboard.min.js?1724766111 defer></script><script src=/cis400/js/perfect-scrollbar.min.js?1724766111 defer></script><script src=/cis400/js/theme.js?1724766111 defer></script><script src=/cis400/js/tele-scroll.js?1724766111 defer></script></body></html>