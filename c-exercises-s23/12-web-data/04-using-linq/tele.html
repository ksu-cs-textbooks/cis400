




	
	
		

	
	
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		
		

	
	
		

	
	
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		
		

	
	
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		
		

	
	
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		
		

	
	
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		
		

	
	
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		
		

	
	
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		
		

	
	
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		
		
		

	
	
		

	
	
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		
		

	
	
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		
		

	
	
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		
		

	
	
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		
		

	
	
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		
		

	
	
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		
		
		

	
	
		

	
	
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		
		

	
	
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		
		

	
	
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		
		

	
	
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		
		

	
	
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		
		

	
	
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		
		
		

	
	
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		
		

	
	
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		
		

	
	
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		
		

	
	
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		
		

	
	
		

	
	
		
		

	
	
		
		
		
<!DOCTYPE html>
<html lang="en" dir="ltr">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="height=device-height, width=device-width, initial-scale=1.0, minimum-scale=1.0">
    <meta name="generator" content="Hugo 0.117.0">
    <meta name="generator" content="Relearn 5.18.0">
    <meta name="description" content="K-State CIS 400 Textbook">
    <meta name="author" content="Nathan Bean">
    <title>Using LINQ :: K-State CIS 400 Textbook</title>
    <link href="https://ksu-cs-textbooks.github.io/cis400/c-exercises-s23/12-web-data/04-using-linq/index.html" rel="canonical" type="text/html" title="Using LINQ :: K-State CIS 400 Textbook">
    <link href="https://ksu-cs-textbooks.github.io/cis400/c-exercises-s23/12-web-data/04-using-linq/index.xml" rel="alternate" type="application/rss+xml" title="Using LINQ :: K-State CIS 400 Textbook">
    <link href="https://ksu-cs-textbooks.github.io/cis400/c-exercises-s23/12-web-data/04-using-linq/index.print.html" rel="alternate" type="text/html" title="Using LINQ :: K-State CIS 400 Textbook">
    <link href="https://ksu-cs-textbooks.github.io/cis400/c-exercises-s23/12-web-data/04-using-linq/embed.html" rel="alternate" type="text/html" title="Using LINQ :: K-State CIS 400 Textbook">
    <!-- https://github.com/filamentgroup/loadCSS/blob/master/README.md#how-to-use -->
    <link href="https://ksu-cs-textbooks.github.io/cis400/css/fontawesome-all.min.css?1713796387" rel="stylesheet" media="print" onload="this.media='all';this.onload=null;"><noscript><link href="https://ksu-cs-textbooks.github.io/cis400/css/fontawesome-all.min.css?1713796387" rel="stylesheet"></noscript>
    <link href="https://ksu-cs-textbooks.github.io/cis400/css/nucleus.css?1713796387" rel="stylesheet">
    <link href="https://ksu-cs-textbooks.github.io/cis400/css/auto-complete.css?1713796387" rel="stylesheet" media="print" onload="this.media='all';this.onload=null;"><noscript><link href="https://ksu-cs-textbooks.github.io/cis400/css/auto-complete.css?1713796387" rel="stylesheet"></noscript>
    <link href="https://ksu-cs-textbooks.github.io/cis400/css/perfect-scrollbar.min.css?1713796387" rel="stylesheet">
    <link href="https://ksu-cs-textbooks.github.io/cis400/css/fonts.css?1713796387" rel="stylesheet" media="print" onload="this.media='all';this.onload=null;"><noscript><link href="https://ksu-cs-textbooks.github.io/cis400/css/fonts.css?1713796387" rel="stylesheet"></noscript>
    <link href="https://ksu-cs-textbooks.github.io/cis400/css/theme.css?1713796387" rel="stylesheet">
    <link href="https://ksu-cs-textbooks.github.io/cis400/css/theme-auto.css?1713796387" rel="stylesheet" id="variant-style">
    <link href="https://ksu-cs-textbooks.github.io/cis400/css/variant.css?1713796387" rel="stylesheet">
    <link href="https://ksu-cs-textbooks.github.io/cis400/css/print.css?1713796387" rel="stylesheet" media="print">
    <link href="https://ksu-cs-textbooks.github.io/cis400/css/ie.css?1713796387" rel="stylesheet">
    <script src="https://ksu-cs-textbooks.github.io/cis400/js/url.js?1713796387"></script>
    <script src="https://ksu-cs-textbooks.github.io/cis400/js/variant.js?1713796387"></script>
    <script>
      // hack to let hugo tell us how to get to the root when using relativeURLs, it needs to be called *url= for it to do its magic:
      // https://github.com/gohugoio/hugo/blob/145b3fcce35fbac25c7033c91c1b7ae6d1179da8/transform/urlreplacers/absurlreplacer.go#L72
      window.index_js_url="https://ksu-cs-textbooks.github.io/cis400/index.search.js";
      var root_url="https://ksu-cs-textbooks.github.io/cis400/";
      var baseUri=root_url.replace(/\/$/, '');
      // translations
      window.T_Copy_to_clipboard = 'Copy to clipboard';
      window.T_Copied_to_clipboard = 'Copied to clipboard!';
      window.T_Copy_link_to_clipboard = 'Copy link to clipboard';
      window.T_Link_copied_to_clipboard = 'Copied link to clipboard!';
      window.T_No_results_found = 'No results found for \u0022{0}\u0022';
      window.T_N_results_found = '{1} results found for \u0022{0}\u0022';
      // some further base stuff
      var baseUriFull='https:\/\/ksu-cs-textbooks.github.io\/cis400/';
      window.variants && variants.init( [ 'auto', 'light-theme', 'dark-theme' ] );
    </script>
    
    <link href="https://ksu-cs-textbooks.github.io/cis400/css/custom.css?1713796387" rel="stylesheet">

  </head>
  <body class="mobile-support tele disableInlineCopyToClipboard" data-url="https://ksu-cs-textbooks.github.io/cis400/c-exercises-s23/12-web-data/04-using-linq/index.html">
    
    <div id="tele" class="tele mirror">
    
    <div id="body" class="default-animation">
      
      
      
      <main id="body-inner" class="highlightable default" tabindex="-1">
        <div class="flex-block-wrapper">
          <article class="default">
            <header class="headline">
            </header>
<h1 id="using-linq">Using LINQ</h1>

<p>In our movie website, we&rsquo;ve been using a custom &ldquo;database&rdquo; object, <code>MovieDatabase</code> to provide the movie data and search and filter functionality.  In professional practice, we would probably replace this with an external database program.  These programs have been developed specifically for persisting and accessing data, and leverage specialized data structures like B+ trees that allow them to do searches and filters much more efficiently.</p>
<p>Some of the most widely adopted database programs are <em>relational databases</em> like MySQL, MsSQL, Postgres, and SQLLite.  These predate object-orientation, and accept requests for data in the form of SQL (Structured Query Language).  You will learn more about these databases and how to use them in CIS560.</p>
<h2 id="linq">LINQ</h2>
<p>Microsoft, inspired by SQL, introduced Language Integrated Query (LINQ) in 2007 to bring the concept of a query language into .NET.  LINQ allows you to construct queries in either chained method calls or in a syntax similar to SQL that can operate on collections or relational databases.</p>
<p>For relational databases, LINQ queries are converted internally to SQL queries, and dispatched to the database.  But their real power is that they can also be used with any collection that supports either the <code>IEnumerable</code> or <code>IEnumerable&lt;T&gt;</code> interfaces.  LINQ can be used to replace the kinds of filter and search functions we wrote for our <code>MovieDatabase</code>.  Let&rsquo;s try it out with our movie website.</p>
<p>LINQ operates through extension methods, so we need to be sure to add the LINQ namespace to our CS files where we are going to employ them.  We&rsquo;ll be adding our LINQ commands to our page model, so sure that is the case with your <em>Pages/Index.cshtml.cs</em>:</p>
<div class="wrap-code highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-csharp" data-lang="csharp"><span style="display:flex;"><span><span style="color:#66d9ef">using</span> System.Linq;</span></span></code></pre></div><p>Adding this using statement will bring in all the extension methods for LINQ, and will also prompt Visual Studio to recognize the query-style syntax.</p>
<h2 id="searching-with-linq">Searching with LINQ</h2>
<p>One of the most useful extension methods in LINQ is <a href="https://docs.microsoft.com/en-us/dotnet/api/system.linq.enumerable.where?view=netcore-3.1" target="_blank">Where()</a>
.  It can be invoked on any <code>IEnumerable</code> and accepts a <code>Func</code> (a delegate type).  This delegate takes a single argument - the current item being enumerated over, and its body should return a boolean value - <code>true</code> if the item should be included in the results, and <code>false</code> if it should not.</p>
<p>We can thus use our existing <code>SearchTerms</code> property as the basis for our test: <code>movie =&gt; movie.Title != null &amp;&amp; movie.Title.Contains(SearchTerms)</code> (note that with lambda expressions, if the result is single expression we can omit the <code>{}</code> and the <code>return</code> is implied).  Also note that we incorporate the null check directly into the expression using the boolean and <code>&amp;&amp;</code> operator.</p>
<p>We can replace our current search with a <code>Where()</code> call invoking this method:</p>
<div class="wrap-code highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-csharp" data-lang="csharp"><span style="display:flex;"><span>Movies = MovieDatabase.All.Where(movie =&gt; movie.Title != <span style="color:#66d9ef">null</span> &amp;&amp; movie.Title.Contains(SearchTerms, String));</span></span></code></pre></div><p>However if we run the program we will encounter a null exception.  On our first GET request, the value of <code>SearchTerms</code> is null, which is <em>not</em> a legal argument for <code>String.Contains()</code>.</p>
<h2 id="making-search-conditional">Making Search Conditional</h2>
<p>If the <code>SearchTerms</code> is null, that indicates that the user did not enter a search term - accordingly, we probably don&rsquo;t want to search.  We can wrap our filter in an <code>if</code> test to prevent applying the filter when there is no search term.  Thus, we would refactor our filtering expression to:</p>
<div class="wrap-code highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-csharp" data-lang="csharp"><span style="display:flex;"><span>Movies = MovieDatabase.All;
</span></span><span style="display:flex;"><span><span style="color:#75715e">// Search movie titles for the SearchTerms</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">if</span>(SearchTerms != <span style="color:#66d9ef">null</span>) {
</span></span><span style="display:flex;"><span>    Movies = Movies.Where(movie =&gt; movie.Title != <span style="color:#66d9ef">null</span> &amp;&amp; movie.Title.Contains(SearchTerms, StringComparison.InvariantCultureIgnoreCase));
</span></span><span style="display:flex;"><span>}</span></span></code></pre></div><p>Now if we run the program, and search for a specific term, we&rsquo;ll see our results is modified to contain <em>only</em> those movies with the terms in their title!</p>
<p>We can also use the query syntax instead of the extension method syntax, which is similar to SQL:</p>
<div class="wrap-code highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-csharp" data-lang="csharp"><span style="display:flex;"><span>Movies = MovieDatabase.All;
</span></span><span style="display:flex;"><span><span style="color:#75715e">// Search movie titles for the SearchTerms</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">if</span>(SerchTerms != <span style="color:#66d9ef">null</span>)
</span></span><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>    Movies = <span style="color:#66d9ef">from</span> movie <span style="color:#66d9ef">in</span> Movies
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">where</span> movie.Title != <span style="color:#66d9ef">null</span> &amp;&amp; movie.Title.Contains(SearchTerms, StringComparison.InvariantCultureIgnoreCase)
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">select</span> movie;
</span></span><span style="display:flex;"><span>}</span></span></code></pre></div><p>This syntax is converted by the C# compiler to use the extension methods as part of the compilation process.</p>

  
  
<div class="box notices cstyle info">
  <div class="box-label"><i class="fa-fw fas fa-info-circle"></i> Info</div>
  <div class="box-content">

<p>The search approach listed above will only find the <em>exact</em> search terms, i.e. searching for &ldquo;Clear Present Danger&rdquo; will <em>not</em> match the film &ldquo;Clear and Present Danger&rdquo;.  How might you tweak the search approach so that terms would be found individually?</p>
</div>
</div>
<p>You can use either form for writing your queries, though it is best to stay consistent within a single program.</p>
<h2 id="filtering-with-linq">Filtering with LINQ</h2>
<p>Filtering is also accomplished through the <a href="https://docs.microsoft.com/en-us/dotnet/api/system.linq.enumerable.where?view=netcore-3.1" target="_blank">Where()</a>
.  We can add additional tests within our search <code>Where()</code>, but it is more legible to add <em>additional</em> <code>Where</code> calls:</p>
<div class="wrap-code highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-csharp" data-lang="csharp"><span style="display:flex;"><span>Movies = MovieDatabase.All
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">// Search movie titles for the SearchTerms</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">if</span>(SearchTerms != <span style="color:#66d9ef">null</span>) {
</span></span><span style="display:flex;"><span>        Movies = Movies.Where(movie =&gt; movie.Title != <span style="color:#66d9ef">null</span> &amp;&amp; movie.Title.Contains(SearchTerms, StringComparison.InvariantCultureIgnoreCase));
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">// Filter by MPAA Rating</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">if</span>(MPAARatings != <span style="color:#66d9ef">null</span> &amp;&amp; MPAARatings.Length != <span style="color:#ae81ff">0</span>)
</span></span><span style="display:flex;"><span>    {
</span></span><span style="display:flex;"><span>        Movies = Movies.Where(movie =&gt;
</span></span><span style="display:flex;"><span>            movie.MPAARating != <span style="color:#66d9ef">null</span> &amp;&amp;
</span></span><span style="display:flex;"><span>            MPAARatings.Contains(movie.MPAARating)
</span></span><span style="display:flex;"><span>            );
</span></span><span style="display:flex;"><span>    }</span></span></code></pre></div>
  
  
<div class="box notices cstyle todo">
  <div class="box-label"></div>
  <div class="box-content">

<p>The numerical filters are handled the same way - with additional <code>Where</code> clauses.  I leave this as an exercise for the reader to complete.</p>
</div>
</div>
<h2 id="benefits-of-linq">Benefits of LINQ</h2>
<p>While LINQ is a bit less code for us to write, there is another big benefit - the actual filtering is only applied <em>when we start iterating through the results</em>.  This means that LINQ queries with multiple <code>Where()</code> invocations can combine them into a single iteration.</p>
<p>Consider our movie website example.  We have four filters - the search, the MPAA Ratings, the IMDB Ratings, and the Rotten Tomato Rating.  In the worst case, each movie in the database would pass each filter, so that our list never got smaller.  With the filter functions we wrote in <code>MovieDatabase</code>, we would have to iterate over that full list <em>four times</em>.  In terms of complexity, that&rsquo;s $O(4n)$.</p>
<p>In contrast, because LINQ doesn&rsquo;t actually run the filters until we start iterating, it can combine all the <code>While</code> tests into a single boolean expression.  The result is it only has to iterate through the list <em>once</em>.  Hence, its complexity becomes $O(n)$.  There is a little additional overhead for holding onto the query information that way, but it&rsquo;s small compared to the benefit.</p>
<p>Also, we could have done the same kind of optimization ourselves, but it takes a lot of work to set up, and may not be worth it for a single web app.  But LINQ provides us that benefit for free.</p>

            <footer class="footline">

            </footer>
          </article>
        </div>
      </main>
    </div>
    
    </div>
    
    
    
    
    <script src="https://ksu-cs-textbooks.github.io/cis400/js/clipboard.min.js?1713796391" defer></script>
    <script src="https://ksu-cs-textbooks.github.io/cis400/js/perfect-scrollbar.min.js?1713796391" defer></script>
    <script src="https://ksu-cs-textbooks.github.io/cis400/js/theme.js?1713796391" defer></script>
    
    <script src="https://ksu-cs-textbooks.github.io/cis400/js/tele-scroll.js?1713796391 defer"></script>
    
  </body>
</html>
