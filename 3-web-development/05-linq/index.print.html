




	
	
		

	
	
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		
		

	
	
		

	
	
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		
		

	
	
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		
		

	
	
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		
		

	
	
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		
		

	
	
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		
		

	
	
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		
		

	
	
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		
		
		

	
	
		

	
	
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		
		

	
	
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		
		

	
	
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		
		

	
	
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		
		

	
	
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		
		

	
	
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		
		
		

	
	
		

	
	
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		
		

	
	
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		
		

	
	
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		
		

	
	
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		
		

	
	
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		
		

	
	
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		
		
		

	
	
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		
		

	
	
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		
<!DOCTYPE html>
<html lang="en" dir="ltr">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="height=device-height, width=device-width, initial-scale=1.0, minimum-scale=1.0">
    <meta name="generator" content="Hugo 0.117.0">
    <meta name="generator" content="Relearn 5.18.0">
    <meta name="description" content="K-State CIS 400 Textbook">
    <meta name="author" content="Nathan Bean">
    <title>LINQ :: K-State CIS 400 Textbook</title>
    <link href="https://ksu-cs-textbooks.github.io/cis400/3-web-development/05-linq/index.html" rel="canonical" type="text/html" title="LINQ :: K-State CIS 400 Textbook">
    <link href="https://ksu-cs-textbooks.github.io/cis400/3-web-development/05-linq/index.xml" rel="alternate" type="application/rss+xml" title="LINQ :: K-State CIS 400 Textbook">
    <link href="https://ksu-cs-textbooks.github.io/cis400/3-web-development/05-linq/tele.html" rel="alternate" type="text/html" title="LINQ :: K-State CIS 400 Textbook">
    <link href="https://ksu-cs-textbooks.github.io/cis400/3-web-development/05-linq/embed.html" rel="alternate" type="text/html" title="LINQ :: K-State CIS 400 Textbook">
    <!-- https://github.com/filamentgroup/loadCSS/blob/master/README.md#how-to-use -->
    <link href="https://ksu-cs-textbooks.github.io/cis400/css/fontawesome-all.min.css?1698777572" rel="stylesheet" media="print" onload="this.media='all';this.onload=null;"><noscript><link href="https://ksu-cs-textbooks.github.io/cis400/css/fontawesome-all.min.css?1698777572" rel="stylesheet"></noscript>
    <link href="https://ksu-cs-textbooks.github.io/cis400/css/nucleus.css?1698777572" rel="stylesheet">
    <link href="https://ksu-cs-textbooks.github.io/cis400/css/auto-complete.css?1698777572" rel="stylesheet" media="print" onload="this.media='all';this.onload=null;"><noscript><link href="https://ksu-cs-textbooks.github.io/cis400/css/auto-complete.css?1698777572" rel="stylesheet"></noscript>
    <link href="https://ksu-cs-textbooks.github.io/cis400/css/perfect-scrollbar.min.css?1698777572" rel="stylesheet">
    <link href="https://ksu-cs-textbooks.github.io/cis400/css/fonts.css?1698777572" rel="stylesheet" media="print" onload="this.media='all';this.onload=null;"><noscript><link href="https://ksu-cs-textbooks.github.io/cis400/css/fonts.css?1698777572" rel="stylesheet"></noscript>
    <link href="https://ksu-cs-textbooks.github.io/cis400/css/theme.css?1698777572" rel="stylesheet">
    <link href="https://ksu-cs-textbooks.github.io/cis400/css/theme-auto.css?1698777572" rel="stylesheet" id="variant-style">
    <link href="https://ksu-cs-textbooks.github.io/cis400/css/variant.css?1698777572" rel="stylesheet">
    <link href="https://ksu-cs-textbooks.github.io/cis400/css/print.css?1698777572" rel="stylesheet" media="print">
    <link href="https://ksu-cs-textbooks.github.io/cis400/css/format-print.css?1698777572" rel="stylesheet">
    <link href="https://ksu-cs-textbooks.github.io/cis400/css/ie.css?1698777572" rel="stylesheet">
    <script src="https://ksu-cs-textbooks.github.io/cis400/js/url.js?1698777572"></script>
    <script src="https://ksu-cs-textbooks.github.io/cis400/js/variant.js?1698777572"></script>
    <script>
      // hack to let hugo tell us how to get to the root when using relativeURLs, it needs to be called *url= for it to do its magic:
      // https://github.com/gohugoio/hugo/blob/145b3fcce35fbac25c7033c91c1b7ae6d1179da8/transform/urlreplacers/absurlreplacer.go#L72
      window.index_js_url="https://ksu-cs-textbooks.github.io/cis400/index.search.js";
      var root_url="https://ksu-cs-textbooks.github.io/cis400/";
      var baseUri=root_url.replace(/\/$/, '');
      // translations
      window.T_Copy_to_clipboard = 'Copy to clipboard';
      window.T_Copied_to_clipboard = 'Copied to clipboard!';
      window.T_Copy_link_to_clipboard = 'Copy link to clipboard';
      window.T_Link_copied_to_clipboard = 'Copied link to clipboard!';
      window.T_No_results_found = 'No results found for \u0022{0}\u0022';
      window.T_N_results_found = '{1} results found for \u0022{0}\u0022';
      // some further base stuff
      var baseUriFull='https:\/\/ksu-cs-textbooks.github.io\/cis400/';
      window.variants && variants.init( [ 'auto', 'light-theme', 'dark-theme' ] );
    </script>
    
    <link href="https://ksu-cs-textbooks.github.io/cis400/css/custom.css?1698777572" rel="stylesheet">

  </head>
  <body class="mobile-support print disableInlineCopyToClipboard" data-url="https://ksu-cs-textbooks.github.io/cis400/3-web-development/05-linq/index.html">
    <div id="body" class="default-animation">
      <div id="sidebar-overlay"></div>
      <div id="toc-overlay"></div>
      <nav id="topbar" class="highlightable">
        <div>
          <div id="top-tele-link">
            <a class="print-link" title='Teleprompter View' href="https://ksu-cs-textbooks.github.io/cis400/3-web-development/05-linq/tele.html">
              <i class="fas fa-tv fa-fw"></i>
            </a>
          </div>
          <div id="top-embed-link">
            <a class="print-link" title='Embeddable Version' href="https://ksu-cs-textbooks.github.io/cis400/3-web-development/05-linq/embed.html">
              <i class="fas fa-expand-arrows-alt fa-fw"></i>
            </a>
          </div>
          <div id="breadcrumbs">
            <span id="sidebar-toggle-span">
              <a href="#" id="sidebar-toggle" class="topbar-link" title='Menu (CTRL+ALT+n)'><i class="fas fa-bars fa-fw"></i></a>
            </span>
            <ol class="links" itemscope itemtype="http://schema.org/BreadcrumbList">
              <li itemscope itemtype="https://schema.org/ListItem" itemprop="itemListElement"><a itemprop="item" href="https://ksu-cs-textbooks.github.io/cis400/index.html"><span itemprop="name">CIS 400: Object-Oriented Design, Implementation, and Testing</span></a><meta itemprop="position" content="1"> &gt; </li>
              <li itemscope itemtype="https://schema.org/ListItem" itemprop="itemListElement"><a itemprop="item" href="https://ksu-cs-textbooks.github.io/cis400/3-web-development/index.html"><span itemprop="name">Web Development</span></a><meta itemprop="position" content="2"> &gt; </li>
              <li itemscope itemtype="https://schema.org/ListItem" itemprop="itemListElement"><span itemprop="name">LINQ</span><meta itemprop="position" content="3"></li>
            </ol>
          </div>
        </div>
      </nav>
      <main id="body-inner" class="highlightable chapter narrow" tabindex="-1">
        <div class="flex-block-wrapper">
          <article class="chapter">
            <header class="headline">
            </header>


<div class="article-subheading">Chapter 5</div>
<h1 id="linq">LINQ</h1>

<p>Bridging the Gap Between Databases and Data Structures</p>

            <footer class="footline">

            </footer>
          </article>

          <section>
            <h1 class="a11y-only">Subsections of LINQ</h1>
    
    
          <article class="default">
            <header class="headline">
            </header>
<h1 id="introduction">Introduction</h1>

<p>We saw in the last chapter how many web applications are built around the concept of <em>resources</em>.  An online store has products to sell.  A social media application has people with accounts.  Resource-oriented web applications therefore need to store these resources in some fashion - possibly as objects in some kind of collection, or possibly with a database.</p>
<h2 id="key-terms">Key Terms</h2>
<p>Some key terms to learn in this chapter are:</p>
<ul>
<li>Database</li>
<li>Relational Database</li>
<li>Object-Oriented Database</li>
<li>Document-Based Database</li>
<li>Structured Query Language (SQL)</li>
<li>Language Integrated Query (LINQ)</li>
<li>Anonymous Types</li>
<li>Extension Methods</li>
</ul>
<h2 id="key-skills">Key Skills</h2>
<p>The key skills to develop in this chapter are:</p>
<ul>
<li>Using LINQ to perform query operations on data sets</li>
<li>Writing extension methods to provide new functionality to existing classes</li>
</ul>

            <footer class="footline">

            </footer>
          </article>

    
    
          <article class="default">
            <header class="headline">
            </header>
<h1 id="databases">Databases</h1>

<p>We use the term &ldquo;Database&rdquo; to describe a program primarily designed to efficiently store and retrieve data.  These are often used in conjunction with other kinds of applications - such as web applications or desktop applications.  Why use a separate program rather than building this storage and retrieval into the application we are building?  There are a lot of possible reasons, but some common ones are:</p>
<ol>
<li>
<p>Centralized access.  Consider a desktop application that tracks inventory for a large company.  You might want to have the application installed on every computer in the sales department, and you want the inventory to stay up-to-date for all of these.  If each desktop app connects to the same centralized database, they will all be kept up-to-date.</p>
</li>
<li>
<p>Efficiency of specialization.  By designing a database program for the sole purpose of storing and retrieving data, it can be designed by programmers who specialize in this area, and be designed to be as efficient as possible&hellip; often far more than we would be able to build into our own applications.</p>
</li>
</ol>
<h3 id="relational-databases">Relational Databases</h3>
<p>The most common type of database in use today are <em>relational databases</em>.  These are databases that organize data into structured <em>tables</em> consisting of columns with a specific data type.  Each record is therefore a row in the database.  Visually, such a database appears much like a spreadsheet.  These databases are typically communicated with using <em>Structured Query Language (SQL)</em>.  This is a special programming language developed specifically to express the kinds of operations we need to carry out on these databases.</p>
<p>For example, to retrieve the first and last names of all students in the <em>students</em> table who are earning above a 3.0, we would use the query:</p>
<div class="wrap-code highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-SQL" data-lang="SQL"><span style="display:flex;"><span><span style="color:#66d9ef">SELECT</span> <span style="color:#66d9ef">first</span>, <span style="color:#66d9ef">last</span> <span style="color:#66d9ef">FROM</span> students <span style="color:#66d9ef">WHERE</span> gpa <span style="color:#f92672">&gt;</span> <span style="color:#ae81ff">3</span>.<span style="color:#ae81ff">0</span>;</span></span></code></pre></div><p>And the results would be provided as a stream of text:</p>
<div class="wrap-code highlight"><pre tabindex="0"><code>first | last
Mike | Rowe
Jan | Herting
Sam | Sprat</code></pre></div><p>You&rsquo;ll learn more about these databases in CIS 560.</p>
<h3 id="object-oriented-databases">Object-Oriented Databases</h3>
<p>Relational databases were developed in the 60&rsquo;s and 70&rsquo;s to deal with the specific challenges of computer systems in those days.  The way they organize data lends itself to large, flat files, and SQL and its results are handled as streams of data.  When object-orientation became a popular programming language paradigm, object-oriented databases - databases that store data as objects, were also developed.  However, while object-oriented programming languages became quite popular, the corresponding databases failed to.  As a result, object-oriented databases remain quite niche.</p>
<h3 id="document-based-databases">Document-Based Databases</h3>
<p>The popularity of JSON and XML with the web led to another category of databases being developed, document-based databases (sometimes called No-SQL databases).  These databases store records in a serialized format like JSON or XML, and downplay relationships between records.  Unlike relational databases, document-based databases can be flexible in what data exists for an individual record.</p>
<p>For example, if we were to create a Student table in a relational database, and wanted to hold the student&rsquo;s degree plan, we&rsquo;d need two columns to represent a dual-major.  All students in the table would have two columns, even if they only had one degree plan.  In contrast, with a document-based database most students would only have one degree plan, but dual major would have two, and if we had a rare triple major, they could have three!</p>
<p>Thus, document-based databases add flexibility at the cost of some efficiency in retrieval.</p>
<h3 id="object-relational-mapping">Object-Relational Mapping</h3>
<p>Despite the growing popularity of Document-Based Databases, the vast majority of databases remain relational (MySql, MSSQL, PostgreSQL, Oracle, SQLite).  Yet, most of the programs that utilize them are now object-oriented.  This creates a bit of a disconnect for many programmers working with both.  One of the solutions devised to help with this challenge are object-relational mappers (ORMs).  These are libraries that are written for object-oriented languages that facilitate talking to the relational database.  When a query is run against the database with an ORM, the results are provided as a collection of objects instead of the normal text (basically, the ORM parses the results and transforms them into an object representation).  This simplifies working with databases for the programmer.</p>

            <footer class="footline">

            </footer>
          </article>

    
    
          <article class="default">
            <header class="headline">
            </header>
<h1 id="linq">LINQ</h1>

<p>One solution that Microsoft has developed to tackle the disconnect between relational databases and C# is Language Integrated Query (LINQ).  This technology integrates querying directly into the C# language.  It can act as a bridge to a MS SQL server, replacing the need for writing SQL queries and processing the results.  But it can <em>also</em> be used to query collections that implement the <code>IEnumerable</code> interface, as well as XML files.  As such, we can design the logic of our program to use LINQ, and change out the data source for any of these options with minimal refactoring.</p>
<p>LINQ queries are written as either <em>query expressions</em> or by using <em>query operators</em>.  Let&rsquo;s examine the two.</p>
<h3 id="query-expressions">Query Expressions</h3>
<p>LINQ query expressions appear much like SQL statements.  For example, the query from the last section, selecting the names of students whose GPA is greater than 3.0 as a LINQ query expression would be:</p>
<div class="wrap-code highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-csharp" data-lang="csharp"><span style="display:flex;"><span><span style="color:#66d9ef">var</span> highGPAStudents = <span style="color:#66d9ef">from</span> student <span style="color:#66d9ef">in</span> students <span style="color:#66d9ef">where</span> student.GPA &gt; <span style="color:#ae81ff">3.0</span> <span style="color:#66d9ef">select</span> <span style="color:#66d9ef">new</span> { First = student.First, Last = student.Last};</span></span></code></pre></div><p>This format looks much like SQL, and is often more comfortable for programmers who come from a SQL background.</p>
<h3 id="query-operators">Query Operators</h3>
<p>LINQ queries are actually implemented through C# operators.  Query expressions, like the one above, are compiled into an equivalent series of query operators.  Programmers can also use these operators directly.  For example, the above query expressed using operators would be:</p>
<div class="wrap-code highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-csharp" data-lang="csharp"><span style="display:flex;"><span><span style="color:#66d9ef">var</span> highGPAStudents = students.Where(student =&gt; student.GPA &gt; <span style="color:#ae81ff">3.0</span>).Select(student =&gt; <span style="color:#66d9ef">new</span> {First = student.First, Last = student.Last});</span></span></code></pre></div><p>Programmers from an object-oriented background often find the operators (which are essentially methods that take lambda expressions as parameters) more comfortable.</p>
<h3 id="query-execution">Query Execution</h3>
<p>Queries are not actually executed until you start iterating over their results.  This allows you to chain additional queries on an existing query, and allows the compiler to optimize queries by grouping query expressions together.  Consider this compound query to select half of low-performing students to assign to an advisor:</p>
<div class="wrap-code highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-csharp" data-lang="csharp"><span style="display:flex;"><span><span style="color:#66d9ef">var</span> strugglingStudents = <span style="color:#66d9ef">from</span> student <span style="color:#66d9ef">in</span> students <span style="color:#66d9ef">where</span> student.GPA &lt; <span style="color:#ae81ff">2.0</span> <span style="color:#66d9ef">select</span> student;
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">var</span> strugglingStudentsAtoN = <span style="color:#66d9ef">from</span> strugglingStudents <span style="color:#66d9ef">where</span> student.Last.CharAt(<span style="color:#ae81ff">0</span>) &gt;= <span style="color:#e6db74">&#39;A&#39;</span> &amp;&amp; student.Last.CharAt(<span style="color:#ae81ff">0</span>) &lt; <span style="color:#e6db74">&#39;N&#39;</span> <span style="color:#66d9ef">select</span> student;</span></span></code></pre></div><p>If we wrote this as C# algorithm, we might do something like:</p>
<div class="wrap-code highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-csharp" data-lang="csharp"><span style="display:flex;"><span><span style="color:#66d9ef">var</span> strugglingStudents = <span style="color:#66d9ef">new</span> List&lt;Student&gt;();
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">foreach</span>(<span style="color:#66d9ef">var</span> student <span style="color:#66d9ef">in</span> students) {
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">if</span>(student.GPA &lt; <span style="color:#ae81ff">2.0</span>) strugglingStudents.Add(student);
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">var</span> strugglingStudentsAtoN = <span style="color:#66d9ef">new</span> List&lt;Student&gt;();
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">foreach</span>(<span style="color:#66d9ef">var</span> student <span style="color:#66d9ef">in</span> strugglingStudents) {
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">if</span>(student.Last.CharAt(<span style="color:#ae81ff">0</span>) &gt;= <span style="color:#e6db74">&#39;A&#39;</span> &amp;&amp; student.Last.CharAt(<span style="color:#ae81ff">0</span>) &lt; <span style="color:#e6db74">&#39;N&#39;</span>) strugglingStudentsAtoN.Add(student)
</span></span><span style="display:flex;"><span>}</span></span></code></pre></div><p>As you can see, this results in <em>two</em> iterations over lists of students.  In the worst case (when every student is struggling) this has a complexity of $O(2*n)$.</p>
<p>On the other hand, by delaying the execution of the query until the first time its values are used, LINQ can refactor the query into a form like:</p>
<div class="wrap-code highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-csharp" data-lang="csharp"><span style="display:flex;"><span><span style="color:#66d9ef">var</span> strugglingStudentsAtoN = <span style="color:#66d9ef">new</span> List&lt;Student&gt;();
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">foreach</span>(<span style="color:#66d9ef">var</span> student <span style="color:#66d9ef">in</span> students) {
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">if</span>(student.GPA &lt; <span style="color:#ae81ff">2.0</span> &amp;&amp; student.Last.CharAt(<span style="color:#ae81ff">0</span>) &gt;= <span style="color:#e6db74">&#39;A&#39;</span> &amp;&amp; student.Last.CharAt(<span style="color:#ae81ff">0</span>) &lt; <span style="color:#e6db74">&#39;N&#39;</span>) 
</span></span><span style="display:flex;"><span>        strugglingStudents.Add(student);
</span></span><span style="display:flex;"><span>}</span></span></code></pre></div><p>With this refactoring, the worst case becomes $O(n)$ - our query would run twice as fast!  Also, if we never <em>use</em> <code>strugglingStudentsAtoN</code>, the query is never executed, so the cost is $O(0)$.  This might seem nonsensical, but consider if we have some kind of conditional, i.e.:</p>
<div class="wrap-code highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-csharp" data-lang="csharp"><span style="display:flex;"><span><span style="color:#66d9ef">switch</span>(advisor.Number) {
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">case</span> <span style="color:#ae81ff">1</span>:
</span></span><span style="display:flex;"><span>        ReportStudents(strugglingStudentsAtoN);
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">break</span>;
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">case</span> <span style="color:#ae81ff">2</span>: 
</span></span><span style="display:flex;"><span>        ReportStudents(strugglingStudentsNtoZ);
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">break</span>;
</span></span><span style="display:flex;"><span>}</span></span></code></pre></div><p>We only end up executing the query necessary for the logged-in advisor.</p>

  
  
<div class="box notices cstyle info">
  <div class="box-label"><i class="fa-fw fas fa-info-circle"></i> Info</div>
  <div class="box-content">

<p>LINQ uses a programming pattern known as <a href="https://en.wikipedia.org/wiki/Method_chaining" target="_blank"><em>method chaining</em></a>
, where each query method returns an object upon which additional query operations can be performed.  Thus, it is perfectly legal to write a query like:</p>
<div class="wrap-code highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-csharp" data-lang="csharp"><span style="display:flex;"><span><span style="color:#66d9ef">var</span> query = students.Where(s =&gt; s.GPA &gt; <span style="color:#ae81ff">2.0</span>).Where(s =&gt; s.Age &gt; <span style="color:#ae81ff">25</span>).Where(s =&gt; s.Last.CharAt(<span style="color:#ae81ff">0</span>) == <span style="color:#e6db74">&#39;C&#39;</span>);</span></span></code></pre></div><p>While this may seem silly (as we could have expressed this with one where clause), it makes more sense when we have user interface filters that may or may not have a value, i.e.:</p>
<div class="wrap-code highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-csharp" data-lang="csharp"><span style="display:flex;"><span><span style="color:#66d9ef">var</span> query = students.All();
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">if</span>(minGPA != <span style="color:#66d9ef">null</span>) query = query.Where(s =&gt; s.GPA &gt;= minGPA);
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">if</span>(maxGPA != <span style="color:#66d9ef">null</span>) query = query.Where(s =&gt; s.GPA &lt;= maxGPA);
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">if</span>(first != <span style="color:#66d9ef">null</span>) query = query.Where(s =&gt; s.First == first);
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">if</span>(last != <span style="color:#66d9ef">null</span>) query = query.Where(s =&gt; s.Last == last);</span></span></code></pre></div></div>
</div>
<h3 id="query-results">Query Results</h3>
<p>The result of the query is therefore a specialized object created by LINQ that implements the <code>IEnumerable&lt;T&gt;</code> interface.  The type of <code>T</code> depends on the query (queries are always strongly typed, though the type can be inferred).  Fore example, in our <code>strugglingStudent</code> query, the result type is <code>IEnumerable&lt;Student&gt;</code>:</p>
<div class="wrap-code highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-csharp" data-lang="csharp"><span style="display:flex;"><span><span style="color:#66d9ef">var</span> strugglingStudents = <span style="color:#66d9ef">from</span> student <span style="color:#66d9ef">in</span> students <span style="color:#66d9ef">where</span> student.GPA &lt; <span style="color:#ae81ff">2.0</span> <span style="color:#66d9ef">select</span> student;</span></span></code></pre></div><p>In contrast, the <code>highGPAStudents</code> result uses an <a href="https://docs.microsoft.com/en-us/dotnet/csharp/programming-guide/classes-and-structs/anonymous-types" target="_blank"><em>anonymous type</em></a>
:</p>
<div class="wrap-code highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-csharp" data-lang="csharp"><span style="display:flex;"><span><span style="color:#66d9ef">var</span> highGPAStudents = <span style="color:#66d9ef">from</span> student <span style="color:#66d9ef">in</span> students <span style="color:#66d9ef">where</span> student.GPA &gt; <span style="color:#ae81ff">3.0</span> <span style="color:#66d9ef">select</span> <span style="color:#66d9ef">new</span> { First = student.First, Last = student.Last};</span></span></code></pre></div><p>The anonymous type is created by the expression <code>new { First = student.First, Last = student.Last}</code>.  Basically, it&rsquo;s an object with a <code>First</code> and <code>Last</code> property (and no methods or other properties).  Anonymous types are created by the interpreter at runtime (much like an auto-Property&rsquo;s backing field).  As such, we aren&rsquo;t able to use its type in our code.</p>
<p>If we want the query to return a specific type, we can instead declare a struct or object to return, i.e.:</p>
<div class="wrap-code highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-csharp" data-lang="csharp"><span style="display:flex;"><span><span style="color:#66d9ef">class</span> <span style="color:#a6e22e">StudentName</span> {
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">string</span> First;
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">string</span> Last;
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">public</span> StudentName(<span style="color:#66d9ef">string</span> first, <span style="color:#66d9ef">string</span> last) {
</span></span><span style="display:flex;"><span>        First = first;
</span></span><span style="display:flex;"><span>        Last = last;
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>}</span></span></code></pre></div><p>And then set this as the projection type:</p>
<div class="wrap-code highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-csharp" data-lang="csharp"><span style="display:flex;"><span><span style="color:#66d9ef">var</span> highGPAStudents = <span style="color:#66d9ef">from</span> student <span style="color:#66d9ef">in</span> students <span style="color:#66d9ef">where</span> student.GPA &gt; <span style="color:#ae81ff">3.0</span> <span style="color:#66d9ef">select</span> <span style="color:#66d9ef">new</span> StudentName(student.First, student.Last);</span></span></code></pre></div><p>Let&rsquo;s take a deeper look at LINQ syntax next.</p>

            <footer class="footline">

            </footer>
          </article>

    
    
          <article class="default">
            <header class="headline">
            </header>
<h1 id="linq-syntax">LINQ Syntax</h1>

<p>Let&rsquo;s discuss some of the more common operations we might want to perform with LINQ.  Please note that this is <em>not an exhaustive list</em> - just some of the most common operations you will be encountering at this time.</p>
<h2 id="data-source">Data Source</h2>
<p>For these examples, we&rsquo;ll be using a data source consisting of <code>Student</code> objects.  These are defined by the class:</p>
<div class="wrap-code highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-csharp" data-lang="csharp"><span style="display:flex;"><span><span style="color:#66d9ef">public</span> <span style="color:#66d9ef">class</span> <span style="color:#a6e22e">Student</span> {
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">string</span> EID;
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">string</span> First;
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">string</span> Last;
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">double</span> GPA;
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">int</span> Age;    
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">string</span> Major;
</span></span><span style="display:flex;"><span>}</span></span></code></pre></div><p>And the variable <code>students</code> is a <code>List&lt;Student&gt;</code> that we can assume is populated with initialized student objects.</p>
<p>We select this as our data source with the LINQ <code>from</code> operator.  In query syntax, this would be:</p>
<div class="wrap-code highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-csharp" data-lang="csharp"><span style="display:flex;"><span><span style="color:#66d9ef">var</span> query = <span style="color:#66d9ef">from</span> student <span style="color:#66d9ef">in</span> students ...</span></span></code></pre></div><p>And with method syntax, we would simply use the <code>students</code> list:</p>
<div class="wrap-code highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-csharp" data-lang="csharp"><span style="display:flex;"><span><span style="color:#66d9ef">var</span> query = students.SomeQueryMethod(student =&gt; ...)</span></span></code></pre></div><p>To create a query from a data source using method syntax without applying any query methods (useful for chaining optional queries), we can invoke <code>All()</code> on the collection:</p>
<div class="wrap-code highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-csharp" data-lang="csharp"><span style="display:flex;"><span><span style="color:#66d9ef">var</span> query = students.All();</span></span></code></pre></div><p>To use a different data source, we would just swap <code>students</code> for that source, an object that supports either the <code>IEnumerable</code> (usually data structures) or <code>IQueryable</code> (typically SQL or XML data sources) interface.</p>
<h2 id="projecting">Projecting</h2>
<p>Projecting refers to selecting specific data from a data source.  For example, if we wanted to select the full name of every  <code>Student</code>, we could do so with this query syntax:</p>
<div class="wrap-code highlight"><pre tabindex="0"><code class="language-chsarp" data-lang="chsarp">var studentNames = from student in students select $&#34;{student.First} {student.Last}&#34;;</code></pre></div><p>Or with method syntax:</p>
<div class="wrap-code highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-csharp" data-lang="csharp"><span style="display:flex;"><span><span style="color:#66d9ef">var</span> studentNames = students.Select(student =&gt; <span style="color:#e6db74">$&#34;{student.First} {student.Last}&#34;</span>);</span></span></code></pre></div><p>As the name is simply a string, the select above simply constructs the string, and the type of <code>studentNames</code> is inferred to be <code>IEnumerable&lt;string&gt;</code>.</p>
<p>We can also project an <a href="https://docs.microsoft.com/en-us/dotnet/csharp/programming-guide/classes-and-structs/anonymous-types" target="_blank">anonymous type</a>
.  This is a special kind of object whose type is created at runtime.  Anonymous types are basically collections of properties and nothing more (they cannot have methods).  For example, if we wanted just the student&rsquo;s full name and age, we would use this query syntax:</p>
<div class="wrap-code highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-csharp" data-lang="csharp"><span style="display:flex;"><span><span style="color:#66d9ef">var</span> studentInfo = <span style="color:#66d9ef">from</span> student <span style="color:#66d9ef">in</span> students <span style="color:#66d9ef">select</span> <span style="color:#66d9ef">new</span> {FullName = <span style="color:#e6db74">$&#34;{student.First} {student.Last}&#34;</span>, Age = student.Age};</span></span></code></pre></div><p>or this method syntax:</p>
<div class="wrap-code highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-csharp" data-lang="csharp"><span style="display:flex;"><span><span style="color:#66d9ef">var</span> studentInfo = students.Select(student =&gt; <span style="color:#66d9ef">new</span> {FullName = <span style="color:#e6db74">$&#34;{student.First} {student.Last}&#34;</span>, Age = student.Age});</span></span></code></pre></div><p>Finally, we could also define a new data type (i.e. class) and create an instance of it as our projection:</p>
<div class="wrap-code highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-csharp" data-lang="csharp"><span style="display:flex;"><span><span style="color:#66d9ef">class</span> <span style="color:#a6e22e">StudentInfo</span> {
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">string</span> FullName {<span style="color:#66d9ef">get</span>; <span style="color:#66d9ef">set</span>;}
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">int</span> Age {<span style="color:#66d9ef">get</span>; <span style="color:#66d9ef">set</span>;}
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">public</span> StudentInfo(<span style="color:#66d9ef">string</span> fullName, <span style="color:#66d9ef">int</span> age)
</span></span><span style="display:flex;"><span>    {
</span></span><span style="display:flex;"><span>        FullName = fullName;
</span></span><span style="display:flex;"><span>        Age = age;
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>}</span></span></code></pre></div><p>Using query syntax:</p>
<div class="wrap-code highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-csharp" data-lang="csharp"><span style="display:flex;"><span><span style="color:#66d9ef">var</span> studentInfo = <span style="color:#66d9ef">from</span> student <span style="color:#66d9ef">in</span> students <span style="color:#66d9ef">select</span> <span style="color:#66d9ef">new</span> StudentInfo(<span style="color:#e6db74">$&#34;{student.First} {student.Last}&#34;</span>, student.Age);</span></span></code></pre></div><p>or this method syntax:</p>
<div class="wrap-code highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-csharp" data-lang="csharp"><span style="display:flex;"><span><span style="color:#66d9ef">var</span> studentInfo = students.Select(student =&gt; <span style="color:#66d9ef">new</span> StudentInfo(<span style="color:#e6db74">$&#34;{student.First} {student.Last}&#34;</span>, student.Age));</span></span></code></pre></div><h2 id="filtering">Filtering</h2>
<p>One of the most common operations you will do with a query is filter the data, so the results contains only part of the original data.  This is done with the <code>where</code> operator takes a statement that resolves to a boolean.  If this boolean expression resolves to true, then the data is included in the results; if it is false, it is excluded.  For example, to find all students older than 25, we would use this query syntax:</p>
<div class="wrap-code highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-csharp" data-lang="csharp"><span style="display:flex;"><span><span style="color:#66d9ef">var</span> olderStudents = <span style="color:#66d9ef">from</span> student <span style="color:#66d9ef">in</span> students <span style="color:#66d9ef">where</span> student.Age &gt; <span style="color:#ae81ff">25</span>;</span></span></code></pre></div><p>or this method syntax:</p>
<div class="wrap-code highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-csharp" data-lang="csharp"><span style="display:flex;"><span><span style="color:#66d9ef">var</span> olderStudents = students.Where(student =&gt; student.Age &gt; <span style="color:#ae81ff">25</span>);</span></span></code></pre></div><h2 id="filtering-by-type">Filtering By Type</h2>
<p>If we have a list that contains multiple types, we can filter for specific types with the <code>where</code> operator or the <code>OfType</code> operator (this is an instance where query and operator syntax vary more greatly).  Consider the case where our <code>Student</code> class is a base class to <code>GraduateStudent</code> and <code>UndergraduateStudent</code> classes.  If we wanted to get a list of only the undergraduates, we could use a <code>where</code> query syntax combined with an <code>is</code> casting test:</p>
<div class="wrap-code highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-csharp" data-lang="csharp"><span style="display:flex;"><span><span style="color:#66d9ef">var</span> undergraduates = <span style="color:#66d9ef">from</span> student <span style="color:#66d9ef">in</span> students <span style="color:#66d9ef">where</span> student <span style="color:#66d9ef">is</span> UndergraduateStudent;</span></span></code></pre></div><p>In this case, the result would be an <code>IEnumerable&lt;UndergraduateStudent&gt;</code>.  But the corresponding where in operator syntax would result in an <code>IEnumerable&lt;Student&gt;</code> that contained only <code>UndergraduateStudent</code> objects.  To perform a cast as part of the filtering, we would instead use the <code>OfType&lt;T&gt;()</code> method:</p>
<div class="wrap-code highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-csharp" data-lang="csharp"><span style="display:flex;"><span><span style="color:#66d9ef">var</span> undergraduates = students.OfType&lt;UndergraduateStudent&gt;();</span></span></code></pre></div><h2 id="ordering">Ordering</h2>
<p>Often we want to apply some form of sorting to our results, i.e. we might want to sort students by GPA.  This can be done with an <code>orderby</code> operator.  In query syntax it would be:</p>
<div class="wrap-code highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-csharp" data-lang="csharp"><span style="display:flex;"><span><span style="color:#66d9ef">var</span> studentsByGPA = <span style="color:#66d9ef">from</span> student <span style="color:#66d9ef">in</span> students <span style="color:#66d9ef">orderby</span> student.GPA;</span></span></code></pre></div><p>And in method syntax:</p>
<div class="wrap-code highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-csharp" data-lang="csharp"><span style="display:flex;"><span><span style="color:#66d9ef">var</span> studentsByGPA = students.OrderBy(student =&gt; student.GPA);</span></span></code></pre></div><p>The <code>orderby</code> operator sorts in <em>ascending</em> order (so students with the lowest grades would come first in the list).  If we wanted to sort in <em>descending</em> order, we would need to specify descending order in our query syntax:</p>
<div class="wrap-code highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-csharp" data-lang="csharp"><span style="display:flex;"><span><span style="color:#66d9ef">var</span> studentsByGPA = <span style="color:#66d9ef">from</span> student <span style="color:#66d9ef">in</span> students <span style="color:#66d9ef">orderby</span> student.GPA <span style="color:#66d9ef">descending</span>;</span></span></code></pre></div>
  
  
<div class="box notices cstyle tip">
  <div class="box-label"><i class="fa-fw fas fa-lightbulb"></i> Tip</div>
  <div class="box-content">

<p>There is also an <em>ascending</em> keyword you can use.  This is helpful if you can&rsquo;t remember the default or want to make it clear to other programmers that the list will be sorted in ascending order:</p>
<div class="wrap-code highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-csharp" data-lang="csharp"><span style="display:flex;"><span><span style="color:#66d9ef">var</span> studentsByGPA = <span style="color:#66d9ef">from</span> student <span style="color:#66d9ef">in</span> students <span style="color:#66d9ef">orderby</span> student.GPA <span style="color:#66d9ef">ascending</span>;</span></span></code></pre></div></div>
</div>
<p>However, in method syntax this is accomplished by a separate operator, the <code>OrderByDescending()</code> method:</p>
<div class="wrap-code highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-csharp" data-lang="csharp"><span style="display:flex;"><span><span style="color:#66d9ef">var</span> studentsByGPA = students.OrderByDescending(student =&gt; student.GPA);</span></span></code></pre></div><p>If we need to order by multiple properties, i.e. first and last names, this is accomplished by a comma-separated list in query syntax:</p>
<div class="wrap-code highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-csharp" data-lang="csharp"><span style="display:flex;"><span><span style="color:#66d9ef">var</span> studentsByName = <span style="color:#66d9ef">from</span> student <span style="color:#66d9ef">in</span> students <span style="color:#66d9ef">orderby</span> student.Last, student.First;</span></span></code></pre></div><p>But in method syntax, we need to use a <code>ThenBy()</code> operator for subsequent sorting options:</p>
<div class="wrap-code highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-csharp" data-lang="csharp"><span style="display:flex;"><span><span style="color:#66d9ef">var</span> studentsByName = students.OrderBy(student =&gt; student.Last).ThenBy(student =&gt; student.First);</span></span></code></pre></div><p>We can mix and match ascending and descending sorting as well - for example, to sort students by descending GPA, then by names in alphabetical order we would use the query syntax:</p>
<div class="wrap-code highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-csharp" data-lang="csharp"><span style="display:flex;"><span><span style="color:#66d9ef">var</span> studentsByGPAAndName = <span style="color:#66d9ef">from</span> student <span style="color:#66d9ef">in</span> students <span style="color:#66d9ef">orderby</span> student.GPA <span style="color:#66d9ef">ascending</span>, student.Last, student.First;</span></span></code></pre></div><p>The corresponding method syntax would need separate operators for each sorting:</p>
<div class="wrap-code highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-csharp" data-lang="csharp"><span style="display:flex;"><span><span style="color:#66d9ef">var</span> studentsByGPAAndName = students.OrderByDescending(student =&gt; student.GPA).ThenBy(student =&gt; student.Last).ThenBy(student =&gt; student.First);</span></span></code></pre></div><p>There is also a <code>ThenByDescending()</code> operator for chaining descending sorts.</p>
<p>Finally, there is also a <code>Reverse()</code> operator which simply reverses the order of items in the collection without sorting.</p>
<h2 id="grouping">Grouping</h2>
<p>We often want to split our results into groups, which can be accomplished with the <code>group by</code> operator.  Consider the case where we want to split our students by the value of their <code>Major</code> field.  We can accomplish this with query syntax:</p>
<div class="wrap-code highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-csharp" data-lang="csharp"><span style="display:flex;"><span><span style="color:#66d9ef">var</span> studentsByMajor = <span style="color:#66d9ef">from</span> student <span style="color:#66d9ef">in</span> students <span style="color:#66d9ef">select</span> student <span style="color:#66d9ef">group</span> student <span style="color:#66d9ef">by</span> student.Major;</span></span></code></pre></div><p>or using method syntax:</p>
<div class="wrap-code highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-csharp" data-lang="csharp"><span style="display:flex;"><span><span style="color:#66d9ef">var</span> studentsByMajor = students.GroupBy(student =&gt; student.Major);</span></span></code></pre></div><p>The result type of a grouping operation is an <code>IEnumerable&lt;IGrouping&lt;TKey, TSource&gt;&gt;</code>; the <code>IGrouping</code> is essentially a key/value pair with the key being the type we were grouping by.  In the example it would be <code>IEnumerable&lt;IGrouping&lt;string, Student&gt;&gt;</code> (Seeing this, you can probably begin to appreciate why we normally use <code>var</code> for query variables).</p>
<p>To print out each student in each category, we&rsquo;d need to iterate over this collection, and then over the groupings:</p>
<div class="wrap-code highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-csharp" data-lang="csharp"><span style="display:flex;"><span><span style="color:#66d9ef">foreach</span>(<span style="color:#66d9ef">var</span> <span style="color:#66d9ef">group</span> <span style="color:#66d9ef">in</span> studentsByMajor) {
</span></span><span style="display:flex;"><span>    Console.WriteLine(<span style="color:#e6db74">$&#34;{group.Key} Students&#34;</span>);
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">foreach</span>(<span style="color:#66d9ef">var</span> student <span style="color:#66d9ef">in</span> <span style="color:#66d9ef">group</span>) {
</span></span><span style="display:flex;"><span>        Console.WriteLine(<span style="color:#e6db74">$&#34;{student.First} {student.Last}&#34;</span>);
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>}</span></span></code></pre></div><h2 id="paging">Paging</h2>
<p>A common strategy with large data sets is to separate them into <em>pages</em>, i.e. the first 20 items might appear on page 1, and by clicking the page 2 link, the user could view the next twenty items, and so on.  This paging functionality is implemented in LINQ using the <code>Skip()</code> and <code>Take()</code> operators.  The <code>Skip()</code> operator specifies how many records to skip over, while the <code>Take()</code> operator indicates how many records to include.  Thus, to take the second page of students when each page displays twenty students, we would use:</p>
<div class="wrap-code highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-csharp" data-lang="csharp"><span style="display:flex;"><span><span style="color:#66d9ef">var</span> pagedStudents = students.Skip(<span style="color:#ae81ff">20</span>).Take(<span style="color:#ae81ff">20</span>);</span></span></code></pre></div><p>Note that there is no query syntax corresponding to the <code>Skip()</code> and <code>Take()</code> operations, so to use them with query syntax, we wrap the query in parenthesis and invoke the methods on the result.  I.e. sorting students alphabetically and then taking the third page of twenty would be:</p>
<div class="wrap-code highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-csharp" data-lang="csharp"><span style="display:flex;"><span><span style="color:#66d9ef">var</span> pagedSortedStudents = (<span style="color:#66d9ef">from</span> student <span style="color:#66d9ef">in</span> students sort <span style="color:#66d9ef">by</span> last, first).Skip(<span style="color:#ae81ff">40</span>).Take(<span style="color:#ae81ff">20</span>);</span></span></code></pre></div><h2 id="existence-checks">Existence Checks</h2>
<p>Sometimes we want to know if a particular record exists in our data source.  The <code>Any()</code> operator can be used to perform such a check.  It evaluates to <code>true</code> if the query has any results, or <code>false</code> if it does not.  Like the <code>Skip()</code> and <code>Take()</code>, it does not have a query syntax form, so it must be invoked using the method syntax.  For example, to determine if we have at least one student named Bob Smith, we could use:</p>
<div class="wrap-code highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-csharp" data-lang="csharp"><span style="display:flex;"><span><span style="color:#66d9ef">var</span> bobSmithExists = (<span style="color:#66d9ef">from</span> student <span style="color:#66d9ef">in</span> students <span style="color:#66d9ef">where</span> student.First == <span style="color:#e6db74">&#34;Bob&#34;</span> &amp;&amp; student.Last == <span style="color:#e6db74">&#34;Smith&#34;</span>).Any();</span></span></code></pre></div><p>Or, in method syntax:</p>
<div class="wrap-code highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-csharp" data-lang="csharp"><span style="display:flex;"><span><span style="color:#66d9ef">var</span> bobSmithExists = students.Any(student =&gt; student.First == <span style="color:#e6db74">&#34;Bob&#34;</span> &amp;&amp; student.Last == <span style="color:#e6db74">&#34;Smith&#34;</span>);</span></span></code></pre></div><p>Alternatively, if we wanted to retrieve Bob Smith&rsquo;s record instead of simply determining if we had one, we could use <code>First()</code>:</p>
<div class="wrap-code highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-csharp" data-lang="csharp"><span style="display:flex;"><span><span style="color:#66d9ef">var</span> bobSmith = (<span style="color:#66d9ef">from</span> student <span style="color:#66d9ef">in</span> students <span style="color:#66d9ef">where</span> student.First == <span style="color:#e6db74">&#34;Bob&#34;</span> &amp;&amp; student.Last == <span style="color:#e6db74">&#34;Smith&#34;</span>).First();</span></span></code></pre></div><p>or in method syntax:</p>
<div class="wrap-code highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-csharp" data-lang="csharp"><span style="display:flex;"><span><span style="color:#66d9ef">var</span> bobSmith = students.First(student =&gt; student.First == <span style="color:#e6db74">&#34;Bob&#34;</span> &amp;&amp; student.Last == <span style="color:#e6db74">&#34;Smith&#34;</span>);</span></span></code></pre></div><p>This evaluates to the first matching result of the query (if we have multiple Bob Smiths, we&rsquo;ll only get the first one).  If there is no matching record, an <code>InvalidOperationException</code> is thrown.  Alternatively, we can use <code>FirstOrDefault()</code> which returns a default value corresponding to the query data type. For classes, this would be <code>null</code>, so given this query:</p>
<div class="wrap-code highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-csharp" data-lang="csharp"><span style="display:flex;"><span><span style="color:#66d9ef">var</span> bobSmith = students.FirstOrDefault(student =&gt; student.First == <span style="color:#e6db74">&#34;Bob&#34;</span> &amp;&amp; student.Last == <span style="color:#e6db74">&#34;Smith&#34;</span>);</span></span></code></pre></div><p>The value of <code>bobSmith</code> would be his record (if he is in the collection) or <code>null</code> (if he was not).</p>
<h2 id="aggregating">Aggregating</h2>
<p>Sometimes we want to perform aggregate operations upon a data source, i.e. counting, summing, or averaging. As with paging, these are accomplished via method-only operators.  For example, to count all students in our data source, we could use:</p>
<div class="wrap-code highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-csharp" data-lang="csharp"><span style="display:flex;"><span><span style="color:#66d9ef">var</span> studentCount = students.Count();</span></span></code></pre></div><p>This can be combined with any LINQ query, i.e. the count of students with a GPA above 3.0 in query syntax would be:</p>
<div class="wrap-code highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-csharp" data-lang="csharp"><span style="display:flex;"><span><span style="color:#66d9ef">var</span> studentsAbove3GPA = (<span style="color:#66d9ef">from</span> student <span style="color:#66d9ef">in</span> students <span style="color:#66d9ef">where</span> student.GPA &gt; <span style="color:#ae81ff">3.0</span>).Count();</span></span></code></pre></div><p>or in method syntax:</p>
<div class="wrap-code highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-csharp" data-lang="csharp"><span style="display:flex;"><span><span style="color:#66d9ef">var</span> studentsAbove3GPA = students.Where(student =&gt; student.GPA &gt; <span style="color:#ae81ff">3.0</span>).Count();</span></span></code></pre></div><p>Similarly, to compute the average GPA we would use the <code>Average()</code> method in conjunction with a projection.  In query syntax:</p>
<div class="wrap-code highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-csharp" data-lang="csharp"><span style="display:flex;"><span><span style="color:#66d9ef">var</span> averageGPA = (<span style="color:#66d9ef">from</span> student <span style="color:#66d9ef">in</span> students <span style="color:#66d9ef">select</span> student.GPA).Average();</span></span></code></pre></div><p>or in method syntax:</p>
<div class="wrap-code highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-csharp" data-lang="csharp"><span style="display:flex;"><span><span style="color:#66d9ef">var</span> averageGPA = students.Select(student =&gt; student.GPA).Average();</span></span></code></pre></div><p>or we can move the selector Predicate into the <code>Average()</code> directly:</p>
<div class="wrap-code highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-csharp" data-lang="csharp"><span style="display:flex;"><span><span style="color:#66d9ef">var</span> averageGPA = students.Average(student =&gt; student.GPA);</span></span></code></pre></div><p>We can create more complex queries to address specific questions.  For example, with a <code>group by</code> we could compute the average GPA by major:</p>
<div class="wrap-code highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-csharp" data-lang="csharp"><span style="display:flex;"><span><span style="color:#66d9ef">var</span> gpaByMajor = <span style="color:#66d9ef">from</span> student <span style="color:#66d9ef">in</span> students <span style="color:#66d9ef">group</span> student <span style="color:#66d9ef">by</span> student.Major <span style="color:#66d9ef">into</span> majorGroup <span style="color:#66d9ef">select</span> <span style="color:#66d9ef">new</span> 
</span></span><span style="display:flex;"><span>    { 
</span></span><span style="display:flex;"><span>        Major = majorGroup.Key,
</span></span><span style="display:flex;"><span>        AverageGPA = majorGroup.Average(student =&gt; student.GPA);
</span></span><span style="display:flex;"><span>    }</span></span></code></pre></div><p>The <code>Sum()</code> operator works similarly, summing a value.  To sum the ages of all students, we could use:</p>
<div class="wrap-code highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-csharp" data-lang="csharp"><span style="display:flex;"><span><span style="color:#66d9ef">var</span> sumOfAges = (<span style="color:#66d9ef">from</span> student <span style="color:#66d9ef">in</span> students <span style="color:#66d9ef">select</span> student.Age).Sum();</span></span></code></pre></div><p>or</p>
<div class="wrap-code highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-csharp" data-lang="csharp"><span style="display:flex;"><span><span style="color:#66d9ef">var</span> sumOfAges = students.Select(student =&gt; student.Age).Sum();</span></span></code></pre></div><p>or</p>
<div class="wrap-code highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-csharp" data-lang="csharp"><span style="display:flex;"><span><span style="color:#66d9ef">var</span> sumOfAges = students.Sum(student =&gt; student.Age);</span></span></code></pre></div><p>There are also <code>Min()</code> and <code>Max()</code> aggregate operators which select the minimum and maximum values, respectively.  For example, we could find the maximum and minimum earned GPAs with:</p>
<div class="wrap-code highlight"><pre tabindex="0"><code class="language-chsarp" data-lang="chsarp">var minGPA = students.Min(student =&gt; student.GPA);
var maxGPA = students.Max(student =&gt; student.GPA);</code></pre></div><p>Finally, there is a generic <code>Aggregate()</code> method which provides an aggregator variable that we can use to build any kind of aggregate function.  Let&rsquo;s first see how it can be used to duplicate the functionality of the <code>Sum()</code> method:</p>
<div class="wrap-code highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-csharp" data-lang="csharp"><span style="display:flex;"><span><span style="color:#66d9ef">var</span> sumOfAges = students.Aggregate((sum, student) =&gt; sum + student.Age);</span></span></code></pre></div><p>Here, <code>sum</code> is inferred to be an <code>int</code>, as <code>student.Age</code> is an int.  So it starts at <code>0</code>, and each time the <code>Aggregate</code> method processes a student, it adds that student&rsquo;s <code>Age</code> into the <code>sum</code>.</p>
<p>Now let&rsquo;s use this method for something new - generating a string of email addresses for a bulk mailing.  Assume our email application needs a list of semicolon-separated email addresses.  In that case, we could generate the emails for all students from:</p>
<div class="wrap-code highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-csharp" data-lang="csharp"><span style="display:flex;"><span><span style="color:#66d9ef">var</span> emails = students.Aggregate((emails, student) =&gt; emails + <span style="color:#e6db74">$&#34;; {student.EID}@k-state.edu&#34;</span>);</span></span></code></pre></div><p>If we had students with EIDs &ldquo;mary&rdquo;, &ldquo;brb30&rdquo;, and &ldquo;stan&rdquo;, the resulting string would be:</p>
<div class="wrap-code highlight"><pre tabindex="0"><code>mary@k-state.edu; brb30@k-state.edu; stan@ksu.edu</code></pre></div>
  
  
<div class="box notices cstyle info">
  <div class="box-label"><i class="fa-fw fas fa-info-circle"></i> Info</div>
  <div class="box-content">

<p>You may have heard the term <a href="https://en.wikipedia.org/wiki/MapReduce" target="_blank">map/reduce</a>
 in the context of functional programming or big data.  This is an algorithmic approach to processing data.  This pattern can be duplicated in LINQ using a query as the mapping function, and <code>Aggregate()</code> as the reduce function.</p>
</div>
</div>

            <footer class="footline">

            </footer>
          </article>

    
    
          <article class="default">
            <header class="headline">
            </header>
<h1 id="extension-methods">Extension Methods</h1>

<p>In order to use LINQ with your <code>IEnumerable</code> collections, you must include this using statement:</p>
<div class="wrap-code highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-csharp" data-lang="csharp"><span style="display:flex;"><span><span style="color:#66d9ef">using</span> System.LINQ </span></span></code></pre></div><p>Without it, the LINQ collection methods will not be available.  You might be wondering why, as your collections are mostly defined in the <code>System.Collections</code> or <code>System.Collections.Generic</code> namespaces.</p>
<p>The answer is that LINQ on collections is implemented using <a href="https://docs.microsoft.com/en-us/dotnet/csharp/programming-guide/classes-and-structs/extension-methods" target="_blank">extension methods</a>
.  This is a C# feature that allows you to add methods to any class, even a <code>sealed</code> class.  But how can we add methods to a sealed class?  Isn&rsquo;t the point of sealing a class to prevent altering it?</p>
<p>The answer is that extension methods don&rsquo;t actually modify the class itself.  Instead, they make available additional methods that the compiler &ldquo;pretends&rdquo; are a part of the class.  But these are defined separate from the class, and cannot modify it, nor access private or protected members of the class.  As the LINQ extension methods are defined in the <code>System.LINQ</code> namespace, we must make them available with a using statement before the compiler and intellisense will let us use them.</p>
<p>Let&rsquo;s see an example of creating our own extension methods.  As programmers, we often use class names in Pascal case, that might be useful to convert into human-readable strings.  Let&rsquo;s write an extension method to do this transformation:</p>
<div class="wrap-code highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-csharp" data-lang="csharp"><span style="display:flex;"><span><span style="color:#66d9ef">using</span> System.Text;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">namespace</span> StringExtensions {
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">/// &lt;summary&gt;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">/// Converts a camel-case or pascal case string into a human-readable one </span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">/// &lt;/summary&gt;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">static</span> <span style="color:#66d9ef">string</span> Humanize(<span style="color:#66d9ef">this</span> String s)
</span></span><span style="display:flex;"><span>    {
</span></span><span style="display:flex;"><span>        StringBuilder sb = <span style="color:#66d9ef">new</span> StringBuilder();
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">int</span> start = <span style="color:#ae81ff">0</span>;
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">for</span>(<span style="color:#66d9ef">int</span> i = <span style="color:#ae81ff">1</span>; i &lt; s.Length; i++) 
</span></span><span style="display:flex;"><span>        {
</span></span><span style="display:flex;"><span>            <span style="color:#75715e">// An upper case character is the start of a new word</span>
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">if</span>(Char.IsUpper(s[i]))
</span></span><span style="display:flex;"><span>            {
</span></span><span style="display:flex;"><span>                <span style="color:#75715e">// So we&#39;ll add the last word to the StringBuilder</span>
</span></span><span style="display:flex;"><span>                <span style="color:#66d9ef">string</span> word = s.Substring(start, i - start);
</span></span><span style="display:flex;"><span>                sb.Append(word);
</span></span><span style="display:flex;"><span>                <span style="color:#75715e">// Since that wasn&#39;t the last word, add a space </span>
</span></span><span style="display:flex;"><span>                sb.Append(<span style="color:#e6db74">&#34; &#34;</span>);
</span></span><span style="display:flex;"><span>                <span style="color:#75715e">// Mark the start of the new word </span>
</span></span><span style="display:flex;"><span>                start = i;
</span></span><span style="display:flex;"><span>            }
</span></span><span style="display:flex;"><span>        } 
</span></span><span style="display:flex;"><span>        <span style="color:#75715e">// We should have one more word left </span>
</span></span><span style="display:flex;"><span>        sb.Append(s.Substring(start));
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">return</span> sb.ToString();
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>}</span></span></code></pre></div><p>Notice a couple of important features.  First, the method is defined as <code>static</code>.  All extension methods are <code>static</code> methods.  Second, note the use of <code>this</code> in the first parameter, <code>this string s</code>.  The use of the <code>this</code> keyword is what tells C# the method is an extension method.  Moreover, it indicates the class that is being extended - <code>String</code> (which is equivalent to <code>string</code>).</p>
<p>Other than these two details, the rest of the method looks much like any other method.  But any time this method is in scope (i.e. within the <code>StringExtensions</code> namespace, or in any file with a <code>using StringExtensions</code> statement), there will be an additional method available on <code>string</code>, <code>Humanize()</code>.</p>
<p>That&rsquo;s all there is to writing an extension method.  Go ahead and try writing your own to convert human-readable strings into Pascal or Camel case!</p>

            <footer class="footline">

            </footer>
          </article>

    
    
          <article class="default">
            <header class="headline">
            </header>
<h1 id="summary">Summary</h1>

<p>In this chapter we learned about LINQ, Microsoft&rsquo;s query technology for querying collections, relational databases, and XML files (along with community implementations for many other queryable things).  We saw how to use both query and method syntax provided by LINQ to perform common query operations.  Finally, we examined the mechanism LINQ uses to provide new functionality to <code>IEnumerable</code> collections - extension methods.  We even implemented a few extension methods of our own!</p>
<p>Now you should be ready to use LINQ in your own projects, as well as define your own custom extension methods.</p>

            <footer class="footline">

            </footer>
          </article>

          </section>

        </div>
      </main>
    
<div class="git-footer">
<p class="theme-version-footer">5.18.0</p>
<p>Last modified by: 
            <i class='fas fa-user'></i> Russell Feldhausen
            <i class='fas fa-calendar'></i> <a href="https://gitlab.cs.ksu.edu/cs-textbooks/cis400-textbook/-/commit/681e5c9c43e3ac6de614c2cc74487702fd43cab7">Aug 10, 2023</a>
</p>
</div>

    
    </div>
    <script src="https://ksu-cs-textbooks.github.io/cis400/js/clipboard.min.js?1698777575" defer></script>
    <script src="https://ksu-cs-textbooks.github.io/cis400/js/perfect-scrollbar.min.js?1698777575" defer></script>
    <script src="https://ksu-cs-textbooks.github.io/cis400/js/theme.js?1698777575" defer></script>
  </body>
</html>
