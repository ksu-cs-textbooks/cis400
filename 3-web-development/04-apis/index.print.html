<!doctype html><html lang=en-us dir=ltr itemscope itemtype=http://schema.org/Article><head><meta charset=utf-8><meta name=viewport content="height=device-height,width=device-width,initial-scale=1,minimum-scale=1"><meta name=generator content="Hugo 0.128.0"><meta name=generator content="Relearn 6.0.0"><meta name=description content="Making the Web Accessible - for Programs"><meta name=author content="Nathan Bean"><meta name=twitter:card content="summary"><meta name=twitter:title content="Web APIs :: K-State CIS 400 Textbook"><meta name=twitter:description content="Making the Web Accessible - for Programs"><meta property="og:url" content="https://textbooks.cs.ksu.edu/cis400/3-web-development/04-apis/"><meta property="og:site_name" content="K-State CIS 400 Textbook"><meta property="og:title" content="Web APIs :: K-State CIS 400 Textbook"><meta property="og:description" content="Making the Web Accessible - for Programs"><meta property="og:locale" content="en-us"><meta property="og:type" content="website"><meta itemprop=name content="Web APIs :: K-State CIS 400 Textbook"><meta itemprop=description content="Making the Web Accessible - for Programs"><meta itemprop=datePublished content="2018-08-24T10:53:05-05:00"><meta itemprop=dateModified content="2023-08-10T15:29:34-05:00"><meta itemprop=wordCount content="7"><title>Web APIs :: K-State CIS 400 Textbook</title>
<link href=https://textbooks.cs.ksu.edu/cis400/3-web-development/04-apis/ rel=canonical type=text/html title="Web APIs :: K-State CIS 400 Textbook"><link href=/cis400/3-web-development/04-apis/index.xml rel=alternate type=application/rss+xml title="Web APIs :: K-State CIS 400 Textbook"><link href=/cis400/3-web-development/04-apis/tele.html rel=alternate type=text/html title="Web APIs :: K-State CIS 400 Textbook"><link href=/cis400/3-web-development/04-apis/embed.html rel=alternate type=text/html title="Web APIs :: K-State CIS 400 Textbook"><link href=/cis400/css/fontawesome-all.min.css?1731961654 rel=stylesheet media=print onload='this.media="all",this.onload=null'><noscript><link href=/cis400/css/fontawesome-all.min.css?1731961654 rel=stylesheet></noscript><link href=/cis400/css/nucleus.css?1731961654 rel=stylesheet><link href=/cis400/css/auto-complete.css?1731961654 rel=stylesheet media=print onload='this.media="all",this.onload=null'><noscript><link href=/cis400/css/auto-complete.css?1731961654 rel=stylesheet></noscript><link href=/cis400/css/perfect-scrollbar.min.css?1731961654 rel=stylesheet><link href=/cis400/css/fonts.css?1731961654 rel=stylesheet media=print onload='this.media="all",this.onload=null'><noscript><link href=/cis400/css/fonts.css?1731961654 rel=stylesheet></noscript><link href=/cis400/css/theme.css?1731961654 rel=stylesheet><link href=/cis400/css/theme-auto.css?1731961654 rel=stylesheet id=R-variant-style><link href=/cis400/css/chroma-auto.css?1731961654 rel=stylesheet id=R-variant-chroma-style><link href=/cis400/css/variant.css?1731961654 rel=stylesheet><link href=/cis400/css/print.css?1731961654 rel=stylesheet media=print><link href=/cis400/css/format-print.css?1731961654 rel=stylesheet><script src=/cis400/js/variant.js?1731961654></script><script>window.relearn=window.relearn||{},window.relearn.relBasePath="../..",window.relearn.relBaseUri="../../..",window.relearn.absBaseUri="https://textbooks.cs.ksu.edu/cis400",window.index_js_url="/cis400/index.search.js",window.variants&&variants.init(["auto","light-theme","dark-theme"]),window.T_Copy_to_clipboard=`Copy to clipboard`,window.T_Copied_to_clipboard=`Copied to clipboard!`,window.T_Copy_link_to_clipboard=`Copy link to clipboard`,window.T_Link_copied_to_clipboard=`Copied link to clipboard!`,window.T_Reset_view=`Reset view`,window.T_View_reset=`View reset!`,window.T_No_results_found=`No results found for "{0}"`,window.T_N_results_found=`{1} results found for "{0}"`</script><link href=/cis400/css/custom.css?1731961654 rel=stylesheet></head><body class="mobile-support print disableInlineCopyToClipboard" data-url=/cis400/3-web-development/04-apis/><div id=R-body class=default-animation><div id=R-body-overlay></div><nav id=R-topbar><div class=topbar-wrapper><div class=topbar-sidebar-divider></div><div class="topbar-area topbar-area-start" data-area=start><div class="topbar-button topbar-button-sidebar" data-content-empty=disable data-width-s=show data-width-m=hide data-width-l=hide><button class=topbar-control onclick=toggleNav() type=button title="Menu (CTRL+ALT+n)"><i class="fa-fw fas fa-bars"></i></button></div></div><ol class="topbar-breadcrumbs breadcrumbs highlightable" itemscope itemtype=http://schema.org/BreadcrumbList><li itemscope itemtype=https://schema.org/ListItem itemprop=itemListElement><a itemprop=item href=/cis400/3-web-development/><span itemprop=name>Web Development</span></a><meta itemprop=position content="1">&nbsp;>&nbsp;</li><li itemscope itemtype=https://schema.org/ListItem itemprop=itemListElement><span itemprop=name>Web APIs</span><meta itemprop=position content="2"></li></ol><div class="topbar-area topbar-area-end" data-area=end><div class="topbar-button topbar-button-prev" data-content-empty=disable data-width-s=show data-width-m=show data-width-l=show><a class=topbar-control href=/cis400/3-web-development/03-web-forms/06-summary/ title="Summary (ðŸ¡)"><i class="fa-fw fas fa-chevron-left"></i></a></div><div class="topbar-button topbar-button-next" data-content-empty=disable data-width-s=show data-width-m=show data-width-l=show><a class=topbar-control href=/cis400/3-web-development/04-apis/01-introduction/ title="Introduction (ðŸ¡’)"><i class="fa-fw fas fa-chevron-right"></i></a></div></div></div></nav><div id=R-main-overlay></div><main id=R-body-inner class="highlightable chapter narrow" tabindex=-1><div class=flex-block-wrapper><article class=chapter><header class=headline></header><div class=article-subheading>Chapter 4</div><h1 id=web-apis>Web APIs</h1><p>Making the Web Accessible - for Programs</p><footer class=footline></footer></article><section><h1 class=a11y-only>Subsections of Web APIs</h1><article class=default><header class=headline></header><h1 id=introduction>Introduction</h1><p>Not all web applications are built to be viewed in a browser. Many are built to be used by other programs. We call these web applications Web APIs (Application Programming Interfaces). These also make HTTP or HTTPS requests against our apps, but usually instead of serving HTML, we serve some form of serialized data instead - most commonly XML or JSON.</p><footer class=footline></footer></article><article class=default><header class=headline></header><h1 id=making-requests>Making Requests</h1><p>Making a HTTP request is a multi-step process. First you must establish a connection with the server, then create the request data, then you must stream that data to your server through the connection. Once the server has received and processed your request data, it should stream a response back to you.</p><p>You can write code to handle each step, but most programming languages provide one or more libraries that provide a level of abstraction to this process. The C# language actually offers several options in its system libraries, and there are multiple open-source options as well.</p><h3 id=webrequest>WebRequest</h3><p>The simplest of these is the <code>WebRequest</code> object. It represents and carries out a single HTTP request and provides the response. Let&rsquo;s take a look at an example, which retrieves a &ldquo;Joke of the Day&rdquo; from a web API at <a href=https://jokes.one rel=external target=_blank>https://jokes.one</a>:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-csharp data-lang=csharp><span class=line><span class=cl><span class=n>WebRequest</span> <span class=n>request</span> <span class=p>=</span> <span class=n>WebRequest</span><span class=p>.</span><span class=n>Create</span><span class=p>(</span><span class=s>&#34;http://api.jokes.one/jod&#34;</span><span class=p>);</span></span></span></code></pre></div><p>This one line of code creates the <code>WebRequest</code> object. Notice that we are <strong>not using a constructor</strong>. Instead, we invoke a <code>Create()</code> method. This is an example of the <a href=https://en.wikipedia.org/wiki/Factory_method_pattern rel=external target=_blank>Factory Method Pattern</a>, which you will learn more about in CIS 501. But to briefly introduce the concept, the <code>WebRequest</code> class is actually a <em>base class</em> for a multiple different classes, each representing a <em>specific kind</em> of web request (i.e. using HTTP, HTTPS, FTP and so on). Based on the URI supplied to <code>WebRequest.Create(Uri uri)</code>, the method will determine the appropriate kind of request to make, and create and return the corresponding object.</p><p>Now that we have our request, we can send it and obtain a response with:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-csharp data-lang=csharp><span class=line><span class=cl><span class=n>WebResponse</span> <span class=n>response</span> <span class=p>=</span> <span class=n>request</span><span class=p>.</span><span class=n>GetResponse</span><span class=p>();</span></span></span></code></pre></div><p>This opens the connection to the server, streams the request to it, and then captures the sever&rsquo;s response. We can access this response as a stream (similar to how we would read a file):</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-csharp data-lang=csharp><span class=line><span class=cl><span class=k>using</span> <span class=nn>Stream</span> <span class=n>responseStream</span> <span class=p>=</span> <span class=n>response</span><span class=p>.</span><span class=n>GetStream</span><span class=p>()</span> 
</span></span><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=n>StreamReader</span> <span class=n>reader</span> <span class=p>=</span> <span class=k>new</span> <span class=n>StreamReader</span><span class=p>(</span><span class=n>responseStream</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=kt>string</span> <span class=n>responseText</span><span class=p>=</span> <span class=n>reader</span><span class=p>.</span><span class=n>ReadToEnd</span><span class=p>();</span>
</span></span><span class=line><span class=cl>  <span class=n>Console</span><span class=p>.</span><span class=n>WriteLine</span><span class=p>(</span><span class=n>responseText</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=p>}</span></span></span></code></pre></div><p>You likely are wondering what the <code>using</code> and curly braces <code>{}</code> are doing in this code. They are there because the <code>Stream</code> object implements the <code>IDisposable</code> interface. We&rsquo;ll discuss this in detail in the next section. But for now, let&rsquo;s focus on how we use the stream. First we create a <code>StreamReader</code> to read it:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-csharp data-lang=csharp><span class=line><span class=cl>  <span class=n>StreamReader</span> <span class=n>reader</span> <span class=p>=</span> <span class=k>new</span> <span class=n>StreamReader</span><span class=p>(</span><span class=n>responseStream</span><span class=p>);</span></span></span></code></pre></div><p>Then read to the end of the stream:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-csharp data-lang=csharp><span class=line><span class=cl>  <span class=kt>string</span> <span class=n>responseFromServer</span> <span class=p>=</span> <span class=n>reader</span><span class=p>.</span><span class=n>ReadToEnd</span><span class=p>();</span></span></span></code></pre></div><p>And write the response&rsquo;s text to the console:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-csharp data-lang=csharp><span class=line><span class=cl>  <span class=n>Console</span><span class=p>.</span><span class=n>WriteLine</span><span class=p>(</span><span class=n>responseText</span><span class=p>);</span></span></span></code></pre></div><p>Finally, we must close the <code>WebResponse</code> object&rsquo;s connection to the server once we are done:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-csharp data-lang=csharp><span class=line><span class=cl>  <span class=n>response</span><span class=p>.</span><span class=n>Close</span><span class=p>();</span></span></span></code></pre></div><p>This last step is important, as the open connection is actually managed by our operating system, and unless we close it, our system resources will be tied up, making our computer slower and potentially unable to make web requests for other programs (including your browser)!</p><footer class=footline></footer></article><article class=default><header class=headline></header><h1 id=working-with-disposables>Working With Disposables</h1><p>In the previous section, we looked at a line of code that included the keyword <code>using</code> in a way you haven&rsquo;t probably seen it before:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-csharp data-lang=csharp><span class=line><span class=cl><span class=k>using</span> <span class=nn>Stream</span> <span class=n>responseStream</span> <span class=p>=</span> <span class=n>response</span><span class=p>.</span><span class=n>GetStream</span><span class=p>()</span> 
</span></span><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=c1>// TODO: Use the responseStream</span>
</span></span><span class=line><span class=cl><span class=p>}</span></span></span></code></pre></div><p>Let&rsquo;s examine this statement in more detail. This use of <code>using</code> is a <a href=https://docs.microsoft.com/en-us/dotnet/csharp/language-reference/keywords/using-statement rel=external target=_blank>using statement</a>, not to be confused with a <a href=https://docs.microsoft.com/en-us/dotnet/csharp/language-reference/keywords/using-directive rel=external target=_blank>using directive</a>.</p><p>When you put a statement like <code>using System.Text</code>, you are using the <em>using directive</em>, which instructs the compiler to use types in the corresponding namespace without needing to provide the fully qualified namespace. You&rsquo;ve been using this technique for some time, so it should be familiar to you.</p><p>In contrast, the <em>using statement</em> is used in the body of your code in conjunction with an object implementing the <code>IDisposable</code> interface. Objects that implement this interface have a <code>Dispose()</code> method, which needs to be called when you are done with them. These kinds of objects typically access some resource from outside of the program, which needs to be released when you are done with it.</p><h4 id=managed-vs-unmanaged-resources>Managed vs. Unmanaged Resources</h4><p>To understand this better, let&rsquo;s talk about <em>managed</em> vs. <em>unmanaged</em> resources. We say a resource is <em>managed</em> when obtaining and releasing it is handled by the language. Memory is a great example of this. In C#, we are using <em>managed memory</em>. When we invoke a constructor or declare an array, the interpreter automatically creates the memory we need to hold them.</p><p>In contrast, C uses <em>unmanaged memory</em>. When we want to create an array, we must <em>allocate</em> that memory with <code>alloc()</code>, <code>calloc()</code>, or <code>malloc()</code> function call.</p><p>This might not seem very different, until we are done with the array. In C#, we can simply let it fall out of scope, knowing the garbage collector should eventually free that memory. But in a C program, we must manually free the memory with a call to <code>free()</code>.</p><p>Sometimes in C#, we need to access some resource in a way that is unmanaged - in which case, we must be sure to free the resource when we are done with it.</p><h4 id=idisposable>IDisposable</h4><p>The <code>IDisposable()</code> interface provides a standard way of handling this kind of situation. It requires any class implementing it to define a <code>Dispose()</code> method that frees any unmanaged resources. A <em>stream</em> (the data being read in from a file, the network, or a terminal) is a good example of an unmanaged resource - the stream is actually created by the operating system, and the <code>Stream</code> object (a <code>FileStream</code>, <code>BufferedStream</code>, etc) is a C# object providing access to it.</p><p>Let&rsquo;s focus on a <code>FileStream</code> for a moment. One is created every time you ask the operating system to open a file, i.e.:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-csharp data-lang=csharp><span class=line><span class=cl><span class=n>FileStream</span> <span class=n>fs</span> <span class=p>=</span> <span class=n>File</span><span class=p>.</span><span class=n>OpenRead</span><span class=p>(</span><span class=s>&#34;somefile.txt&#34;</span><span class=p>);</span></span></span></code></pre></div><p>The <code>File.OpenRead()</code> method asks the operating system to provide a stream to the file named <code>"somefile.txt"</code>. We can then read that stream until we reach the end of file marker (indicating we&rsquo;ve read the entire file):</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-csharp data-lang=csharp><span class=line><span class=cl><span class=kt>byte</span> <span class=n>data</span> <span class=p>=</span> <span class=n>fs</span><span class=p>.</span><span class=n>ReadByte</span><span class=p>();</span>
</span></span><span class=line><span class=cl><span class=c1>// Invariant: while there are bytes in the file to read</span>
</span></span><span class=line><span class=cl><span class=k>while</span><span class=p>(</span><span class=n>data</span> <span class=p>!=</span> <span class=p>-</span><span class=m>1</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=c1>// Write the current byte to the console</span>
</span></span><span class=line><span class=cl>  <span class=n>System</span><span class=p>.</span><span class=n>Out</span><span class=p>.</span><span class=n>Write</span><span class=p>(</span><span class=n>data</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=c1>// Read the next byte</span>
</span></span><span class=line><span class=cl>  <span class=n>data</span> <span class=p>=</span> <span class=n>fs</span><span class=p>.</span><span class=n>ReadByte</span><span class=p>();</span>
</span></span><span class=line><span class=cl><span class=p>}</span></span></span></code></pre></div><p>Once we&rsquo;ve finished reading the file, we need to call <code>Dispose()</code> on the stream to tell the operating system that we&rsquo;re done with it:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-csharp data-lang=csharp><span class=line><span class=cl><span class=n>fs</span><span class=p>.</span><span class=n>Dispose</span><span class=p>();</span></span></span></code></pre></div><p>If we don&rsquo;t, then the operating system will assume we&rsquo;re still working with the file, and refuse to let any other program read it. Including our own program, if we were to run it again.</p><p>But what happens if an error occurs while reading the file? We&rsquo;ll never reach the call to <code>Dispose()</code>, so we&rsquo;ll <em>never free the file</em>! In order to access it, we&rsquo;d have to restart the computer. Not great.</p><p>We <em>could</em> manage this with a <code>try/catch/finally</code>, i.e.:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-csharp data-lang=csharp><span class=line><span class=cl><span class=k>try</span> 
</span></span><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=n>FileStream</span> <span class=n>fs</span> <span class=p>=</span> <span class=n>File</span><span class=p>.</span><span class=n>OpenRead</span><span class=p>(</span><span class=s>&#34;somefile.txt&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=kt>byte</span> <span class=n>data</span> <span class=p>=</span> <span class=n>fs</span><span class=p>.</span><span class=n>ReadByte</span><span class=p>();</span>
</span></span><span class=line><span class=cl>  <span class=c1>// Invariant: while there are bytes in the file to read</span>
</span></span><span class=line><span class=cl>  <span class=k>while</span><span class=p>(</span><span class=n>data</span> <span class=p>!=</span> <span class=p>-</span><span class=m>1</span><span class=p>)</span>
</span></span><span class=line><span class=cl>  <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=c1>// Write the current byte to the console</span>
</span></span><span class=line><span class=cl>    <span class=n>System</span><span class=p>.</span><span class=n>Out</span><span class=p>.</span><span class=n>Write</span><span class=p>(</span><span class=n>data</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=c1>// Read the next byte</span>
</span></span><span class=line><span class=cl>    <span class=n>data</span> <span class=p>=</span> <span class=n>fs</span><span class=p>.</span><span class=n>ReadByte</span><span class=p>();</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl>  <span class=n>fs</span><span class=p>.</span><span class=n>Dispose</span><span class=p>();</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl><span class=k>catch</span><span class=p>(</span><span class=n>Exception</span> <span class=n>e</span><span class=p>)</span> 
</span></span><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=c1>// Do something with e</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl><span class=k>finally</span>
</span></span><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=n>fs</span><span class=p>.</span><span class=n>Dispose</span><span class=p>();</span>
</span></span><span class=line><span class=cl><span class=p>}</span></span></span></code></pre></div><p>But you have to catch all exceptions.</p><h4 id=using-statement>Using Statement</h4><p>A using statement operates similarly, but takes far less typing:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-csharp data-lang=csharp><span class=line><span class=cl><span class=k>using</span> <span class=nn>FileStream</span> <span class=n>fs</span> <span class=p>=</span> <span class=n>File</span><span class=p>.</span><span class=n>OpenRead</span><span class=p>(</span><span class=s>&#34;somefile.txt&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=kt>byte</span> <span class=n>data</span> <span class=p>=</span> <span class=n>fs</span><span class=p>.</span><span class=n>ReadByte</span><span class=p>();</span>
</span></span><span class=line><span class=cl>  <span class=c1>// Invariant: while there are bytes in the file to read</span>
</span></span><span class=line><span class=cl>  <span class=k>while</span><span class=p>(</span><span class=n>data</span> <span class=p>!=</span> <span class=p>-</span><span class=m>1</span><span class=p>)</span>
</span></span><span class=line><span class=cl>  <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=c1>// Write the current byte to the console</span>
</span></span><span class=line><span class=cl>    <span class=n>System</span><span class=p>.</span><span class=n>Out</span><span class=p>.</span><span class=n>Write</span><span class=p>(</span><span class=n>data</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=c1>// Read the next byte</span>
</span></span><span class=line><span class=cl>    <span class=n>data</span> <span class=p>=</span> <span class=n>fs</span><span class=p>.</span><span class=n>ReadByte</span><span class=p>();</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span></span></span></code></pre></div><p>It also comes with some benefits. One, it creates a new scope (within the <code>{}</code> following the using statement). If for some reason the stream can&rsquo;t be opened, this scope is skipped over. Similarly it jumps execution to the end of the scope if an error occurs. Finally, it <em>automatically</em> calls <code>Dispose()</code> when the scope ends.</p><h4 id=syntax-shorthand>Syntax Shorthand</h4><p>As of C# 8.0, a shorthand for the using statement that omits the scope markers (the <code>{}</code>) is available. In this case, the scope is from the start of the <code>using</code> statement to the end of its containing scope (usually a method):</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-csharp data-lang=csharp><span class=line><span class=cl><span class=k>using</span> <span class=nn>FileStream</span> <span class=n>fs</span> <span class=p>=</span> <span class=n>File</span><span class=p>.</span><span class=n>OpenRead</span><span class=p>(</span><span class=s>&#34;somefile.txt&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=kt>byte</span> <span class=n>data</span> <span class=p>=</span> <span class=n>fs</span><span class=p>.</span><span class=n>ReadByte</span><span class=p>();</span>
</span></span><span class=line><span class=cl><span class=c1>// Invariant: while there are bytes in the file to read</span>
</span></span><span class=line><span class=cl><span class=k>while</span><span class=p>(</span><span class=n>data</span> <span class=p>!=</span> <span class=p>-</span><span class=m>1</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=c1>// Write the current byte to the console</span>
</span></span><span class=line><span class=cl>  <span class=n>System</span><span class=p>.</span><span class=n>Out</span><span class=p>.</span><span class=n>Write</span><span class=p>(</span><span class=n>data</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=c1>// Read the next byte</span>
</span></span><span class=line><span class=cl>  <span class=n>data</span> <span class=p>=</span> <span class=n>fs</span><span class=p>.</span><span class=n>ReadByte</span><span class=p>();</span>
</span></span><span class=line><span class=cl><span class=p>}</span></span></span></code></pre></div><p>This format can be nice when you need to nest multiple <code>using</code> statements, but I would suggest sticking with the scoped version until you are comfortable with the concepts involved.</p><footer class=footline></footer></article><article class=default><header class=headline></header><h1 id=parsing-api-data>Parsing API Data</h1><p>Web APIs typically provide their data in a structured format, i.e. XML or JSON. To use this within a C# program you&rsquo;ll need to either parse it or convert it into an object or objects.</p><p>The Joke of the Day API can provide either - we just need to specify our preference with a <code>Accept</code> header in our HTTP request. This header lets the server know what format(s) of data we are ready to process. XML is signified by the MIME type <code>application/xml</code> and JSON by <code>application/json</code>.</p><p>To set this (or any other header) in our <code>WebRequest</code> object, we use the <code>Header</code> property&rsquo;s <code>Add()</code> method:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-csharp data-lang=csharp><span class=line><span class=cl><span class=n>WebRequest</span> <span class=n>request</span> <span class=p>=</span> <span class=n>WebRequest</span><span class=p>.</span><span class=n>Create</span><span class=p>(</span><span class=s>&#34;http://api.jokes.one/jod&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=n>request</span><span class=p>.</span><span class=n>Headers</span><span class=p>.</span><span class=n>Add</span><span class=p>(</span><span class=s>&#34;Accept&#34;</span><span class=p>,</span> <span class=s>&#34;application/json&#34;</span><span class=p>);</span></span></span></code></pre></div><p>For JSON, or:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-csharp data-lang=csharp><span class=line><span class=cl><span class=n>WebRequest</span> <span class=n>request</span> <span class=p>=</span> <span class=n>WebRequest</span><span class=p>.</span><span class=n>Create</span><span class=p>(</span><span class=s>&#34;http://api.jokes.one/jod&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=n>request</span><span class=p>.</span><span class=n>Headers</span><span class=p>.</span><span class=n>Add</span><span class=p>(</span><span class=s>&#34;Accept&#34;</span><span class=p>,</span> <span class=s>&#34;application/xml&#34;</span><span class=p>);</span></span></span></code></pre></div><p>For XML.</p><h4 id=parsing-xml>Parsing XML</h4><p>Let&rsquo;s start by examining the older format, XML. Assuming you have set the <code>Accept</code> header as discussed above, you will receive a response similar to (but with a different joke):</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-xml data-lang=xml><span class=line><span class=cl><span class=nt>&lt;response&gt;</span>
</span></span><span class=line><span class=cl>  <span class=nt>&lt;success&gt;</span>
</span></span><span class=line><span class=cl>    <span class=nt>&lt;total&gt;</span>1<span class=nt>&lt;/total&gt;</span>
</span></span><span class=line><span class=cl>  <span class=nt>&lt;/success&gt;</span>
</span></span><span class=line><span class=cl>  <span class=nt>&lt;contents&gt;</span>
</span></span><span class=line><span class=cl>    <span class=nt>&lt;jokes&gt;</span>
</span></span><span class=line><span class=cl>      <span class=nt>&lt;description&gt;</span>Joke of the day <span class=nt>&lt;/description&gt;</span>
</span></span><span class=line><span class=cl>      <span class=nt>&lt;language&gt;</span>en<span class=nt>&lt;/language&gt;</span>
</span></span><span class=line><span class=cl>      <span class=nt>&lt;background/&gt;</span>
</span></span><span class=line><span class=cl>      <span class=nt>&lt;category&gt;</span>jod<span class=nt>&lt;/category&gt;</span>
</span></span><span class=line><span class=cl>      <span class=nt>&lt;date&gt;</span>2021-11-29<span class=nt>&lt;/date&gt;</span>
</span></span><span class=line><span class=cl>      <span class=nt>&lt;joke&gt;</span>
</span></span><span class=line><span class=cl>        <span class=nt>&lt;title&gt;</span>Signs for every job<span class=nt>&lt;/title&gt;</span>
</span></span><span class=line><span class=cl>        <span class=nt>&lt;lang&gt;</span>en<span class=nt>&lt;/lang&gt;</span>
</span></span><span class=line><span class=cl>        <span class=nt>&lt;length&gt;</span>1749<span class=nt>&lt;/length&gt;</span>
</span></span><span class=line><span class=cl>        <span class=nt>&lt;clean&gt;</span>0<span class=nt>&lt;/clean&gt;</span>
</span></span><span class=line><span class=cl>        <span class=nt>&lt;racial&gt;</span>0<span class=nt>&lt;/racial&gt;</span>
</span></span><span class=line><span class=cl>        <span class=nt>&lt;date&gt;</span>2021-11-29<span class=nt>&lt;/date&gt;</span>
</span></span><span class=line><span class=cl>        <span class=nt>&lt;id&gt;</span>HqJ1i9L1ujVCcZmS5C4nhAeF<span class=nt>&lt;/id&gt;</span>
</span></span><span class=line><span class=cl>        <span class=nt>&lt;text&gt;</span>
</span></span><span class=line><span class=cl>        In the front yard of a funeral home, &#34;Drive carefully, we&#39;ll wait.&#34; On an electrician&#39;s truck, &#34;Let us remove your shorts.&#34; Outside a radiator repair shop, &#34;Best place in town to take a leak.&#34; In a non-smoking area, &#34;If we see you smoking, we will assume you are on fire and take appropriate action.&#34; On a maternity room door, &#34;Push, Push, Push.&#34; On a front door, &#34;Everyone on the premises is a vegetarian except the dog.&#34; At an optometrist&#39;s office, &#34;If you don&#39;t see what you&#39;re looking for, you&#39;ve come to the right place.&#34; On a taxidermist&#39;s window, &#34;We really know our stuff.&#34; On a butcher&#39;s window, &#34;Let me meat your needs.&#34; On a butcher&#39;s window, &#34;You can beat our prices, but you can&#39;t beat our meat.&#34; On a fence, &#34;Salesmen welcome. Dog food is expensive.&#34; At a car dealership, &#34;The best way to get back on your feet - miss a car payment.&#34; Outside a muffler shop, &#34;No appointment necessary. We&#39;ll hear you coming.&#34; In a dry cleaner&#39;s emporium, &#34;Drop your pants here.&#34; On a desk in a reception room, &#34;We shoot every 3rd salesman, and the 2nd one just left.&#34; In a veterinarian&#39;s waiting room, &#34;Be back in 5 minutes. Sit! Stay!&#34; At the electric company, &#34;We would be delighted if you send in your bill. However, if you don&#39;t, you will be.&#34; In a Beauty Shop, &#34;Dye now!&#34; In a Beauty Shop, &#34;We curl up and Dye for you.&#34; On the side of a garbage truck, &#34;We&#39;ve got what it takes to take what you&#39;ve got.&#34; (Burglars please copy.) In a restaurant window, &#34;Don&#39;t stand there and be hungry, come in and get fed up.&#34; Inside a bowling alley, &#34;Please be quiet. We need to hear a pin drop.&#34; In a cafeteria, &#34;Shoes are required to eat in the cafeteria. Socks can eat any place they want.&#34;
</span></span><span class=line><span class=cl>        <span class=nt>&lt;/text&gt;</span>
</span></span><span class=line><span class=cl>      <span class=nt>&lt;/joke&gt;</span>
</span></span><span class=line><span class=cl>    <span class=nt>&lt;/jokes&gt;</span>
</span></span><span class=line><span class=cl>    <span class=nt>&lt;copyright&gt;</span>2019-20 https://jokes.one<span class=nt>&lt;/copyright&gt;</span>
</span></span><span class=line><span class=cl>  <span class=nt>&lt;/contents&gt;</span>
</span></span><span class=line><span class=cl><span class=nt>&lt;/response&gt;</span></span></span></code></pre></div><p>We can parse this response with C#&rsquo;s <a href="https://docs.microsoft.com/en-us/dotnet/api/system.xml.xmldocument?view=net-6.0" rel=external target=_blank>XmlDocument Class</a> from the <code>System.Xml</code> namespace. First, we create an instance of the class, using our response text. We can use one of the <code>XmlDocument.Load()</code> overrides, which takes a stream, to process our response stream directly:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-csharp data-lang=csharp><span class=line><span class=cl><span class=k>using</span> <span class=nn>Stream</span> <span class=n>responseStream</span> <span class=p>=</span> <span class=n>response</span><span class=p>.</span><span class=n>GetStream</span><span class=p>()</span> 
</span></span><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=n>XmlDocument</span> <span class=n>xDoc</span> <span class=p>=</span> <span class=k>new</span> <span class=n>XmlDocument</span><span class=p>();</span>
</span></span><span class=line><span class=cl>  <span class=n>xDoc</span><span class=p>.</span><span class=n>Load</span><span class=p>(</span><span class=n>responseStream</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=c1>// TODO: get our joke!</span>
</span></span><span class=line><span class=cl><span class=p>}</span></span></span></code></pre></div><p>Then we can query the <code>XmlDocument</code> for the tag we care about, i.e. <em>response > contents > jokes > joke > text</em> (the text of the joke). We use XPath syntax for this:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-csharp data-lang=csharp><span class=line><span class=cl>  <span class=kt>var</span> <span class=n>node</span> <span class=p>=</span> <span class=n>xDoc</span><span class=p>.</span><span class=n>SelectSingleNode</span><span class=p>(</span><span class=s>&#34;/response/contents/jokes/joke/text&#34;</span><span class=p>);</span></span></span></code></pre></div><p><a href=https://en.wikipedia.org/wiki/XPath rel=external target=_blank>XPath</a> is a query language, much like CSS selectors, which allow you to navigate a XML document in a lot of different ways. In this case, we are just finding the exact element based on its path. Then we can pull its value, and do something with it (such as logging it to the console):</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-csharp data-lang=csharp><span class=line><span class=cl>  <span class=n>Console</span><span class=p>.</span><span class=n>WriteLine</span><span class=p>(</span><span class=n>node</span><span class=p>.</span><span class=n>InnerText</span><span class=p>);</span></span></span></code></pre></div><h4 id=parsing-json>Parsing JSON</h4><p>JavaScript Object Notation (JSON) has become a popular format for web APIs, as it usually requires less characters than the corresponding XML, and is natively serializable from JavaScript making it extremely compatible with client-side web applications.</p><p>Assuming you have set the <code>Accept</code> header as discussed above, you will receive a response similar to (but with a different joke):</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-json data-lang=json><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=nt>&#34;success&#34;</span><span class=p>:{</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;total&#34;</span><span class=p>:</span><span class=mi>1</span>
</span></span><span class=line><span class=cl>  <span class=p>},</span>
</span></span><span class=line><span class=cl>  <span class=nt>&#34;contents&#34;</span><span class=p>:{</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;jokes&#34;</span><span class=p>:[</span>
</span></span><span class=line><span class=cl>      <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=nt>&#34;description&#34;</span><span class=p>:</span><span class=s2>&#34;Joke of the day &#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=nt>&#34;language&#34;</span><span class=p>:</span><span class=s2>&#34;en&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=nt>&#34;background&#34;</span><span class=p>:</span><span class=s2>&#34;&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=nt>&#34;category&#34;</span><span class=p>:</span><span class=s2>&#34;jod&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=nt>&#34;date&#34;</span><span class=p>:</span><span class=s2>&#34;2021-11-30&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=nt>&#34;joke&#34;</span><span class=p>:{</span>
</span></span><span class=line><span class=cl>          <span class=nt>&#34;title&#34;</span><span class=p>:</span><span class=s2>&#34;Class With Claus&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>          <span class=nt>&#34;lang&#34;</span><span class=p>:</span><span class=s2>&#34;en&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>          <span class=nt>&#34;length&#34;</span><span class=p>:</span><span class=s2>&#34;78&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>          <span class=nt>&#34;clean&#34;</span><span class=p>:</span><span class=kc>null</span><span class=p>,</span>
</span></span><span class=line><span class=cl>          <span class=nt>&#34;racial&#34;</span><span class=p>:</span><span class=kc>null</span><span class=p>,</span>
</span></span><span class=line><span class=cl>          <span class=nt>&#34;date&#34;</span><span class=p>:</span><span class=s2>&#34;2021-11-30&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>          <span class=nt>&#34;id&#34;</span><span class=p>:</span><span class=s2>&#34;LuVeRJsEIzCzvTnRmBTHXweF&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>          <span class=nt>&#34;text&#34;</span><span class=p>:</span><span class=s2>&#34;Q: What do you say to Santa when he&#39;s taking attendance at school?\nA: Present.&#34;</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>      <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=p>],</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;copyright&#34;</span><span class=p>:</span><span class=s2>&#34;2019-20 https:\/\/jokes.one&#34;</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span></span></span></code></pre></div><p>The C# system libraries provide JSON support in the <code>System.Text.Json</code> namespace using the <a href="https://docs.microsoft.com/en-us/dotnet/api/system.text.json.jsonserializer?view=net-6.0" rel=external target=_blank>JsonSerializer</a> class. The default behavior of the deserializer is to deserialize into a <code>JsonDocument</code> composed of nested <code>JsonElement</code> objects - essentially, dictionaries of dictionaries. As with the <code>XDocument</code>, we can deserialize JSON directly from a <code>Stream</code>:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-csharp data-lang=csharp><span class=line><span class=cl><span class=k>using</span> <span class=nn>Stream</span> <span class=n>responseStream</span> <span class=p>=</span> <span class=n>response</span><span class=p>.</span><span class=n>GetStream</span><span class=p>()</span> 
</span></span><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=n>JsonDocument</span> <span class=n>jDoc</span> <span class=p>=</span> <span class=n>JsonSerializer</span><span class=p>.</span><span class=n>Deserialize</span><span class=p>(</span><span class=n>responseStream</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=c1>// TODO: get our joke!</span>
</span></span><span class=line><span class=cl><span class=p>}</span></span></span></code></pre></div><p>Then we can navigate from the root element (a <code>JsonElement</code> instance) down the nested path of key/value pairs, by calling <code>GetProperty()</code> to access each successive property, and then print the joke text to the console:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-csharp data-lang=csharp><span class=line><span class=cl>  <span class=kt>var</span> <span class=n>contents</span> <span class=p>=</span> <span class=n>jDoc</span><span class=p>.</span><span class=n>RootElement</span><span class=p>.</span><span class=n>GetProperty</span><span class=p>(</span><span class=s>&#34;contents&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=kt>var</span> <span class=n>jokes</span> <span class=p>=</span> <span class=n>contents</span><span class=p>.</span><span class=n>GetProperty</span><span class=p>(</span><span class=s>&#34;jokes&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=kt>var</span> <span class=n>jokeData</span> <span class=p>=</span> <span class=n>jokes</span><span class=p>[</span><span class=m>0</span><span class=p>];</span>
</span></span><span class=line><span class=cl>  <span class=kt>var</span> <span class=n>joke</span> <span class=p>=</span> <span class=n>jokeData</span><span class=p>.</span><span class=n>GetProperty</span><span class=p>(</span><span class=s>&#34;joke&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=kt>var</span> <span class=n>text</span> <span class=p>=</span> <span class=n>joke</span><span class=p>.</span><span class=n>GetProperty</span><span class=p>(</span><span class=s>&#34;text&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=n>Console</span><span class=p>.</span><span class=n>WriteLine</span><span class=p>(</span><span class=n>text</span><span class=p>);</span></span></span></code></pre></div><footer class=footline></footer></article><article class=default><header class=headline></header><h1 id=asynchronous-requests>Asynchronous Requests</h1><p>Now that we&rsquo;re more comfortable with <code>using</code> statements, let&rsquo;s return to our request-making code:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-csharp data-lang=csharp><span class=line><span class=cl><span class=n>WebRequest</span> <span class=n>request</span> <span class=p>=</span> <span class=n>WebRequest</span><span class=p>.</span><span class=n>Create</span><span class=p>(</span><span class=s>&#34;http://api.jokes.one/jod&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=k>using</span> <span class=nn>Stream</span> <span class=n>responseStream</span> <span class=p>=</span> <span class=n>response</span><span class=p>.</span><span class=n>GetStream</span><span class=p>()</span> 
</span></span><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=n>StreamReader</span> <span class=n>reader</span> <span class=p>=</span> <span class=k>new</span> <span class=n>StreamReader</span><span class=p>(</span><span class=n>responseStream</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=kt>string</span> <span class=n>responseText</span><span class=p>=</span> <span class=n>reader</span><span class=p>.</span><span class=n>ReadToEnd</span><span class=p>();</span>
</span></span><span class=line><span class=cl>  <span class=n>Console</span><span class=p>.</span><span class=n>WriteLine</span><span class=p>(</span><span class=n>responseText</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl><span class=n>response</span><span class=p>.</span><span class=n>Close</span><span class=p>();</span></span></span></code></pre></div><p>The <code>response.GetStream()</code> triggers the http request, which hits the API and returns its result. Remember a HTTP request is streamed across the internet, then processed by the server, and the response streamed back. That can take some time (at least to a computer). While the program waits on it to finish, it cannot do anything else. For some programs, like one that only displays jokes, this is fine. But what if our program needs to also be responding to the user&rsquo;s events - like typing or moving the mouse? While the program is waiting, it is effectively paused, and nothing the user does will cause the program to change.</p><h4 id=asynchronous-methods>Asynchronous Methods</h4><p>This is where asynchronous methods come in. An asynchronous method operates on a separate thread, allowing execution of the program to continue.</p><p>let&rsquo;s revisit our <code>WebRequest</code> example:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-csharp data-lang=csharp><span class=line><span class=cl><span class=n>WebRequest</span> <span class=n>request</span> <span class=p>=</span> <span class=n>WebRequest</span><span class=p>.</span><span class=n>Create</span><span class=p>(</span><span class=s>&#34;http://api.jokes.one/jod&#34;</span><span class=p>);</span></span></span></code></pre></div><p>We can then make the request <em>asynchronously</em> by calling the asynchronous version of <code>GetResponse()</code> - <code>GetResponseAsync()</code>:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-csharp data-lang=csharp><span class=line><span class=cl><span class=n>WebResponse</span> <span class=n>response</span> <span class=p>=</span> <span class=k>await</span> <span class=n>request</span><span class=p>.</span><span class=n>GetResponseAsync</span><span class=p>();</span></span></span></code></pre></div><p>The <code>await</code> keyword effectively pauses this thread of execution until the response is received. Effectively, the subsequent code is set aside to be processed when the asynchronous method finishes or encounters an error. This allows the main thread of the program to continue responding to user input and other events. The rest of the process is handled exactly as before:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-csharp data-lang=csharp><span class=line><span class=cl><span class=k>using</span> <span class=nn>Stream</span> <span class=n>responseStream</span> <span class=p>=</span> <span class=n>response</span><span class=p>.</span><span class=n>GetStream</span><span class=p>()</span> 
</span></span><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=n>StreamReader</span> <span class=n>reader</span> <span class=p>=</span> <span class=k>new</span> <span class=n>StreamReader</span><span class=p>(</span><span class=n>responseStream</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=kt>string</span> <span class=n>responseText</span><span class=p>=</span> <span class=n>reader</span><span class=p>.</span><span class=n>ReadToEnd</span><span class=p>();</span>
</span></span><span class=line><span class=cl>  <span class=n>Console</span><span class=p>.</span><span class=n>WriteLine</span><span class=p>(</span><span class=n>responseText</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=p>}</span></span></span></code></pre></div><h4 id=writing-asynchronous-methods>Writing Asynchronous Methods</h4><p>Normally we would wrap the asynchronous method calls within our own asynchronous method. Thus, we might define a method, <code>GetJoke()</code>:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-csharp data-lang=csharp><span class=line><span class=cl><span class=kd>public</span> <span class=kt>string</span> <span class=kd>async</span> <span class=n>GetJoke</span><span class=p>()</span>
</span></span><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=n>WebRequest</span> <span class=n>request</span> <span class=p>=</span> <span class=n>WebRequest</span><span class=p>.</span><span class=n>Create</span><span class=p>(</span><span class=s>&#34;http://api.jokes.one/jod&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=n>WebResponse</span> <span class=n>response</span> <span class=p>=</span> <span class=k>await</span> <span class=n>request</span><span class=p>.</span><span class=n>GetResponseAsync</span><span class=p>();</span>
</span></span><span class=line><span class=cl>  <span class=k>using</span> <span class=nn>Stream</span> <span class=n>responseStream</span> <span class=p>=</span> <span class=n>response</span><span class=p>.</span><span class=n>GetStream</span><span class=p>()</span> 
</span></span><span class=line><span class=cl>  <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=n>XmlDocument</span> <span class=n>xDoc</span> <span class=p>=</span> <span class=k>new</span> <span class=n>XmlDocument</span><span class=p>();</span>
</span></span><span class=line><span class=cl>    <span class=n>xDoc</span><span class=p>.</span><span class=n>Load</span><span class=p>(</span><span class=n>responseStream</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=kt>var</span> <span class=n>node</span> <span class=p>=</span> <span class=n>xDoc</span><span class=p>.</span><span class=n>SelectSingleNode</span><span class=p>(</span><span class=s>&#34;/response/contents/jokes/joke/text&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=n>node</span><span class=p>.</span><span class=n>InnerText</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl>  <span class=k>return</span> <span class=s>&#34;&#34;</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span></span></span></code></pre></div><h4 id=asynchronous-asp-requestresponse-methods>Asynchronous ASP Request/Response Methods</h4><p>ASP.Net includes built-in support for asynchronous request handling. You just need to add the <code>async</code> keyword to your <code>OnGet()</code> or <code>OnPost()</code> method, and the ASP.NET server will process it asynchronously.</p><p>For example, we could invoke our <code>GetJoke()</code> method in a <code>OnGet()</code>:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-csharp data-lang=csharp><span class=line><span class=cl><span class=kd>public</span> <span class=k>class</span> <span class=nc>JokeModel</span> <span class=p>:</span> <span class=n>PageModel</span> 
</span></span><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=kd>async</span> <span class=n>IActionResult</span> <span class=n>OnGet</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=kt>var</span> <span class=n>joke</span> <span class=p>=</span> <span class=k>await</span> <span class=n>GetJoke</span><span class=p>();</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=n>Content</span><span class=p>(</span><span class=n>joke</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span></span></span></code></pre></div><p>This will cause the text of the joke to be sent as the response, and allow other pages to be served while this one request is awaiting a response from the Joke API.</p><footer class=footline></footer></article><article class=default><header class=headline></header><h1 id=restful-routes>RESTful Routes</h1><p>Many web applications deal with some kind of <em>resource</em>, i.e. people, widgets, records. Much like in object-orientation we have organized the program around objects, many web applications are organized around resources. And as we have specialized ways to construct, access, and destroy objects, web applications need to create, read, update, and destroy resource records (we call these CRUD operations).</p><p>In his 2000 PhD. dissertation, Roy Fielding defined <a href=https://en.wikipedia.org/wiki/Representational_state_transfer rel=external target=_blank>Representational State Transfer (REST</a>), a way of mapping HTTP routes to the CRUD operations for a specific resource. This practice came to be known as RESTful routing, and has become one common strategy for structuring a web application&rsquo;s routes. Consider the case where we have an online directory of students. The students would be our resource, and we would define routes to create, read, update and destroy them by a combination of HTTP action and route:</p><table><tr><th>CRUD Operation</th><th>HTTP Action</th><th>Route</th></tr><tr><td>Create</td><td>POST</td><td>/students</td></tr><tr><td>Read (all)</td><td>GET</td><td>/students</td></tr><tr><td>Read (one)</td><td>GET</td><td>/students/[ID]</td></tr><tr><td>Update</td><td>PUT or POST</td><td>/students/[ID]</td></tr><tr><td>Destroy</td><td>DELETE</td><td>/students/[ID]</td></tr></table><p>Here the <code>[ID]</code> is a unique identifier for the individual student. Note too that we have <em>two</em> routes for reading - one for getting a list of <em>all</em> students, and one for getting the details of an individual student.</p><p>REST is a remarkably straightforward implementation of very common functionality, no doubt driving its wide adoption. Razor pages supports REST implicitly - the RESTful resource <em>is the PageModel object</em>. This is the reason model binding does not bind properties on GET requests by default - because a GET request is used to retrieve, not update a resource. However, properties derived from the route (such as <code>:ID</code> in our example, <em>will</em> be bound and available on GET requests).</p><p>With Razor Pages, you can specify a route parameter after the <code>@page</code> directive. I.e. to add our <code>ID</code> parameter, we would use:</p><div class=highlight><pre tabindex=0><code class=language-cshtml data-lang=cshtml>@page &#34;{ID?}&#34;</code></pre></div><p>We can use any parameter name; it doesn&rsquo;t have to be <code>ID</code> (though this is common). The <code>?</code> indicates that the ID parameter is optional - so we can still visit <code>/students</code>. Without it, we only can visit specific students, i.e. <code>/students/2</code>.</p><p>Route parameters can be bound using any of the binding methods we discussed previously - parameter binding, model binding, or be accessed directly from the <code>@RouteData.Values</code> dictionary. When we <em>are</em> using these parameters to create or update new resources, we often want to take an additional step - <em>validating</em> the supplied data.</p><footer class=footline></footer></article><article class=default><header class=headline></header><h1 id=summary>Summary</h1><p>In this chapter we explored using web APIs to retrieve data from remote servers. We saw how to use the <code>WebRequest</code> object to make this task approachable. We also revisited ideas you&rsquo;ve seen in prior courses like the <code>IDisposable</code> interface and <code>using</code> statements to work with unmanaged objects. We saw how to consume XML data we receive as a response from a web API.</p><p>We also discussed using <code>async</code> methods to allow our programs to continue to respond to user input and incoming web requests while processing long-running tasks in parallel. Finally, we discussed RESTful routes, a standardized way of determining the routes for your web API.</p><footer class=footline></footer></article></section></div></main><div class=git-footer><p class=theme-version-footer>6.0.0</p><p>Last modified by:
<i class='fas fa-user'></i> Russell Feldhausen
<i class='fas fa-calendar'></i> <a href=https://github.com/ksu-cs-textbooks/cis400/commit/681e5c9c43e3ac6de614c2cc74487702fd43cab7>Aug 10, 2023</a></p></div></div><script src=/cis400/js/clipboard.min.js?1731961654 defer></script><script src=/cis400/js/perfect-scrollbar.min.js?1731961654 defer></script><script src=/cis400/js/theme.js?1731961654 defer></script></body></html>