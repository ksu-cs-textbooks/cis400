




	
	
		

	
	
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		
		

	
	
		

	
	
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		
		

	
	
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		
		

	
	
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		
		

	
	
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		
		

	
	
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		
		

	
	
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		
		

	
	
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		
		
		

	
	
		

	
	
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		
		

	
	
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		
		

	
	
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		
		

	
	
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		
		

	
	
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		
		

	
	
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		
		
		

	
	
		

	
	
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		
		

	
	
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		
		

	
	
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		
		

	
	
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		
		

	
	
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		
		

	
	
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		
		
		

	
	
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		
		

	
	
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		
		

	
	
		
		

	
	
		

	
	
		
		
<!DOCTYPE html>
<html lang="en" dir="ltr">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="height=device-height, width=device-width, initial-scale=1.0, minimum-scale=1.0">
    <meta name="generator" content="Hugo 0.117.0">
    <meta name="generator" content="Relearn 5.18.0">
    <meta name="description" content="K-State CIS 400 Textbook">
    <meta name="author" content="Nathan Bean">
    <title>Parsing API Data :: K-State CIS 400 Textbook</title>
    <link href="https://ksu-cs-textbooks.github.io/cis400/3-web-development/04-apis/04-parsing-data/index.html" rel="canonical" type="text/html" title="Parsing API Data :: K-State CIS 400 Textbook">
    <link href="https://ksu-cs-textbooks.github.io/cis400/3-web-development/04-apis/04-parsing-data/index.xml" rel="alternate" type="application/rss+xml" title="Parsing API Data :: K-State CIS 400 Textbook">
    <link href="https://ksu-cs-textbooks.github.io/cis400/3-web-development/04-apis/04-parsing-data/tele.html" rel="alternate" type="text/html" title="Parsing API Data :: K-State CIS 400 Textbook">
    <link href="https://ksu-cs-textbooks.github.io/cis400/3-web-development/04-apis/04-parsing-data/embed.html" rel="alternate" type="text/html" title="Parsing API Data :: K-State CIS 400 Textbook">
    <!-- https://github.com/filamentgroup/loadCSS/blob/master/README.md#how-to-use -->
    <link href="https://ksu-cs-textbooks.github.io/cis400/css/fontawesome-all.min.css?1692653136" rel="stylesheet" media="print" onload="this.media='all';this.onload=null;"><noscript><link href="https://ksu-cs-textbooks.github.io/cis400/css/fontawesome-all.min.css?1692653136" rel="stylesheet"></noscript>
    <link href="https://ksu-cs-textbooks.github.io/cis400/css/nucleus.css?1692653136" rel="stylesheet">
    <link href="https://ksu-cs-textbooks.github.io/cis400/css/auto-complete.css?1692653136" rel="stylesheet" media="print" onload="this.media='all';this.onload=null;"><noscript><link href="https://ksu-cs-textbooks.github.io/cis400/css/auto-complete.css?1692653136" rel="stylesheet"></noscript>
    <link href="https://ksu-cs-textbooks.github.io/cis400/css/perfect-scrollbar.min.css?1692653136" rel="stylesheet">
    <link href="https://ksu-cs-textbooks.github.io/cis400/css/fonts.css?1692653136" rel="stylesheet" media="print" onload="this.media='all';this.onload=null;"><noscript><link href="https://ksu-cs-textbooks.github.io/cis400/css/fonts.css?1692653136" rel="stylesheet"></noscript>
    <link href="https://ksu-cs-textbooks.github.io/cis400/css/theme.css?1692653136" rel="stylesheet">
    <link href="https://ksu-cs-textbooks.github.io/cis400/css/theme-auto.css?1692653136" rel="stylesheet" id="variant-style">
    <link href="https://ksu-cs-textbooks.github.io/cis400/css/variant.css?1692653136" rel="stylesheet">
    <link href="https://ksu-cs-textbooks.github.io/cis400/css/print.css?1692653136" rel="stylesheet" media="print">
    <link href="https://ksu-cs-textbooks.github.io/cis400/css/format-print.css?1692653136" rel="stylesheet">
    <link href="https://ksu-cs-textbooks.github.io/cis400/css/ie.css?1692653136" rel="stylesheet">
    <script src="https://ksu-cs-textbooks.github.io/cis400/js/url.js?1692653136"></script>
    <script src="https://ksu-cs-textbooks.github.io/cis400/js/variant.js?1692653136"></script>
    <script>
      // hack to let hugo tell us how to get to the root when using relativeURLs, it needs to be called *url= for it to do its magic:
      // https://github.com/gohugoio/hugo/blob/145b3fcce35fbac25c7033c91c1b7ae6d1179da8/transform/urlreplacers/absurlreplacer.go#L72
      window.index_js_url="https://ksu-cs-textbooks.github.io/cis400/index.search.js";
      var root_url="https://ksu-cs-textbooks.github.io/cis400/";
      var baseUri=root_url.replace(/\/$/, '');
      // translations
      window.T_Copy_to_clipboard = 'Copy to clipboard';
      window.T_Copied_to_clipboard = 'Copied to clipboard!';
      window.T_Copy_link_to_clipboard = 'Copy link to clipboard';
      window.T_Link_copied_to_clipboard = 'Copied link to clipboard!';
      window.T_No_results_found = 'No results found for \u0022{0}\u0022';
      window.T_N_results_found = '{1} results found for \u0022{0}\u0022';
      // some further base stuff
      var baseUriFull='https:\/\/ksu-cs-textbooks.github.io\/cis400/';
      window.variants && variants.init( [ 'auto', 'light-theme', 'dark-theme' ] );
    </script>
    
    <link href="https://ksu-cs-textbooks.github.io/cis400/css/custom.css?1692653136" rel="stylesheet">

  </head>
  <body class="mobile-support print disableInlineCopyToClipboard" data-url="https://ksu-cs-textbooks.github.io/cis400/3-web-development/04-apis/04-parsing-data/index.html">
    <div id="body" class="default-animation">
      <div id="sidebar-overlay"></div>
      <div id="toc-overlay"></div>
      <nav id="topbar" class="highlightable">
        <div>
          <div id="top-tele-link">
            <a class="print-link" title='Teleprompter View' href="https://ksu-cs-textbooks.github.io/cis400/3-web-development/04-apis/04-parsing-data/tele.html">
              <i class="fas fa-tv fa-fw"></i>
            </a>
          </div>
          <div id="top-embed-link">
            <a class="print-link" title='Embeddable Version' href="https://ksu-cs-textbooks.github.io/cis400/3-web-development/04-apis/04-parsing-data/embed.html">
              <i class="fas fa-expand-arrows-alt fa-fw"></i>
            </a>
          </div>
          <div id="breadcrumbs">
            <span id="sidebar-toggle-span">
              <a href="#" id="sidebar-toggle" class="topbar-link" title='Menu (CTRL+ALT+n)'><i class="fas fa-bars fa-fw"></i></a>
            </span>
            <ol class="links" itemscope itemtype="http://schema.org/BreadcrumbList">
              <li itemscope itemtype="https://schema.org/ListItem" itemprop="itemListElement"><a itemprop="item" href="https://ksu-cs-textbooks.github.io/cis400/index.html"><span itemprop="name">CIS 400: Object-Oriented Design, Implementation, and Testing</span></a><meta itemprop="position" content="1"> &gt; </li>
              <li itemscope itemtype="https://schema.org/ListItem" itemprop="itemListElement"><a itemprop="item" href="https://ksu-cs-textbooks.github.io/cis400/3-web-development/index.html"><span itemprop="name">Web Development</span></a><meta itemprop="position" content="2"> &gt; </li>
              <li itemscope itemtype="https://schema.org/ListItem" itemprop="itemListElement"><a itemprop="item" href="https://ksu-cs-textbooks.github.io/cis400/3-web-development/04-apis/index.html"><span itemprop="name">Web APIs</span></a><meta itemprop="position" content="3"> &gt; </li>
              <li itemscope itemtype="https://schema.org/ListItem" itemprop="itemListElement"><span itemprop="name">Parsing API Data</span><meta itemprop="position" content="4"></li>
            </ol>
          </div>
        </div>
      </nav>
      <main id="body-inner" class="highlightable default" tabindex="-1">
        <div class="flex-block-wrapper">
          <article class="default">
            <header class="headline">
            </header>
<h1 id="parsing-api-data">Parsing API Data</h1>

<p>Web APIs typically provide their data in a structured format, i.e. XML or JSON.  To use this within a C# program you&rsquo;ll need to either parse it or convert it into an object or objects.</p>
<p>The Joke of the Day API can provide either - we just need to specify our preference with a <code>Accept</code> header in our HTTP request. This header lets the server know what format(s) of data we are ready to process.  XML is signified by the MIME type <code>application/xml</code> and JSON by <code>application/json</code>.</p>
<p>To set this (or any other header) in our <code>WebRequest</code> object, we use the <code>Header</code> property&rsquo;s <code>Add()</code> method:</p>
<div class="wrap-code highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-csharp" data-lang="csharp"><span style="display:flex;"><span>WebRequest request = WebRequest.Create(<span style="color:#e6db74">&#34;http://api.jokes.one/jod&#34;</span>);
</span></span><span style="display:flex;"><span>request.Headers.Add(<span style="color:#e6db74">&#34;Accept&#34;</span>, <span style="color:#e6db74">&#34;application/json&#34;</span>);</span></span></code></pre></div><p>For JSON, or:</p>
<div class="wrap-code highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-csharp" data-lang="csharp"><span style="display:flex;"><span>WebRequest request = WebRequest.Create(<span style="color:#e6db74">&#34;http://api.jokes.one/jod&#34;</span>);
</span></span><span style="display:flex;"><span>request.Headers.Add(<span style="color:#e6db74">&#34;Accept&#34;</span>, <span style="color:#e6db74">&#34;application/xml&#34;</span>);</span></span></code></pre></div><p>For XML.</p>
<h4 id="parsing-xml">Parsing XML</h4>
<p>Let&rsquo;s start by examining the older format, XML.  Assuming you have set the <code>Accept</code> header as discussed above, you will receive a response similar to (but with a different joke):</p>
<div class="wrap-code highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-xml" data-lang="xml"><span style="display:flex;"><span><span style="color:#f92672">&lt;response&gt;</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">&lt;success&gt;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">&lt;total&gt;</span>1<span style="color:#f92672">&lt;/total&gt;</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">&lt;/success&gt;</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">&lt;contents&gt;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">&lt;jokes&gt;</span>
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">&lt;description&gt;</span>Joke of the day <span style="color:#f92672">&lt;/description&gt;</span>
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">&lt;language&gt;</span>en<span style="color:#f92672">&lt;/language&gt;</span>
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">&lt;background/&gt;</span>
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">&lt;category&gt;</span>jod<span style="color:#f92672">&lt;/category&gt;</span>
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">&lt;date&gt;</span>2021-11-29<span style="color:#f92672">&lt;/date&gt;</span>
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">&lt;joke&gt;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">&lt;title&gt;</span>Signs for every job<span style="color:#f92672">&lt;/title&gt;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">&lt;lang&gt;</span>en<span style="color:#f92672">&lt;/lang&gt;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">&lt;length&gt;</span>1749<span style="color:#f92672">&lt;/length&gt;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">&lt;clean&gt;</span>0<span style="color:#f92672">&lt;/clean&gt;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">&lt;racial&gt;</span>0<span style="color:#f92672">&lt;/racial&gt;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">&lt;date&gt;</span>2021-11-29<span style="color:#f92672">&lt;/date&gt;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">&lt;id&gt;</span>HqJ1i9L1ujVCcZmS5C4nhAeF<span style="color:#f92672">&lt;/id&gt;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">&lt;text&gt;</span>
</span></span><span style="display:flex;"><span>        In the front yard of a funeral home, &#34;Drive carefully, we&#39;ll wait.&#34; On an electrician&#39;s truck, &#34;Let us remove your shorts.&#34; Outside a radiator repair shop, &#34;Best place in town to take a leak.&#34; In a non-smoking area, &#34;If we see you smoking, we will assume you are on fire and take appropriate action.&#34; On a maternity room door, &#34;Push, Push, Push.&#34; On a front door, &#34;Everyone on the premises is a vegetarian except the dog.&#34; At an optometrist&#39;s office, &#34;If you don&#39;t see what you&#39;re looking for, you&#39;ve come to the right place.&#34; On a taxidermist&#39;s window, &#34;We really know our stuff.&#34; On a butcher&#39;s window, &#34;Let me meat your needs.&#34; On a butcher&#39;s window, &#34;You can beat our prices, but you can&#39;t beat our meat.&#34; On a fence, &#34;Salesmen welcome. Dog food is expensive.&#34; At a car dealership, &#34;The best way to get back on your feet - miss a car payment.&#34; Outside a muffler shop, &#34;No appointment necessary. We&#39;ll hear you coming.&#34; In a dry cleaner&#39;s emporium, &#34;Drop your pants here.&#34; On a desk in a reception room, &#34;We shoot every 3rd salesman, and the 2nd one just left.&#34; In a veterinarian&#39;s waiting room, &#34;Be back in 5 minutes. Sit! Stay!&#34; At the electric company, &#34;We would be delighted if you send in your bill. However, if you don&#39;t, you will be.&#34; In a Beauty Shop, &#34;Dye now!&#34; In a Beauty Shop, &#34;We curl up and Dye for you.&#34; On the side of a garbage truck, &#34;We&#39;ve got what it takes to take what you&#39;ve got.&#34; (Burglars please copy.) In a restaurant window, &#34;Don&#39;t stand there and be hungry, come in and get fed up.&#34; Inside a bowling alley, &#34;Please be quiet. We need to hear a pin drop.&#34; In a cafeteria, &#34;Shoes are required to eat in the cafeteria. Socks can eat any place they want.&#34;
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">&lt;/text&gt;</span>
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">&lt;/joke&gt;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">&lt;/jokes&gt;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">&lt;copyright&gt;</span>2019-20 https://jokes.one<span style="color:#f92672">&lt;/copyright&gt;</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">&lt;/contents&gt;</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">&lt;/response&gt;</span></span></span></code></pre></div><p>We can parse this response with C#&rsquo;s <a href="https://docs.microsoft.com/en-us/dotnet/api/system.xml.xmldocument?view=net-6.0" target="_blank">XmlDocument Class</a>
 from the <code>System.Xml</code> namespace.  First, we create an instance of the class, using our response text.  We can use one of the <code>XmlDocument.Load()</code> overrides, which takes a stream, to process our response stream directly:</p>
<div class="wrap-code highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-csharp" data-lang="csharp"><span style="display:flex;"><span><span style="color:#66d9ef">using</span> Stream responseStream = response.GetStream() 
</span></span><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>  XmlDocument xDoc = <span style="color:#66d9ef">new</span> XmlDocument();
</span></span><span style="display:flex;"><span>  xDoc.Load(responseStream);
</span></span><span style="display:flex;"><span>  <span style="color:#75715e">// TODO: get our joke!</span>
</span></span><span style="display:flex;"><span>}</span></span></code></pre></div><p>Then we can query the <code>XmlDocument</code> for the tag we care about, i.e. <em>response &gt; contents &gt; jokes &gt; joke &gt; text</em> (the text of the joke).  We use XPath syntax for this:</p>
<div class="wrap-code highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-csharp" data-lang="csharp"><span style="display:flex;"><span>  <span style="color:#66d9ef">var</span> node = xDoc.SelectSingleNode(<span style="color:#e6db74">&#34;/response/contents/jokes/joke/text&#34;</span>);</span></span></code></pre></div><p><a href="https://en.wikipedia.org/wiki/XPath" target="_blank">XPath</a>
 is a query language, much like CSS selectors, which allow you to navigate a XML document in a lot of different ways.  In this case, we are just finding the exact element based on its path.  Then we can pull its value, and do something with it (such as logging it to the console):</p>
<div class="wrap-code highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-csharp" data-lang="csharp"><span style="display:flex;"><span>  Console.WriteLine(node.InnerText);</span></span></code></pre></div><h4 id="parsing-json">Parsing JSON</h4>
<p>JavaScript Object Notation (JSON) has become a popular format for web APIs, as it usually requires less characters than the corresponding XML, and is natively serializable from JavaScript making it extremely compatible with client-side web applications.</p>
<p>Assuming you have set the <code>Accept</code> header as discussed above, you will receive a response similar to (but with a different joke):</p>
<div class="wrap-code highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-json" data-lang="json"><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">&#34;success&#34;</span>:{
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">&#34;total&#34;</span>:<span style="color:#ae81ff">1</span>
</span></span><span style="display:flex;"><span>  },
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">&#34;contents&#34;</span>:{
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">&#34;jokes&#34;</span>:[
</span></span><span style="display:flex;"><span>      {
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">&#34;description&#34;</span>:<span style="color:#e6db74">&#34;Joke of the day &#34;</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">&#34;language&#34;</span>:<span style="color:#e6db74">&#34;en&#34;</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">&#34;background&#34;</span>:<span style="color:#e6db74">&#34;&#34;</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">&#34;category&#34;</span>:<span style="color:#e6db74">&#34;jod&#34;</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">&#34;date&#34;</span>:<span style="color:#e6db74">&#34;2021-11-30&#34;</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">&#34;joke&#34;</span>:{
</span></span><span style="display:flex;"><span>          <span style="color:#f92672">&#34;title&#34;</span>:<span style="color:#e6db74">&#34;Class With Claus&#34;</span>,
</span></span><span style="display:flex;"><span>          <span style="color:#f92672">&#34;lang&#34;</span>:<span style="color:#e6db74">&#34;en&#34;</span>,
</span></span><span style="display:flex;"><span>          <span style="color:#f92672">&#34;length&#34;</span>:<span style="color:#e6db74">&#34;78&#34;</span>,
</span></span><span style="display:flex;"><span>          <span style="color:#f92672">&#34;clean&#34;</span>:<span style="color:#66d9ef">null</span>,
</span></span><span style="display:flex;"><span>          <span style="color:#f92672">&#34;racial&#34;</span>:<span style="color:#66d9ef">null</span>,
</span></span><span style="display:flex;"><span>          <span style="color:#f92672">&#34;date&#34;</span>:<span style="color:#e6db74">&#34;2021-11-30&#34;</span>,
</span></span><span style="display:flex;"><span>          <span style="color:#f92672">&#34;id&#34;</span>:<span style="color:#e6db74">&#34;LuVeRJsEIzCzvTnRmBTHXweF&#34;</span>,
</span></span><span style="display:flex;"><span>          <span style="color:#f92672">&#34;text&#34;</span>:<span style="color:#e6db74">&#34;Q: What do you say to Santa when he&#39;s taking attendance at school?\nA: Present.&#34;</span>
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>      }
</span></span><span style="display:flex;"><span>    ],
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">&#34;copyright&#34;</span>:<span style="color:#e6db74">&#34;2019-20 https:\/\/jokes.one&#34;</span>
</span></span><span style="display:flex;"><span>  }
</span></span><span style="display:flex;"><span>}</span></span></code></pre></div><p>The C# system libraries provide JSON support in the <code>System.Text.Json</code> namespace using the <a href="https://docs.microsoft.com/en-us/dotnet/api/system.text.json.jsonserializer?view=net-6.0" target="_blank">JsonSerializer</a>
 class. The default behavior of the deserializer is to deserialize into a <code>JsonDocument</code> composed of nested <code>JsonElement</code> objects - essentially, dictionaries of dictionaries.  As with the <code>XDocument</code>, we can deserialize JSON directly from a <code>Stream</code>:</p>
<div class="wrap-code highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-csharp" data-lang="csharp"><span style="display:flex;"><span><span style="color:#66d9ef">using</span> Stream responseStream = response.GetStream() 
</span></span><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>  JsonDocument jDoc = JsonSerializer.Deserialize(responseStream);
</span></span><span style="display:flex;"><span>  <span style="color:#75715e">// TODO: get our joke!</span>
</span></span><span style="display:flex;"><span>}</span></span></code></pre></div><p>Then we can navigate from the root element (a <code>JsonElement</code> instance) down the nested path of key/value pairs, by calling <code>GetProperty()</code> to access each successive property, and then print the joke text to the console:</p>
<div class="wrap-code highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-csharp" data-lang="csharp"><span style="display:flex;"><span>  <span style="color:#66d9ef">var</span> contents = jDoc.RootElement.GetProperty(<span style="color:#e6db74">&#34;contents&#34;</span>);
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">var</span> jokes = contents.GetProperty(<span style="color:#e6db74">&#34;jokes&#34;</span>);
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">var</span> jokeData = jokes[<span style="color:#ae81ff">0</span>];
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">var</span> joke = jokeData.GetProperty(<span style="color:#e6db74">&#34;joke&#34;</span>);
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">var</span> text = joke.GetProperty(<span style="color:#e6db74">&#34;text&#34;</span>);
</span></span><span style="display:flex;"><span>  Console.WriteLine(text);</span></span></code></pre></div><!-- 
This approach can be cumbersome, but there is another possibility - to deserialize the JSON directly into a C# object.  Let's look at that next.


#### Deserializing JSON into a C# Object

The `JsonSerializer` also allows us to deserialize JSON directly into a corresponding C# object.  For this to work, we have to define the structure of this object to match our expected response.  Since our JSON is a nested structure, we'll actually need _multiple_ classes to represent it.  Let's start with the innermost one - the joke itself, which has a structure like:

```json
{
  "title":"Class With Claus",
  "lang":"en",
  "length":"78",
  "clean":null,
  "racial":null,
  "date":"2021-11-30",
  "id":"LuVeRJsEIzCzvTnRmBTHXweF",
  "text":"Q: What do you say to Santa when he's taking attendance at school?\nA: Present."
}
```

We need to reproduce this as a C# class, converting the JSON properties into C# equivalents i.e.:

```csharp
public class Joke
{
  [JsonPropertyName("title")]
  public string Title {get; set;}

  [JsonPropertyName("lang")]
  public string Lang {get; set;}

  [JsonPropertyName("length")]
  public int Length {get; set;}

  [JsonPropertyName("clean")]
  public bool? Clean {get; set;}

  [JsonPropertyName("racial")]
  public bool? Racial {get; set;}

  [JsonPropertyName("date")]
  public DateTime Date {get; set;}

  [JsonPropertyName("id")]
  public string Id {get; set;}

  [JsonPropertyName("text")]
  public string Text {get; set;}
}
```

Note that for JSON, the standard naming convention is to use Camel Case property names, not the Pascal Case we use in C#.  The `[JsonPropertyName()]` attribute from the `System.Text.Json.Serialization` namespace allows us to indicate how the name needs to be transformed when we transform to and from a JSON string to match both naming conventions.

The `Joke` is then nested in a second object that provides additional metadata describing the joke:

```json
{
  "description":"Joke of the day ",
  "language":"en",
  "background":"",
  "category":"jod",
  "date":"2021-11-30",
  "joke":{...}
}
```

All we really care about here is the joke itself.  But the `JsonSerializer` will throw an error unless all properties are accounted for.  However, it does allow a bit of a wildcard in the form of a `Dictionary<string, JsonElement>` property - if we provide one named `ExtensionData`, then any property not otherwise present in the object will be mapped to it.  Let's take advantage of this to simplify our next class:

-->
            <footer class="footline">

            </footer>
          </article>


        </div>
      </main>
    
<div class="git-footer">
<p class="theme-version-footer">5.18.0</p>
<p>Last modified by: 
            <i class='fas fa-user'></i> Nathan Bean
            <i class='fas fa-calendar'></i> <a href="https://gitlab.cs.ksu.edu/cs-textbooks/cis400-textbook/-/commit/408a4bfc0e46b959337506e3f74d06482028eb83">Feb 14, 2022</a>
</p>
</div>

    
    </div>
    <script src="https://ksu-cs-textbooks.github.io/cis400/js/clipboard.min.js?1692653139" defer></script>
    <script src="https://ksu-cs-textbooks.github.io/cis400/js/perfect-scrollbar.min.js?1692653139" defer></script>
    <script src="https://ksu-cs-textbooks.github.io/cis400/js/theme.js?1692653139" defer></script>
  </body>
</html>
