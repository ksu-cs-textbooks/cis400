<!doctype html><html lang=en-us dir=ltr itemscope itemtype=http://schema.org/Article><head><meta charset=utf-8><meta name=viewport content="height=device-height,width=device-width,initial-scale=1,minimum-scale=1"><meta name=generator content="Hugo 0.128.0"><meta name=generator content="Relearn 6.0.0"><meta name=description content='Now that we’re more comfortable with using statements, let’s return to our request-making code:
WebRequest request = WebRequest.Create("http://api.jokes.one/jod"); using Stream responseStream = response.GetStream() { StreamReader reader = new StreamReader(responseStream); string responseText= reader.ReadToEnd(); Console.WriteLine(responseText); } response.Close();The response.GetStream() triggers the http request, which hits the API and returns its result. Remember a HTTP request is streamed across the internet, then processed by the server, and the response streamed back. That can take some time (at least to a computer).'><meta name=author content="Nathan Bean"><meta name=twitter:card content="summary"><meta name=twitter:title content="Asynchronous Requests :: K-State CIS 400 Textbook"><meta name=twitter:description content='Now that we’re more comfortable with using statements, let’s return to our request-making code:
WebRequest request = WebRequest.Create("http://api.jokes.one/jod"); using Stream responseStream = response.GetStream() { StreamReader reader = new StreamReader(responseStream); string responseText= reader.ReadToEnd(); Console.WriteLine(responseText); } response.Close();The response.GetStream() triggers the http request, which hits the API and returns its result. Remember a HTTP request is streamed across the internet, then processed by the server, and the response streamed back. That can take some time (at least to a computer).'><meta property="og:url" content="https://textbooks.cs.ksu.edu/cis400/3-web-development/04-apis/05-asynchronous-requests/embed.html"><meta property="og:site_name" content="K-State CIS 400 Textbook"><meta property="og:title" content="Asynchronous Requests :: K-State CIS 400 Textbook"><meta property="og:description" content='Now that we’re more comfortable with using statements, let’s return to our request-making code:
WebRequest request = WebRequest.Create("http://api.jokes.one/jod"); using Stream responseStream = response.GetStream() { StreamReader reader = new StreamReader(responseStream); string responseText= reader.ReadToEnd(); Console.WriteLine(responseText); } response.Close();The response.GetStream() triggers the http request, which hits the API and returns its result. Remember a HTTP request is streamed across the internet, then processed by the server, and the response streamed back. That can take some time (at least to a computer).'><meta property="og:locale" content="en-us"><meta property="og:type" content="article"><meta property="article:section" content="Web Development"><meta property="article:published_time" content="2018-08-24T10:53:26-05:00"><meta property="article:modified_time" content="2021-12-05T19:26:05-06:00"><meta itemprop=name content="Asynchronous Requests :: K-State CIS 400 Textbook"><meta itemprop=description content='Now that we’re more comfortable with using statements, let’s return to our request-making code:
WebRequest request = WebRequest.Create("http://api.jokes.one/jod"); using Stream responseStream = response.GetStream() { StreamReader reader = new StreamReader(responseStream); string responseText= reader.ReadToEnd(); Console.WriteLine(responseText); } response.Close();The response.GetStream() triggers the http request, which hits the API and returns its result. Remember a HTTP request is streamed across the internet, then processed by the server, and the response streamed back. That can take some time (at least to a computer).'><meta itemprop=datePublished content="2018-08-24T10:53:26-05:00"><meta itemprop=dateModified content="2021-12-05T19:26:05-06:00"><meta itemprop=wordCount content="425"><title>Asynchronous Requests :: K-State CIS 400 Textbook</title>
<link href=https://textbooks.cs.ksu.edu/cis400/3-web-development/04-apis/05-asynchronous-requests/ rel=canonical type=text/html title="Asynchronous Requests :: K-State CIS 400 Textbook"><link href=/cis400/3-web-development/04-apis/05-asynchronous-requests/index.xml rel=alternate type=application/rss+xml title="Asynchronous Requests :: K-State CIS 400 Textbook"><link href=/cis400/3-web-development/04-apis/05-asynchronous-requests/index.print.html rel=alternate type=text/html title="Asynchronous Requests :: K-State CIS 400 Textbook"><link href=/cis400/3-web-development/04-apis/05-asynchronous-requests/tele.html rel=alternate type=text/html title="Asynchronous Requests :: K-State CIS 400 Textbook"><link href=/cis400/css/fontawesome-all.min.css?1719517089 rel=stylesheet media=print onload='this.media="all",this.onload=null'><noscript><link href=/cis400/css/fontawesome-all.min.css?1719517089 rel=stylesheet></noscript><link href=/cis400/css/nucleus.css?1719517089 rel=stylesheet><link href=/cis400/css/auto-complete.css?1719517089 rel=stylesheet media=print onload='this.media="all",this.onload=null'><noscript><link href=/cis400/css/auto-complete.css?1719517089 rel=stylesheet></noscript><link href=/cis400/css/perfect-scrollbar.min.css?1719517089 rel=stylesheet><link href=/cis400/css/fonts.css?1719517089 rel=stylesheet media=print onload='this.media="all",this.onload=null'><noscript><link href=/cis400/css/fonts.css?1719517089 rel=stylesheet></noscript><link href=/cis400/css/theme.css?1719517089 rel=stylesheet><link href=/cis400/css/theme-light-theme.css?1719517089 rel=stylesheet id=R-variant-style><link href=/cis400/css/chroma-relearn-light.css?1719517089 rel=stylesheet id=R-variant-chroma-style><link href=/cis400/css/variant.css?1719517089 rel=stylesheet><link href=/cis400/css/print.css?1719517089 rel=stylesheet media=print><script>window.relearn=window.relearn||{},window.relearn.relBasePath="../../..",window.relearn.relBaseUri="../../../..",window.relearn.absBaseUri="https://textbooks.cs.ksu.edu/cis400",window.index_js_url="/cis400/index.search.js",window.variants&&variants.init(["light-theme"]),window.T_Copy_to_clipboard=`Copy to clipboard`,window.T_Copied_to_clipboard=`Copied to clipboard!`,window.T_Copy_link_to_clipboard=`Copy link to clipboard`,window.T_Link_copied_to_clipboard=`Copied link to clipboard!`,window.T_Reset_view=`Reset view`,window.T_View_reset=`View reset!`,window.T_No_results_found=`No results found for "{0}"`,window.T_N_results_found=`{1} results found for "{0}"`</script><link href=/cis400/css/custom.css?1719517089 rel=stylesheet></head><body class="mobile-support embed disableInlineCopyToClipboard" data-url=/cis400/3-web-development/04-apis/05-asynchronous-requests/embed.html><div id=R-body class=default-animation><div id=R-body-overlay></div><div id=R-main-overlay></div><main id=R-body-inner class="highlightable default" tabindex=-1><div class=flex-block-wrapper><article class=default><p>Now that we&rsquo;re more comfortable with <code>using</code> statements, let&rsquo;s return to our request-making code:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-csharp data-lang=csharp><span class=line><span class=cl><span class=n>WebRequest</span> <span class=n>request</span> <span class=p>=</span> <span class=n>WebRequest</span><span class=p>.</span><span class=n>Create</span><span class=p>(</span><span class=s>&#34;http://api.jokes.one/jod&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=k>using</span> <span class=nn>Stream</span> <span class=n>responseStream</span> <span class=p>=</span> <span class=n>response</span><span class=p>.</span><span class=n>GetStream</span><span class=p>()</span> 
</span></span><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=n>StreamReader</span> <span class=n>reader</span> <span class=p>=</span> <span class=k>new</span> <span class=n>StreamReader</span><span class=p>(</span><span class=n>responseStream</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=kt>string</span> <span class=n>responseText</span><span class=p>=</span> <span class=n>reader</span><span class=p>.</span><span class=n>ReadToEnd</span><span class=p>();</span>
</span></span><span class=line><span class=cl>  <span class=n>Console</span><span class=p>.</span><span class=n>WriteLine</span><span class=p>(</span><span class=n>responseText</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl><span class=n>response</span><span class=p>.</span><span class=n>Close</span><span class=p>();</span></span></span></code></pre></div><p>The <code>response.GetStream()</code> triggers the http request, which hits the API and returns its result. Remember a HTTP request is streamed across the internet, then processed by the server, and the response streamed back. That can take some time (at least to a computer). While the program waits on it to finish, it cannot do anything else. For some programs, like one that only displays jokes, this is fine. But what if our program needs to also be responding to the user&rsquo;s events - like typing or moving the mouse? While the program is waiting, it is effectively paused, and nothing the user does will cause the program to change.</p><h4 id=asynchronous-methods>Asynchronous Methods</h4><p>This is where asynchronous methods come in. An asynchronous method operates on a separate thread, allowing execution of the program to continue.</p><p>let&rsquo;s revisit our <code>WebRequest</code> example:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-csharp data-lang=csharp><span class=line><span class=cl><span class=n>WebRequest</span> <span class=n>request</span> <span class=p>=</span> <span class=n>WebRequest</span><span class=p>.</span><span class=n>Create</span><span class=p>(</span><span class=s>&#34;http://api.jokes.one/jod&#34;</span><span class=p>);</span></span></span></code></pre></div><p>We can then make the request <em>asynchronously</em> by calling the asynchronous version of <code>GetResponse()</code> - <code>GetResponseAsync()</code>:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-csharp data-lang=csharp><span class=line><span class=cl><span class=n>WebResponse</span> <span class=n>response</span> <span class=p>=</span> <span class=k>await</span> <span class=n>request</span><span class=p>.</span><span class=n>GetResponseAsync</span><span class=p>();</span></span></span></code></pre></div><p>The <code>await</code> keyword effectively pauses this thread of execution until the response is received. Effectively, the subsequent code is set aside to be processed when the asynchronous method finishes or encounters an error. This allows the main thread of the program to continue responding to user input and other events. The rest of the process is handled exactly as before:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-csharp data-lang=csharp><span class=line><span class=cl><span class=k>using</span> <span class=nn>Stream</span> <span class=n>responseStream</span> <span class=p>=</span> <span class=n>response</span><span class=p>.</span><span class=n>GetStream</span><span class=p>()</span> 
</span></span><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=n>StreamReader</span> <span class=n>reader</span> <span class=p>=</span> <span class=k>new</span> <span class=n>StreamReader</span><span class=p>(</span><span class=n>responseStream</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=kt>string</span> <span class=n>responseText</span><span class=p>=</span> <span class=n>reader</span><span class=p>.</span><span class=n>ReadToEnd</span><span class=p>();</span>
</span></span><span class=line><span class=cl>  <span class=n>Console</span><span class=p>.</span><span class=n>WriteLine</span><span class=p>(</span><span class=n>responseText</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=p>}</span></span></span></code></pre></div><h4 id=writing-asynchronous-methods>Writing Asynchronous Methods</h4><p>Normally we would wrap the asynchronous method calls within our own asynchronous method. Thus, we might define a method, <code>GetJoke()</code>:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-csharp data-lang=csharp><span class=line><span class=cl><span class=kd>public</span> <span class=kt>string</span> <span class=kd>async</span> <span class=n>GetJoke</span><span class=p>()</span>
</span></span><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=n>WebRequest</span> <span class=n>request</span> <span class=p>=</span> <span class=n>WebRequest</span><span class=p>.</span><span class=n>Create</span><span class=p>(</span><span class=s>&#34;http://api.jokes.one/jod&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=n>WebResponse</span> <span class=n>response</span> <span class=p>=</span> <span class=k>await</span> <span class=n>request</span><span class=p>.</span><span class=n>GetResponseAsync</span><span class=p>();</span>
</span></span><span class=line><span class=cl>  <span class=k>using</span> <span class=nn>Stream</span> <span class=n>responseStream</span> <span class=p>=</span> <span class=n>response</span><span class=p>.</span><span class=n>GetStream</span><span class=p>()</span> 
</span></span><span class=line><span class=cl>  <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=n>XmlDocument</span> <span class=n>xDoc</span> <span class=p>=</span> <span class=k>new</span> <span class=n>XmlDocument</span><span class=p>();</span>
</span></span><span class=line><span class=cl>    <span class=n>xDoc</span><span class=p>.</span><span class=n>Load</span><span class=p>(</span><span class=n>responseStream</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=kt>var</span> <span class=n>node</span> <span class=p>=</span> <span class=n>xDoc</span><span class=p>.</span><span class=n>SelectSingleNode</span><span class=p>(</span><span class=s>&#34;/response/contents/jokes/joke/text&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=n>node</span><span class=p>.</span><span class=n>InnerText</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl>  <span class=k>return</span> <span class=s>&#34;&#34;</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span></span></span></code></pre></div><h4 id=asynchronous-asp-requestresponse-methods>Asynchronous ASP Request/Response Methods</h4><p>ASP.Net includes built-in support for asynchronous request handling. You just need to add the <code>async</code> keyword to your <code>OnGet()</code> or <code>OnPost()</code> method, and the ASP.NET server will process it asynchronously.</p><p>For example, we could invoke our <code>GetJoke()</code> method in a <code>OnGet()</code>:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-csharp data-lang=csharp><span class=line><span class=cl><span class=kd>public</span> <span class=k>class</span> <span class=nc>JokeModel</span> <span class=p>:</span> <span class=n>PageModel</span> 
</span></span><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=kd>async</span> <span class=n>IActionResult</span> <span class=n>OnGet</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=kt>var</span> <span class=n>joke</span> <span class=p>=</span> <span class=k>await</span> <span class=n>GetJoke</span><span class=p>();</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=n>Content</span><span class=p>(</span><span class=n>joke</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span></span></span></code></pre></div><p>This will cause the text of the joke to be sent as the response, and allow other pages to be served while this one request is awaiting a response from the Joke API.</p><footer class=footline></footer></article></div></main></div><script src=/cis400/js/clipboard.min.js?1719517089 defer></script><script src=/cis400/js/perfect-scrollbar.min.js?1719517089 defer></script><script src=/cis400/js/theme.js?1719517089 defer></script><script src=/cis400/js/embed-iframe.js?1719517089 defer></script></body></html>