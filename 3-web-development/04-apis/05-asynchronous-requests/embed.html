




	
	
		

	
	
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		
		

	
	
		

	
	
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		
		

	
	
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		
		

	
	
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		
		

	
	
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		
		

	
	
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		
		

	
	
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		
		

	
	
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		
		
		

	
	
		

	
	
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		
		

	
	
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		
		

	
	
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		
		

	
	
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		
		

	
	
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		
		

	
	
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		
		
		

	
	
		

	
	
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		
		

	
	
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		
		

	
	
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		
		

	
	
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		
		

	
	
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		
		

	
	
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		
		
		

	
	
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		
		

	
	
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		
		

	
	
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		
		

	
	
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		
		

	
	
		

	
	
		
		

	
	
		
		
		
<!DOCTYPE html>
<html lang="en" dir="ltr">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="height=device-height, width=device-width, initial-scale=1.0, minimum-scale=1.0">
    <meta name="generator" content="Hugo 0.117.0">
    <meta name="generator" content="Relearn 5.18.0">
    <meta name="description" content="K-State CIS 400 Textbook">
    <meta name="author" content="Nathan Bean">
    <title>Asynchronous Requests :: K-State CIS 400 Textbook</title>
    <link href="https://ksu-cs-textbooks.github.io/cis400/3-web-development/04-apis/05-asynchronous-requests/index.html" rel="canonical" type="text/html" title="Asynchronous Requests :: K-State CIS 400 Textbook">
    <link href="https://ksu-cs-textbooks.github.io/cis400/3-web-development/04-apis/05-asynchronous-requests/index.xml" rel="alternate" type="application/rss+xml" title="Asynchronous Requests :: K-State CIS 400 Textbook">
    <link href="https://ksu-cs-textbooks.github.io/cis400/3-web-development/04-apis/05-asynchronous-requests/index.print.html" rel="alternate" type="text/html" title="Asynchronous Requests :: K-State CIS 400 Textbook">
    <link href="https://ksu-cs-textbooks.github.io/cis400/3-web-development/04-apis/05-asynchronous-requests/tele.html" rel="alternate" type="text/html" title="Asynchronous Requests :: K-State CIS 400 Textbook">
    
    <!-- https://github.com/filamentgroup/loadCSS/blob/master/README.md#how-to-use -->
    <link href="https://ksu-cs-textbooks.github.io/cis400/css/fontawesome-all.min.css?1709567168" rel="stylesheet" media="print" onload="this.media='all';this.onload=null;"><noscript><link href="https://ksu-cs-textbooks.github.io/cis400/css/fontawesome-all.min.css?1709567168" rel="stylesheet"></noscript>
    <link href="https://ksu-cs-textbooks.github.io/cis400/css/nucleus.css?1709567168" rel="stylesheet">
    <link href="https://ksu-cs-textbooks.github.io/cis400/css/auto-complete.css?1709567168" rel="stylesheet" media="print" onload="this.media='all';this.onload=null;"><noscript><link href="https://ksu-cs-textbooks.github.io/cis400/css/auto-complete.css?1709567168" rel="stylesheet"></noscript>
    <link href="https://ksu-cs-textbooks.github.io/cis400/css/perfect-scrollbar.min.css?1709567168" rel="stylesheet">
    <link href="https://ksu-cs-textbooks.github.io/cis400/css/fonts.css?1709567168" rel="stylesheet" media="print" onload="this.media='all';this.onload=null;"><noscript><link href="https://ksu-cs-textbooks.github.io/cis400/css/fonts.css?1709567168" rel="stylesheet"></noscript>
    <link href="https://ksu-cs-textbooks.github.io/cis400/css/theme.css?1709567168" rel="stylesheet">
    
    
    
    <link href="https://ksu-cs-textbooks.github.io/cis400/css/theme-light-theme.css?1709567168" rel="stylesheet" id="variant-style">
    <link href="https://ksu-cs-textbooks.github.io/cis400/css/variant.css?1709567168" rel="stylesheet">
    <link href="https://ksu-cs-textbooks.github.io/cis400/css/print.css?1709567168" rel="stylesheet" media="print">
    <link href="https://ksu-cs-textbooks.github.io/cis400/css/ie.css?1709567168" rel="stylesheet">
    <script src="https://ksu-cs-textbooks.github.io/cis400/js/url.js?1709567168"></script>
    
    
    
    <script>
      // hack to let hugo tell us how to get to the root when using relativeURLs, it needs to be called *url= for it to do its magic:
      // https://github.com/gohugoio/hugo/blob/145b3fcce35fbac25c7033c91c1b7ae6d1179da8/transform/urlreplacers/absurlreplacer.go#L72
      window.index_js_url="https://ksu-cs-textbooks.github.io/cis400/index.search.js";
      var root_url="https://ksu-cs-textbooks.github.io/cis400/";
      var baseUri=root_url.replace(/\/$/, '');
      // translations
      window.T_Copy_to_clipboard = 'Copy to clipboard';
      window.T_Copied_to_clipboard = 'Copied to clipboard!';
      window.T_Copy_link_to_clipboard = 'Copy link to clipboard';
      window.T_Link_copied_to_clipboard = 'Copied link to clipboard!';
      window.T_No_results_found = 'No results found for \u0022{0}\u0022';
      window.T_N_results_found = '{1} results found for \u0022{0}\u0022';
      // some further base stuff
      var baseUriFull='https:\/\/ksu-cs-textbooks.github.io\/cis400/';
      window.variants && variants.init( [ 'light-theme', 'dark-theme' ] );
    </script>
    
    <link href="https://ksu-cs-textbooks.github.io/cis400/css/custom.css?1709567168" rel="stylesheet">

    
  </head>
  <body class="mobile-support embed disableInlineCopyToClipboard" data-url="https://ksu-cs-textbooks.github.io/cis400/3-web-development/04-apis/05-asynchronous-requests/embed.html">
    <div id="body" class="default-animation">
      
      
      
      <main id="body-inner" class="highlightable default" tabindex="-1">
        <div class="flex-block-wrapper">
          <article class="default">
    
    
    
<p>Now that we&rsquo;re more comfortable with <code>using</code> statements, let&rsquo;s return to our request-making code:</p>
<div class="wrap-code highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-csharp" data-lang="csharp"><span style="display:flex;"><span>WebRequest request = WebRequest.Create(<span style="color:#e6db74">&#34;http://api.jokes.one/jod&#34;</span>);
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">using</span> Stream responseStream = response.GetStream() 
</span></span><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>  StreamReader reader = <span style="color:#66d9ef">new</span> StreamReader(responseStream);
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">string</span> responseText= reader.ReadToEnd();
</span></span><span style="display:flex;"><span>  Console.WriteLine(responseText);
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>response.Close();</span></span></code></pre></div><p>The <code>response.GetStream()</code> triggers the http request, which hits the API and returns its result.  Remember a HTTP request is streamed across the internet, then processed by the server, and the response streamed back.  That can take some time (at least to a computer).  While the program waits on it to finish, it cannot do anything else.  For some programs, like one that only displays jokes, this is fine. But what if our program needs to also be responding to the user&rsquo;s events - like typing or moving the mouse? While the program is waiting, it is effectively paused, and nothing the user does will cause the program to change.</p>
<h4 id="asynchronous-methods">Asynchronous Methods</h4>
<p>This is where asynchronous methods come in. An asynchronous method operates on a separate thread, allowing execution of the program to continue.</p>
<p>let&rsquo;s revisit our <code>WebRequest</code> example:</p>
<div class="wrap-code highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-csharp" data-lang="csharp"><span style="display:flex;"><span>WebRequest request = WebRequest.Create(<span style="color:#e6db74">&#34;http://api.jokes.one/jod&#34;</span>);</span></span></code></pre></div><p>We can then make the request <em>asynchronously</em> by calling the asynchronous version of <code>GetResponse()</code> - <code>GetResponseAsync()</code>:</p>
<div class="wrap-code highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-csharp" data-lang="csharp"><span style="display:flex;"><span>WebResponse response = <span style="color:#66d9ef">await</span> request.GetResponseAsync();</span></span></code></pre></div><p>The <code>await</code> keyword effectively pauses this thread of execution until the response is received.  Effectively, the subsequent code is set aside to be processed when the asynchronous method finishes or encounters an error.  This allows the main thread of the program to continue responding to user input and other events.  The rest of the process is handled exactly as before:</p>
<div class="wrap-code highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-csharp" data-lang="csharp"><span style="display:flex;"><span><span style="color:#66d9ef">using</span> Stream responseStream = response.GetStream() 
</span></span><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>  StreamReader reader = <span style="color:#66d9ef">new</span> StreamReader(responseStream);
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">string</span> responseText= reader.ReadToEnd();
</span></span><span style="display:flex;"><span>  Console.WriteLine(responseText);
</span></span><span style="display:flex;"><span>}</span></span></code></pre></div><h4 id="writing-asynchronous-methods">Writing Asynchronous Methods</h4>
<p>Normally we would wrap the asynchronous method calls within our own asynchronous method.  Thus, we might define a method, <code>GetJoke()</code>:</p>
<div class="wrap-code highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-csharp" data-lang="csharp"><span style="display:flex;"><span><span style="color:#66d9ef">public</span> <span style="color:#66d9ef">string</span> <span style="color:#66d9ef">async</span> GetJoke()
</span></span><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>  WebRequest request = WebRequest.Create(<span style="color:#e6db74">&#34;http://api.jokes.one/jod&#34;</span>);
</span></span><span style="display:flex;"><span>  WebResponse response = <span style="color:#66d9ef">await</span> request.GetResponseAsync();
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">using</span> Stream responseStream = response.GetStream() 
</span></span><span style="display:flex;"><span>  {
</span></span><span style="display:flex;"><span>    XmlDocument xDoc = <span style="color:#66d9ef">new</span> XmlDocument();
</span></span><span style="display:flex;"><span>    xDoc.Load(responseStream);
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">var</span> node = xDoc.SelectSingleNode(<span style="color:#e6db74">&#34;/response/contents/jokes/joke/text&#34;</span>);
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">return</span> node.InnerText;
</span></span><span style="display:flex;"><span>  }
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">return</span> <span style="color:#e6db74">&#34;&#34;</span>;
</span></span><span style="display:flex;"><span>}</span></span></code></pre></div><h4 id="asynchronous-asp-requestresponse-methods">Asynchronous ASP Request/Response Methods</h4>
<p>ASP.Net includes built-in support for asynchronous request handling.  You just need to add the <code>async</code> keyword to your <code>OnGet()</code> or <code>OnPost()</code> method, and the ASP.NET server will process it asynchronously.</p>
<p>For example, we could invoke our <code>GetJoke()</code> method in a <code>OnGet()</code>:</p>
<div class="wrap-code highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-csharp" data-lang="csharp"><span style="display:flex;"><span><span style="color:#66d9ef">public</span> <span style="color:#66d9ef">class</span> <span style="color:#a6e22e">JokeModel</span> : PageModel 
</span></span><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">async</span> IActionResult OnGet()
</span></span><span style="display:flex;"><span>    {
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">var</span> joke = <span style="color:#66d9ef">await</span> GetJoke();
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">return</span> Content(joke);
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>}</span></span></code></pre></div><p>This will cause the text of the joke to be sent as the response, and allow other pages to be served while this one request is awaiting a response from the Joke API.</p>

            <footer class="footline">

            </footer>
          </article>
        </div>
      </main>
    </div>
    
    
    
    <script src="https://ksu-cs-textbooks.github.io/cis400/js/clipboard.min.js?1709567170" defer></script>
    <script src="https://ksu-cs-textbooks.github.io/cis400/js/perfect-scrollbar.min.js?1709567170" defer></script>
    <script src="https://ksu-cs-textbooks.github.io/cis400/js/theme.js?1709567170" defer></script>
    
    <script src="https://ksu-cs-textbooks.github.io/cis400/js/embed-iframe.js?1709567170 defer"></script>
  </body>
</html>
