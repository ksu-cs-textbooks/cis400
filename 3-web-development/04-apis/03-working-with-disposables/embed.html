<!doctype html><html lang=en-us dir=ltr itemscope itemtype=http://schema.org/Article><head><meta charset=utf-8><meta name=viewport content="height=device-height,width=device-width,initial-scale=1,minimum-scale=1"><meta name=generator content="Hugo 0.128.0"><meta name=generator content="Relearn 6.0.0"><meta name=description content="In the previous section, we looked at a line of code that included the keyword using in a way you haven’t probably seen it before:
using Stream responseStream = response.GetStream() { // TODO: Use the responseStream }Let’s examine this statement in more detail. This use of using is a using statement, not to be confused with a using directive.
When you put a statement like using System.Text, you are using the using directive, which instructs the compiler to use types in the corresponding namespace without needing to provide the fully qualified namespace."><meta name=author content="Nathan Bean"><meta name=twitter:card content="summary"><meta name=twitter:title content="Working With Disposables :: K-State CIS 400 Textbook"><meta name=twitter:description content="In the previous section, we looked at a line of code that included the keyword using in a way you haven’t probably seen it before:
using Stream responseStream = response.GetStream() { // TODO: Use the responseStream }Let’s examine this statement in more detail. This use of using is a using statement, not to be confused with a using directive.
When you put a statement like using System.Text, you are using the using directive, which instructs the compiler to use types in the corresponding namespace without needing to provide the fully qualified namespace."><meta property="og:url" content="https://textbooks.cs.ksu.edu/cis400/3-web-development/04-apis/03-working-with-disposables/embed.html"><meta property="og:site_name" content="K-State CIS 400 Textbook"><meta property="og:title" content="Working With Disposables :: K-State CIS 400 Textbook"><meta property="og:description" content="In the previous section, we looked at a line of code that included the keyword using in a way you haven’t probably seen it before:
using Stream responseStream = response.GetStream() { // TODO: Use the responseStream }Let’s examine this statement in more detail. This use of using is a using statement, not to be confused with a using directive.
When you put a statement like using System.Text, you are using the using directive, which instructs the compiler to use types in the corresponding namespace without needing to provide the fully qualified namespace."><meta property="og:locale" content="en-us"><meta property="og:type" content="article"><meta property="article:section" content="Web Development"><meta property="article:published_time" content="2018-08-24T10:53:26-05:00"><meta property="article:modified_time" content="2021-11-29T10:41:36-06:00"><meta itemprop=name content="Working With Disposables :: K-State CIS 400 Textbook"><meta itemprop=description content="In the previous section, we looked at a line of code that included the keyword using in a way you haven’t probably seen it before:
using Stream responseStream = response.GetStream() { // TODO: Use the responseStream }Let’s examine this statement in more detail. This use of using is a using statement, not to be confused with a using directive.
When you put a statement like using System.Text, you are using the using directive, which instructs the compiler to use types in the corresponding namespace without needing to provide the fully qualified namespace."><meta itemprop=datePublished content="2018-08-24T10:53:26-05:00"><meta itemprop=dateModified content="2021-11-29T10:41:36-06:00"><meta itemprop=wordCount content="916"><title>Working With Disposables :: K-State CIS 400 Textbook</title>
<link href=https://textbooks.cs.ksu.edu/cis400/3-web-development/04-apis/03-working-with-disposables/ rel=canonical type=text/html title="Working With Disposables :: K-State CIS 400 Textbook"><link href=/cis400/3-web-development/04-apis/03-working-with-disposables/index.xml rel=alternate type=application/rss+xml title="Working With Disposables :: K-State CIS 400 Textbook"><link href=/cis400/3-web-development/04-apis/03-working-with-disposables/index.print.html rel=alternate type=text/html title="Working With Disposables :: K-State CIS 400 Textbook"><link href=/cis400/3-web-development/04-apis/03-working-with-disposables/tele.html rel=alternate type=text/html title="Working With Disposables :: K-State CIS 400 Textbook"><link href=/cis400/css/fontawesome-all.min.css?1724766094 rel=stylesheet media=print onload='this.media="all",this.onload=null'><noscript><link href=/cis400/css/fontawesome-all.min.css?1724766094 rel=stylesheet></noscript><link href=/cis400/css/nucleus.css?1724766094 rel=stylesheet><link href=/cis400/css/auto-complete.css?1724766094 rel=stylesheet media=print onload='this.media="all",this.onload=null'><noscript><link href=/cis400/css/auto-complete.css?1724766094 rel=stylesheet></noscript><link href=/cis400/css/perfect-scrollbar.min.css?1724766094 rel=stylesheet><link href=/cis400/css/fonts.css?1724766094 rel=stylesheet media=print onload='this.media="all",this.onload=null'><noscript><link href=/cis400/css/fonts.css?1724766094 rel=stylesheet></noscript><link href=/cis400/css/theme.css?1724766094 rel=stylesheet><link href=/cis400/css/theme-light-theme.css?1724766094 rel=stylesheet id=R-variant-style><link href=/cis400/css/chroma-relearn-light.css?1724766094 rel=stylesheet id=R-variant-chroma-style><link href=/cis400/css/variant.css?1724766094 rel=stylesheet><link href=/cis400/css/print.css?1724766094 rel=stylesheet media=print><script>window.relearn=window.relearn||{},window.relearn.relBasePath="../../..",window.relearn.relBaseUri="../../../..",window.relearn.absBaseUri="https://textbooks.cs.ksu.edu/cis400",window.index_js_url="/cis400/index.search.js",window.variants&&variants.init(["light-theme"]),window.T_Copy_to_clipboard=`Copy to clipboard`,window.T_Copied_to_clipboard=`Copied to clipboard!`,window.T_Copy_link_to_clipboard=`Copy link to clipboard`,window.T_Link_copied_to_clipboard=`Copied link to clipboard!`,window.T_Reset_view=`Reset view`,window.T_View_reset=`View reset!`,window.T_No_results_found=`No results found for "{0}"`,window.T_N_results_found=`{1} results found for "{0}"`</script><link href=/cis400/css/custom.css?1724766094 rel=stylesheet></head><body class="mobile-support embed disableInlineCopyToClipboard" data-url=/cis400/3-web-development/04-apis/03-working-with-disposables/embed.html><div id=R-body class=default-animation><div id=R-body-overlay></div><div id=R-main-overlay></div><main id=R-body-inner class="highlightable default" tabindex=-1><div class=flex-block-wrapper><article class=default><p>In the previous section, we looked at a line of code that included the keyword <code>using</code> in a way you haven&rsquo;t probably seen it before:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-csharp data-lang=csharp><span class=line><span class=cl><span class=k>using</span> <span class=nn>Stream</span> <span class=n>responseStream</span> <span class=p>=</span> <span class=n>response</span><span class=p>.</span><span class=n>GetStream</span><span class=p>()</span> 
</span></span><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=c1>// TODO: Use the responseStream</span>
</span></span><span class=line><span class=cl><span class=p>}</span></span></span></code></pre></div><p>Let&rsquo;s examine this statement in more detail. This use of <code>using</code> is a <a href=https://docs.microsoft.com/en-us/dotnet/csharp/language-reference/keywords/using-statement rel=external target=_blank>using statement</a>, not to be confused with a <a href=https://docs.microsoft.com/en-us/dotnet/csharp/language-reference/keywords/using-directive rel=external target=_blank>using directive</a>.</p><p>When you put a statement like <code>using System.Text</code>, you are using the <em>using directive</em>, which instructs the compiler to use types in the corresponding namespace without needing to provide the fully qualified namespace. You&rsquo;ve been using this technique for some time, so it should be familiar to you.</p><p>In contrast, the <em>using statement</em> is used in the body of your code in conjunction with an object implementing the <code>IDisposable</code> interface. Objects that implement this interface have a <code>Dispose()</code> method, which needs to be called when you are done with them. These kinds of objects typically access some resource from outside of the program, which needs to be released when you are done with it.</p><h4 id=managed-vs-unmanaged-resources>Managed vs. Unmanaged Resources</h4><p>To understand this better, let&rsquo;s talk about <em>managed</em> vs. <em>unmanaged</em> resources. We say a resource is <em>managed</em> when obtaining and releasing it is handled by the language. Memory is a great example of this. In C#, we are using <em>managed memory</em>. When we invoke a constructor or declare an array, the interpreter automatically creates the memory we need to hold them.</p><p>In contrast, C uses <em>unmanaged memory</em>. When we want to create an array, we must <em>allocate</em> that memory with <code>alloc()</code>, <code>calloc()</code>, or <code>malloc()</code> function call.</p><p>This might not seem very different, until we are done with the array. In C#, we can simply let it fall out of scope, knowing the garbage collector should eventually free that memory. But in a C program, we must manually free the memory with a call to <code>free()</code>.</p><p>Sometimes in C#, we need to access some resource in a way that is unmanaged - in which case, we must be sure to free the resource when we are done with it.</p><h4 id=idisposable>IDisposable</h4><p>The <code>IDisposable()</code> interface provides a standard way of handling this kind of situation. It requires any class implementing it to define a <code>Dispose()</code> method that frees any unmanaged resources. A <em>stream</em> (the data being read in from a file, the network, or a terminal) is a good example of an unmanaged resource - the stream is actually created by the operating system, and the <code>Stream</code> object (a <code>FileStream</code>, <code>BufferedStream</code>, etc) is a C# object providing access to it.</p><p>Let&rsquo;s focus on a <code>FileStream</code> for a moment. One is created every time you ask the operating system to open a file, i.e.:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-csharp data-lang=csharp><span class=line><span class=cl><span class=n>FileStream</span> <span class=n>fs</span> <span class=p>=</span> <span class=n>File</span><span class=p>.</span><span class=n>OpenRead</span><span class=p>(</span><span class=s>&#34;somefile.txt&#34;</span><span class=p>);</span></span></span></code></pre></div><p>The <code>File.OpenRead()</code> method asks the operating system to provide a stream to the file named <code>"somefile.txt"</code>. We can then read that stream until we reach the end of file marker (indicating we&rsquo;ve read the entire file):</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-csharp data-lang=csharp><span class=line><span class=cl><span class=kt>byte</span> <span class=n>data</span> <span class=p>=</span> <span class=n>fs</span><span class=p>.</span><span class=n>ReadByte</span><span class=p>();</span>
</span></span><span class=line><span class=cl><span class=c1>// Invariant: while there are bytes in the file to read</span>
</span></span><span class=line><span class=cl><span class=k>while</span><span class=p>(</span><span class=n>data</span> <span class=p>!=</span> <span class=p>-</span><span class=m>1</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=c1>// Write the current byte to the console</span>
</span></span><span class=line><span class=cl>  <span class=n>System</span><span class=p>.</span><span class=n>Out</span><span class=p>.</span><span class=n>Write</span><span class=p>(</span><span class=n>data</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=c1>// Read the next byte</span>
</span></span><span class=line><span class=cl>  <span class=n>data</span> <span class=p>=</span> <span class=n>fs</span><span class=p>.</span><span class=n>ReadByte</span><span class=p>();</span>
</span></span><span class=line><span class=cl><span class=p>}</span></span></span></code></pre></div><p>Once we&rsquo;ve finished reading the file, we need to call <code>Dispose()</code> on the stream to tell the operating system that we&rsquo;re done with it:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-csharp data-lang=csharp><span class=line><span class=cl><span class=n>fs</span><span class=p>.</span><span class=n>Dispose</span><span class=p>();</span></span></span></code></pre></div><p>If we don&rsquo;t, then the operating system will assume we&rsquo;re still working with the file, and refuse to let any other program read it. Including our own program, if we were to run it again.</p><p>But what happens if an error occurs while reading the file? We&rsquo;ll never reach the call to <code>Dispose()</code>, so we&rsquo;ll <em>never free the file</em>! In order to access it, we&rsquo;d have to restart the computer. Not great.</p><p>We <em>could</em> manage this with a <code>try/catch/finally</code>, i.e.:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-csharp data-lang=csharp><span class=line><span class=cl><span class=k>try</span> 
</span></span><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=n>FileStream</span> <span class=n>fs</span> <span class=p>=</span> <span class=n>File</span><span class=p>.</span><span class=n>OpenRead</span><span class=p>(</span><span class=s>&#34;somefile.txt&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=kt>byte</span> <span class=n>data</span> <span class=p>=</span> <span class=n>fs</span><span class=p>.</span><span class=n>ReadByte</span><span class=p>();</span>
</span></span><span class=line><span class=cl>  <span class=c1>// Invariant: while there are bytes in the file to read</span>
</span></span><span class=line><span class=cl>  <span class=k>while</span><span class=p>(</span><span class=n>data</span> <span class=p>!=</span> <span class=p>-</span><span class=m>1</span><span class=p>)</span>
</span></span><span class=line><span class=cl>  <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=c1>// Write the current byte to the console</span>
</span></span><span class=line><span class=cl>    <span class=n>System</span><span class=p>.</span><span class=n>Out</span><span class=p>.</span><span class=n>Write</span><span class=p>(</span><span class=n>data</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=c1>// Read the next byte</span>
</span></span><span class=line><span class=cl>    <span class=n>data</span> <span class=p>=</span> <span class=n>fs</span><span class=p>.</span><span class=n>ReadByte</span><span class=p>();</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl>  <span class=n>fs</span><span class=p>.</span><span class=n>Dispose</span><span class=p>();</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl><span class=k>catch</span><span class=p>(</span><span class=n>Exception</span> <span class=n>e</span><span class=p>)</span> 
</span></span><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=c1>// Do something with e</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl><span class=k>finally</span>
</span></span><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=n>fs</span><span class=p>.</span><span class=n>Dispose</span><span class=p>();</span>
</span></span><span class=line><span class=cl><span class=p>}</span></span></span></code></pre></div><p>But you have to catch all exceptions.</p><h4 id=using-statement>Using Statement</h4><p>A using statement operates similarly, but takes far less typing:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-csharp data-lang=csharp><span class=line><span class=cl><span class=k>using</span> <span class=nn>FileStream</span> <span class=n>fs</span> <span class=p>=</span> <span class=n>File</span><span class=p>.</span><span class=n>OpenRead</span><span class=p>(</span><span class=s>&#34;somefile.txt&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=kt>byte</span> <span class=n>data</span> <span class=p>=</span> <span class=n>fs</span><span class=p>.</span><span class=n>ReadByte</span><span class=p>();</span>
</span></span><span class=line><span class=cl>  <span class=c1>// Invariant: while there are bytes in the file to read</span>
</span></span><span class=line><span class=cl>  <span class=k>while</span><span class=p>(</span><span class=n>data</span> <span class=p>!=</span> <span class=p>-</span><span class=m>1</span><span class=p>)</span>
</span></span><span class=line><span class=cl>  <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=c1>// Write the current byte to the console</span>
</span></span><span class=line><span class=cl>    <span class=n>System</span><span class=p>.</span><span class=n>Out</span><span class=p>.</span><span class=n>Write</span><span class=p>(</span><span class=n>data</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=c1>// Read the next byte</span>
</span></span><span class=line><span class=cl>    <span class=n>data</span> <span class=p>=</span> <span class=n>fs</span><span class=p>.</span><span class=n>ReadByte</span><span class=p>();</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span></span></span></code></pre></div><p>It also comes with some benefits. One, it creates a new scope (within the <code>{}</code> following the using statement). If for some reason the stream can&rsquo;t be opened, this scope is skipped over. Similarly it jumps execution to the end of the scope if an error occurs. Finally, it <em>automatically</em> calls <code>Dispose()</code> when the scope ends.</p><h4 id=syntax-shorthand>Syntax Shorthand</h4><p>As of C# 8.0, a shorthand for the using statement that omits the scope markers (the <code>{}</code>) is available. In this case, the scope is from the start of the <code>using</code> statement to the end of its containing scope (usually a method):</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-csharp data-lang=csharp><span class=line><span class=cl><span class=k>using</span> <span class=nn>FileStream</span> <span class=n>fs</span> <span class=p>=</span> <span class=n>File</span><span class=p>.</span><span class=n>OpenRead</span><span class=p>(</span><span class=s>&#34;somefile.txt&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=kt>byte</span> <span class=n>data</span> <span class=p>=</span> <span class=n>fs</span><span class=p>.</span><span class=n>ReadByte</span><span class=p>();</span>
</span></span><span class=line><span class=cl><span class=c1>// Invariant: while there are bytes in the file to read</span>
</span></span><span class=line><span class=cl><span class=k>while</span><span class=p>(</span><span class=n>data</span> <span class=p>!=</span> <span class=p>-</span><span class=m>1</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=c1>// Write the current byte to the console</span>
</span></span><span class=line><span class=cl>  <span class=n>System</span><span class=p>.</span><span class=n>Out</span><span class=p>.</span><span class=n>Write</span><span class=p>(</span><span class=n>data</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=c1>// Read the next byte</span>
</span></span><span class=line><span class=cl>  <span class=n>data</span> <span class=p>=</span> <span class=n>fs</span><span class=p>.</span><span class=n>ReadByte</span><span class=p>();</span>
</span></span><span class=line><span class=cl><span class=p>}</span></span></span></code></pre></div><p>This format can be nice when you need to nest multiple <code>using</code> statements, but I would suggest sticking with the scoped version until you are comfortable with the concepts involved.</p><footer class=footline></footer></article></div></main></div><script src=/cis400/js/clipboard.min.js?1724766094 defer></script><script src=/cis400/js/perfect-scrollbar.min.js?1724766094 defer></script><script src=/cis400/js/theme.js?1724766094 defer></script><script src=/cis400/js/embed-iframe.js?1724766094 defer></script></body></html>